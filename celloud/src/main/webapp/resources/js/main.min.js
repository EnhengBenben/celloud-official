var utils={};!function($){$.extend({format:function(str,step,splitor){str=str.toString();var len=str.length;if(len>step){var l1=len%step,l2=parseInt(len/step),arr=[],first=str.substr(0,l1);""!=first&&arr.push(first);for(var i=0;i<l2;i++)arr.push(str.substr(l1+i*step,step));str=arr.join(splitor)}return str}})}(jQuery),utils._stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},utils.formatDate=function(size){var ss=parseInt(size);if(0===ss)return"00:00:00";if(/\D/.test(ss))return"N/A";ss=parseInt(size);var radix=60,mm=0,hh=0;return ss>radix&&(mm=parseInt(ss/radix),ss=parseInt(ss%radix),mm>radix&&(hh=parseInt(mm/radix),mm=parseInt(mm%radix))),hh>0&&hh<10?result="0"+parseInt(hh):hh>=10?result=parseInt(hh):hh<=0&&(result="00"),result+=":",mm>0&&mm<10?result+="0"+parseInt(mm):mm>=10?result+=parseInt(mm):mm<=0&&(result+="00"),result+=":",ss>0&&ss<10?result+="0"+parseInt(ss):ss>=10?result+=parseInt(ss):ss<=0&&(result+="00"),result},utils.getExt=function(fileName){var result=/\.[^\.]+/.exec(fileName);return result},utils.isConfigure=function(fileName){return".txt"==utils.getExt(fileName)||".lis"==utils.getExt(fileName)},utils.setDocSize=function(){var winWidth=$(window).width(),docWidth=$(document).width(),winHeight=$(window).height(),docHeight=$(document).height();winWidth>=docWidth?($(".bgContainer").width(winWidth),$(".longbackground").width(winWidth),$("#bg").width(winWidth)):($(".bgContainer").width(docWidth),$(".longbackground").width(docWidth),$("#bg").width(docWidth)),winHeight>=docHeight?($(".bgContainer").height(winHeight),$(".longbackground").height(winHeight),$("#bg").height(winHeight)):($(".bgContainer").height(docHeight),$(".longbackground").height(docHeight),$("#bg").height(docHeight)),$(".bgContainer").css("overflow","hidden")},utils.checkPlaceholder=function(){var input=document.createElement("input"),isPlaceholder="placeholder"in input;isPlaceholder||$(document).ready(function(){if(!isPlaceholder){$("input").not("input[type='password']").each(function(){""==$(this).val()&&""!=$(this).attr("placeholder")&&($(this).val($(this).attr("placeholder")),$(this).addClass("placeholder"),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")}),$(this).blur(function(){""==$(this).val()&&$(this).val($(this).attr("placeholder"))}))});var pwdField=$("input[type=password]"),pwdVal=pwdField.attr("placeholder");pwdField.after('<input id="pwdPlaceholder" type="text" class="pwd" value='+pwdVal+' autocomplete="off" />');var pwdPlaceholder=$("#pwdPlaceholder");pwdField.val()?(pwdPlaceholder.hide(),pwdField.show()):(pwdPlaceholder.show(),pwdField.hide()),pwdPlaceholder.focus(function(){pwdPlaceholder.hide(),pwdField.show(),pwdField.focus()}),pwdField.blur(function(){""==pwdField.val()&&(pwdPlaceholder.show(),pwdField.hide())})}})},utils.splitDataByInfo=function(data,splitStr,number){var reStr="(.{"+number+"}|.*)",reg=new RegExp(reStr,"g"),dataArray=data.match(reg);dataArray.pop();for(var i=(dataArray.length+1,0);i<dataArray.length;i+=2)dataArray.splice(i+1,0,splitStr);dataArray.pop();var str=dataArray.join("");return str},utils.loadBaiduTongji=function(){var host=window.location.host;if(host.indexOf("www.celloud.cn")>=0){!function(){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?f6b04d06932c0fc1578e79be222599f4",hm.async="async",hm.defer="defer";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)}()}},utils.loadBaiduTongji(),utils.setDocSize(),$(window).resize(function(){utils.setDocSize()}),utils.stopBubble=function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0};
function drawScatter(id,totaldata,thisdata,title,xAxisName,yAxisName){require(["echarts","echarts/chart/scatter"],function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);option={title:{text:title,subtext:"结果来自: CelLoud全部数据",y:0},grid:{y:60},tooltip:{trigger:"axis",showDelay:0,formatter:function(params){return params.value.length>1?params.seriesName+" :<br/>"+params.value[0]+" "+params.value[1]+" ":params.seriesName+" :<br/>"+params.name+" : "+params.value+" "},axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},legend:{data:["全部数据","当前数据"]},toolbox:{show:!0,feature:{dataZoom:{show:!0},restore:{show:!0}}},xAxis:[{type:"value",name:xAxisName,scale:!0,axisLabel:{formatter:"{value} "}}],yAxis:[{type:"value",name:yAxisName,scale:!0,axisLabel:{formatter:"{value} "}}],series:[{name:"全部数据",type:"scatter",data:totaldata,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{name:"当前数据",type:"scatter",data:thisdata,symbol:"star",symbolSize:10,markPoint:{data:[{type:"average",name:"当前数据平均值"}]}}]},myChart.setOption(option,!0)})}$.reportChar={},$.reportChar.draw={_require:function(chartName,option,id){require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}}),require(["echarts","echarts/chart/"+chartName],function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);myChart.setOption(option,!0)})},_requireMulti:function(chartName,option,id){require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}});var chartArr=new Array;chartArr.push("echarts");for(var i=0;i<chartName.length;i++)chartArr.push("echarts/chart/"+chartName[i]);require(chartArr,function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);myChart.setOption(option,!0)})},circularGraphDataOptions:{dataStyle:{normal:{label:{show:!1},labelLine:{show:!1}}},placeHolderStyle:{normal:{color:"rgba(0,0,0,0)",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"rgba(0,0,0,0)"}},legendData:null,seriesData:null},circularGraph:function(id,title,subTitle,data){$.reportChar.circularGraphSeriesData(data),option={title:{text:title,subtext:subTitle,sublink:"",x:"center",y:"center",itemGap:5,textStyle:{color:"rgba(30,144,255,0.8)",fontFamily:"微软雅黑",fontSize:16,fontWeight:"bolder"}},tooltip:{show:!0,formatter:"{b}"},legend:{orient:"vertical",x:$("#"+id).width()/2-10,y:30,itemGap:6,data:$.reportChar.draw.circularGraphDataOptions.legendData},series:$.reportChar.draw.circularGraphDataOptions.seriesData},$.reportChar.draw._require("pie",option,id)},echartsShowPie:function(id,title,data){var option={title:{text:title,x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{type:"pie",radius:"55%",center:["50%","60%"],data:data,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};$.reportChar.draw._require("pie",option,id)},echartsShowBar:function(id,title,X,Y,rotate,width,height){var option={tooltip:{trigger:"axis"},legend:{data:[title],top:15},calculable:!0,xAxis:[{type:"category",data:X,position:"bottom",axisLabel:{rotate:rotate}}],yAxis:[{type:"value",name:"样本数量"}],series:[{name:title,type:"bar",data:Y,barWidth:20}],color:["#feabac"],grid:{width:width,height:height}};$.reportChar.draw._require("bar",option,id)},echartsShowHorizontalBar:function(id,title,X,Y,width,height,xname){var option={tooltip:{trigger:"axis"},calculable:!0,xAxis:[{type:"value",name:xname}],yAxis:[{type:"category",data:Y}],series:[{name:title,type:"bar",data:X,barWidth:20}],color:["#feabac"],grid:{width:width}};$.reportChar.draw._require("bar",option,id)},echartsShowHBVType:function(id,appId,hbvType,currentType,rotate){subtext="",genDat="",seriesName="",82==appId?(subtext="数据来源:CelLoud全部HBV数据",genDat="HBV基因型",seriesName="HBV基因型"):(subtext="数据来源:CelLoud全部Sanger数据",genDat="Sanger基因型",seriesName="Sanger基因型");var option={title:{text:"基因型分类总览表",subtext:subtext,x:"center"},tooltip:{trigger:"axis"},legend:{data:[genDat,"当前数据基因型"],y:340},calculable:!0,xAxis:[{type:"category",data:["A","B","C","D","E","F","G","H","比对失败","异常数据"],position:"bottom",axisLabel:{rotate:rotate}}],yAxis:[{type:"value",name:"基因型数量(个)"}],series:[{name:seriesName,type:"bar",data:eval(hbvType),barWidth:30},{name:"当前数据基因型",type:"scatter",data:eval(currentType),barWidth:30,symbol:"triangle"}],grid:{width:750,height:250},color:["#00cccc","#ff0000"]};$.reportChar.draw._requireMulti(["scatter","bar"],option,id)},singleBar:function(id,title,subTitle,data,yAxisName,seriesName){for(var zrColor=require("zrender/tool/color"),_xariaData=new Array,_seriesData=new Array,i=0;i<data.length;i++){var key=data[i][0],value=data[i][1],num_value=""!=value?parseInt(value):0;_xariaData.push(key),_seriesData.push(num_value)}option={title:{x:"center",text:title,subtext:"",textStyle:{color:"rgba(30,144,255,0.8)",fontFamily:"微软雅黑",fontSize:16,fontWeight:"bolder"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},calculable:!0,xAxis:[{type:"category",axisLabel:{rotate:10,margin:3,interval:0,textStyle:{align:"right"}},data:_xariaData}],yAxis:[{type:"value",name:yAxisName}],series:[{name:seriesName,type:"bar",itemStyle:{normal:{color:function(params){return zrColor.lift("#87cefa",.02*params.dataIndex)},label:{show:!0,position:"top",formatter:"{c}"}}},data:_seriesData}]},$.reportChar.draw._require("bar",option,id)},echartsShowScatter:function(id,title,multi,single){var option={title:{text:title,x:"center"},grid:{width:220},tooltip:{trigger:"item",axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},legend:{data:["All data","This one"],x:300,y:180},xAxis:[{type:"value",scale:!0,min:0,max:2,splitNumber:2,name:"序号",nameLocation:"middle",nameGap:20,splitLine:{show:!1}}],yAxis:[{type:"value",scale:!0,axisLabel:{formatter:"{value}"},name:"值"}],series:[{name:"All data",type:"scatter",data:multi},{name:"This one",type:"scatter",data:single}]};$.reportChar.draw._require("scatter",option,id)}},$.reportChar.circularGraphSeriesData=function(list){var o=$.reportChar.draw.circularGraphDataOptions;o.legendData=new Array,o.seriesData=new Array;for(var radius_inner=120,radius_outer=140,i=0;i<list.length;i++){var _key=list[i][0],_value=list[i][1],num_value=""!=_value?parseInt(_value):0,data_name=_value+"% "+_key;o.legendData.push(data_name),o.seriesData.push({name:_key,type:"pie",clockWise:!1,radius:[radius_inner,radius_outer],center:["45%","50%"],itemStyle:o.dataStyle,data:[{value:num_value,name:data_name},{value:100-num_value,name:data_name,tooltip:null,itemStyle:o.placeHolderStyle}]}),radius_inner>0&&(radius_inner-=20,radius_outer-=20)}};var macarons_theme={color:["#2ec7c9","#9a7fd1","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#b6a2de","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],title:{textStyle:{fontWeight:"normal",color:"#008acd"}},dataRange:{itemWidth:15,color:["#5ab1ef","#e0ffff"]},toolbox:{color:["#1e90ff","#1e90ff","#1e90ff","#1e90ff"],effectiveColor:"#ff4500"},tooltip:{backgroundColor:"rgba(50,50,50,0.5)",axisPointer:{type:"line",lineStyle:{color:"#008acd"},crossStyle:{color:"#008acd"},shadowStyle:{color:"rgba(200,200,200,0.2)"}}},dataZoom:{dataBackgroundColor:"#efefff",fillerColor:"rgba(154,127,209,0.2)",handleColor:"#008acd"},grid:{borderColor:"#eee"},categoryAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},polar:{axisLine:{lineStyle:{color:"#ddd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}},splitLine:{lineStyle:{color:"#ddd"}}},timeline:{lineStyle:{color:"#008acd"},controlStyle:{normal:{color:"#008acd"},emphasis:{color:"#008acd"}},symbol:"emptyCircle",symbolSize:3},bar:{itemStyle:{normal:{barBorderRadius:5},emphasis:{barBorderRadius:5}}},line:{smooth:!0,symbol:"emptyCircle",symbolSize:3},k:{itemStyle:{normal:{color:"#d87a80",color0:"#2ec7c9",lineStyle:{color:"#d87a80",color0:"#2ec7c9"}}}},scatter:{symbol:"circle",symbolSize:4},radar:{symbol:"emptyCircle",symbolSize:3},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#d87a80"}}},emphasis:{areaStyle:{color:"#fe994e"}}}},force:{itemStyle:{normal:{linkStyle:{color:"#1e90ff"}}}},chord:{itemStyle:{normal:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{axisLine:{lineStyle:{color:[[.2,"#2ec7c9"],[.8,"#5ab1ef"],[1,"#d87a80"]],width:10}},axisTick:{splitNumber:10,length:15,lineStyle:{color:"auto"}},splitLine:{length:22,lineStyle:{color:"auto"}},pointer:{width:5}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}};
var map={};map.TTT="F",map.TCT="S",map.TAT="Y",map.TGT="C",map.TTC="F",map.TCC="S",map.TAC="Y",map.TGC="C",map.TTA="L",map.TCA="S",map.TAA="",map.TGA="",map.TTG="L",map.TCG="S",map.TAG="",map.TGG="W",map.CTT="L",map.CCT="P",map.CAT="H",map.CGT="R",map.CTC="L",map.CCC="P",map.CAC="H",map.CGC="R",map.CTA="L",map.CCA="P",map.CAA="Q",map.CGA="R",map.CTG="L",map.CCG="P",map.CAG="Q",map.CGG="R",map.ATT="I",map.ACT="T",map.AAT="N",map.AGT="S",map.ATC="I",map.ACC="T",map.AAC="N",map.AGC="S",map.ATA="I",map.ACA="T",map.AAA="K",map.AGA="R",map.ATG="M",map.ACG="T",map.AAG="K",map.AGG="R",map.GTT="V",map.GCT="A",map.GAT="D",map.GGT="G",map.GTC="V",map.GCC="A",map.GAC="D",map.GGC="G",map.GTA="V",map.GCA="A",map.GAA="E",map.GGA="G",map.GTG="V",map.GCG="A",map.GAG="E",map.GGG="G";
var messageUtils=function(messageUtils){function bindEvents(){self.ws.onopen=function(){console.log("websocket connect is opened : "+new Date),clearTimeouts();for(var listener in self.openListeners)$.isFunction(self.openListeners[listener])&&self.openListeners[listener]()},self.ws.onmessage=function(e){var message=JSON.parse(e.data),channels=self.messageChannels[message.channel]||[];if(channels.length<=0)return void console.log("no listener for channel: "+message.channel);for(var channel in channels)$.isFunction(channels[channel])&&channels[channel](message.message)},self.ws.onclose=function(){console.log("websocket connect is closed : "+new Date);for(var listener in self.closeListeners)$.isFunction(self.closeListeners[listener])&&self.closeListeners[listener]()},self.ws.onerror=function(event){console.log("websocket error : "+new Date),console.log(event),console.log(event.data)}}function clearTimeouts(){for(var t in self.timeouts)clearTimeout(self.timeouts[t]);self.timeouts=[]}var self=messageUtils||{};self.messageChannels={listenerNumbers:0},self.openListeners={listenerNumbers:0},self.closeListeners={listenerNumbers:0},self.timeouts={},self.addOpenListener=function(listener){self.openListeners[self.openListeners.listenerNumbers]=listener,self.openListeners.listenerNumbers=self.openListeners.listenerNumbers+1},self.addCloseListener=function(listener){self.closeListeners[self.closeListeners.listenerNumbers]=listener,self.closeListeners.listenerNumbers=self.closeListeners.listenerNumbers+1},self.subscribe=function(channel,callback){var channels=self.messageChannels[channel]||{listenerNumbers:0};$.isFunction(callback)&&(channels[channels.listenerNumbers]=callback,channels.listenerNumbers=channels.listenerNumbers+1,self.messageChannels[channel]=channels)};var openWebSocket=function(){var contextPath=window.CONTEXT_PATH||window.contextPath||"",protocol="https:"==window.location.protocol?"wss://":"ws://",hostname=window.location.hostname,port=window.location.port?":"+window.location.port:"",wsUrl=protocol+hostname+port+contextPath+"/websocket/message",ws=null;return ws="WebSocket"in window?new WebSocket(wsUrl):window.MozWebSocket?new MozWebSocket(wsUrl):new SockJS(contextPath+"/sockjs/message")};self.ws=openWebSocket(),bindEvents();var createNotification=function(title,message,options){var defaultOptions={icon:CONTEXT_PATH+"/images/icon/portrait.png"};return options=$.extend({},defaultOptions,options),options.body=message,new Notification(title,options)};return self.notify=function(title,message,options,events){if(!("Notification"in window))return void console.log("This browser does not support desktop notification");var notification=null;if("granted"===Notification.permission?notification=createNotification(title,message,options):"default"===Notification.permission&&Notification.requestPermission(function(permission){"granted"===permission&&(notification=createNotification(title,message,options))}),null!=notification){var defaultEvents={onclick:function(){notification.close()}};events=$.extend({},defaultEvents,events),$.isFunction(events.onclick)&&(notification.onclick=events.onclick)}},self}(messageUtils);messageUtils.addOpenListener(function(){}),messageUtils.addCloseListener(function(){}),messageUtils.subscribe("userMessage",function(data){console.log("消息来了!")});
!function($){var defaults={delay:3e3},messages=[],showNext=function(){$("#alerts").children().length<5&&messages.length>0&&show(messages.shift())},show=function(message){message.msg=message.msg||"";var $alert=$('<div class="alert message-alert alert-dismissible fade in" role="alert"><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><span>'+message.msg+"</span></div>");$alert.addClass("alert-"+message.type),$alert.on("closed.bs.alert",function(){close($alert)}),$("#alerts").append($alert),setTimeout(function(){close($alert)},message.delay||defaults.delay)},close=function($alert){$alert.remove(),showNext()},push=function(msg,type,delay){messages.push({msg:msg,type:type,delay:delay}),showNext()};$.extend({success:function(msg,delay){push(msg,"success",delay)},info:function(msg,delay){push(msg,"info",delay)},warn:function(msg,delay){push(msg,"warning",delay)},danger:function(msg,delay){push(msg,"danger",delay)},alert:function(msg,delay){push(msg,"success",delay)}})}(jQuery);
!function($){var show=function(type,title,message,callback){$("#confirm-modal-div").html()?$("#confirm-modal-div").html(""):$("BODY").append('<div id="confirm-modal-div"></div>');var $alert=$('<div id="confirm-modal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" role="alert"></div>');$alert.addClass(type+"-modal");var $dialog=$('<div class="modal-dialog modal-sm"></div>'),$content=$('<div class="modal-content"></div>'),$header=$('<div class="modal-header"><button type="button" class="close" aria-label="Close" id="close-confirm"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><h4 class="modal-title">'+title+"</h4></div>"),$body=$('<div class="modal-body"></div>'),$h5=$("<h5></h5>"),$footer=$('<div class="modal-footer"><button type="reset" class="btn btn-cancel -low pull-left" data-dismiss="modal" id="confirm-cancle">取消</button><button type="submit" class="btn -low pull-right" id="confirm-ok">确定</button></div>');switch($h5.append($('<i class="fa fa-exclamation-circle" aria-hidden="true"></i>')),$h5.append($("<span>"+message+"</span>")),$body.append($h5),$content.append($header),$content.append($body),type){case"confirm":$content.append($footer),$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert),$("#confirm-ok").click(function(){hide(),callback()}),$("#confirm-cancle").click(function(){hide()});break;case"tips":$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert)}$("#close-confirm").click(function(){hide()})},hide=function(){$("#confirm-modal").modal("hide")},confirm=function(message,title,callback){null==title&&(title="确认框"),show("confirm",title,message,function(result){callback&&callback(result)})},tips=function(message,title){null==title&&(title="提示框"),show("tips",title,message,null)};$.extend({confirm:function(message,title,callback){confirm(message,title,callback)},tips:function(message,title){tips(message,title)}})}(jQuery);
!function(){window.celloudApp=angular.module("celloudApp",["ngRoute","ngResource","ngSanitize"])}();
!function(){celloudApp.directive("diHref",["$location","$route",function($location,$route){return function(scope,element,attrs){scope.$watch("diHref",function(){attrs.diHref&&(element.attr("href",attrs.diHref),element.bind("click",function(event){scope.$apply(function(){$location.path()==attrs.diHref.substr(attrs.diHref.indexOf("#/")+1)&&$route.reload()})}))})}}])}();
!function(){celloudApp.directive("pagination",function(){return{restrict:"E",replace:!0,scope:{page:"=",change:"&"},templateUrl:"pages/partial/_partial_pagination_template.jsp",controller:function($scope){$scope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p}}}})}();
!function(){celloudApp.service("uploadService",function($resource,$http){this.getProductTags=function(){return $resource("uploadFile/getProductTag?v="+(new Date).getTime(),{cache:!1})},this.checkRole=function(){return $http({method:"GET",url:"uploadFile/checkRole",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){function getUploadingCount(uploader){for(var count=0,i=0;i<uploader.files.length;i++)5!=uploader.files[i].status&&count++;return count}function getSize(fileSize){var unit="b";return fileSize>1e3&&(fileSize/=1e3,unit="kb"),fileSize>1e3&&(fileSize/=1e3,unit="mb"),fileSize.toFixed(2)+unit}function handleStatus(file){var actionClass,iconClass;file.status==plupload.DONE&&(actionClass="plupload_done",iconClass="fa fa-check-circle"),file.status==plupload.FAILED&&(actionClass="plupload_failed",iconClass="fa fa-exclamation-triangle"),file.status!=plupload.QUEUED&&file.status!=plupload.UPLOADING||(actionClass="plupload_delete",iconClass="fa fa-times-circle-o");var icon=$("#uploading-"+file.id).attr("class",actionClass).find("i").attr("class",iconClass);file.hint&&icon.attr("title",file.hint)}celloudApp.controller("fileUpload",function($route,$location,$scope,$rootScope,uploadService){$scope.step="one",$rootScope.getProTags=function(){$location.path().indexOf("/product/rocky")>-1?$location.path().indexOf("upload")>-1?$route.reload():window.location.href="#/product/rocky/upload":$location.path().indexOf("/product/bactive")>-1||uploadService.checkRole().success(function(data){"0"==data?alert("测试账号不可上传，请联系我们注册正式账号"):("one"==$scope.step&&($scope.upload.splice(),$rootScope.tags=uploadService.getProductTags().query()),$("#upload-modal").modal("show"))})},$scope.nextStep=function(){$scope.step="two"},$scope.beginUpload=function(){$scope.step="three",$scope.upload.start()},$scope.uploadMore=function(){var count=getUploadingCount($scope.upload);0==count&&($scope.step="two")};var initUploader=function(button){var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:button,url:"../uploadFile/uploadManyFile",chunk_size:"1mb",dragdrop:!0,unique_names:!0,drop_element:"plupload-content",filters:{max_file_size:"10gb",prevent_duplicates:!0,mime_types:[{title:"bam",extensions:"bam"},{title:"ab1",extensions:"ab1"},{title:"abi",extensions:"abi"},{title:"fasta",extensions:"fasta"},{title:"fastq",extensions:"fastq"},{title:"tsv",extensions:"tsv"},{title:"gz",extensions:"gz"},{title:"lis",extensions:"lis"},{title:"txt",extensions:"txt"},{title:"xls",extensions:"xls,xlsx"}]},max_retries:5,multiple_queues:!0,flash_swf_url:"//cdn.bootcss.com/plupload/2.1.8/Moxie.swf"});return uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval(function(){$.get("uploadFile/checkAdminSessionTimeOut")},6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("UploadProgress",function(uploader,file){$("#uploading-"+file.id+" .plupload-file-status").html(file.percent+"%"),$("#uploading-"+file.id+" .plupload-file-surplus").html(utils.formatDate((file.size-file.loaded)/uploader.total.bytesPerSec)),$("#uploading-"+file.id+" .plupload_file_speed").html(getSize(uploader.total.bytesPerSec)+"/s")}),uploader.bind("FilesAdded",function(uploader,files){$.get("uploadFile/checkAdminSessionTimeOut",function(response){response||uploader.destroy()}),$.each(files,function(index,item){if(item.size>0){var $fileDom_upload=$('<tr class="plupload_delete" id="upload-'+item.id+'">');$fileDom_upload.append($('<td class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></td>")),$fileDom_upload.append($('<td class="plupload-file-size">'+getSize(item.size)+"</td>")),$fileDom_upload.append($('<td class="plupload-file-action"><a href="#" style="display: block;line-height: 30px;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></td>')),$fileDom_upload.append($("</tr>")),$("#upload-list-tbody").append($fileDom_upload);var $fileDom_uploading=$('<tr class="plupload_delete" id="uploading-'+item.id+'">');$fileDom_uploading.append($('<td class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></td>")),$fileDom_uploading.append($('<td class="plupload-file-status">_</td>')),$fileDom_uploading.append($('<td class="plupload-file-surplus">_</td>')),$fileDom_uploading.append($('<td class="plupload_file_speed">_</td>')),$fileDom_uploading.append($('<td class="plupload-file-action"><a href="#" style="display: block;line-height: 30px;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></td>')),$fileDom_uploading.append($("</tr>")),$("#uploading-list-tbody").append($fileDom_uploading),handleStatus(item),$("#upload-"+item.id+".plupload_delete a").click(function(e){$("#upload-"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e),$scope.$apply()}),$("#uploading-"+item.id+".plupload_delete a").click(function(e){var count=getUploadingCount(uploader);1==count&&5!=item.status&&($scope.isCancel=!0),$("#upload-"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e)})}else uploader.removeFile(item)}),uploader.files.length>0&&($scope.isCancel=!1,$scope.$apply())}),uploader.bind("FileUploaded",function(uploader,file,response){var res=response.response;"1"!=res&&$.get("data/run",JSON.parse(res),function(result){$.report.find.condition()}),handleStatus(file)}),uploader.bind("UploadComplete",function(uploader,files){$scope.step="one",$scope.isCancel||($("#upload-list-tbody").children().remove(),$("#uploading-list-tbody").children().remove(),$("#upload-modal").modal("hide"),"/data"==$location.path()&&$route.reload())}),uploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{size:file.size,lastModifiedDate:file.lastModifiedDate,originalName:file.name,tagId:$scope.tagSelected.tagId,batch:$scope.batch})}),uploader.bind("Error",function(uploader,error){"-602"==error.code&&alert("当前队列已存在文件【"+error.file.name+"】，请勿重复添加！")}),uploader};$("#upload-modal").on("hidden.bs.modal",function(e){"three"!=$scope.step&&($("#upload-list-tbody").children().remove(),$("#uploading-list-tbody").children().remove(),$scope.step="one",$scope.$apply())}),$scope.upload=initUploader(["plupload-content","uploadMore"]),$scope.upload.init(),window.onbeforeunload=function(){var qp=$scope.upload.total,percent=qp.percent;if(qp.size>0&&percent<100&&percent>0)return"数据正在上传，您确定要关闭页面吗?"}})}();
!function(){celloudApp.service("appService",function($http){this.toAppStore=function(){return $http({method:"POST",url:"app/toAppStore",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getMyApp=function(){return $http({method:"POST",url:"app/myApps"})},this.toSclassifyApp=function(pid,pname){return $http({method:"POST",url:"app/toSclassifyApp",data:$.param({paramId:pid}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getAppDetail=function(pid){return $http({method:"POST",url:"app/appDetail",data:$.param({paramId:pid}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("toAppStore",function($route,$scope,appService){$scope.toSclassifyApp=function(pid,pname){appService.toSclassifyApp(pid,pname).success(function(data){$("#appClassifyUl li").removeClass("active"),$("#classifypidLi"+pid).addClass("active"),$scope.classifyAppMap=data.classifyAppMap,$scope.sclassifys=data.sclassifys})},$scope.toAppDetail=function(id){$.get("app/appDetail",{paramId:id},function(responseText){$("#appMain").html(responseText),window.scrollTo(0,0),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","right"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2),$("#manageAppBtns .btn").removeAttr("href"),$("#manageAppBtns .btn").removeAttr("onclick"),$("#manageAppBtns").bind("click",function(){1==hasNavi&&null!=intro&&($("#toUploadMenu").attr("data-step",3),intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(3)),$("#manageAppBtns").unbind("click")}))})},$scope.toMoreApp=function(pid,sid,pageNum,isParent){currentPage=pageNum,$("#rootClassifyName").unbind("click"),$("#secondClassifyName").unbind("click"),$.get("app/toMoreAppList",{classifyId:sid,classifyPid:pid,classifyFloor:isParent,size:pageAppNum,page:currentPage,condition:self.sortFiled,type:self.sortType},function(responseText){$("#appMain").html(responseText),0==pid?$("#rootClassifyName").html($("#pid"+sid).html()):$("#rootClassifyName").html($("#pid"+pid).html()),0==sid||0==pid?$("#secondClassifyName").html("全部"):$("#secondClassifyName").html($("#sid"+sid).html()),$("#rootClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}),"全部"==$("#secondClassifyName").html()?$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}):$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,sid,pageNum,isParent)}),$("#secondClassifyName").parent().removeClass("hide"),$("#sortByCreateDate").bind("click",function(){self.sortFiled="a.create_date","desc"==self.sortType?self.sortType="asc":self.sortType="desc",self.toMoreApp(pid,sid,1,isParent)}),$("#defaultSort").bind("click",function(){self.sortFiled=null,self.sortType=null}),self.sortApp(),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2))})},$scope.removeApp=function(id){$.get("app/removeApp",{paramId:id},function(responseText){responseText==-1&&alert("测试账号不允许修改App"),responseText>0&&appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()})})},$scope.refreshProduct=function(){var appElement=document.querySelector("[ng-controller=sidebarController]"),element=angular.element(appElement),$scope=element.scope();$scope.refreshUserProduct()},appService.toAppStore().success(function(data){$scope.pclassifys=data,appService.getMyApp().success(function(data){$scope.appList=data;var pid=$scope.pclassifys[0].classifyId,pname=$scope.pclassifys[0].classifyName;$scope.toSclassifyApp(pid,pname)})})}),celloudApp.controller("toAppDetail",function($routeParams,$route,$scope,appService){appService.getAppDetail($routeParams.pid).success(function(data){$scope.app=data.app,$scope.screenList=data.screenList,window.scrollTo(0,0),appService.getMyApp().success(function(data){$scope.appList=data})}),$scope.refreshProduct=function(){var appElement=document.querySelector("[ng-controller=sidebarController]"),element=angular.element(appElement),$scope=element.scope();$scope.refreshUserProduct()},$scope.toAppMoreDetail=function(id){$("#toAppMoreDetailUl li").removeClass("select"),$("#"+id).addClass("select")},$scope.addApp=function(id){$.get("app/addApp",{paramId:id},function(responseText){responseText==-1&&alert("测试账号不允许修改App"),responseText>0&&($scope.app.isAdded=1,appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()}))})},$scope.removeApp=function(id){$.get("app/removeApp",{paramId:id},function(responseText){responseText==-1&&alert("测试账号不允许修改App"),responseText>0&&($scope.app.appId==id&&($scope.app.isAdded=0),appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()}))})}})}();
celloudApp.filter("substring",function(){return function(input){return input>50?input.substring(0,50)+"...":input}}),celloudApp.filter("emptyText",function(){return function(input,other){return null==input||""==input?other:input}});
!function(){celloudApp.service("expenseService",function($http){this.pageQueryConsume=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"expense/toRunExpenseList",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryRecharge=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"pay/recharge/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryInvoice=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"invoice/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getInvoiceById=function(invoiceId){return $http({method:"POST",url:"invoice/detail",data:$.param({id:invoiceId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.apply=function(params){return $http({method:"POST",url:"invoice/apply",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.toRecharge=function(){return $http({method:"POST",url:"pay/recharge",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("pageQueryConsume",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryConsume=function(currentPage,pageSize){expenseService.pageQueryConsume(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryConsume(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryConsume(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryConsume($routeParams.page,$rootScope.pageSize)}),celloudApp.controller("pageQueryRecharge",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryRecharge=function(currentPage,pageSize){expenseService.pageQueryRecharge(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList,$("input[name=checkAll]").prop("checked",!1)})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryRecharge(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryRecharge(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryRecharge($routeParams.page,$rootScope.pageSize),$scope.reset=function(){$scope.invoiceForm={}},$("input[name=checkAll]").click(function(){$(this).prop("checked")?$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").prop("checked",!0):$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").prop("checked",!1)}),$scope.rechargeIds=function(){$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").length==$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]:checked").length?$("#checkAll").prop("checked",!0):$("#checkAll").prop("checked",!1)},$scope.applyInvoice=function(){var rechargeIds=$("input[name='rechargeIds']:checked"),money=0;if(rechargeIds.length<1)return $rootScope.errorInfo="请选择至少一条记录",void $("#tips-modal").modal("show");if(rechargeIds.each(function(){money+=parseFloat($(this).parent().parent().siblings().eq(0).html())}),money<100&&.02!=money)return $rootScope.errorInfo="最少申请100元",void $("#tips-modal").modal("show");$("#apply-invoice-modal").modal("show"),$("#money").attr("value",money);var ids=new Array;rechargeIds.each(function(){ids.push($(this).val())}),$("#rechargeIds").val(ids.join(","))},$scope.apply=function(){$("#invoiceSubmit").prop("disabled",!0),$scope.invoiceForm.invoiceType=$("input[name=invoiceType]:checked").val(),$scope.invoiceForm.rechargeIds=$("#rechargeIds").val(),expenseService.apply($scope.invoiceForm).success(function(data){$("#apply-invoice-modal").modal("hide"),data>0?($.alert("申请成功!"),$scope.pageQueryRecharge(1,10)):$.alert("发生未知错误,请联系管理员!")}),$("#invoiceSubmit").prop("disabled",!1)},$scope.length=0,$scope.invoiceForm={}}),celloudApp.controller("pageQueryInvoice",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryInvoice=function(currentPage,pageSize){expenseService.pageQueryInvoice(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryInvoice(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryInvoice(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryInvoice($routeParams.page,$rootScope.pageSize),$scope.showInvoiceDetail=function(invoiceId){expenseService.getInvoiceById(invoiceId).success(function(invoiceDetail){$scope.invoiceDetail=invoiceDetail})}}),celloudApp.controller("toRecharge",function($scope,$rootScope,expenseService){expenseService.toRecharge().success(function(data){$scope.balance=data}),$scope.tab="pay_tab_alipay",$scope.pay_type="online",$scope.rechargeForm={money:10},$scope.checkMoney=function(){var money=$scope.rechargeForm.money;return $.isNumeric(money)?1*money<10&&1*money!=.01?($scope.moneyError="充值金额要大于10元哦！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):1*money>1e4?($scope.moneyError="大于10000元的充值金额，请使用公司转账方式充值！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):money!=parseInt(money)&&.01!=money?($scope.moneyError="请输入整数金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):$.isNumeric(money)?($scope.checkFlag=!1,$scope.checkSubmit=!1,!0):void 0:($scope.moneyError="请正确输入充值金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1)},$scope.sumbitRecharge=function(){var payWay=$("input[name='pay-way']:checked").val(),action=CONTEXT_PATH+"/pay/recharge/"+payWay;$("#rechargeForm").attr("action",action),$rootScope.errorInfo="请在新打开的页面完成支付操作！",$("#tips-modal").modal("show")}})}();
!function(){celloudApp.service("samplingService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getSamplingList?v="+new Date).query()},self.getProductTags=function(){return $resource("uploadFile/getProductTag").query()},self.typeList=function(){return $resource("metadata/sampleType").query()},self.sampling=function(sampleName,tagId,type){return $http({method:"POST",url:"sample/sampling",headers:{"x-requested-with":null},params:{sampleName:sampleName,tagId:tagId,type:type}})},self.listMetadata=function(param){return $http({method:"POST",url:"metadata/listMetadataToSelectByTagIdAndFlag",data:$.param(param),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},self.deleteSample=function(id){return $http({method:"POST",url:"sample/bsi/deleteOne",params:{sampleId:id}})},self.commitSample=function(sampleList){var sampleIds=new Array;for(s in sampleList)void 0!=sampleList[s].sampleId&&sampleIds.push(sampleList[s].sampleId);return $http({method:"POST",url:"sample/commitSampling",params:{sampleIds:sampleIds}})}}),celloudApp.service("sampleInfoService",function($resource,$http){var self=this;self.getSampleInfo=function(id){return $http({method:"GET",url:"sample/sampleInfos/"+id})},self.getProductTags=function(){return $resource("uploadFile/getProductTag").query()},self.typeList=function(){return $resource("metadata/sampleType").query()},self.sampleInfos=function(patient,sample,tagId,type){var param={tagId:tagId[0],type:type[0]};return param=$.extend(sample,param),param=$.extend(patient,param),$http({method:"POST",url:"sample/sampleInfos",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(param)})},self.removeSampleInfo=function(id){return $http({method:"POST",url:"sample/removeSampleInfo",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({sampleId:id})})},self.updateSampleInfos=function(patient,sample,tagId,type){var param={tagId:tagId[0],type:type[0]};return param=$.extend(sample,param),param=$.extend(patient,param),$http({method:"POST",url:"sample/updateSampleInfos",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(param)})},self.listSampleInfo=function(){return $http({method:"GET",url:"sample/listSampleInfo"})},self.commitSample=function(){return $http({method:"GET",url:"sample/commitSampleInfo"})}}),celloudApp.service("sampleOrderService",function($resource,$http){this.sampleOrderInfo=function(orderId){return $http({method:"POST",url:"sample/getSampleOrderInfo",params:{orderId:orderId,v:new Date}})}}),celloudApp.service("sampleInfoOrderService",function($resource,$http){this.sampleInfoOrderInfo=function(orderId){return $http({method:"POST",url:"sample/getSampleInfoOrderInfo",params:{orderId:orderId,v:new Date}})},this.sendSampleInfoOrderInfo=function(orderId){return $http({method:"POST",url:"sample/sendSampleInfoOrderInfo",params:{orderId:orderId}})}}),celloudApp.service("sampleTrackingService",function($resource,$http){var self=this;self.sampleList=function(sampleName){return $resource("sample/sampleTranking?v="+new Date).get()},self.pageList=function(page,size,sampleName){return $http.get("sample/sampleTranking?v="+new Date,{params:{page:page,size:size,sampleName:sampleName}})}}),celloudApp.service("scanStorageService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getScanStorageSamples?v="+new Date).get()},self.pageList=function(page,size){return $http.get("sample/getScanStorageSamples?v="+new Date,{params:{page:page,size:size}})},self.scanStorage=function(orderNo,sampleName){return $http({method:"POST",url:"sample/toScanStorage",params:{orderNo:orderNo,sampleName:sampleName}})},self.editRemark=function(id,remark){return $http({method:"POST",url:"sample/editRemark",params:{sampleId:id,remark:remark}})},self.remove=function(id){return $http({method:"POST",url:"sample/removeSampleLog",params:{sampleLogId:id}})}}),celloudApp.service("tokenDNAService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getTokenDnaSamples?v="+new Date).get()},self.pageList=function(page,size){return $http.get("sample/getTokenDnaSamples?v="+new Date,{params:{page:page,size:size}})},self.tokenDNA=function(sampleName){return $http({method:"POST",url:"sample/toTokenDNA",params:{experSampleName:sampleName}})}}),celloudApp.service("buidLibraryService",function($resource,$http){var self=this;self.infos=function(){return $resource("sample/getBuidLibrarySamples?v="+new Date).get()},self.addSample=function(sampleName,sampleList){var sindexs=new Array;for(s in sampleList)sindexs.push(sampleList[s].sindex);return $http({method:"POST",url:"sample/addSampleToLibrary",params:{experSampleName:sampleName,sindexs:sindexs}})},self.addLibrary=function(libraryName,sindex,sampleList){var sampleIds=new Array;for(s in sampleList)void 0!=sampleList[s].sampleId&&sampleIds.push(sampleList[s].sampleId);return $http({method:"POST",url:"sample/addLibrary",params:{libraryName:libraryName,sindex:sindex,sampleIds:sampleIds}})},self.downloadExcel=function(ssId,storageName){return $http.get("sample/downExperExcel",{params:{ssId:ssId,storageName:storageName}})}}),celloudApp.service("storagesService",function($resource,$http,$routeParams){var self=this;self.storages=function(){return $resource("sample/getSampleStorages?v="+new Date).get()},self.pageList=function(page,size){return $http.get("sample/getSampleStorages?v="+new Date,{params:{page:page,size:size}})},self.sampleList=function(){return $http.get("sample/sampleListInStorage?v="+new Date,{params:{ssId:$routeParams.ssId}})},self.changeInMachine=function(id){return $http({method:"POST",url:"sample/changeInMachine",params:{sampleStorageId:id}})}})}();
!function(){celloudApp.controller("samplingController",function($scope,samplingService){$scope.productTags=samplingService.getProductTags(),$scope.typeList=null,$scope.changeSampleType=function(){var tagId=0;void 0!=$scope.selTags&&(tagId=$scope.selTags.tagId);var param={tagId:tagId,flag:3};samplingService.listMetadata(param).success(function(data){$scope.typeList=data})};var refreshList=function(){$scope.sampleList=samplingService.sampleList()};refreshList(),$scope.addSample=function(){samplingService.sampling($scope.sampleName,$scope.selTags.tagId,$scope.type.text).success(function(data){2==data?$.alert("此样品信息已经收集过，请核查或者采集下一管样品信息！"):refreshList(),$scope.sampleName=""})},$scope.commitSample=function(){samplingService.commitSample($scope.sampleList).success(function(data){data>0?(window.open(window.CONTEXT_PATH+"/sample_order.html#/sampling/order/"+data),refreshList()):$.alert("样本已提交")})},$scope.deleteSample=function(id){samplingService.deleteSample(id).success(function(data){data>0?(refreshList(),$.alert("删除样本成功!")):$.alert("删除样本失败!")})}}),celloudApp.controller("samplingInfoController",function($scope,sampleInfoService,$timeout){$scope.sampleTypes=sampleInfoService.typeList();var productTagObj1=null,productTagObj2=null,sampleTypeObj1=null,sampleTypeObj2=null;$scope.sample={},$scope.patient={},$scope.addReset=function(){$timeout(function(){productTagObj1.val(null).trigger("change"),sampleTypeObj1.val(null).trigger("change"),$scope.sample.sampleName="",$scope.patient.name="",$scope.patient.tel="",$scope.patient.age="",$scope.patient.gender=1,$scope.patient.idCard="",$scope.patient.smoke=1,$scope.addSampleInfoForm.$setPristine()})},$scope.changeSampleTypeByTag=function(flag){$scope.sampleType=null;var oldWidth=$("#sampleTypes"+flag+" .select2-search__field").attr("style");$("#sampleTypes"+flag+" li.select2-selection__choice").remove(),$("#sampleTypes"+flag+" span.select2-selection__clear").remove(),$("#sampleTypes"+flag+" .select2-search__field").attr("placeholder","请选择样本类型"),$("#sampleTypes"+flag+" .select2-search__field").attr("style","oldWidth"),$("#sampleType"+flag+" option").remove();var tagId=null,optionVal=$("#productTag"+flag).val();null!=optionVal&&(isNaN(optionVal)||(tagId=parseInt(optionVal)),$.ajax({url:"metadata/listMetadataToSelectByTagIdAndFlag",type:"POST",data:{tagId:tagId,flag:3},success:function(data){var json=eval(data);$("#sampleType"+flag).select2({data:json,tags:!0,placeholder:"请选择样本类型",language:"zh-CN",allowClear:!0,maximumSelectionLength:1}),$(".select2-search__field").css("height","20px")}})),$(".select2-search__field").css("height","20px")},$scope.listSampleInfo=function(){sampleInfoService.listSampleInfo().success(function(data){$scope.sampleInfoList=data})},$scope.toAddSample=function(){$timeout(function(){$scope.sample={},$scope.patient={},$scope.patient.gender=1,$scope.patient.smoke=1,productTagObj1.val(null).trigger("change"),sampleTypeObj1.val(null).trigger("change"),$("#addSampleInfoModal").modal("show"),$scope.addSampleInfoForm.$setPristine()})},$scope.saveSample=function(){$scope.patient.gender=$("input[name='gender']:checked").val(),$scope.patient.smoke=$("input[name='smoke']:checked").val(),sampleInfoService.sampleInfos($scope.patient,$scope.sample,$scope.productTag,$scope.sampleType).success(function(data,status){201==status&&($("#addSampleInfoModal").modal("hide"),$.alert("新增样本成功"),$scope.listSampleInfo()),$scope.sampleName=""}).error(function(data,status){400==status?$scope.repeat=!0:500==status&&$.alert("服务器发生内部错误")})},$scope.bakPatient={},$scope.bakSample={},$scope.editReset=function(){$timeout(function(){$scope.patient=angular.copy($scope.bakPatient),$scope.sample=angular.copy($scope.bakSample),$scope.sample.sampleName=$scope.bakSample.sampleName,$scope.patient.name=$scope.bakPatient.name,$scope.patient.tel=$scope.bakPatient.tel,$scope.patient.age=$scope.bakPatient.age,$scope.patient.gender=$scope.bakPatient.gender,$scope.patient.idCard=$scope.bakPatient.idCard,$scope.patient.smoke=$scope.bakPatient.smoke,$scope.updateSampleInfoForm.$setPristine(),productTagObj2.val([$scope.bakSample.tagId,$scope.bakSample.tagName]).trigger("change"),$.ajax({url:"metadata/listMetadataToSelectByTagIdAndFlag",type:"POST",data:{tagId:$scope.bakSample.tagId,flag:3},success:function(data){var json=eval(data);$("#sampleType2").select2({data:json,tags:!0,placeholder:"请选择样本类型",language:"zh-CN",allowClear:!0,maximumSelectionLength:1}),sampleTypeObj2.val([$scope.bakSample.type,$scope.bakSample.type]).trigger("change"),$(".select2-search__field").css("height","20px")}}),$scope.updateSampleInfoForm.$setPristine()})},$scope.toEditSampleInfo=function(id){sampleInfoService.getSampleInfo(id).success(function(sampleData){$scope.sample.sampleId=sampleData.sampleId,$scope.sample.sampleName=sampleData.sampleName,$scope.sample.type=sampleData.type,$scope.sample.tagId=sampleData.tagId,$scope.sample.oldTagId=sampleData.tagId,$scope.sample.tagName=sampleData.tagName,$scope.patient.id=sampleData.id,$scope.patient.name=sampleData.name,$scope.patient.gender=sampleData.gender,$scope.patient.age=sampleData.age,$scope.patient.tel=sampleData.tel,$scope.patient.idCard=sampleData.idCard,$scope.patient.weight=sampleData.weight,$scope.patient.height=sampleData.height,$scope.patient.email=sampleData.email,$scope.patient.smoke=sampleData.smoke,$scope.patient.personalHistory=sampleData.personalHistory,$scope.patient.familyHistory=sampleData.familyHistory,$scope.bakPatient=angular.copy($scope.patient),$scope.bakSample=angular.copy($scope.sample),$("#editSampleInfoModal").modal("show"),$timeout(function(){productTagObj2.val([sampleData.tagId,sampleData.tagName]).trigger("change"),$.ajax({url:"metadata/listMetadataToSelectByTagIdAndFlag",type:"POST",data:{tagId:sampleData.tagId,flag:3},success:function(data){var json=eval(data);$("#sampleType2").select2({data:json,tags:!0,placeholder:"请选择样本类型",language:"zh-CN",allowClear:!0,maximumSelectionLength:1}),sampleTypeObj2.val([sampleData.type,sampleData.type]).trigger("change"),$(".select2-search__field").css("height","20px")}})})})},$scope.updateSample=function(){$scope.patient.gender=$("input[name='gender']:checked").val(),$scope.patient.smoke=$("input[name='smoke']:checked").val(),sampleInfoService.updateSampleInfos($scope.patient,$scope.sample,$scope.productTag,$scope.sampleType).success(function(data,status){201==status&&($("#editSampleInfoModal").modal("hide"),$.alert("更新样本成功"),$scope.listSampleInfo()),$scope.sampleName=""}).error(function(data,status){400==status?$scope.repeat=!0:500==status&&$.alert("服务器发生内部错误")})},$("#addSampleInfoModal").on("hidden.bs.modal",function(e){$scope.sample={},$scope.patient={},$scope.patient.gender=1,$scope.patient.smoke=1,$scope.productTag="",$scope.sampleType="",productTagObj1.val(null).trigger("change"),sampleTypeObj1.val(null).trigger("change")}),$("#editSampleInfoModal").on("hidden.bs.modal",function(e){$scope.sample={},$scope.patient={},$scope.patient.gender=1,$scope.patient.smoke=1,$scope.productTag="",$scope.sampleType="",productTagObj2.val(null).trigger("change"),sampleTypeObj2.val(null).trigger("change")}),$.ajax({url:CONTEXT_PATH+"/uploadFile/listProductTagToSelect",type:"post",dataType:"text",success:function(data){var json=eval("("+data+")");productTagObj1=$("#productTag1").select2({data:json,tags:!0,placeholder:"检测产品编号",language:"zh-CN",allowClear:!0,maximumSelectionLength:1}),productTagObj2=$("#productTag2").select2({data:json,tags:!0,placeholder:"检测产品编号",language:"zh-CN",allowClear:!0,maximumSelectionLength:1}),$(".select2-search__field").css("height","20px")},error:function(data){}}),sampleTypeObj1=$("#sampleType1").select2({tags:!0,placeholder:"请选择样本类型",language:"zh-CN",allowClear:!0,maximumSelectionLength:1}),sampleTypeObj2=$("#sampleType2").select2({tags:!0,placeholder:"请选择样本类型",language:"zh-CN",allowClear:!0,maximumSelectionLength:1}),$scope.commitSampleInfo=function(){sampleInfoService.commitSample().success(function(data,status){if(200==status){var url=window.CONTEXT_PATH+"/sampleInfoOrder#/samplinginfo/order/"+data;window.open(url),$scope.listSampleInfo()}}).error(function(data,status){500==status&&$.alert("服务器发生错误")})},$scope.removeSampleInfo=function(sampleId){sampleInfoService.removeSampleInfo(sampleId).success(function(data,status){204==status&&($scope.listSampleInfo(),$.alert("删除样本成功!"))}).error(function(data,status){500==status&&$.alert("删除样本失败!")})},$(".select2-search__field").css("height","20px"),$scope.listSampleInfo()}),celloudApp.controller("sampleTrackingController",function($scope,$routeParams,sampleTrackingService){$scope.pages={page:1,pageSize:20},$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},sampleTrackingService.pageList($scope.pages.page,$scope.pages.pageSize,$scope.sampleName).success(function(data){$scope.sampleList=data})},$scope.sampleNameQuery=function(){$scope.pageQuery(1,$scope.pages.pageSize)},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.sampleNameQuery())},$scope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize)}),celloudApp.controller("sampleInfoTrackingController",function($scope,$routeParams,sampleTrackingService){$scope.pages={page:1,pageSize:20},$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},sampleTrackingService.pageList($scope.pages.page,$scope.pages.pageSize,$scope.sampleName).success(function(data){$scope.sampleList=data})},$scope.sampleNameQuery=function(){$scope.pageQuery(1,$scope.pages.pageSize)},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.sampleNameQuery())},$scope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize)}),celloudApp.controller("sampleOrderController",function($scope,commonService,$routeParams,sampleOrderService){sampleOrderService.sampleOrderInfo($routeParams.orderId).success(function(data){null!=data?($scope.userProduct=commonService.getProduct().get(),$scope.sampleOrderInfo=data):$.alert("样本已提交")}),$scope.print=function(){window.print()}}),celloudApp.controller("sampleInfoOrderController",function($scope,$routeParams,sampleInfoOrderService){sampleInfoOrderService.sampleInfoOrderInfo($routeParams.orderId).success(function(data){null!=data?$scope.sampleOrderInfo=data:$.alert("样本已提交")}),$scope.print=function(){window.print()},$scope.send=function(){sampleInfoOrderService.sendSampleInfoOrderInfo($routeParams.orderId).success(function(data,status){200==status&&alert("发送成功!")}).error(function(data,status){500==sttus&&$.alert("服务器内部错误")})}}),celloudApp.controller("scanStorageController",function($scope,scanStorageService){$scope.pages={page:1,pageSize:20},$scope.checkedLength=0,$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},scanStorageService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$scope.sampleList=data})},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.scanStorage())},$scope.checkAll=function(){var flag=$("input[name='checkAll']").prop("checked");flag?$scope.checkedLength=$("input[name='checkOne']").length:$scope.checkedLength=0,$("input[name='checkOne']").each(function(){$(this).prop("checked",flag)})},$scope.checkOne=function(){var length1=$("input[name='checkOne']:checked").length;$scope.checkedLength=length1;var length2=$("input[name='checkOne']").length;length1==length2?$("input[name='checkAll']").prop("checked",!0):$("input[name='checkAll']").prop("checked",!1)},$scope.printQRCode=function(){var sampleNames=new Array,dates=new Array;$("input[name='checkOne']:checked").each(function(){sampleNames.unshift($(this).parent().parent().parent().children(".experSampleName").html().trim()),dates.unshift($(this).parent().parent().parent().children(".createDate").html().trim())}),printQRCodeBatch(sampleNames,dates)},$scope.scanStorage=function(){return""==$scope.orderNo||void 0==$scope.orderNo?($.alert("请输入订单编号！"),!1):""==$scope.sampleName||void 0==$scope.sampleName?($.alert("请输入样本信息！"),!1):void scanStorageService.scanStorage($scope.orderNo,$scope.sampleName).success(function(data){void 0!=data.error?$.alert(data.error):$scope.sampleList=$scope.pageQuery($scope.page,$scope.pageSize),$scope.sampleName=""})},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($scope.pageQuery($scope.pages.page,$scope.pages.pageSize),$.alert("样本删除成功")):$.alert("样本删除失败")})},$scope.sampleList=$scope.pageQuery($scope.page,$scope.pageSize)}),celloudApp.controller("tokenDNAController",function($scope,scanStorageService,tokenDNAService){$scope.pages={page:1,pageSize:20},$scope.checkedLength=0,$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},tokenDNAService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$scope.sampleList=data})},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.tokenDNA())},$scope.tokenDNA=function(){return""==$scope.sampleName||void 0==$scope.sampleName?($.alert("请输入实验样本编号！"),!1):void tokenDNAService.tokenDNA($scope.sampleName).success(function(data){void 0!=data.error?$.alert(data.error):$scope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize),$scope.sampleName=""})},$scope.checkAll=function(){var flag=$("input[name='checkAll']").prop("checked");flag?$scope.checkedLength=$("input[name='checkOne']").length:$scope.checkedLength=0,$("input[name='checkOne']").each(function(){$(this).prop("checked",flag)})},$scope.checkOne=function(){var length1=$("input[name='checkOne']:checked").length;$scope.checkedLength=length1;var length2=$("input[name='checkOne']").length;length1==length2?$("input[name='checkAll']").prop("checked",!0):$("input[name='checkAll']").prop("checked",!1)},$scope.printQRCode=function(){var sampleNames=new Array,dates=new Array;$("input[name='checkOne']:checked").each(function(){sampleNames.unshift($(this).parent().parent().parent().children(".experSampleName").html().trim()),dates.unshift($(this).parent().parent().parent().children(".createDate").html().trim())}),printQRCodeBatch(sampleNames,dates)},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($scope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize),$.alert("样本删除成功")):$.alert("样本删除失败")})},$scope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize)}),celloudApp.controller("buidLibraryController",function($scope,scanStorageService,buidLibraryService){$scope.infos=buidLibraryService.infos(),$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName?$.alert("请输入样本信息"):$scope.addSample())},$scope.addSample=function(){var sampleList=$scope.infos.pageList.datas,samplelength=$scope.infos.sampleIndex.length;sampleList.length>=samplelength?$.tips("每个文库最多"+samplelength+"个样本！"):""==$scope.sampleName||void 0==$scope.sampleName?$.alert("请输入实验样本编号"):buidLibraryService.addSample($scope.sampleName,sampleList).success(function(data){data>0?$scope.infos=buidLibraryService.infos():0==data?$.alert("此样本未提取DNA"):$.alert("此样品已在等待建库，请核查或者扫描下一管样品信息！")}),$scope.sampleName=""},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($scope.infos=buidLibraryService.infos(),$.alert("样本删除成功")):$.alert("样本删除失败")})},$scope.addLibrary=function(){var select=$scope.sindex.name+":"+$scope.sindex.seq;buidLibraryService.addLibrary($scope.infos.libraryName,select,$scope.infos.pageList.datas).success(function(data){null!=data&&void 0!=data?(printQRCode(data.storageName,data.sindex),$scope.infos=buidLibraryService.infos(),$.alert("建库成功！")):($scope.repeatError=!0,$.alert("建库失败！"))})},$scope.addAndDownLibrary=function(){var select=$scope.sindex.name+":"+$scope.sindex.seq;buidLibraryService.addLibrary($scope.infos.libraryName,select,$scope.infos.pageList.datas).success(function(data){if(null==data)$scope.notPrevError=!0;else if(null!=data){$scope.infos.libraryName;$scope.infos=buidLibraryService.infos(),buidLibraryService.downloadExcel(data.id,data.storageName).success(function(flag){if(1==flag)$.alert("没有正确生成Excel文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"sample/downExperExcel?ssId="+data.id+"&storageName="+data.storageName,$.alert("建库并下载成功！")}})}else $scope.repeatError=!0})}}),celloudApp.controller("storagesController",function($scope,storagesService,buidLibraryService){$scope.storages=storagesService.storages(),storagesService.sampleList().success(function(data){$scope.sampleList=data}),$scope.pages={page:1,pageSize:20},$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},storagesService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$scope.storages=data})},$scope.download=function(id,storageName){buidLibraryService.downloadExcel(id,storageName).success(function(flag){if(1==flag)$.alert("没有正确生成Excel文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"sample/downExperExcel?ssId="+id+"&storageName="+storageName,$.alert("下载Excel文件成功！")}})},$scope.updateInMachine=function(id){storagesService.changeInMachine(id).success(function(flag){flag>0?($.alert("修改上机状态成功"),$scope.storages=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize)):$.alert("修改上机状态失败")})}}),celloudApp.controller("editSampleController",function($scope,scanStorageService,tokenDNAService){$scope.toEditRemark=function(id,remark){$scope.sampleId=id,$scope.remark=remark,$scope.remark_bak=remark},$scope.resetSampleRemark=function(){$scope.remark=angular.copy($scope.remark_bak)},$scope.editRemark=function(){scanStorageService.editRemark($scope.sampleId,$scope.remark).success(function(data){data>0?(1==$scope.exper_state?scanStorageService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$scope.sampleList=data}):tokenDNAService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$scope.sampleList=data}),$.alert("样本修改成功")):$.alert("样本修改失败"),$("#sample-remark-modal").modal("hide")})}})}();
!function(){celloudApp.service("userService",function($q,$http,$resource){this.getUserInfo=function(){return $http({method:"POST",url:"user/info",params:{}})},this.updatePassword=function(oldPassword,newPassword){return $http({method:"POST",url:"user/updatePassword",params:{oldPassword:oldPassword,newPassword:newPassword}})},this.updateEmail=function(email){return $http({method:"POST",url:"user/sendOldEmail",params:{email:email}})},this.pageQueryLog=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"user/logInfo",params:{currentPage:currentPage,pageSize:pageSize}})},this.getUserCompanyIcon=function(){return $http({method:"POST",url:"user/getCompanyIcon",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.setUserCompanyIcon=function(companyIcon){return $http({method:"POST",url:"user/setCompanyIcon",data:$.param({companyIcon:companyIcon}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.sendCaptcha=function(cellphone){return $http({method:"POST",url:"user/sendCaptcha",data:$.param({cellphone:cellphone}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.authenticationCellphone=function(cellphone,captcha){return $http({method:"POST",url:"user/authenticationCellphone",data:$.param({cellphone:cellphone,captcha:captcha}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("updateBaseInfo",function($route,$scope,userService){userService.getUserInfo().success(function(data){$scope.user=data,$scope.user_bak=angular.copy(data)}),$scope.sendCaptcha=function(){userService.sendCaptcha($scope.user.cellphone).success(function(data,status){if(200==status){time=60,$("#captchaButton").prop("disabled",!0),$("#captchaButton").html("重新发送(<span id='times'>60</span>)");var setinterval=setInterval(function(){time--,0==time?($("#captchaButton").prop("disabled",!1),clearInterval(setinterval),$("#captchaButton").html("重新发送")):$("#times").html(time)},1e3)}}).error(function(data,status){403==status&&alert("测试账号不允许修改信息"),400==status&&$.alert("手机号格式有误!"),500==status&&$.alert("请勿频繁获取验证码")})},$scope.authenticationCellphone=function(){userService.authenticationCellphone($scope.user.cellphone,$scope.captcha).success(function(data,status){$route.reload(),$.alert(data.message)}).error(function(data,status){403==status?alert("测试账号不允许修改信息"):$.alert(data.message)})},$scope.reset=function(){$scope.user=angular.copy($scope.user_bak),$scope.captcha=void 0}}),celloudApp.controller("updatePassword",function($scope,userService){$scope.reset=function(){$scope.oldPwd="",$scope.newPwd="",$scope.confirmPwd=""},$scope.updatePassword=function(){$scope.state=!1,userService.updatePassword($scope.oldPwd,$scope.newPwd).success(function(data){$scope.code=data.code,5==$scope.code&&alert("测试账号不允许修改信息"),102==$scope.code?$.alert("修改成功"):$scope.pwdMessage=data.message}).error(function(data){$.alert("修改密码失败")})},$scope.checkOldPwd=function(){""==$.trim($scope.oldPwd)&&($scope.code=0)}}),celloudApp.controller("pageQueryLog",function($scope,$rootScope,$routeParams,$location,userService){$scope.pageQueryLog=function(currentPage,pageSize){userService.pageQueryLog(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryLog(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryLog(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryLog($routeParams.page,$rootScope.pageSize)}),celloudApp.controller("updateEmail",function($scope,userService){userService.getUserInfo().success(function(data){$scope.user=data}),$scope.isSend=!1,$scope.updateEmail=function(){userService.updateEmail($scope.user.email).success(function(data){data==-1?alert("测试账号不允许修改邮箱"):1==data?$scope.sendFail=!0:0==data&&($scope.sendSuccess=!0)})}}),celloudApp.controller("setReportController",function($scope,userService){$scope.icon="",$scope.haveImage=!1,userService.getUserCompanyIcon().success(function(company){$scope.icon=company.companyIcon,""==$scope.icon?$scope.isTemp=!0:($scope.haveImage=!0,$scope.isTemp=!1,$scope.path=CONTEXT_PATH+"/user/icon?file="+$scope.icon)}),$scope.apply=function(){userService.setUserCompanyIcon($scope.icon).success(function(data){data>0&&($.alert("更新成功!"),$scope.icon="")})};var initUploader=function(button){var uploader=new plupload.Uploader({browse_button:button,url:"../user/uploadCompanyIcon",chunk_size:"2mb",file_data_name:"file",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}],prevent_duplicates:!1},multi_selection:!1,flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",init:{FilesAdded:function(uploader,files){uploader.start()}}});return uploader},unsaveUploader=initUploader("unsavedAttachmentUploadBtn");unsaveUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name})}),unsaveUploader.bind("FileUploaded",function(uploader,file,response){$scope.tempPath=CONTEXT_PATH+"/user/icon/temp?file="+response.response,$scope.icon=response.response,$scope.isTemp=!0,$scope.haveImage=!0,$scope.$apply()}),unsaveUploader.init()})}();
!function(){celloudApp.service("runService",function($resource,$http){var self=this;self.pageList=function(){var options=$.dataManager.options;return $http.get("data/dataPageListCondition?random="+(new Date).getTime(),{params:{page:options.page,size:options.pageSize,condition:options.condition,sort:options.sort,sortDateType:options.sortDateType,sortNameType:options.sortNameType,sortAnotherName:options.sortAnotherName,sortRun:options.sortRun}})},self.run=function(){var checkedIds=$.dataManager.options.checkedIds,dataIds=[];return $.each(checkedIds,function(i,el){$.inArray(el,dataIds)===-1&&dataIds.push(el)}),$http.get("data/runWithProject",{params:{dataIds:dataIds.toString()}})},self.deleteData=function(){for(var checkedIds=$.dataManager.options.checkedIds,dataIds="",i=0;i<checkedIds.length;i++)dataIds+=checkedIds[i]+",";return dataIds=dataIds.substring(0,dataIds.length-1),$http.get("data/delete.action",{params:{dataIds:dataIds}})},self.toEditData=function(fileId){return $http.get("data/toEditData?random="+new Date,{params:{dataId:fileId}})},self.submitEditData=function(dataFile){return $http.get("data/updateDataAndTag",{params:{fileId:dataFile.fileId,anotherName:dataFile.anotherName,batch:dataFile.batch,tagName:dataFile.tagName}})}})}();
!function(){celloudApp.controller("dataListController",function($scope,$rootScope,$location,$routeParams,runService,uploadService){$scope.pageQuery=function(page,pageSize){$.dataManager.options.condition=$scope.dataCondition,$.dataManager.options.page=page,$.dataManager.options.pageSize=pageSize,runService.pageList().success(function(response){$scope.dataList=response}),$.dataManager.refreshDataList("clean")},$.dataManager.options.sort=0,$scope.sortQuery=function(column,order){console.log(column,order),"anotherName"==column?($scope.column="anotherName",$.dataManager.options.sort=3,"asc"==order?($scope.order="desc",$.dataManager.options.sortAnotherName="desc"):($scope.order="asc",$.dataManager.options.sortAnotherName="asc")):"run"==column&&($scope.column="run",$.dataManager.options.sort=4,"asc"==order?($scope.order="desc",$.dataManager.options.sortRun="desc"):($scope.order="asc",$.dataManager.options.sortRun="asc")),runService.pageList().success(function(response){$scope.dataList=response})},$scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$scope.conditionList=function(){$scope.pageQuery(1,$.dataManager.options.pageSize)},$scope.doSearch=function($event){13==$event.keyCode&&$scope.conditionList()},$scope.checkNum=function(){var checkedIds=$.dataManager.options.checkedIds;if(0==checkedIds.length)return $rootScope.errorInfo="请选择至少一条记录",$("#tips-modal").modal("show"),!1;var maxNum=$.dataManager.options.dataMax;return!(checkedIds.length>maxNum)||($rootScope.errorInfo="最多允许同时操作"+maxNum+"条数据！",$("#tips-modal").modal("show"),!1)},$scope.runWithProject=function(){uploadService.checkRole().success(function(data){if("0"==data)return void $.alert("运行成功");if($scope.checkNum())return 0!=$.dataManager.options.isRun?($rootScope.errorInfo="所勾选的数据必须不处于运行状态！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isTag?($rootScope.errorInfo="所勾选的数据必须有产品标签！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isBSI?($rootScope.errorInfo="所勾选的数据产品标签不能为百菌探！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isRocky?($rootScope.errorInfo="所勾选的数据产品标签不能为华木兰！",void $("#tips-modal").modal("show")):void(0!=$.dataManager.options.isPair?$.confirm("请保证所选数据为配对数据！","确认框",function(){$scope.run()}):$scope.run())})};var opts={lines:13,length:28,width:14,radius:42,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"50%"};$scope.run=function(){var checkedIds=$.dataManager.options.checkedIds;if(checkedIds.length!=$.dataManager.options.validIds)return $rootScope.errorInfo="数据选择异常，请刷新页面后重新选择！",void $("#tips-modal").modal("show");spinner=new Spinner(opts);var target=document.getElementById("_data_table");spinner.spin(target),runService.run().success(function(response){response.success?($.alert("运行成功"),$scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$.dataManager.refreshDataList()):$scope.message=response.message,spinner.stop()})},$scope.deleteData=function(){uploadService.checkRole().success(function(data){if("0"==data)alert("测试账号不可归档");else{if(!$scope.checkNum())return;uploadService.checkRole,$.confirm("确定要归档所选数据？","确认框",function(){runService.deleteData().success(function(response){response.success&&($scope.conditionList(),$.dataManager.refreshDataList()),$.alert(response.message)})})}})},$scope.toEditData=function(fileId){uploadService.checkRole().success(function(data){"0"==data?alert("测试账号不可以修改数据信息!"):($scope.updateState=!1,runService.toEditData(fileId).success(function(response){for($scope.dataFile=response.file,$scope.appList=response.appList,i=0;i<$scope.appList.length;i++)if($.trim($scope.appList[i].tagName)==$.trim($scope.dataFile.tagName)){$scope.appSelected=$scope.appList[i];break}}),$("#data-detail-modal").modal("show"))})},$scope.submitEditData=function(){var alias=$scope.dataFile.anotherName;if(null!=alias&&alias.length>50)return $scope.updateMessage="文件别名不能超过50个字符",void($scope.updateState=!0);var batch=$scope.dataFile.batch;return null!=batch&&batch.length>50?($scope.updateMessage="数据标签不能超过50个字符",void($scope.updateState=!0)):($scope.updateState=!1,$scope.dataFile.tagName=void 0==$scope.appSelected?"":$scope.appSelected.tagName,void runService.submitEditData($scope.dataFile).success(function(response){response.success&&($scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$.dataManager.refreshDataList(),$("#data-detail-modal").modal("hide")),$.alert(response.message)}))}})}();
function _init_data(){$.dataManager.options={condition:null,page:1,pageSize:20,sort:0,dataMax:25,sortDateType:"desc",sortNameType:"asc",checkedIds:[],validIds:0,isRun:0,isTag:0,isBSI:0,isRocky:0,isPair:0},$.dataManager.checkOneData=function(obj){var _checked=$(obj).prop("checked"),_dataId=$(obj).val(),_isRun=$(obj).attr("is_run"),_isTag=$(obj).attr("is_tag"),_isBSI=$(obj).attr("is_bsi"),_isRocky=$(obj).attr("is_rocky"),_isPair=$(obj).attr("is_pair");_checked?($.dataManager.checkData.isCheck(_dataId),"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun+1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag+1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI+1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky+1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair+1,$.dataManager.options.validIds=$.dataManager.options.validIds+1):$.dataManager.options.validIds=$.dataManager.options.validIds+1):($.dataManager.checkData.noCheck(_dataId),"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun-1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag-1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI-1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky-1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair-1,$.dataManager.options.validIds=$.dataManager.options.validIds-1):$.dataManager.options.validIds=$.dataManager.options.validIds-1),$.dataManager.editBtn.update()},$.dataManager.checkAll=function(obj,name){var _checked=$(obj).prop("checked");if($.dataManager.options.checkedIds=new Array,_checked){for(var choicearr=document.getElementsByName(name),_checkedLength=choicearr.length,i=0;i<_checkedLength;i++)if(0==$(choicearr[i]).prop("disabled")){if(0==$(choicearr[i]).prop("checked")){var _isRun=$(choicearr[i]).attr("is_run"),_isTag=$(choicearr[i]).attr("is_tag"),_isBSI=$(choicearr[i]).attr("is_bsi"),_isRocky=$(choicearr[i]).attr("is_rocky"),_isPair=$(choicearr[i]).attr("is_pair");"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun+1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag+1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI+1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky+1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair+1,$.dataManager.options.validIds=$.dataManager.options.validIds+1):$.dataManager.options.validIds=$.dataManager.options.validIds+1}$(choicearr[i]).prop("checked",!0);var dataId=$(choicearr[i]).val();$.dataManager.checkData.isCheck(dataId)}$.dataManager.options.checkedIds.length>0&&$.dataManager.editBtn.show()}else $("[name='"+name+"']").prop("checked",!1),$.dataManager.options.isRun=0,$.dataManager.options.isTag=0,$.dataManager.options.isBSI=0,$.dataManager.options.isRocky=0,$.dataManager.options.isPair=0,$.dataManager.options.validIds=0,$.dataManager.editBtn.disable()},$.dataManager.cleanCheckbox=function(name){$("input[type='checkbox'][name='"+name+"']").prop("checked",!1)},$.dataManager.refreshDataList=function(name){$.dataManager.options.checkedIds=new Array,$.dataManager.options.isRun=0,$.dataManager.options.isTag=0,$.dataManager.options.isBSI=0,$.dataManager.options.isRocky=0,$.dataManager.options.isPair=0,$.dataManager.options.validIds=0,$.dataManager.editBtn.update(),$.dataManager.cleanCheckbox("demo-checkbox1")},$.dataManager.checkData={isCheck:function(dataId){$.dataManager.options.checkedIds.push(dataId),$("input[name='data-checkone']").length==$.dataManager.options.checkedIds.length&&$("#data-checkall").prop("checked",!0)},noCheck:function(dataId){$("#data-checkall").prop("checked",!1);var index=$.inArray(dataId.toString(),$.dataManager.options.checkedIds);$.dataManager.options.checkedIds.splice(index,1)}},$.dataManager.editBtn={update:function(){var _checkedIds=$.dataManager.options.checkedIds;_checkedIds.length>0?$.dataManager.editBtn.show():$.dataManager.editBtn.disable()},show:function(){$(".data-operate").attr("disabled",!1),$(".data-operate").removeClass("btn-cancel")},disable:function(){$(".data-operate").attr("disabled",!0),$(".data-operate").addClass("btn-cancel")}}}$.dataManager={},$.ajaxSetup({cache:!1}),$(function(){_init_data()});
!function(){celloudApp.filter("hcvShowMore",function(){return function(input){return"1b"!=input&&"2a"!=input&&"3a"!=input&&"3b"!=input&&"6a"!=input?($("#_change").parent().css("display",""),"其他"):input}})}();
!function(){celloudApp.service("mibReportService",function($resource,$http){var self=this;self.reportInfo=function(dataKey,projectId,appId){return $http.get("report/getMIBReportInfo",{params:{dataKey:dataKey,projectId:projectId,appId:appId}})}})}();
!function(){celloudApp.controller("mibReportController",function($scope,$routeParams,mibReportService){mibReportService.reportInfo($routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(mibInfo){$scope.mib=mibInfo.mib,console.log(eval(mibInfo.genusDistributionInfo)),void 0!=mibInfo.readsDistributionInfo&&$.reportChar.draw.circularGraph("reads-distribution-char","Reads","Distribution",mibInfo.readsDistributionInfo),void 0!=mibInfo.familyDistributionInfo&&$.reportChar.draw.circularGraph("family-distribution-char","Family","Distribution",mibInfo.familyDistributionInfo),void 0!=mibInfo.genusDistributionInfo&&$.reportChar.draw.singleBar("genus-distribution-char","Top 10 genus distribution","",mibInfo.genusDistributionInfo,"Depth","Depth")})}),celloudApp.controller("ngsReportController",function($scope,$routeParams,mibReportService){mibReportService.reportInfo($routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(mibInfo){$scope.mib=mibInfo.mib,console.log(eval(mibInfo.genusDistributionInfo)),void 0!=mibInfo.readsDistributionInfo&&$.reportChar.draw.circularGraph("reads-distribution-char","Reads","Distribution",mibInfo.readsDistributionInfo),void 0!=mibInfo.familyDistributionInfo&&$.reportChar.draw.circularGraph("family-distribution-char","Family","Distribution",mibInfo.familyDistributionInfo),void 0!=mibInfo.genusDistributionInfo&&$.reportChar.draw.singleBar("genus-distribution-char","Top 10 genus distribution","",mibInfo.genusDistributionInfo,"Depth","Depth")})})}();
!function(){celloudApp.service("projectReportService",function($resource,$http){var self=this;self.getRanAPP=function(){return $resource("app/getRanAPP").get()},self.getReportList=function(){return $resource("report/getReportPageList").get()},self.getReportListCondition=function(currentPage,pageSize,belongs,start,end,appId,condition){return $http.get("report/getReportPageList?random="+(new Date).getTime(),{params:{page:currentPage,size:pageSize,condition:condition,start:start,end:end,appId:appId,belongs:belongs}})},self.changeProjectName=function(projectId,projectName){return $http.get("project/update",{params:{projectId:projectId,projectName:projectName}})},self.deleteProject=function(projectId){return $http.get("project/deleteByState",{params:{projectId:projectId}})},self.cancelProjectShare=function(projectId){return $http.get("project/deleteShare",{params:{projectId:projectId}})},self.projectShare=function(projectId,userNames){return $http.get("project/shareProject",{params:{projectId:projectId,userNames:userNames}})},self.getShareTo=function(projectId){return $http.get("project/getShareTo",{params:{projectId:projectId}})},self.downPDF=function(path){return $http.get("report/down",{params:{path:path}})}}),celloudApp.service("dataReportService",function($resource,$http){var self=this;self.getReports=function(){return $resource("report/dataReportPages?v="+(new Date).getTime()).get()},self.getReportsByParams=function(currentPage,pageSize,condition,beginDate,endDate,batch,tagId,period,sort){return $http.get("report/dataReportPages?v="+(new Date).getTime(),{params:{page:currentPage,size:pageSize,condition:condition,beginDate:beginDate,endDate:endDate,tagId:tagId,batch:batch,period:period,sort:sort}})},self.getSearchInfos=function(){return $resource("report/reportSearchInfo?v="+(new Date).getTime()).get()},self.getDataReportInfo=function(url,dataKey,projectId,appId){return $http({method:"POST",url:url,data:$.param({dataKey:dataKey,projectId:projectId,appId:appId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},self.dataInBatch=function(params){return $http({url:"report/reportInBatch",method:"POST",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){function viewDataReport(userId,dataKey,fileName,appId,appName,proId,proName,obj){for(index in rememberDataReport)if(rememberDataReport[index].proId==proId){var dataKeys=rememberDataReport[index].dataKeys;break}if(void 0!=dataKeys){var flag=!1;for(key in dataKeys)if(dataKeys[key]==dataKey){flag=!0;break}flag||dataKeys.push(dataKey)}else{var remember={proId:proId,dataKeys:[dataKey]};rememberDataReport.push(remember)}if(81==appId||83==appId||85==appId||86==appId||87==appId||88==appId||91==appId||92==appId||93==appId||94==appId||99==appId||100==appId||101==appId||104==appId||116==appId||119==appId||120==appId||121==appId||122==appId||124==appId||125==appId||129==appId||130==appId)var href="#/reportpro/PGS/"+appId+"/"+dataKey+"/"+proId;else if(138==appId)var href="#/reportdata/Sanger/"+appId+"/"+dataKey+"/"+proId;else var href="#/reportpro/"+appName+"/"+appId+"/"+dataKey+"/"+proId;window.location.href=href}function getCountValue(key,id){var val,num=0;return $("#"+id).find("tr").each(function(i){0==i?$(this).find("th").each(function(j){var title=$(this).html();title==key&&(num=j)}):$(this).find("td").each(function(k){if(num==k&&(val=$(this).html(),val.indexOf(",")>0)){var reg=new RegExp(",","g");val=val.replace(reg,"")}})}),val}function dataInPro(appInfo,proId,projectName){$.get("data/getDataFromTbTask",{projectId:proId},function(fileList){$("#fileListUl").append("<a id='prevA' class='btn -low' style='width:100%;'><span class='fa fa-sort-asc'></span></button>");var fileNames=new Array,newList="";if(appId=appInfo.appId,userId=appInfo.userId,dataKey=appInfo.dataKey,110==appId||111==appId||112==appId||113==appId||126==appId||127==appId||128==appId||131==appId||279==appId){$.each(fileList,function(index,item){utils.isConfigure(item.fileName)||fileNames.push(item.fileName)}),newList="[{",fileNames.sort();for(var fileId_n="fileId:",fileName_n=",fileName:'",dataKey_n=",dataKey:'",code_n=",code:'",i=0;i<fileNames.length;i++)fileName_n+=fileNames[i],i<fileNames.length-1&&(fileName_n+="_&_");$.each(fileList,function(index,item){fileNames[0]==item.fileName&&(fileId_n+=item.fileId,dataKey_n+=item.dataKey,code_n+=item.code)}),newList+=fileId_n+fileName_n+"'"+dataKey_n+"'"+code_n+"'}]",newList=eval(newList)}else newList=fileList;$.each(newList,function(index,item){var inner="",obj1=$("#dataSpan"+proId+item.dataKey);0==index&&(dataItem0=item,obj1=$("#dataSpan"+proId+dataItem0.dataKey));var isActive="";item.dataKey==dataKey&&(isActive="active",reportIdNow="fileA"+proId+item.fileId),inner+="<a class='btn -low "+isActive+"' style='font-size:12px;width:100%;margin-top:1px;' id='fileA"+proId+item.fileId+"' title='"+item.fileName+"'>"+(item.fileName.length>15?item.fileName.substring(0,15)+"...":item.fileName)+"</button>",$("#fileListUl").append(inner),$("#fileA"+proId+item.fileId).bind("click",function(){viewDataReport(userId,item.dataKey,item.fileName,appId,item.code,proId,projectName,$(this)),$.get("report/clickItemDataReport",{},function(state){})})}),$("#fileListUl").append("<a id='nextA' class='btn -low' style='width:100%;margin-top:1px;'><span class='caret'></span></button>"),$("#prevA").bind("click",function(){var preId=$("#"+reportIdNow).prev().attr("id");return"prevA"==preId?void $.alert("已经是第一条数据"):($("#fileListUl").find("#"+preId).trigger("click"),$("#fileListUl").removeClass("active"),$("#"+preId).addClass("active"),void $.get("report/prevDataReport",{},function(state){}))}),$("#nextA").bind("click",function(){var nextId=$("#"+reportIdNow).next().attr("id");return"nextA"==nextId?void $.alert("已经是最后一条数据"):($("#fileListUl").find("#"+nextId).trigger("click"),$("#fileListUl").removeClass("active"),$("#"+nextId).addClass("active"),void $.get("report/nextDataReport",{},function(state){}))})})}celloudApp.directive("loadOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("reportLoadOver")})}}}),celloudApp.directive("pgsOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("pgsLoadOver")})}}}),celloudApp.controller("accuseqa2DataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getAccuSeqα2Info",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(accuSeqα2Info){$scope.accuSeq=accuSeqα2Info.accuSeqα2,$scope.project=accuSeqα2Info.project,$scope.uploadPath=accuSeqα2Info.uploadPath,dataInPro($scope.accuSeq,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataAccuseqa2DataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getAccuSeqα2Info",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(accuSeqα2Info){$scope.accuSeq=accuSeqα2Info.accuSeqα2,$scope.project=accuSeqα2Info.project,$scope.uploadPath=accuSeqα2Info.uploadPath,$scope.appName="AccuSeqα2",$scope.obj=$scope.accuSeq,$scope.obj.batch=accuSeqα2Info.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("commonReport",function($rootScope,dataReportService){$rootScope.dataInBatch=function(currentPage,obj){var params={};null!=currentPage&&(params.currentPage=currentPage),params.appId=obj.appId,params.projectId=obj.projectId,params.dataKey=obj.dataKey,params.batch=obj.batch,dataReportService.dataInBatch(params).success(function(data){$rootScope.taskPageList=data})}}),celloudApp.controller("egfrDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getEGFRInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(egfrInfo){$scope.egfr=egfrInfo.egfr,$scope.project=egfrInfo.project,$scope.uploadPath=egfrInfo.uploadPath,dataInPro($scope.egfr,$scope.project.projectId,$scope.project.projectName);var length=$scope.egfr.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/egfrCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("dataEgfrDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getEGFRInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(egfrInfo){$scope.egfr=egfrInfo.egfr,$scope.project=egfrInfo.project,$scope.uploadPath=egfrInfo.uploadPath,$scope.appName="EGFR",$scope.obj=$scope.egfr,$scope.obj.batch=egfrInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var length=$scope.egfr.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/egfrCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("krasDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getKRASInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(krasInfo){$scope.kras=krasInfo.kras,$scope.project=krasInfo.project,$scope.uploadPath=krasInfo.uploadPath,dataInPro($scope.kras,$scope.project.projectId,$scope.project.projectName);var length=$scope.kras.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/krasCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("dataKrasDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getKRASInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(krasInfo){$scope.kras=krasInfo.kras,$scope.project=krasInfo.project,$scope.uploadPath=krasInfo.uploadPath,$scope.appName="KRAS",$scope.obj=$scope.kras,$scope.obj.batch=krasInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var length=$scope.kras.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/krasCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("hcvDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getHCVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hcvInfo){$scope.hcv=hcvInfo.hcv,$scope.project=hcvInfo.project,$scope.uploadPath=hcvInfo.uploadPath,dataInPro($scope.hcv,$scope.project.projectId,$scope.project.projectName),$scope.change=function(){var val=$("#_change").html();"显示更多"==val?($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#_change").html("返回")):($("#nomal").css("display","none"),$("#cfda").css("display",""),$("#_change").html("显示更多"))},$.get("count/hcvCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split(";"),k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',",Y+=n[0]==one?"{ dataLabels: { enabled: true, y: 0, crop: false, style: { fontWeight: 'bold', fontSize:16 }, }, y:"+n[1]+"},":n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","Subtype",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("dataHcvDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getHCVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hcvInfo){$scope.hcv=hcvInfo.hcv,$scope.project=hcvInfo.project,$scope.uploadPath=hcvInfo.uploadPath,$scope.appName="HCV_Genotype",$scope.obj=$scope.hcv,$scope.obj.batch=hcvInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.change=function(){var val=$("#_change").html();"显示更多"==val?($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#_change").html("返回")):($("#nomal").css("display","none"),$("#cfda").css("display",""),$("#_change").html("显示更多"))},$.get("count/hcvCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split(";"),k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',",Y+=n[0]==one?"{ dataLabels: { enabled: true, y: 0, crop: false, style: { fontWeight: 'bold', fontSize:16 }, }, y:"+n[1]+"},":n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","Subtype",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("brafDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBRAFInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(brafInfo){if($scope.braf=brafInfo.braf,$scope.project=brafInfo.project,$scope.uploadPath=brafInfo.uploadPath,dataInPro($scope.braf,$scope.project.projectId,$scope.project.projectName),void 0!=$scope.braf){var $table=$($scope.braf.mutationPosition);$scope.searchTable=function(){var result="";$table.find("td").each(function(){var context=$(this).html(),len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(k==-1)result+=after;else if(before!=after)result+=after;else{var search=$("#_snum").val(),r=context.substring(d+1,k);if(parseFloat(r)>parseFloat(search))result+=after;else{var l=context.indexOf("|"),r=context.indexOf("(");result+=context.substring(l+1,r)}}}),$("#searchResult").html(map[result])},$scope.searchTable()}})}),celloudApp.controller("dataBrafDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBRAFInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(brafInfo){if($scope.braf=brafInfo.braf,$scope.project=brafInfo.project,$scope.uploadPath=brafInfo.uploadPath,$scope.appName="BRAF",$scope.obj=$scope.braf,$scope.obj.batch=brafInfo.batch,$rootScope.dataInBatch(null,$scope.obj),void 0!=$scope.braf){var $table=$($scope.braf.mutationPosition);$scope.searchTable=function(){var result="";$table.find("td").each(function(){var context=$(this).html(),len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(k==-1)result+=after;else if(before!=after)result+=after;else{var search=$("#_snum").val(),r=context.substring(d+1,k);if(parseFloat(r)>parseFloat(search))result+=after;else{var l=context.indexOf("|"),r=context.indexOf("(");result+=context.substring(l+1,r)}}}),$("#searchResult").html(map[result])},$scope.searchTable()}})}),celloudApp.controller("tbRifampicinDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBRifampicinInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbrifampicinInfo){$scope.tbrifampicin=tbrifampicinInfo.tbrifampicin,$scope.project=tbrifampicinInfo.project,$scope.uploadPath=tbrifampicinInfo.uploadPath,dataInPro($scope.tbrifampicin,$scope.project.projectId,$scope.project.projectName),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.tbrifampicin.report).find("td").each(function(){var context=$(this).html();if(search){var len=context.indexOf("-"),d=context.indexOf(","),k=context.indexOf(")");if(len==-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)<parseFloat(search))$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var kl=context.indexOf("(");context=context.substring(0,kl)+context.substring(k+1,context.length),$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3));if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var c5,c=context.split("\t"),c3=c[3].substring(0,c[3].indexOf("|")),c4=(c[4].substring(0,c[3].lastIndexOf("|")-1)+c[4].substring(c[4].lastIndexOf(")")+1,c[4].length)).replace("(","");c5=c[5].indexOf("|")==-1?c[5]:c[5].substring(0,c[5].indexOf("|"));var last=c[0]+"\t"+c[1]+"\t"+c[2]+"\t"+c3+"\t"+c4+"\t"+c5;$("#_sr").append("<tr><td>"+last.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")})},$scope.searchTable(),$.get("count/tbCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("dataTbRifampicinDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBRifampicinInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbrifampicinInfo){$scope.tbrifampicin=tbrifampicinInfo.tbrifampicin,$scope.project=tbrifampicinInfo.project,$scope.uploadPath=tbrifampicinInfo.uploadPath,$scope.appName="TB-Rifampicin",$scope.obj=$scope.tbrifampicin,$scope.obj.batch=tbrifampicinInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.tbrifampicin.report).find("td").each(function(){var context=$(this).html();if(search){var len=context.indexOf("-"),d=context.indexOf(","),k=context.indexOf(")");if(len==-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)<parseFloat(search))$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var kl=context.indexOf("(");context=context.substring(0,kl)+context.substring(k+1,context.length),$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3));if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var c5,c=context.split("\t"),c3=c[3].substring(0,c[3].indexOf("|")),c4=(c[4].substring(0,c[3].lastIndexOf("|")-1)+c[4].substring(c[4].lastIndexOf(")")+1,c[4].length)).replace("(","");c5=c[5].indexOf("|")==-1?c[5]:c[5].substring(0,c[5].indexOf("|"));var last=c[0]+"\t"+c[1]+"\t"+c[2]+"\t"+c3+"\t"+c4+"\t"+c5;$("#_sr").append("<tr><td>"+last.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")})},$scope.searchTable(),$.get("count/tbCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("tbinhDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBINHInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbinhInfo){$scope.tbinh=tbinhInfo.tbinh,$scope.project=tbinhInfo.project,$scope.uploadPath=tbinhInfo.uploadPath,dataInPro($scope.tbinh,$scope.project.projectId,$scope.project.projectName);var mutant=tbinhInfo.mutant,wild=tbinhInfo.wild,neither=tbinhInfo.neither,data=[{name:"Mutant strain",value:mutant},{name:"Wild type",value:wild},{name:"No Result",value:neither}];$.reportChar.draw.echartsShowPie("_showPie","Samples Statistic",data),$scope.searchTable=function(numId,sourceId,resultId){var search=$("#"+numId).val();$("#"+resultId).html("");var i=0;"r1"==sourceId?$table=$($scope.tbinh.position):$table=$($scope.tbinh.mutationPosition),$table.find("td").each(function(){var context=$(this).html();if(""==search)i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var len=context.lastIndexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&(i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>"))}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),i++,$("#"+resultId).append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}}}),0==i&&$("#"+resultId).append("<tr><td style='color:red'>没有符合筛选条件的结果</tr></td>")},$scope.searchTable("_snum1","r1","_sr1"),$scope.searchTable("_snum2","r2","_sr2")})}),celloudApp.controller("dataTbinhDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBINHInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbinhInfo){$scope.tbinh=tbinhInfo.tbinh,$scope.project=tbinhInfo.project,$scope.uploadPath=tbinhInfo.uploadPath,$scope.appName="TB-INH",$scope.obj=$scope.tbinh,$scope.obj.batch=tbinhInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var mutant=tbinhInfo.mutant,wild=tbinhInfo.wild,neither=tbinhInfo.neither,data=[{name:"Mutant strain",value:mutant},{name:"Wild type",value:wild},{name:"No Result",value:neither}];$.reportChar.draw.echartsShowPie("_showPie","Samples Statistic",data),$scope.searchTable=function(numId,sourceId,resultId){var search=$("#"+numId).val();$("#"+resultId).html("");var i=0;"r1"==sourceId?$table=$($scope.tbinh.position):$table=$($scope.tbinh.mutationPosition),$table.find("td").each(function(){var context=$(this).html();if(""==search)i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var len=context.lastIndexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&(i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>"))}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),i++,$("#"+resultId).append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}}}),0==i&&$("#"+resultId).append("<tr><td style='color:red'>没有符合筛选条件的结果</tr></td>")},$scope.searchTable("_snum1","r1","_sr1"),$scope.searchTable("_snum2","r2","_sr2")})}),celloudApp.controller("hbvDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.hbvOtherSiteList=hbvInfo.hbvOtherSiteList,$scope.siteKeys=new Array,$scope.lowQcStr=null,$scope.hbv.lowQc&&($scope.lowQcStr=$scope.hbv.lowQc.join(","));for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])$scope.siteKeys.push(j);dataInPro($scope.hbv,$scope.project.projectId,$scope.project.projectName),$scope.change1=function(){if($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#showMain").scrollTop(0),void 0==localStorage.hbvIntro&&(localStorage.hbvIntro=0),0==localStorage.hbvIntro){var intro=introJs();intro.setOption("tooltipPosition","bottom"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.setOption("highlightClass","hbv-introjs-helperLayer"),intro.setOption("tooltipClass","introjs-hbv-tooltip"),intro.goToStep(2).start()}},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display",""),$("#showMain").scrollTop(0)},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)};var X=new Array,Y=new Array;for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])Y.push(j),X.push($scope.hbvOtherSiteList[i][j].count);X.length>20?(xLess=X.slice(0,20),yLess=Y.slice(0,20)):(xLess=X,yLess=Y),xLess=xLess.reverse(),yLess=yLess.reverse();var divLess=$("<div id='less' class='col-lg-12' style='width: 1000px;height: "+40*xLess.length+"px;'></div>");xLessStr="["+xLess.join(",")+"]",yLessStr="["+yLess.join(",")+"]",$("#charDiv0").append(divLess),$.reportChar.draw.echartsShowHorizontalBar("less","其他位点",eval(xLessStr),eval(yLessStr),700,40*xLess.length,"其他位点数量"),X=X.reverse(),Y=Y.reverse();var divMore=$("<div id='more' class='col-lg-12' style='width: 1000px;height: "+40*X.length+"px;'></div>");XStr="["+X.join(",")+"]",YStr="["+Y.join(",")+"]",$("#charDiv0").append(divMore),$.reportChar.draw.echartsShowHorizontalBar("more","其他位点",eval(XStr),eval(YStr),700,40*X.length,"其他位点数量"),$scope.more=!0,$("#more").hide(),$scope.tablePos=document.getElementById("tableDiv").offsetTop,$scope.chartPos=document.getElementById("charDiv0").offsetTop,$scope.showMore=function(flag){$("#more").show(),$("#less").hide(),$scope.more=!1,$scope.less=!0,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$scope.showLess=function(flag){$("#more").hide(),$("#less").show(),$scope.more=!0,$scope.less=!1,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",$routeParams.appId,hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("dataHbvDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.appName="HBV_SNP2",$scope.obj=$scope.hbv,$scope.obj.batch=hbvInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.hbvOtherSiteList=hbvInfo.hbvOtherSiteList,$scope.siteKeys=new Array,$scope.lowQcStr=null,$scope.hbv.lowQc&&($scope.lowQcStr=$scope.hbv.lowQc.join(","));for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])$scope.siteKeys.push(j);$scope.change1=function(){
if($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#showMain").scrollTop(0),void 0==localStorage.hbvIntro&&(localStorage.hbvIntro=0),0==localStorage.hbvIntro){var intro=introJs();intro.setOption("tooltipPosition","bottom"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.setOption("highlightClass","hbv-introjs-helperLayer"),intro.setOption("tooltipClass","introjs-hbv-tooltip"),intro.goToStep(2).start()}},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display",""),$("#showMain").scrollTop(0)},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)};var X=new Array,Y=new Array;for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])Y.push(j),X.push($scope.hbvOtherSiteList[i][j].count);X.length>20?(xLess=X.slice(0,20),yLess=Y.slice(0,20)):(xLess=X,yLess=Y),xLess=xLess.reverse(),yLess=yLess.reverse();var divLess=$("<div id='less' class='col-lg-12' style='width: 1000px;height: "+40*xLess.length+"px;'></div>");xLessStr="["+xLess.join(",")+"]",yLessStr="["+yLess.join(",")+"]",$("#charDiv0").append(divLess),$.reportChar.draw.echartsShowHorizontalBar("less","其他位点",eval(xLessStr),eval(yLessStr),700,40*xLess.length,"其他位点数量"),X=X.reverse(),Y=Y.reverse();var divMore=$("<div id='more' class='col-lg-12' style='width: 1000px;height: "+40*X.length+"px;'></div>");XStr="["+X.join(",")+"]",YStr="["+Y.join(",")+"]",$("#charDiv0").append(divMore),$.reportChar.draw.echartsShowHorizontalBar("more","其他位点",eval(XStr),eval(YStr),700,40*X.length,"其他位点数量"),$scope.more=!0,$("#more").hide(),$scope.tablePos=document.getElementById("tableDiv").offsetTop,$scope.chartPos=document.getElementById("charDiv0").offsetTop,$scope.showMore=function(flag){$("#more").show(),$("#less").hide(),$scope.more=!1,$scope.less=!0,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$scope.showLess=function(flag){$("#more").hide(),$("#less").show(),$scope.more=!0,$scope.less=!1,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",$routeParams.appId,hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("sangerDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.hbvOtherSiteList=hbvInfo.hbvOtherSiteList,$scope.siteKeys=new Array,$scope.lowQcStr=null,$scope.hbv.lowQc&&($scope.lowQcStr=$scope.hbv.lowQc.join(","));for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])$scope.siteKeys.push(j);dataInPro($scope.hbv,$scope.project.projectId,$scope.project.projectName),$scope.change1=function(){$("#nomal").css("display",""),$("#cfda").css("display","none"),$("#showMain").scrollTop(0)},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display",""),$("#showMain").scrollTop(0)},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)};var X=new Array,Y=new Array;for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])Y.push(j),X.push($scope.hbvOtherSiteList[i][j].count);X.length>20?(xLess=X.slice(0,20),yLess=Y.slice(0,20)):(xLess=X,yLess=Y),xLess=xLess.reverse(),yLess=yLess.reverse();var divLess=$("<div id='less' class='col-lg-12' style='width: 1000px;height: "+40*xLess.length+"px;'></div>");xLessStr="["+xLess.join(",")+"]",yLessStr="["+yLess.join(",")+"]",$("#charDiv0").append(divLess),$.reportChar.draw.echartsShowHorizontalBar("less","其他位点",eval(xLessStr),eval(yLessStr),700,40*xLess.length,"其他位点数量"),X=X.reverse(),Y=Y.reverse();var divMore=$("<div id='more' class='col-lg-12' style='width: 1000px;height: "+40*X.length+"px;'></div>");XStr="["+X.join(",")+"]",YStr="["+Y.join(",")+"]",$("#charDiv0").append(divMore),$.reportChar.draw.echartsShowHorizontalBar("more","其他位点",eval(XStr),eval(YStr),700,40*X.length,"其他位点数量"),$scope.more=!0,$("#more").hide(),$scope.tablePos=document.getElementById("tableDiv").offsetTop,$scope.chartPos=document.getElementById("charDiv0").offsetTop,$scope.showMore=function(flag){$("#more").show(),$("#less").hide(),$scope.more=!1,$scope.less=!0,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$scope.showLess=function(flag){$("#more").hide(),$("#less").show(),$scope.more=!0,$scope.less=!1,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("oncogeneDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getOncogeneInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(oncogeneInfo){$scope.oncogene=oncogeneInfo.oncogene,$scope.project=oncogeneInfo.project,$scope.uploadPath=oncogeneInfo.uploadPath,dataInPro($scope.oncogene,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataOncogeneDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getOncogeneInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(oncogeneInfo){$scope.oncogene=oncogeneInfo.oncogene,$scope.project=oncogeneInfo.project,$scope.uploadPath=oncogeneInfo.uploadPath,$scope.appName="oncogene",$scope.obj=$scope.oncogene,$scope.obj.batch=oncogeneInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("dpdDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getDpdInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(dpdInfo){$scope.dpd=dpdInfo.dpd,$scope.project=dpdInfo.project,$scope.uploadPath=dpdInfo.uploadPath,dataInPro($scope.dpd,$scope.project.projectId,$scope.project.projectName),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.dpd.mutationPosition).find("td").each(function(){var context=$(this).html();if(""==search)$("#_sr").append("<tr><td>"+context+"</tr></td>");else{var len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),$("#_sr").append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else $("#_sr").append("<tr><td>"+context+"</tr></td>")}}})},$scope.searchTable()})}),celloudApp.controller("dataDpdDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getDpdInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(dpdInfo){$scope.dpd=dpdInfo.dpd,$scope.project=dpdInfo.project,$scope.uploadPath=dpdInfo.uploadPath,$scope.appName="DPD",$scope.obj=$scope.dpd,$scope.obj.batch=dpdInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.dpd.mutationPosition).find("td").each(function(){var context=$(this).html();if(""==search)$("#_sr").append("<tr><td>"+context+"</tr></td>");else{var len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),$("#_sr").append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else $("#_sr").append("<tr><td>"+context+"</tr></td>")}}})},$scope.searchTable()})}),celloudApp.controller("abinjDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getABINJInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(abinjInfo){$scope.abinj=abinjInfo.abinj,$scope.project=abinjInfo.project,$scope.uploadPath=abinjInfo.uploadPath,dataInPro($scope.abinj,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataAbinjDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getABINJInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(abinjInfo){$scope.abinj=abinjInfo.abinj,$scope.project=abinjInfo.project,$scope.uploadPath=abinjInfo.uploadPath,$scope.appName="ABI_NJ",$scope.obj=$scope.abinj,$scope.obj.batch=abinjInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("ugtDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getUGTInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(ugtInfo){$scope.ugt=ugtInfo.ugt,$scope.project=ugtInfo.project,$scope.uploadPath=ugtInfo.uploadPath,dataInPro($scope.ugt,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataUgtDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getUGTInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(ugtInfo){$scope.ugt=ugtInfo.ugt,$scope.project=ugtInfo.project,$scope.uploadPath=ugtInfo.uploadPath,$scope.appName="UGT",$scope.obj=$scope.ugt,$scope.obj.batch=ugtInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("16sDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/get16SInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(s16Info){$scope.s16=s16Info.s16,$scope.project=s16Info.project,$scope.uploadPath=s16Info.uploadPath,dataInPro($scope.s16,$scope.project.projectId,$scope.project.projectName);var $table=$("<div>"+$scope.s16.resultTable+"</div>");$table.find("tr").each(function(i){0==i?length=$(this).find("td").length:(tdlength=$(this).find("td").length,tdlength<length&&$(this).children("td").eq(1).attr("colspan",5))}),$scope.s16.resultTable=$table.html()})}),celloudApp.controller("data16sDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/get16SInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(s16Info){$scope.s16=s16Info.s16,$scope.project=s16Info.project,$scope.uploadPath=s16Info.uploadPath,$scope.appName="16S",$scope.obj=$scope.s16,$scope.obj.batch=s16Info.batch,$rootScope.dataInBatch(null,$scope.obj);var $table=$("<div>"+$scope.s16.resultTable+"</div>");$table.find("tr").each(function(i){0==i?length=$(this).find("td").length:(tdlength=$(this).find("td").length,tdlength<length&&$(this).children("td").eq(1).attr("colspan",5))}),$scope.s16.resultTable=$table.html()})}),celloudApp.controller("translateDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTranslateInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(translateInfo){$scope.translate=translateInfo.translate,$scope.project=translateInfo.project,$scope.uploadPath=translateInfo.uploadPath,dataInPro($scope.translate,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataTranslateDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTranslateInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(translateInfo){$scope.translate=translateInfo.translate,$scope.project=translateInfo.project,$scope.uploadPath=translateInfo.uploadPath,$scope.appName="translate_simplified",$scope.obj=$scope.translate,$scope.obj.batch=translateInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("gddDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getGDDInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(gddInfo){$scope.gdd=gddInfo.cmp,$scope.project=gddInfo.project,$scope.uploadPath=gddInfo.uploadPath,dataInPro($scope.gdd,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataGddDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getGDDInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(gddInfo){$scope.gdd=gddInfo.cmp,$scope.project=gddInfo.project,$scope.uploadPath=gddInfo.uploadPath,$scope.appName=$scope.gdd.appName,$scope.obj=$scope.gdd,$scope.obj.batch=gddInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("cmpDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getCMPInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(cmpInfo){$scope.cmp=cmpInfo.cmp,$scope.project=cmpInfo.project,$scope.uploadPath=cmpInfo.uploadPath,dataInPro($scope.cmp,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataCmpDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getCMPInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(cmpInfo){$scope.cmp=cmpInfo.cmp,$scope.project=cmpInfo.project,$scope.uploadPath=cmpInfo.uploadPath,$scope.appName=$scope.cmp.appName,$scope.obj=$scope.cmp,$scope.obj.batch=cmpInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("bsiDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBSIInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(bsiInfo){if($scope.bsi=bsiInfo.bsi,$scope.project=bsiInfo.project,$scope.uploadPath=bsiInfo.uploadPath,$scope.tab="patient",$scope.havestrain="",$scope.bsi&&$scope.bsi.species_20){for(var i=0;i<$scope.bsi.species_20.length;i++)havestrain+=$scope.bsi.species_20[i].species_zh+",";$scope.havestrain=havestrain.substr(0,havestrain.length-1)}$scope.getRowspan=function(val1,val2,val3){var val0=1;return null!=val1&&val0++,null!=val2&&val0++,null!=val3&&val0++,val0}})}),celloudApp.controller("rockyDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getRockyInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(rockyInfo){$scope.rocky=rockyInfo.rocky,$scope.project=rockyInfo.project,$scope.uploadPath=rockyInfo.uploadPath,$scope.significances=rockyInfo.significances})}),celloudApp.controller("fsocgDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getFSocgInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(fsocgInfo){$scope.fsocg=fsocgInfo.fsocg,$scope.appName=$scope.fsocg.appName,$scope.obj=$scope.fsocg,$scope.obj.batch=fsocgInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("dataMibReportController",function($scope,$rootScope,$routeParams,mibReportService){mibReportService.reportInfo($routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(mibInfo){$scope.mib=mibInfo.mib,$scope.appName="MIB",$scope.obj=$scope.mib,$scope.obj.batch=mibInfo.batch,$rootScope.dataInBatch(null,$scope.obj),void 0!=mibInfo.readsDistributionInfo&&$.reportChar.draw.circularGraph("reads-distribution-char","Reads","Distribution",mibInfo.readsDistributionInfo),void 0!=mibInfo.familyDistributionInfo&&$.reportChar.draw.circularGraph("family-distribution-char","Family","Distribution",mibInfo.familyDistributionInfo),void 0!=mibInfo.genusDistributionInfo&&$.reportChar.draw.singleBar("genus-distribution-char","Top 10 genus distribution","",mibInfo.genusDistributionInfo,"Depth","Depth")})}),celloudApp.controller("splitDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getSplitInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(splitInfo){$scope.split=splitInfo.split,$scope.project=splitInfo.project,$scope.uploadPath=splitInfo.uploadPath,$scope.appName="split",$scope.obj=$scope.split,$scope.obj.batch=splitInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var printReport={main:function(method,param){$.get(method,param,function(responseText){var obj=window.open("");obj.document.write(responseText),obj.document.close()})},mongoParam:function(projectId,dataKey,appId){var _param={projectId:projectId,dataKey:dataKey,appId:appId};return _param}};$scope.printSplit=function(projectId,dataKey,appId){printReport.main("report/printSplitReport",printReport.mongoParam(projectId,dataKey,appId))},$.get("count/splitCompare",{id:splitInfo.splitId},function(data){var totalSource=JSON.stringify(data.totalSource),totalSample=JSON.stringify(data.totalSample),thisSource=JSON.stringify(data.thisSource),thisSample=JSON.stringify(data.thisSample);console.log("totalSource: "+totalSource),console.log("totalSample: "+totalSample),console.log("thisSource: "+thisSource),console.log("thisSample: "+thisSample),drawScatter("sourceCharDiv",eval(totalSource),eval(thisSource),"Split源数据同比图","平均质量","序列总数"),drawScatter("sampleCharDiv",eval(totalSample),eval(thisSample),"Split分离结果数据同比图","平均质量","序列总数")})})}),celloudApp.controller("pgsDataReportController",function($scope,$routeParams,$compile,dataReportService){$scope.$on("pgsLoadOver",function(){var num=0;$("#reportDiv").find("td").each(function(){var result=$(this).text();num%4==0&&$(this).css("min-width","90px"),num%4==1&&$(this).css("min-width","55px"),num%4==2&&result.length>85&&($(this).html(result.substring(0,84)+"..."),$(this).attr("title",result)),num%4==3&&(result.length>39&&($(this).html(result.substring(0,38)+"..."),$(this).attr("title",result)),$(this).css("width","300px")),$(this).css("padding-left","20px"),$(this).css("text-align","left"),num++});var trTotal=0,tr=0,count=1,need=!1;$("#reportDiv").find("tr").each(function(){var tdVal=$(this).children("td").eq(0).html();if(tdVal.toLowerCase().indexOf("chr")==-1)$(this).children("td").eq(2).remove(),$(this).children("td").eq(2).remove(),tr=trTotal-count,count++,need=!0;else if(need){var rowTr=$("#reportTable tr").eq(tr);$(rowTr).children("td").eq(0).attr("rowspan",count),$(rowTr).children("td").eq(0).css("vertical-align","middle"),$(rowTr).children("td").eq(1).attr("rowspan",count),$(rowTr).children("td").eq(1).css("vertical-align","middle"),count=1,need=!1}trTotal++})}),dataReportService.getDataReportInfo("report/getPgsInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(pgsInfo){function showEdditError(info){$("#edit-conclusionErrorInfo").html(info),$("#edit-conclusion-error").removeClass("hide")}$scope.pgs=pgsInfo.pgs,$scope.experiment=pgsInfo.experiment,$scope.project=pgsInfo.project,$scope.uploadPath=pgsInfo.uploadPath,dataInPro($scope.pgs,$scope.project.projectId,$scope.project.projectName),$scope.editShowConclusion=function(){$("#edit-conclusion-error").addClass("hide"),$("#editReportConclusion").modal("show")},$scope.saveConclusion=function(){var qualified=$("#reportConclusion").find("input:radio[name='qualified']:checked").val();return qualified?void $.get("experiment/updateExperiment",$("#reportConclusionForm").serialize(),function(flag){1==flag?(showAddError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#reportConclusion").modal("hide")},2e3)):showAddError("保存失败！")}):void showAddError("请选择是否合格！")},$scope.editSaveConclusion=function(){var qualified=$("#editReportConclusion").find("input:radio[name='qualified']:checked").val();if(!qualified)return void showEdditError("请选择是否合格！");var remarks=$("#editReportConclusion").find("textarea[name='remarks']").val();return remarks.length>125?void showEdditError("备注长度不能大于125个字符！！"):void $.get("experiment/updateExperiment",$("#editReportConclusionForm").serialize(),function(flag){1==flag?(showEdditError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#editReportConclusion").modal("hide")},2e3)):showEdditError("保存失败！")})},$scope.showModal=function(id){$("#"+id).modal("show")};var appId=$scope.pgs.appId;$.get("count/pgsCompare",{appId:appId,columns:charMap[appId]},function(data){var sp=data.split(";");$("#charResult").html("");for(var i=1;i<sp.length;i++){var big=0,div=$("<div id='char"+i+"' class='col-lg-5' style='width: 410px;height:400px;'></div>");$("#charDiv").append(div);for(var ev=sp[i].split(":"),one=getCountValue(ev[0],"_table"),value=ev[1].split(","),context="[",k=0;k<value.length-1;k++)context+="[1,"+value[k]+"],",value[k]>one&&big++;context+="]";var percent=0;percent="Duplicate"==ev[0]||"Duplicate(%)"==ev[0]||"*SD"==ev[0]?Math.round(big/value.length*100):100-Math.round(big/value.length*100),$("#charResult").append("本数据的 "+ev[0]+" 打败了 <span class='green'>"+percent+"%</span> 的数据；");var single="[[2,"+one+"]]";$.reportChar.draw.echartsShowScatter("char"+i,ev[0],eval(context),eval(single))}})})}),celloudApp.controller("dataPgsDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){$scope.$on("pgsLoadOver",function(){var num=0;$("#reportDiv").find("td").each(function(){var result=$(this).text();num%4==0&&$(this).css("min-width","90px"),num%4==1&&$(this).css("min-width","55px"),num%4==2&&result.length>85&&($(this).html(result.substring(0,84)+"..."),$(this).attr("title",result)),num%4==3&&(result.length>39&&($(this).html(result.substring(0,38)+"..."),$(this).attr("title",result)),$(this).css("width","300px")),$(this).css("padding-left","20px"),$(this).css("text-align","left"),num++});var trTotal=0,tr=0,count=1,need=!1;$("#reportDiv").find("tr").each(function(){var tdVal=$(this).children("td").eq(0).html();if(tdVal.toLowerCase().indexOf("chr")==-1)$(this).children("td").eq(2).remove(),$(this).children("td").eq(2).remove(),tr=trTotal-count,count++,need=!0;else if(need){var rowTr=$("#reportTable tr").eq(tr);$(rowTr).children("td").eq(0).attr("rowspan",count),$(rowTr).children("td").eq(0).css("vertical-align","middle"),$(rowTr).children("td").eq(1).attr("rowspan",count),$(rowTr).children("td").eq(1).css("vertical-align","middle"),count=1,need=!1}trTotal++})}),dataReportService.getDataReportInfo("report/getPgsInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(pgsInfo){function showEdditError(info){$("#edit-conclusionErrorInfo").html(info),$("#edit-conclusion-error").removeClass("hide")}$scope.pgs=pgsInfo.pgs,$scope.experiment=pgsInfo.experiment,$scope.project=pgsInfo.project,$scope.uploadPath=pgsInfo.uploadPath,$scope.appName="PGS",$scope.obj=$scope.pgs,$scope.obj.batch=pgsInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.editShowConclusion=function(){$("#edit-conclusion-error").addClass("hide"),$("#editReportConclusion").modal("show")},$scope.saveConclusion=function(){var qualified=$("#reportConclusion").find("input:radio[name='qualified']:checked").val();return qualified?void $.get("experiment/updateExperiment",$("#reportConclusionForm").serialize(),function(flag){1==flag?(showAddError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#reportConclusion").modal("hide")},2e3)):showAddError("保存失败！")}):void showAddError("请选择是否合格！")},$scope.editSaveConclusion=function(){var qualified=$("#editReportConclusion").find("input:radio[name='qualified']:checked").val();if(!qualified)return void showEdditError("请选择是否合格！");var remarks=$("#editReportConclusion").find("textarea[name='remarks']").val();return remarks.length>125?void showEdditError("备注长度不能大于125个字符！！"):void $.get("experiment/updateExperiment",$("#editReportConclusionForm").serialize(),function(flag){1==flag?(showEdditError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#editReportConclusion").modal("hide")},2e3)):showEdditError("保存失败！")})},$scope.showModal=function(id){$("#"+id).modal("show")};var appId=$scope.pgs.appId;$.get("count/pgsCompare",{appId:appId,columns:charMap[appId]},function(data){var sp=data.split(";");$("#charResult").html("");for(var i=1;i<sp.length;i++){var big=0,div=$("<div id='char"+i+"' class='col-lg-5' style='width: 410px;height:400px;'></div>");$("#charDiv").append(div);for(var ev=sp[i].split(":"),one=getCountValue(ev[0],"_table"),value=ev[1].split(","),context="[",k=0;k<value.length-1;k++)context+="[1,"+value[k]+"],",value[k]>one&&big++;context+="]";var percent=0;percent="Duplicate"==ev[0]||"Duplicate(%)"==ev[0]||"*SD"==ev[0]?Math.round(big/value.length*100):100-Math.round(big/value.length*100),$("#charResult").append("本数据的 "+ev[0]+" 打败了 <span class='green'>"+percent+"%</span> 的数据；");
var single="[[2,"+one+"]]";$.reportChar.draw.echartsShowScatter("char"+i,ev[0],eval(context),eval(single))}})})}),celloudApp.controller("projectReportController",function($scope,$rootScope,$routeParams,$location,projectReportService){$scope.companyId=companyId,$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,tokenSeparators:[","," "]}),$scope.ranAppList=projectReportService.getRanAPP(),$scope.projectOptions={page:$routeParams.page,pageSize:$routeParams.pageSize,belongs:$routeParams.belongs,changeDate:$routeParams.changeDate,start:$routeParams.start,end:$routeParams.end,app:$routeParams.app,condition:"all"==$routeParams.condition?"":$routeParams.condition},$scope.pageQuery=function(currentPage,pageSize){var belongs=$scope.projectOptions.belongs,start="all"==$scope.projectOptions.start?null:$scope.projectOptions.start+" 00:00:00",end="all"==$scope.projectOptions.end?null:$scope.projectOptions.end+" 23:59:59",app=$scope.projectOptions.app,condition=""==$scope.projectOptions.condition?null:$scope.projectOptions.condition;$scope.projectOptions.pageSize=pageSize,$scope.projectOptions.page=currentPage,projectReportService.getReportListCondition($scope.projectOptions.page,$scope.projectOptions.pageSize,belongs,start,end,app,condition).success(function(dataList){$scope.dataList=dataList})},$rootScope.goBack=function(){var belongs=$scope.projectOptions.belongs,changeDate=$scope.projectOptions.changeDate,start=$scope.projectOptions.start,end=$scope.projectOptions.end,app=$scope.projectOptions.app,condition=$scope.projectOptions.condition,pageSize=$scope.projectOptions.pageSize,page=$scope.projectOptions.page;condition=""==condition?"all":condition,window.location.href=CONTEXT_PATH+"/index#/reportpro/"+page+"/"+pageSize+"/"+belongs+"/"+changeDate+"/"+start+"/"+end+"/"+app+"/"+condition},$scope.pageQuery($scope.projectOptions.page,$scope.projectOptions.pageSize),$scope.changeBelongs=function(id){$scope.projectOptions.belongs=id,$scope.pageQuery(1,$scope.projectOptions.pageSize)};var START=null,END=null;$scope.changeDate=function(flag){if($scope.projectOptions.changeDate=flag,0==flag)START="all",END="all";else{var d=new Date,date=new Date(d.getTime()-864e5*flag),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();START=year+"-"+mounth+"-"+day,END=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()}$scope.dateQuery()},$scope.chooseDate=function(){return START=$("#_searchDate").val(),END=$("#_endDate").val(),START&&END?START>END?void $.alert("起始时间不能大于结束时间"):($scope.projectOptions.changeDate=-1,void $scope.dateQuery()):void $.alert("请同时选择起始时间和结束时间")},$scope.dateQuery=function(){null!=START&&($scope.projectOptions.start=START),null!=END&&($scope.projectOptions.end=END),$scope.pageQuery(1,$scope.projectOptions.pageSize)},$scope.changeApp=function(appId){$(".changeApp").removeClass("active"),$("#changeApp"+appId).addClass("active"),$scope.projectOptions.app=appId,$scope.pageQuery(1,$scope.projectOptions.pageSize)},$scope.changeCondition=function(){$scope.pageQuery(1,$scope.projectOptions.pageSize)},$scope.toChangePname=function(projectId){$("#showPname"+projectId).addClass("hide"),$("#changePname"+projectId).removeClass("hide")},$scope.changePname=function(projectId){var name=$("#updatePname"+projectId).val(),oldName=$("#pnameSpan"+projectId).text().trim();return name==oldName?($("#showPname"+projectId).removeClass("hide"),void $("#changePname"+projectId).addClass("hide")):void projectReportService.changeProjectName(projectId,name).success(function(response){response.success&&(name.length>13&&(name=name.substring(0,12)+"..."),$("#pnameSpan"+projectId).html(name),$("#showPname"+projectId).removeClass("hide"),$("#changePname"+projectId).addClass("hide")),$scope.message=response.message,$scope.state=!0})},$scope.cancelProjectShare=function(projectId){$.confirm("确定要删除该项目？","确认框",function(){projectReportService.cancelProjectShare(projectId).success(function(response){response.success&&$scope.pageQuery(1,$scope.projectOptions.pageSize),$.alert(response.message)})})},$scope.downPDF=function(userId,appId,projectId){var path=userId+"/"+appId+"/"+projectId+"/"+projectId+".pdf";projectReportService.downPDF(path).success(function(flag){if(1==flag)$.alert("没有可以下载的pdf文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"report/down?path="+path}})},$scope.toShareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,$scope.updateState=!1,$("#shareProjectSelect").html("")},$scope.shareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,projectReportService.getShareTo(projectId).success(function(data){$scope.updateState=!1,$("#shareProjectSelect").html(""),$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,data:data,tokenSeparators:[","," "]})})},$scope.saveShareProject=function(){var proId=$scope.shareProjectId,data=$("#shareProjectSelect").select2("data"),userNames="";$.each(data,function(id,value){userNames+=value.text+","}),userNames=userNames.toLowerCase(),userNames=userNames.substring(0,userNames.length-1),projectReportService.projectShare(proId,userNames).success(function(response){function hideModal(){$("#project-share-modal").modal("hide"),$scope.pageQuery($scope.projectOptions.page,$scope.projectOptions.pageSize),$scope.updateState=!1}$scope.updateMessage=response.message,$scope.updateState=!0,response.success&&setTimeout(hideModal,1500)})},$scope.removePro=function(projectId){$.confirm("确定要删除该项目吗？","确认框",function(){projectReportService.deleteProject(projectId).success(function(flag){1==flag?($scope.pageQuery(1,$scope.projectOptions.pageSize),$.alert("项目报告删除成功")):$.alert("项目报告删除失败")})})},$scope.$on("reportLoadOver",function(){$("#_show").find(".projectContext").each(function(){var dataKeys,info=$.trim($(this).prev().html()).split(","),appId=info[0],appName=info[1],proId=info[2],userId=info[3],proName=$("#pnameSpan"+proId).html(),length=0,th_size=0,td_size=0,tr_size=$(this).find("tr").length,fileCount=parseInt($.trim($(this).parent().find("#rdataNum"+proId).html()));for(remember in rememberDataReport)rememberDataReport[remember].proId==proId&&(dataKeys=rememberDataReport[remember].dataKeys);$(this).find("table").addClass("table table-main info-table data-report-table"),$(this).find("tr").each(function(j){0==j?th_size=$(this).children().length:td_size=$(this).children().length;var trc=$(this).children().length;"80"==appId&&(0==j&&(length=$(this).children().length),length>6&&j>1&&j%2==0&&($(this).addClass("_HCVTR"),$(this).css("display","none"),$(this).children().attr("colspan","7"),$(this).children().css("word-break","break-all"))),$(this).mouseover(function(){$(this).find("a").addClass("link_hover")}),$(this).mouseout(function(){$(this).find("a").removeClass("link_hover")}),$(this).find("td").each(function(i){var flag=!1;if(void 0!=dataKeys)for(key in dataKeys)if(dataKeys[key]==$.trim($(this).prev().html())){flag=!0;break}if("90"==appId)if(1!=i)4==trc?0==i&&$(this).addClass("hide"):$(this).addClass("hide");else if($(this).css("border-left","none"),j>0){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if("279"==appId||"131"==appId||"128"==appId||"127"==appId||"126"==appId||"118"==appId||"117"==appId||"114"==appId||"113"==appId||"112"==appId||"111"==appId||"110"==appId||"109"==appId||"106"==appId||"107"==appId||"108"==appId||"105"==appId||"82"==appId||"84"==appId||"89"==appId||"73"==appId||"1"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&"279"!=appId&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId&&"126"!=appId&&"127"!=appId&&"128"!=appId&&"131"!=appId&&(fileName=fileName.substring(0,30)+"..."),"114"!=appId&&"118"!=appId?flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+fileName+"</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+fileName+"</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"82"==appId&&"不敏感"==$(this).html()&&$(this).addClass("red")}if("91"==appId||"95"==appId||"92"==appId||"93"==appId||"94"==appId||"86"==appId||"87"==appId||"88"==appId||"81"==appId||"83"==appId||"85"==appId||"96"==appId||"97"==appId||"98"==appId||"99"==appId||"100"==appId||"101"==appId||"102"==appId||"103"==appId||"104"==appId||"116"==appId||"119"==appId||"120"==appId||"121"==appId||"122"==appId||"124"==appId||"125"==appId||"129"==appId||"130"==appId){if(j>0&&0==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"...");var flag=!1;if(void 0!=dataKeys)for(key in dataKeys)if(dataKeys[key]==$.trim($(this).next().html())){flag=!0;break}flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).next().html()+"'>"+$(this).next().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).next().html()+"'>"+$(this).next().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().next().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if(1==i&&$(this).addClass("hide"),j>0&&(4==i||3==i)){var val=$(this).html();!isNaN(val)&&val>999&&$(this).html($.format(val,3,","))}}if("80"==appId){if(5==length){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","2")}if(7!=length&&8!=length||"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","5"),7==length)j>0&&j%2==1&&0==i&&($(this).addClass("sub"),$(this).html("<a id='dataSpan"+proId+$(this).html()+"'>"+$(this).html()+"</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link"));else if(8==length&&(1==i&&$(this).css("border-left","none"),0!=j&&j%2!=1||0!=i||$(this).addClass("hide"),j>0&&j%2==1&&1==i)){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link")}}if("11"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none")}td_size<th_size&&i==td_size-1&&$(this).attr("colspan",th_size-td_size+1)})});var minTdNum;minTdNum=fileCount<5?5:fileCount+1,"279"!=appId&&"131"!=appId&&"128"!=appId&&"127"!=appId&&"126"!=appId&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId||(minTdNum=fileCount<4?4:fileCount+1);var rdataNum=$("#rdataNum"+proId).html();if(("114"==appId||"118"==appId)&&tr_size-1<rdataNum){var num=Number(rdataNum)-tr_size+1,height=30*(5-tr_size),adHtml="<tr><td colspan='"+th_size+"' style='border-left-style: none;vertical-align: middle;height:"+height+"px' align='center'><img src='/celloud/images/report/running.png' title='正在运行...'/><br>"+num+"个数据正在运行...</td></tr>";$(this).find("tbody").append(adHtml)}else if(tr_size<minTdNum){var num=minTdNum-tr_size;if(tr_size-1<fileCount){var imgTr="<tr><td style='text-align: center;height: 75px;' rowspan='"+num+"' colspan='"+th_size+"'><img src='"+CONTEXT_PATH+"/images/report/running.png' title='正在运行...''/></td></tr>";$(this).find("tbody").append(imgTr)}else for(i=0;i<num;i++){var adHtml="<tr>";for(j=0;j<th_size-1;j++)adHtml+="<td></td>";adHtml+="</tr>",$(this).find("tbody").append(adHtml)}}})})}),celloudApp.controller("dataReportController",function($rootScope,$routeParams,$scope,$location,projectReportService,dataReportService){$scope.searchInfo=dataReportService.getSearchInfos(),$scope.dataOptions={page:$routeParams.page,pageSize:$routeParams.pageSize,fullDate:$routeParams.fullDate,beginDate:$routeParams.beginDate,endDate:$routeParams.endDate,tagId:$routeParams.tagId,period:$routeParams.period,batch:$routeParams.batch,condition:"all"==$routeParams.condition?"":$routeParams.condition,sort:"desc"};var paramQuqery=function(){var beginDate="all"==$scope.dataOptions.beginDate?null:$scope.dataOptions.beginDate+" 00:00:00",endDate="all"==$scope.dataOptions.endDate?null:$scope.dataOptions.endDate+" 23:59:59",tagId="all"==$scope.dataOptions.tagId?null:$scope.dataOptions.tagId,period="all"==$scope.dataOptions.period?null:$scope.dataOptions.period,batch="all"==$scope.dataOptions.batch?null:$scope.dataOptions.batch,condition=""==$scope.dataOptions.condition?null:$scope.dataOptions.condition;dataReportService.getReportsByParams($scope.dataOptions.page,$scope.dataOptions.pageSize,condition,beginDate,endDate,batch,tagId,period,$scope.dataOptions.sort).success(function(dataList){$scope.reportList=dataList})};$rootScope.goBack=function(){var page=$scope.dataOptions.page,pageSize=$scope.dataOptions.pageSize,fullDate=$scope.dataOptions.fullDate,beginDate=$scope.dataOptions.beginDate,endDate=$scope.dataOptions.endDate,tagId=$scope.dataOptions.tagId,period=$scope.dataOptions.period,batch=$scope.dataOptions.batch,condition=$scope.dataOptions.condition;$location.path("/reportdata/"+page+"/"+pageSize+"/"+fullDate+"/"+beginDate+"/"+endDate+"/"+tagId+"/"+period+"/"+batch+"/"+(0==condition.length?"all":condition))},$scope.pageQuery=function(page,pageSize){$scope.dataOptions.page=page,$scope.dataOptions.pageSize=pageSize,paramQuqery()},$scope.tagsQuery=function(tagId){$scope.dataOptions.tagId=tagId,$scope.dataOptions.page=1,paramQuqery()},$scope.batchsQuery=function(batch){$scope.dataOptions.batch=batch,$scope.dataOptions.page=1,paramQuqery()},$scope.periodQuery=function(period){$scope.dataOptions.period=period,$scope.dataOptions.page=1,paramQuqery()},$scope.fullDateQuery=function(days){if($scope.dataOptions.fullDate=days,0==days)$scope.dataOptions.beginDate="all",$scope.dataOptions.endDate="all";else{var d=new Date,date=new Date(d.getTime()-864e5*days),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();$scope.dataOptions.beginDate=year+"-"+mounth+"-"+day,$scope.dataOptions.endDate=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()}$scope.dataOptions.page=1,paramQuqery()},$scope.chooseDate=function(){var d=new Date,begin=$("#begin-date").val(),end=$("#end-date").val();return end=end?end:d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(),begin?begin>end?void $.tips("请确认开始时间  < 结束时间！","时间错误"):($scope.dataOptions.fullDate=-1,$scope.dataOptions.beginDate=begin,$scope.dataOptions.endDate=end,$scope.dataOptions.page=1,void paramQuqery()):void $.tips("请选择开始时间！","时间错误")},$scope.conditionQuery=function(){$scope.dataOptions.page=1,paramQuqery()},paramQuqery()})}();
!function(){celloudApp.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"pages/overview/overview.jsp"}).when("/user/base",{templateUrl:"pages/user/user_base.jsp",controller:"updateBaseInfo"}).when("/user/pwd",{templateUrl:"pages/user/user_pwdreset.jsp",controller:"updatePassword"}).when("/user/pwd/reset/:cellphone",{templateUrl:"pages/user/user_pwdreset.jsp",controller:"updatePwdAndRegister"}).when("/user/log",{templateUrl:"pages/user/user_log.jsp",controller:"pageQueryLog"}).when("/user/log/p:page",{templateUrl:"pages/user/user_log.jsp",controller:"pageQueryLog"}).when("/user/report",{templateUrl:"pages/user/user_reportset.jsp"}).when("/user/email",{templateUrl:"pages/user/user_emailreset.jsp",controller:"updateEmail"}).when("/user/set",{templateUrl:"pages/user/user_reportset.jsp",controller:"setReportController"}).when("/count",{templateUrl:"pages/count/count_main.jsp"}).when("/data",{templateUrl:"pages/data/data_list.jsp",controller:"dataListController"}).when("/expense/consume",{templateUrl:"pages/expense/expense_consume.jsp",controller:"pageQueryConsume"}).when("/expense/consume/p:page",{templateUrl:"pages/expense/expense_consume.jsp",controller:"pageQueryConsume"}).when("/expense/paydetail",{templateUrl:"pages/expense/expense_pay.jsp",controller:"toRecharge"}).when("/expense/paylist",{templateUrl:"pages/expense/expense_paylist.jsp",controller:"pageQueryRecharge"}).when("/expense/paylist/p:page",{templateUrl:"pages/expense/expense_paylist.jsp",controller:"pageQueryRecharge"}).when("/expense/invoice",{templateUrl:"pages/expense/expense_invoicelist.jsp",controller:"pageQueryInvoice"}).when("/expense/invoice/p:page",{templateUrl:"pages/expense/expense_invoicelist.jsp",controller:"pageQueryInvoice"}).when("/feedback",{templateUrl:"pages/feedback/feedback_main.jsp",controller:"feedbackController"}).when("/notices",{templateUrl:"pages/notice/notices.jsp",controller:"noticeController"}).when("/messages",{templateUrl:"pages/notice/messages.jsp",controller:"messageController"}).when("/message/setting",{templateUrl:"pages/notice/notice_set.jsp",controller:"settingController"}).when("/reportdata/:page/:pageSize/:fullDate/:beginDate/:endDate/:tagId/:period/:batch/:condition",{templateUrl:"pages/report/report_data.jsp",controller:"dataReportController"}).when("/reportpro/:page/:pageSize/:belongs/:changeDate/:start/:end/:app/:condition",{templateUrl:"pages/report/report_project.jsp",controller:"projectReportController"}).when("/reportpro/EGFR/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_egfr.jsp",controller:"egfrDataReportController"}).when("/reportdata/EGFR/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_egfr.jsp",controller:"dataEgfrDataReportController"}).when("/reportpro/KRAS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_kras.jsp",controller:"krasDataReportController"}).when("/reportdata/KRAS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_kras.jsp",controller:"dataKrasDataReportController"}).when("/reportpro/HCV_Genotype/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_hcv.jsp",controller:"hcvDataReportController"}).when("/reportdata/HCV_Genotype/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_hcv.jsp",controller:"dataHcvDataReportController"}).when("/reportpro/BRAF/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_braf.jsp",controller:"brafDataReportController"}).when("/reportdata/BRAF/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_braf.jsp",controller:"dataBrafDataReportController"}).when("/reportpro/TB-Rifampicin/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_tbrifampicin.jsp",controller:"tbRifampicinDataReportController"}).when("/reportdata/TB-Rifampicin/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_tbrifampicin.jsp",controller:"dataTbRifampicinDataReportController"}).when("/reportpro/TB-INH/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_tbinh.jsp",controller:"tbinhDataReportController"}).when("/reportdata/TB-INH/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_tbinh.jsp",controller:"dataTbinhDataReportController"}).when("/reportpro/HBV_SNP2/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_hbv.jsp",controller:"hbvDataReportController"}).when("/reportdata/HBV_SNP2/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_hbv.jsp",controller:"dataHbvDataReportController"}).when("/reportpro/oncogene/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_oncogene.jsp",controller:"oncogeneDataReportController"}).when("/reportdata/oncogene/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_oncogene.jsp",controller:"dataOncogeneDataReportController"}).when("/reportpro/DPD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_dpd.jsp",controller:"dpdDataReportController"}).when("/reportdata/DPD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_dpd.jsp",controller:"dataDpdDataReportController"}).when("/reportpro/ABI_NJ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_abinj.jsp",controller:"abinjDataReportController"}).when("/reportdata/ABI_NJ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_abinj.jsp",controller:"dataAbinjDataReportController"}).when("/reportpro/UGT/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_ugt.jsp",controller:"ugtDataReportController"}).when("/reportdata/UGT/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_ugt.jsp",controller:"dataUgtDataReportController"}).when("/reportpro/16S/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_16s.jsp",controller:"16sDataReportController"}).when("/reportdata/16S/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_16s.jsp",controller:"data16sDataReportController"}).when("/reportpro/translate_simplified/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_translate.jsp",controller:"translateDataReportController"}).when("/reportdata/translate_simplified/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_translate.jsp",controller:"dataTranslateDataReportController"}).when("/reportpro/PGS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_pgs.jsp",controller:"pgsDataReportController"}).when("/reportdata/PGS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_pgs.jsp",controller:"dataPgsDataReportController"}).when("/reportpro/GDD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_gdd.jsp",controller:"gddDataReportController"}).when("/reportdata/GDD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_gdd.jsp",controller:"dataGddDataReportController"}).when("/reportpro/AccuSeqΩ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_gdd.jsp",controller:"gddDataReportController"}).when("/reportdata/AccuSeqΩ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_gdd.jsp",controller:"dataGddDataReportController"}).when("/reportpro/CMP/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportdata/CMP/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_cmp.jsp",controller:"dataCmpDataReportController"}).when("/reportpro/AccuSeqα/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportdata/AccuSeqα/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_cmp.jsp",controller:"dataCmpDataReportController"}).when("/reportpro/AccuSeqα2/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_accuseqα2.jsp",controller:"accuseqa2DataReportController"}).when("/reportdata/AccuSeqα2/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_accuseqα2.jsp",controller:"dataAccuseqa2DataReportController"}).when("/reportpro/CMP_199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportdata/CMP_199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_cmp.jsp",controller:"dataCmpDataReportController"}).when("/reportpro/AccuSeqα199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportdata/AccuSeqα199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/data_report_data_cmp.jsp",controller:"dataCmpDataReportController"}).when("/reportdata/split/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_split.jsp",controller:"splitDataReportController"}).when("/reportdata/BSI/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_bsi.jsp",controller:"bsiDataReportController"}).when("/reportdata/rocky/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_rocky.jsp",controller:"rockyDataReportController"}).when("/reportdata/FS-ocg/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_fsocg.jsp",controller:"fsocgDataReportController"}).when("/app",{templateUrl:"pages/app/app_main.jsp",controller:"toAppStore"}).when("/app/detail/:pid",{templateUrl:"pages/app/app_detail_main.jsp",controller:"toAppDetail"}).when("/reportdata/bsi",{templateUrl:"pages/report/report_data_bsi.jsp"}).when("/reportdata/Sanger/:appId/:dataKey/:proId",{templateUrl:"pages/report/report_data_sanger.jsp",controller:"sangerDataReportController"}).when("/reportdata/Ngs/:appId/:dataKey/:proId",{templateUrl:"pages/report/report_data_ngs.jsp",controller:"ngsReportController"}).when("/reportpro/MIB/:appId/:dataKey/:proId",{templateUrl:"pages/report/report_data_mib.jsp",controller:"mibReportController"}).when("/reportdata/MIB/:appId/:dataKey/:proId",{templateUrl:"pages/report/data_report_data_mib.jsp",controller:"dataMibReportController"}).when("/sampling/collection",{templateUrl:"pages/experiment_scan/sampling.jsp",controller:"samplingController"}).when("/sampling/info-collection",{templateUrl:"pages/experiment_scan/sampling_info.jsp",controller:"samplingInfoController"}).when("/sampling/order/:orderId",{templateUrl:"pages/experiment_scan/order_detail.jsp",controller:"sampleOrderController"}).when("/samplinginfo/order/:orderId",{templateUrl:"pages/experiment_scan/order_info_detail.jsp",controller:"sampleInfoOrderController"}).when("/sampling/tracking",{templateUrl:"pages/experiment_scan/sample_tracking.jsp",controller:"sampleTrackingController"}).when("/sampling/info-tracking",{templateUrl:"pages/experiment_scan/sample_info_tracking.jsp",controller:"sampleInfoTrackingController"}).when("/experiment/scanStorage",{templateUrl:"pages/experiment_scan/scan_storage.jsp",controller:"scanStorageController"}).when("/experiment/tokenDNA",{templateUrl:"pages/experiment_scan/token_dna.jsp",controller:"tokenDNAController"}).when("/experiment/createLibrary",{templateUrl:"pages/experiment_scan/create_library.jsp",controller:"buidLibraryController"}).when("/experiment/libraryList",{templateUrl:"pages/experiment_scan/library_list.jsp",controller:"storagesController"}).when("/experiment/libraryList/:ssId",{templateUrl:"pages/experiment_scan/library_detail.jsp",controller:"storagesController"}).when("/product/rocky/upload",{templateUrl:"pages/rocky/rocky_upload.jsp",controller:"rockyUploadController"}).when("/product/rocky/d",{templateUrl:"pages/rocky/rocky_data.jsp",controller:"rockyDataController"}).when("/product/rocky/report",{templateUrl:"pages/rocky/rocky_report.jsp",controller:"rockyReportController"}).when("/product/bactive/report/:appId",{templateUrl:"pages/bsi/bsi_report_list.jsp",controller:"bsiReportController"}).when("/product/bactive/report/:appId/:page/:size/:begin/:end/:period/:batch/:condition/:sort/:sortBatch/:sortName/:sortPeriod/:sortDate",{templateUrl:"pages/bsi/bsi_report_list.jsp",controller:"bsiReportController"}).when("/product/bactive/dat/:appId",{templateUrl:"pages/bsi/bsi_data.jsp",controller:"bsiDataController"}).when("/product/bactive/rdata/:dataKey/:projectId/:appId/:batch/:dataIndex",{templateUrl:"pages/bsi/bsi_report_data.jsp",controller:"bsiReportDataController"}).when("/company/user",{templateUrl:"pages/company/company_user.jsp",controller:"companyUserController"}).when("/company/base",{templateUrl:"pages/company/company_base.jsp",controller:"companyBaseController"}).when("/company/key",{templateUrl:"pages/company/company_key.jsp",controller:"companyKeyController"}).otherwise({redirectTo:"/"})})}();
!function(){window.sessionTimeoutFlag=!1,window.celloudApp.factory("sessionTimeout",["$q",function($q){return{response:function(response){var sessionstatus=response.headers().sessionstatus;return"timeout"!=sessionstatus||window.sessionTimeoutFlag||(window.sessionTimeoutFlag=!0,alert("登录超时，请重新登录！"),window.location.href="logout"),response}}}]),window.celloudApp.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache",$httpProvider.interceptors.push("sessionTimeout")}])}();
!function(){celloudApp.factory("tipsModalService",function(){$("#tips-modal").modal("show")}),celloudApp.service("commonService",function($resource){var self=this;self.getUserInfo=function(){return $resource("user/info")},self.messages=$resource("notice/lastUnread/message"),self.notices=$resource("notice/lastUnread/notice"),self.getProduct=function(){return $resource("app/getProduct?random="+(new Date).getTime())}})}();
!function(){var intro;celloudApp.controller("sidebarController",function($scope,$location,$rootScope,$timeout,commonService){$rootScope.showZoom=function(src){var bh=$("body").height(),bw=$("body").width();$("#imageFullScreen").smartZoom({containerClass:"zoomableContainer"}),$("#imageFullScreen").attr("src",src),$("#fullbg").css({height:bh,width:bw,display:"block"}),$("#closeZoom").css("display","block"),$("#pageContent").show()},$rootScope.closeZoom=function(){$("#imageFullScreen").smartZoom("destroy"),$("#fullbg,#pageContent,#closeZoom").hide()},$rootScope.showBg=function(src,id){var width=$("#"+id).width(),height=$("#"+id).height();$("#imageFullScreen").css("width",1.5*width),$("#imageFullScreen").css("height",1.5*height),$rootScope.showZoom(src)},$("#imageFullScreen").smartZoom({containerClass:"zoomableContainer"}),$rootScope.bigFigure=function(src){$("#imageFullScreen").css("width",960),$("#imageFullScreen").css("height",144),$rootScope.showZoom(src)},$rootScope.bigOrigin=function(src,id){var width=$("#"+id).width(),height=$("#"+id).height();$("#imageFullScreen").css("width",1.5*width),$("#imageFullScreen").css("height",1.5*height),$rootScope.showZoom(src)},$rootScope.bigReplace=function(src){$("#imageFullScreen").css("width",1050),$("#imageFullScreen").css("height",157.5),$rootScope.showZoom(src)},window.rememberDataReport=new Array,$scope.isActive=function(viewLocation){return"/"!=viewLocation?$location.path().indexOf(viewLocation)>=0:viewLocation===$location.path()},$rootScope.collapsed=!1,$rootScope.toggleCollapse=function(){$rootScope.collapsed?$rootScope.collapsed=!1:$rootScope.collapsed=!0},$rootScope.errorInfo="",$scope.refreshUserProduct=function(){$rootScope.userProduct=commonService.getProduct().get()},$rootScope.userProduct=commonService.getProduct().get(),$rootScope.userInfo=commonService.getUserInfo().get(),$rootScope.messages=commonService.messages.get(),$rootScope.notices=commonService.notices.get(),$rootScope.tipsModal=function(info){$rootScope.errorInfo=info,$("#tips-modal").modal("show")},$rootScope.changeChevronType=function(chevronType){return chevronType=!chevronType},$rootScope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p},messageUtils.subscribe("userMessage",function(data){$rootScope.messages=commonService.messages.get(),console.log("监听userMessage"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close()}})}),messageUtils.subscribe("userNotice",function(data){$rootScope.notices=commonService.notices.get(),console.log("监听userNotice"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close()}})}),$timeout(function(){1!=window.navigation||$rootScope.userProduct.onlyBSI||(intro=introJs(),intro.setOption("tooltipPosition","bottom"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.start())},1e3)}),celloudApp.controller("proSidebarController",function($rootScope){$rootScope.collapsed=!1,$rootScope.toggleCollapse()})}();
!function(){celloudApp.filter("collapsedFilter",function(){return function(collapsed){return collapsed?"collapsed":""}}),celloudApp.filter("logoMiniFilter",function(){return function(collapsed){return collapsed?"mini":""}}),celloudApp.filter("collapsedIconFilter",function(){return function(collapsed){return collapsed?"right-indent-icon":"left-indent-icon"}}),celloudApp.filter("proSidebarLeftFilter",function(){return function(collapsed){return collapsed?"":"large-left"}}),celloudApp.filter("chevronTypeFaFilter",function(){return function(chevronType){return chevronType?"fa fa-chevron-down":"fa fa-chevron-up"}}),celloudApp.filter("chevronTypeTextFilter",function(){return function(chevronType){return chevronType?"更多":"收起"}}),celloudApp.filter("chevronTypeDivFilter",function(){return function(chevronType){return chevronType?"":"more"}}),celloudApp.filter("contextLengthFilter",function(){return function(context,length){return context.length<=length?context:context.substring(0,length)+"..."}}),celloudApp.filter("getResultByCompare",function(){return function(input,compare,r1,r2){return input!=compare?r1:r2}}),celloudApp.filter("getBsiRowSpan",function(){return function(val1,val2,val3){var val0=1;return null!=val1&&""!=val1&&val0++,null!=val2&&""!=val2&&val0++,null!=val3&&""!=val3&&val0++,val0}}),celloudApp.filter("fileSizeFormat",function(){return function(size){return 0==size?0:size<1024&&size>0?size+"B":size<1048576&&size>=1024?(temp=size/1024,temp.toFixed(2)+"KB"):size<1073741824&&size>=1048576?(temp=size/1048576,temp.toFixed(2)+"MB"):size>=1073741824?(temp=size/1073741824,temp.toFixed(2)+"GB"):"文件大小异常"}}),celloudApp.filter("trustHtml",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]),celloudApp.filter("taskPeriodFilter",function(){return function(period){if("string"==typeof period&&period.indexOf(",")>=0){for(var p=period.split(","),result="",i=0;i<p.length;i++)period=p[i],0==period?result+="等待分析    ":1==period?result+="分析中    ":2==period?result+="完成    ":3==period?result+="数据不完整    ":4==period?result+="异常终止    ":5==period?result+="送样中    ":6==period&&(result+="实验中    ");return result}return 0==period?"等待分析":1==period?"分析中":2==period?"完成":3==period?"数据不完整":4==period?"异常终止":5==period?"送样中":6==period?"实验中":""}}),celloudApp.filter("experStateFilter",function(){return function(experState){return 0==experState?"已采样":1==experState?"入库":2==experState?"提DNA":3==experState?"建库中":4==experState?"等待上机":5==experState?"上机完成":void 0}}),celloudApp.filter("reportReadFilter",function(){return function(read){return 1==read?"read":""}}),celloudApp.filter("thisReportFilter",function(){return function(thisReport){return thisReport?"this-report":""}})}();
!function(){celloudApp.service("loginCount",function($http){var self=this;self.loginCount=function(){return $http.get("count/loginCount")}})}();
!function(){celloudApp.controller("overviewCount",function($scope,loginCount){var width=($(window).width()-300)/2,height=width/2.5;$(".count-box-body").width(width),$(".count-box-body").height(height),$("body").scrollTop(0),loginCount.loginCount().success(function(response){$scope.map=response,userCount.fileDayCount(),userCount.fileMonthCount(),userCount.fileSizeDayCount(),userCount.fileSizeMonthCount(),userCount.reportDayCount(),userCount.reportMonthCount(),userCount.appDayCount(),userCount.appMonthCount()})})}();
require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}});var userCount=function(userCount){var self=userCount||{};return self.lineModal=function(id,legend,xdata,ydata,yname,unit){require(["echarts","echarts/chart/line"],function(ec){var myChart=ec.init(document.getElementById(id)),option={tooltip:{trigger:"axis",show:!0},legend:{data:[yname]},xAxis:[{type:"category",data:xdata}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"+("undefined"==typeof unit?"":unit)}}],series:[{name:yname,type:"line",data:ydata,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]}}]};myChart.setOption(option)})},self.fileDayCount=function(){$.get("count/fileDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-data-day-chart","日上传文件统计",eval(x),y,"日上传文件数量")})},self.fileMonthCount=function(){$.get("count/fileMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-data-month-chart","月上传文件统计",eval(x),y,"月上传文件数量"):$("#count-data-charts").hide()})},self.fileSizeDayCount=function(){$.get("count/fileSizeDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.substring(0,x.length-1),x+="]",self.lineModal("count-source-day-chart","日资源占用量统计",eval(x),y,"日上传文件大小",unit)})},self.fileSizeMonthCount=function(){$.get("count/fileSizeMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-source-month-chart","月资源占用量统计",eval(x),y,"月上传文件大小",unit):$("#count-source-charts").hide()})},self.reportDayCount=function(){$.get("count/reportDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-report-day-chart","日报告统计",eval(x),y,"日生成报告个数")})},self.reportMonthCount=function(){$.get("count/reportMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-report-month-chart","月报告统计",eval(x),y,"月生成报告个数"):$("#count-report-charts").hide()})},self.appDayCount=function(){$.get("count/appDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-app-day-chart","日已添加APP运行次数",eval(x),y,"日APP运行次数")})},self.appMonthCount=function(){$.get("count/appMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-app-month-chart","月已添加APP运行次数",eval(x),y,"月APP运行次数"):$("#count-app-charts").hide()})},self.dayMonthSwitch=function(idShow,idHide){$("#count-"+idShow+"-chart").removeClass("hide"),$("#"+idShow+"-span").addClass("active"),$("#count-"+idHide+"-chart").addClass("hide"),$("#"+idHide+"-span").removeClass("active")},self}(userCount);
!function(){celloudApp.service("noticeService",function($resource){var actions={listNotices:{method:"get",params:{type:"notice",currentPage:"1",pageSize:"10"}},listMessage:{method:"get",params:{type:"message",currentPage:"1",pageSize:"10"}},read:{url:"notice/read",method:"post",params:{noticeIds:"@noticeIds"}},readNotices:{url:"notice/readAll/notice",method:"post"},readMessage:{url:"notice/readAll/message",method:"post"},deleteNotice:{url:"notice/delete",method:"post",params:{noticeIds:"@noticeIds"}}};return $resource("notice/list/:type",{},actions)}),celloudApp.service("messageService",function($resource,$http){this.getUserSetting=function(){return $resource("message/category/setting")},this.insertUserSetting=function(targetName,targetVal,relatId){return $http({method:"POST",url:"message/category/insert",data:$.param({targetName:targetName,targetVal:targetVal,relatId:relatId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.updateUserSetting=function(targetName,targetVal,relatId){return $http({method:"POST",url:"message/category/update",data:$.param({targetName:targetName,targetVal:targetVal,relatId:relatId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("messageController",function($scope,$rootScope,noticeService,commonService){var pages={page:1,pageSize:10};$scope.checkedNotices=[],$scope.removeState=!1,$scope.readState=!1,$scope.read=function(){var noticeIds=[];for(var i in $scope.checkedNotices)0==$scope.checkedNotices[i].readState&&noticeIds.push($scope.checkedNotices[i].noticeId);noticeService.read({noticeIds:noticeIds},function(){reload(null,null)})},$scope.changePage=function(page,pageSize){pages={page:page,pageSize:pageSize},noticeService.listMessage({currentPage:page,pageSize:pageSize},function(data){$scope.messages=data,$scope.checkedNotices=[],changeState()})},$scope.changePage(pages.page,pages.pageSize),$scope.readAll=function(){noticeService.readMessage(function(){reload(null,null)})},$scope.readMessage=function(){noticeService.readMessage(function(){reload(null,null)})},$scope.remove=function(){var noticeIds=[];for(var i in $scope.checkedNotices)noticeIds.push($scope.checkedNotices[i].noticeId);noticeService.deleteNotice({noticeIds:noticeIds},function(){reload(1,null)})},$scope.checkAll=function(){$scope.checkedNotices=$scope.checkAllState?$scope.messages.datas:[],changeState()},$scope.checkOne=function(notice){var index=$scope.checkedNotices.indexOf(notice);index==-1?$scope.checkedNotices.push(notice):$scope.checkedNotices.splice(index,1),changeState()};var changeState=function(){$scope.removeState=$scope.checkedNotices.length>0;var flag=!1;for(var i in $scope.checkedNotices)if(0==$scope.checkedNotices[i].readState){flag=!0;break}$scope.readState=flag,$scope.checkAllState=$scope.messages.datas.length==$scope.checkedNotices.length},reload=function(page,pageSize){noticeService.listMessage({currentPage:page||pages.page,pageSize:pageSize||pages.pageSize},function(data){$scope.messages=data,$scope.checkedNotices=[],changeState()}),$rootScope.messages=commonService.messages.get()}}),celloudApp.controller("settingController",function($scope,messageService){$scope.userMessageCategoryList=messageService.getUserSetting().query(),$scope.updateMessageCategory=function(flag,mcId,targetName,targetVal){var index=this.$index;0==flag?messageService.insertUserSetting(targetName,targetVal,mcId).success(function(data){$scope.userMessageCategoryList[index].flag=1,$scope.userMessageCategoryList[index][targetName.toLocaleLowerCase()]=targetVal}):messageService.updateUserSetting(targetName,targetVal,mcId).success(function(data){$scope.userMessageCategoryList[index][targetName.toLocaleLowerCase()]=targetVal})}})}();
!function(){celloudApp.controller("noticeController",function($scope,$rootScope,noticeService,commonService){var pages={page:1,pageSize:10};$scope.checkedNotices=[],$scope.noticeRemoveState=!1,$scope.noticeReadState=!1,$scope.changePage=function(page,pageSize){pages={page:page,pageSize:pageSize},noticeService.listNotices({currentPage:page,pageSize:pageSize},function(data){$scope.notices=data,$scope.checkedNotices=[],changeNoticeState()})},$scope.changePage(pages.page,pages.pageSize),$scope.readNotices=function(){var noticeIds=[];for(var i in $scope.checkedNotices)0==$scope.checkedNotices[i].readState&&noticeIds.push($scope.checkedNotices[i].noticeId);noticeService.read({noticeIds:noticeIds},function(){reload(null,null)})},$scope.readAllNotices=function(){noticeService.readNotices(function(){reload(null,null)})},$scope.deleteNotice=function(){var noticeIds=[];for(var i in $scope.checkedNotices)noticeIds.push($scope.checkedNotices[i].noticeId);noticeService.deleteNotice({noticeIds:noticeIds},function(){reload(1,null)})},$scope.checkNoticeAll=function(){$scope.checkedNotices=$scope.checkNoticeAllState?$scope.notices.datas:[],changeNoticeState()},$scope.checkNoticeOne=function(notice){var index=$scope.checkedNotices.indexOf(notice);index==-1?$scope.checkedNotices.push(notice):$scope.checkedNotices.splice(index,1),changeNoticeState()};var changeNoticeState=function(){$scope.removeState=$scope.checkedNotices.length>0;var flag=!1;for(var i in $scope.checkedNotices)if(0==$scope.checkedNotices[i].readState){flag=!0;break}$scope.readState=flag,$scope.checkNoticeAllState=$scope.notices.datas.length==$scope.checkedNotices.length},reload=function(page,pageSize){noticeService.listNotices({currentPage:page||pages.page,pageSize:pageSize||pages.pageSize},function(data){$scope.notices=data,$scope.checkedNotices=[],changeNoticeState()}),$rootScope.notices=commonService.notices.get()}})}();
!function(){celloudApp.service("feedbackService",function($resource){var actions={listAll:{method:"get"},reply:{url:"feedback/reply/:id",method:"put",params:{id:"@id",content:"@content"}},solve:{url:"feedback/solve/:id",method:"post",params:{id:"@id"}},list:{url:"feedback/list",method:"get"},save:{url:"feedback/create",method:"put",params:{title:"@title",content:"@content",attachList:"@attachments"}},deleteAttach:{url:"feedback/attach/delete",method:"post",params:{name:"@name",_method:"delete",attachId:"@attachId"}}};return $resource("feedback/:id",{id:"@id"},actions)})}();
!function(){celloudApp.controller("feedbackController",function($scope,feedbackService){var loadFeedbacks=function(){$scope.feedbacks=feedbackService.list(function(data){data.datas.length>0&&$scope.change(data.datas[0].id)})};loadFeedbacks(),$scope.change=function(id){$scope.current=feedbackService.get({id:id})},$scope.solve=function(id){feedbackService.solve({id:id},function(){$scope.change(id)})},$scope.reply=function(id,content){content&&feedbackService.reply({id:id,content:content},function(){$scope.change(id),$scope.replyContent=""})},$scope.replyKeyUp=function($event){13==$event.keyCode&&$scope.reply($scope.current.id,$scope.replyContent)},$scope.saveFeedback=function(isValid){isValid&&feedbackService.save({title:$scope.unsavedFeedback.title,content:$scope.unsavedFeedback.content,attachments:$scope.unsavedAttachments},function(){$scope.unsavedAttachments=[],$("#new-qa-modal").modal("hide"),loadFeedbacks(),$scope.resetCreateForm()})},$scope.resetCreateForm=function(){$scope.unsavedFeedback=angular.copy({}),$scope.unsavedAttachments=[],unsaveUploader.splice(0,unsaveUploader.files.length)},$scope.deleteAttach=function(attachId,name){feedbackService.deleteAttach({name:name,attachId:attachId},function(data){$.alert(data.message),$("#attachmentModal").modal("hide"),$scope.currentAttach=null,$scope.change($scope.current.id)})},$scope.showAttach=function(attach){$scope.currentAttach=attach,$("#attachmentModal").modal("show")};var initUploader=function(button){var uploader=new plupload.Uploader({browse_button:button,url:"../feedback/attach",chunk_size:"2mb",file_data_name:"file",filters:{max_file_size:"2mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}]},multi_selection:!1,flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",init:{FilesAdded:function(uploader,files){uploader.start()},QueueChanged:function(uploader){uploader.disableBrowse(uploader.files.length>=5)}}});return uploader},unsaveUploader=initUploader("unsavedAttachmentUploadBtn");unsaveUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name})}),unsaveUploader.bind("FileUploaded",function(uploader,file,response){var attachments=$scope.unsavedAttachments||[];attachments.push(response.response),$scope.unsavedAttachments=attachments,$scope.$apply()}),unsaveUploader.init();var savedUploader=initUploader("attachmentUploadBtn");savedUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name,feedbackId:$scope.current.id})}),savedUploader.bind("FileUploaded",function(uploader,file,response){$scope.change($scope.current.id)}),savedUploader.init()})}();
!function(){celloudApp.service("rockyReportService",function($http){this.pageQuery=function(params){return $http({method:"POST",url:"report/rocky/reportMain",data:$.param({batches:params.batches,periods:params.periods,page:params.page,size:params.size,beginDate:params.beginDate,endDate:params.endDate,sample:params.sample,sidx:params.sidx,sord:params.sord}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}}),celloudApp.service("rockyDataService",function($http){this.pageQuery=function(params){return $http({method:"POST",url:"data/rocky/list",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("rockyUploadController",function($route,$location,$scope,$rootScope,uploadService){function getSize(fileSize){if(!fileSize)return"";var unit="b";return fileSize>1e3&&(fileSize/=1e3,unit="kb"),fileSize>1e3&&(fileSize/=1e3,unit="mb"),fileSize.toFixed(2)+unit}$scope.stepOne=function(){$rootScope.rockyUploader&&$rootScope.rockyUploader.files.length<=0&&"three"!=$rootScope.rockyStep?($rootScope.rockyUploader=void 0,$(".steps").addClass("hide"),$("#upload-nav-step-three").addClass("not-reached"),$("#upload-nav-step-two").addClass("not-reached"),$("#upload-step-one").removeClass("hide"),$(".step-line").addClass("not-reached"),$(".uploadtips .tips").addClass("hide"),$("#batch-info-input").val(""),$("#upload-tip-one").removeClass("hide"),$rootScope.rockyBatch=""):$rootScope.rockyUploader||($(".steps").addClass("hide"),$("#upload-nav-step-three").addClass("not-reached"),$("#upload-nav-step-two").addClass("not-reached"),$("#upload-step-one").removeClass("hide"),$(".step-line").addClass("not-reached"),$(".uploadtips .tips").addClass("hide"),$("#batch-info-input").val(""),$("#upload-tip-one").removeClass("hide"),$rootScope.rockyBatch="")},$scope.stepTwo=function(){$rootScope.rockyBatch||($rootScope.rockyBatch=$scope.rockyBatch),$rootScope.rockyUploader||($rootScope.rockyUploader=initUploader(),$rootScope.rockyUploader.init(),$rootScope.rockyUploadSpead={}),$(".steps").addClass("hide"),$(".step-line").addClass("not-reached"),$("#upload-nav-line-one").removeClass("not-reached"),$("#upload-nav-step-two").removeClass("not-reached"),$("#upload-nav-step-three").addClass("not-reached"),$("#upload-step-two").removeClass("hide"),$(".uploadtips .tips").addClass("hide"),$("#upload-tip-two").removeClass("hide")},$scope.stepThree=function(){$(".steps").addClass("hide"),$("#upload-step-three").removeClass("hide"),$("#upload-nav-line-one").removeClass("not-reached"),$("#upload-nav-line-two").removeClass("not-reached"),$("#upload-nav-step-three").removeClass("not-reached"),$("#upload-nav-step-two").removeClass("not-reached"),$(".uploadtips .tips").addClass("hide"),$("#upload-tip-three").removeClass("hide")},$rootScope.rockyUploader&&"two"==$rootScope.rockyStep&&($scope.stepTwo(),$("#rocky-upload-list-table").removeClass("hide"),$.each($rootScope.rockyUploader.files,function(index,item){if(100==item.percent){var $fileDom=$('<tr id="'+item.id+'"></tr>');$fileDom.append($('<td class="filename">'+item.name+"</td>")),$fileDom.append($('<td class="percent">上传完成</td>')),$fileDom.append($('<td class="surplus">00:00:00</td>')),$fileDom.append($('<td class="spead">'+$rootScope.rockyUploadSpead[item.id]+"</td>")),$fileDom.append($('<td><a data-click="del-upload-file" data-id="'+item.id+'"  href="javascript:void(0)"><i class="fa fa-times-circle" aria-hidden="true"></i></a></td>')),$("#rocky-upload-list-tbody").append($fileDom)}else if(item.percent>0){var $fileDom=$('<tr id="'+item.id+'"></tr>');$fileDom.append($('<td class="filename">'+item.name+"</td>")),$fileDom.append($('<td class="percent">'+item.percent+"%</td>")),$fileDom.append($('<td class="surplus">'+getSize($rootScope.rockyUploader.total.bytesPerSec)+"/s</td>")),$fileDom.append($('<td class="spead">'+utils.formatDate((item.size-item.loaded)/$rootScope.rockyUploader.total.bytesPerSec)+"</td>")),$fileDom.append($('<td><a data-click="del-upload-file" data-id="'+item.id+'"  href="javascript:void(0)"><i class="fa fa-times-circle" aria-hidden="true"></i></a></td>')),$("#rocky-upload-list-tbody").append($fileDom)}else{var $fileDom=$('<tr id="'+item.id+'"></tr>');$fileDom.append($('<td class="filename">'+item.name+"</td>")),$fileDom.append($('<td class="percent">等待上传</td>')),$fileDom.append($('<td class="surplus">---</td>')),$fileDom.append($('<td class="spead">---</td>')),$fileDom.append($('<td><a data-click="del-upload-file" data-id="'+item.id+'"  href="javascript:void(0)"><i class="fa fa-times-circle" aria-hidden="true"></i></a></td>')),$("#rocky-upload-list-tbody").append($fileDom)}})),$rootScope.rockyUploader&&"three"==$rootScope.rockyStep&&($rootScope.rockyUploader.destroy(),$scope.stepThree()),$scope.refreshSession=function(){$.get("uploadFile/checkAdminSessionTimeOut")},$scope.continueUpload=function(){$rootScope.rockyUploader=void 0,$rootScope.rockyStep="one",$scope.stepTwo()},$scope.newUpload=function(){$rootScope.rockyUploader=void 0,$rootScope.rockyStep="one",$scope.stepOne()};var initUploader=function(){var uploadUrl="../uploadFile/uploadManyFile";$.ajax({type:"GET",async:!1,url:CONTEXT_PATH+"/box/configs",success:function(configs){for(var index in configs){var config=configs[index],port=config.port||80,context=config.context?config.context.startsWith("/")?config.context:"/"+config.context:"";config="https://"+config.intranetAddress+":"+port+context;var response=$.ajax(config+"/box/alive",{async:!1}).responseText;if(response&&JSON.parse(response).success){$scope.box=config;break}}null!=$scope.box?(uploadUrl=$scope.box+"/box/upload",console.log("成功找到了一个盒子，地址为："+$scope.box)):console.log("没有找到盒子...")}});var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"plupload-content",url:uploadUrl,drop_element:"plupload-content",filters:{max_file_size:"10gb",prevent_duplicates:!0,mime_types:[{title:"fastq",extensions:"fastq"},{title:"txt",extensions:"txt"},{title:"gz",extensions:"gz"},{title:"bam",extensions:"bam"}]},max_retries:5,flash_swf_url:"//cdn.bootcss.com/plupload/2.1.8/Moxie.swf"});return $(document).on("click","[data-click='del-upload-file']",function(){var id=$(this).data("id");uploader.removeFile(id),$("#"+id).remove()}),uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval($scope.refreshSession,6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("UploadProgress",function(uploader,file){$("#"+file.id+" .percent").html(file.percent+"%");var curSpead=getSize(uploader.total.bytesPerSec)+"/s";$("#"+file.id+" .spead").html(curSpead),curSpead&&"undefined"!=curSpead&&($rootScope.rockyUploadSpead[file.id]=curSpead),$("#"+file.id+" .surplus").html(utils.formatDate((file.size-file.loaded)/uploader.total.bytesPerSec))}),uploader.bind("FilesAdded",function(uploader,files){$.each(files,function(index,item){if(item.size>0){var $fileDom=$('<tr id="'+item.id+'"></tr>');$fileDom.append($('<td class="filename">'+item.name+"</td>")),$fileDom.append($('<td class="percent">等待上传</td>')),$fileDom.append($('<td class="surplus">---</td>')),$fileDom.append($('<td class="spead">---</td>')),$fileDom.append($('<td><a data-click="del-upload-file" data-id="'+item.id+'"  href="javascript:void(0)"><i class="fa fa-times-circle" aria-hidden="true"></i></a></td>')),$("#rocky-upload-list-tbody").append($fileDom)}else uploader.removeFile(item)}),uploader.files.length>0&&($("#rocky-upload-list-table").removeClass("hide"),uploader.start(),$rootScope.rockyStep="two")}),uploader.bind("BeforeUpload",function(uploader,file){if(null==$scope.box){$("#"+file.id+" .percent").html("正在上传");var object=$.ajax({url:CONTEXT_PATH+"/oss/upload/postPolicy",async:!1,data:"name="+file.name+"&oName=ddd"+file.id}).responseText;object=JSON.parse(object),uploader.setOption({url:"https://"+object.host,chunk_size:0,multipart_params:{key:object.dir+file.id+object.ext,policy:object.policy,OSSAccessKeyId:object.accessid,success_action_status:"200",signature:object.signature,"x-oss-meta-name":file.name,"x-oss-meta-batch":$rootScope.rockyBatch,"x-oss-meta-tagId":2}}),file.objectKey=object.dir+file.id+object.ext}else uploader.setOption({chunk_size:"1mb",multipart_params:{userId:window.userId,lastModifiedDate:file.lastModifiedDate,size:file.size,originalName:file.name,name:file.name,tagId:2,batch:$rootScope.rockyBatch}})}),uploader.bind("FileUploaded",function(uploader,file,response){if(null==$scope.box){JSON.parse(response.response);uploader.setOption("multipart_params",{originalName:file.name,tagId:2,batch:$rootScope.rockyBatch,size:file.size,lastModifiedDate:file.lastModifiedDate,uniqueName:file.id}),$("#"+file.id+" .percent").html("上传完成"),$.post(CONTEXT_PATH+"/oss/upload/newfile",{name:file.name,batch:$rootScope.rockyBatch,size:file.size,objectKey:file.objectKey,tagId:2},function(data){console.log(data)})}file.hint,messageUtils.notify("上传完成","数据【"+file.name+"】上传成功。")}),uploader.bind("UploadComplete",function(uploader,files){uploader.splice(0,uploader.files.length),$("#rocky-upload-list-tbody").html(""),$("#rocky-upload-list-table").addClass("hide"),$rootScope.rockyUploader.destroy(),$rootScope.rockyStep="three",$scope.stepThree()}),uploader};$scope.stepOne(),window.onbeforeunload=function(){var qp=$rootScope.rockyUploader.total,percent=qp.percent;if(qp.size>0&&percent<100&&percent>0)return"数据正在上传，您确定要关闭页面吗?"}}),celloudApp.controller("rockyDataController",function($scope,$rootScope,rockyDataService){$scope.params={page:1,size:20,sample:null,condition:null,sortField:"createDate",sortType:"desc"},$scope.pageQuery=function(){rockyDataService.pageQuery($scope.params).success(function(dataMap){$scope.dataList=dataMap.dataList,$scope.periodMap=dataMap.periodMap})},$scope.paginationBtn=function(currentPage){$scope.params.page=currentPage,$scope.pageQuery()},$scope.changePageSize=function(){$scope.params.size=$("#rocky_report_page #page-size-sel").val(),$scope.params.page=1,$scope.pageQuery()},$scope.sortQuery=function(sortField){sortField==$scope.params.sortField?$scope.params.sortType="asc"==$scope.params.sortType?"desc":"asc":($scope.params.sortField=sortField,$scope.params.sortType="desc"),$scope.pageQuery()},$scope.sampleQuery=function($event){13==$event.keyCode&&($scope.params.sample=$scope.sample,$scope.params.page=1,$scope.pageQuery())},$scope.conditionQuery=function($event){13==$event.keyCode&&($scope.params.condition=$scope.condition,$scope.params.page=1,$scope.pageQuery())},$scope.curDate=new Date,$scope.pageQuery()}),celloudApp.controller("rockyReportController",function($scope,rockyReportService){$scope.showReport=function(dataKey,projectId,appId){var url=CONTEXT_PATH+"/report/rocky/data/report";$.get(url,{dataKey:dataKey,appId:appId,projectId:projectId},function(data){$("#common-container").html(data)})},$scope.reportSampleFilter=function($event){13==$event.keyCode&&($scope.params.page=1,$scope.pageQuery())},$scope.batchMore=function(){$("#batch-lists").hasClass("show-more")?($("#batch-lists").removeClass("show-more"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")):($("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"))},$scope.batchMultiselect=function(){$("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$("#batch-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$("#batch-more").addClass("disabled"),$("#batch-more").attr("disabled",!0),$(".selector-line").removeClass("select-more"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$(".selector-line .checkbox").removeClass("checkbox-ed").addClass("checkbox-un").addClass("hide"),$(".selector-line").find("[name='sl-confirm']").addClass("disabled"),$(".selector-line").find("[name='sl-confirm']").attr("disabled",!0),$(".selector-line").find(".multisl-btns").addClass("hide");var selectorline=$("#batch-sl");selectorline.addClass("select-more"),selectorline.find(".sl-val").addClass("show-more"),selectorline.find(".checkbox").removeClass("hide"),selectorline.find(".multisl-btns").removeClass("hide")},$scope.resetBatchMultiselect=function(){var selectorline=$("#batch-sl");selectorline.removeClass("select-more"),selectorline.find(".sl-val").removeClass("show-more"),selectorline.find(".checkbox").addClass("hide").addClass("checkbox-un").removeClass("checkbox-ed"),selectorline.find(".multisl-btns").addClass("hide"),$("#batch-more").hasClass("disabled")&&($("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down"))},$scope.resetPeriodMultiSelect=function(){var selectorline=$("#period-sl");selectorline.removeClass("select-more"),selectorline.find(".sl-val").removeClass("show-more"),selectorline.find(".checkbox").addClass("hide").addClass("checkbox-un").removeClass("checkbox-ed"),selectorline.find(".multisl-btns").addClass("hide"),$("#batch-more").hasClass("disabled")&&($("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down"))},$scope.reportSelectMore=function(){$("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(".selector-line").removeClass("select-more"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$(".selector-line .checkbox").removeClass("checkbox-ed").addClass("checkbox-un").addClass("hide"),$(".selector-line").find("[name='sl-confirm']").addClass("disabled"),$(".selector-line").find("[name='sl-confirm']").attr("disabled",!0),$(".selector-line").find(".multisl-btns").addClass("hide");var selectorline=$("#period-sl");selectorline.addClass("select-more"),selectorline.find(".sl-val").addClass("show-more"),selectorline.find(".checkbox").removeClass("hide"),selectorline.find(".multisl-btns").removeClass("hide")},$scope.batchLists=function(batchId){$("#"+batchId).toggleClass("checkbox-un"),$("#"+batchId).toggleClass("checkbox-ed"),$("#batch-lists .checkbox-ed").size()>0?($("#report-multibatch-search").removeClass("disabled"),$("#report-multibatch-search").attr("disabled",!1)):($("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0))},$scope.periodLists=function(periodId){$("#"+periodId).toggleClass("checkbox-un"),$("#"+periodId).toggleClass("checkbox-ed"),$("#period-lists .checkbox-ed").size()>0?($("#report-multiperiod-search").removeClass("disabled"),$("#report-multiperiod-search").attr("disabled",!1)):($("#report-multiperiod-search").addClass("disabled"),$("#report-multiperiod-search").attr("disabled",!0))},$scope.reportDateSearch=function(){$scope.params.beginDate=$("#report-begindate-search").val(),$scope.params.endDate=$("#report-enddate-search").val(),$scope.params.page=1,$scope.pageQuery()},$scope.reportBatchSearch=function(batchId){$("#batch-sl").hasClass("select-more")||($scope.params.batches=$("#"+batchId).next().find("span").text(),$scope.params.page=1,$scope.pageQuery(),$("#selected-batch span").html($("#"+batchId).next().find("span").text()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"))},$scope.clearSlBatch=function(){$("#selected-batch").addClass("hide"),$("#to-sl-batch").removeClass("hide"),$("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-lists").find(".multisl-btns").addClass("hide"),$scope.params.batches="",$scope.params.page=1,$scope.pageQuery()},$scope.reportPeriodSearch=function(periodId){$("#period-sl").hasClass("select-more")||($scope.params.periods=$("#"+periodId).next().find("input").val(),$scope.params.page=1,$scope.pageQuery(),$("#selected-period span").html($("#"+periodId).next().find("span").html()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"))},$scope.clearSlPeriod=function(){$("#selected-period").addClass("hide"),$("#to-sl-period").removeClass("hide"),$scope.params.periods="",$scope.params.page=1,$scope.pageQuery()},$scope.reportMultibatchSearch=function(){var show_val=[],batches="";$("#batch-lists .checkbox-ed").each(function(){batches+=$(this).next().find("span").html()+",",show_val.push($(this).next().text())}),$scope.params.batches=batches.substring(0,batches.length),$scope.params.page=1,$scope.pageQuery(),$("#selected-batch span").html(show_val.toString()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"),$("#batch-sl").removeClass("select-more"),$("#batch-lists").removeClass("show-more"),$("#batch-lists").find(".checkbox").addClass("hide"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")},$scope.reportMultiperiodSearch=function(){var show_val=[],periods="";$("#period-lists .checkbox-ed").each(function(){periods+=$(this).next().find("input[type='hidden']").val()+",",show_val.push($(this).next().find("span").html())}),$scope.params.periods=periods.substring(0,periods.length),$scope.params.page=1,$scope.pageQuery(),$("#selected-period span").html(show_val.toString()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"),$("#period-sl").removeClass("select-more"),$("#period-sl").find(".checkbox").addClass("hide"),$("#period-sl").find(".multisl-btns").addClass("hide"),$("#period-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un")},$scope.reportSortBtn=function(id){var sort=id.split("-");$scope.params.sidx=sort[1],$scope.params.sord=sort[2]||"desc",$scope.pageQuery()},$scope.changePageSize=function(){$scope.params.size=$("#rocky_report_page #page-size-sel").val(),$scope.params.page=1,$scope.pageQuery()},$scope.paginationBtn=function(page){$scope.params.page=page,$scope.pageQuery()},$scope.sort={},$scope.params={page:1,size:20,sidx:$scope.sidx,sord:$scope.sord,sample:$scope.sample,beginDate:$scope.beginDate,endDate:$scope.endDate,condition:$scope.condition,batches:$scope.batches,periods:$scope.periods},$scope.pageQuery=function(){rockyReportService.pageQuery($scope.params).success(function(dataMap){$scope.dataList=dataMap.pageList,$scope.batchList=dataMap.batchList,$scope.periodMap=dataMap.periodMap,$scope.sidx=dataMap.sidx,$scope.sord=dataMap.sord})},$scope.curDate=new Date,$scope.pageQuery()})}();
!function(){celloudApp.service("bsiService",function($http){this.reportPageQuery=function(params){return $http({method:"POST",url:"report/bsi/reportPageQuery",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.reportReRun=function(dataKey,appId,projectId){return $http({method:"POST",url:"data/reRun",data:$.param({dataKey:dataKey,appId:appId,projectId:projectId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getBSIPatientReport=function(params){return $http({method:"POST",url:"report/getBSIPatientReportInfo",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.dataPageQuery=function(params){return $http({method:"POST",url:"data/bsi/dataPageQuery",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getPrevOrNextBSIReport=function(params){return $http({method:"POST",url:"report/getPrevOrNextBSIReportInfo",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getBatchPageList=function(params){return $http({method:"POST",url:"report/bsi/batchReportListInfo",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("bsiFileUpload",function($scope,$location,$rootScope){function getSize(fileSize){var unit="b";return fileSize>1e3&&(fileSize/=1e3,unit="kb"),fileSize>1e3&&(fileSize/=1e3,unit="mb"),fileSize.toFixed(2)+unit}function handleStatus(file){var actionClass,iconClass;file.status==plupload.DONE&&(actionClass="plupload_done",iconClass="fa fa-check-circle"),file.status==plupload.FAILED&&(actionClass="plupload_failed",iconClass="fa fa-exclamation-triangle"),file.status!=plupload.QUEUED&&file.status!=plupload.UPLOADING||(actionClass="plupload_delete",iconClass="fa fa-times-circle-o");var icon=$("#uploading-"+file.id).attr("class",actionClass).find("i").attr("class",iconClass);file.hint&&icon.attr("title",file.hint)}$scope.uploadPercent=0,$rootScope.bsiFinished=!1,$scope.itemBtnToggleActive=function(){$("#common-menu .item-btn").removeClass("active"),$("#to-upload-a").addClass("active")},$("#bsi-upload-modal").on("hidden.bs.modal",function(e){$("#to-upload-a").removeClass("active"),$location.path().indexOf("data")>-1?$("#to-data-a").addClass("active"):$location.path().indexOf("report")>-1&&$("#to-report-a").addClass("active")}),$rootScope.bsiStepOne=function(){$scope.itemBtnToggleActive(),$rootScope.bsiUploader&&"two"==$rootScope.bsiStep&&$rootScope.bsiUploader.files.length>0?($("#upload-filelist").children().remove(),$("#uploading-filelist").children(":not(:first)").remove(),$.each($rootScope.bsiUploader.files,function(index,item){var $fileDom=$('<li class="plupload_delete" id="'+item.id+'">');$fileDom.append($('<div class="plupload-file-name"><span>'+item.name+"</span></div>")),$fileDom.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#upload-filelist").append($fileDom);var $fileDom_uploading=$('<li id="uploading-'+item.id+'">');$fileDom_uploading.append($('<div class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></div>")),$fileDom_uploading.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom_uploading.append($('<div class="plupload-file-surplus">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-status">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom_uploading.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#uploading-filelist").append($fileDom_uploading),handleStatus(item);var params={size:item.size,lastModifiedDate:item.lastModifiedDate,name:item.name};null!=$scope.box&&$.get($scope.box+"/box/checkBreakpoints",params,function(data){data.data&&(item.loaded=data.data,$("#uploading-"+item.id+" .plupload-file-status").html(100*(item.loaded/item.size).toFixed(2)+"%"))}),$("#"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),$rootScope.bsiUploader.removeFile(item),e.preventDefault(),utils.stopBubble(e),$scope.uploadTextType()}),$("#uploading-"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),$rootScope.bsiUploader.removeFile(item),e.preventDefault(),utils.stopBubble(e)})}),$scope.stepTwo()):$rootScope.bsiUploader&&"three"==$rootScope.bsiStep&&$rootScope.bsiUploader.files.length>0?($("#upload-filelist").children().remove(),$("#uploading-filelist").children(":not(:first)").remove(),$.each($rootScope.bsiUploader.files,function(index,item){if(100==item.percent){var $fileDom_uploading=$('<li id="uploading-'+item.id+'">');$fileDom_uploading.append($('<div class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></div>")),$fileDom_uploading.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom_uploading.append($('<div class="plupload-file-surplus">00:00:00</div>')),$fileDom_uploading.append($('<div class="plupload-file-status">100%</div>')),$fileDom_uploading.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom_uploading.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#uploading-filelist").append($fileDom_uploading)}else{var $fileDom_uploading=$('<li id="uploading-'+item.id+'">');$fileDom_uploading.append($('<div class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></div>")),$fileDom_uploading.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom_uploading.append($('<div class="plupload-file-surplus">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-status">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom_uploading.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#uploading-filelist").append($fileDom_uploading)}handleStatus(item);var params={size:item.size,lastModifiedDate:item.lastModifiedDate,name:item.name};null!=$scope.box&&$.get($scope.box+"/box/checkBreakpoints",params,function(data){data.data&&(item.loaded=data.data,$("#uploading-"+item.id+" .plupload-file-status").html(100*(item.loaded/item.size).toFixed(2)+"%"))}),$("#"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),$rootScope.bsiUploader.removeFile(item),e.preventDefault(),utils.stopBubble(e),$scope.uploadTextType()}),$("#uploading-"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),$rootScope.bsiUploader.removeFile(item),e.preventDefault(),utils.stopBubble(e)})}),$scope.beginBsiUpload()):($rootScope.bsiStep="one",$(".plupload_filelist li").hasClass("plupload_droptext")&&($("#batch-info").val(""),$("#batch-div").removeClass("hide"),$("#upload-content").addClass("upload-step-one")),$scope.uploadPercent>=100&&(waveLoading.setProgress(0),document.querySelector("#upload-progress").height=document.querySelector("#upload-progress").height),$rootScope.bsiFinished=!1),$("#bsi-upload-modal").modal("show")},$scope.uploadTextType=function(){$("#upload-filelist").children().length>2?$(".upload-text").addClass("hide"):$(".upload-text").removeClass("hide")},$scope.stepTwo=function(){$(".step-one-content").addClass("hide"),$(".step-two-content").removeClass("hide"),$("#bsi-one-to-two").addClass("active"),$(".step-two").addClass("active"),$scope.uploadTextType(),$rootScope.bsiBatch=$scope.bsiBatch,$rootScope.bsiUploader||initUploader()},$scope.batchInfo=function($event){13==$event.keyCode&&$scope.stepTwo()},$scope.refreshSession=function(){$.get("uploadFile/checkAdminSessionTimeOut")};var initUploader=function(){$.get(CONTEXT_PATH+"/box/configs",function(configs){for(var index in configs){var config=configs[index],port=config.port||80,context=config.context?config.context.startsWith("/")?config.context:"/"+config.context:"";config="https://"+config.intranetAddress+":"+port+context;var response=$.ajax(config+"/box/alive",{async:!1}).responseText;if(response&&JSON.parse(response).success){$scope.box=config;break}}var uploadUrl=null==$scope.box?"../uploadFile/uploadManyFile":$scope.box+"/box/upload";console.log(null==$scope.box?"没有找到盒子...":"成功找到了一个盒子，地址为："+$scope.box);var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:["bsi-plupload-content","bsi-upload-more"],url:uploadUrl,dragdrop:!0,unique_names:!0,drop_element:"bsi-plupload-content",filters:{max_file_size:"10gb",prevent_duplicates:!0,mime_types:[{title:"bam",extensions:"bam"},{title:"ab1",extensions:"ab1"},{title:"abi",extensions:"abi"},{title:"fasta",extensions:"fasta"},{title:"fastq",extensions:"fastq"},{title:"tsv",extensions:"tsv"},{title:"gz",extensions:"gz"},{title:"lis",extensions:"lis"},{title:"txt",extensions:"txt"}]},max_retries:5,multiple_queues:!0,flash_swf_url:"//cdn.bootcss.com/plupload/2.1.8/Moxie.swf"});uploader.init(),uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval("self.refreshSession()",6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("UploadProgress",function(uploader,file){waveLoading.setProgress(uploader.total.percent),uploadPercent=uploader.total.percent,$("#uploading-"+file.id+" .plupload-file-status").html(file.percent+"%"),$("#uploading-"+file.id+" .plupload-file-surplus").html(utils.formatDate((file.size-file.loaded)/uploader.total.bytesPerSec)),handleStatus(uploader.total.percent)}),uploader.bind("FilesAdded",function(uploader,files){$.get("uploadFile/checkAdminSessionTimeOut",function(response){response||uploader.destroy()}),$.each(files,function(index,item){if(item.size>0){var $fileDom=$('<li class="plupload_delete" id="'+item.id+'">');$fileDom.append($('<div class="plupload-file-name"><span>'+item.name+"</span></div>")),$fileDom.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#upload-filelist").append($fileDom);var $fileDom_uploading=$('<li id="uploading-'+item.id+'">');$fileDom_uploading.append($('<div class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></div>")),$fileDom_uploading.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom_uploading.append($('<div class="plupload-file-surplus">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-status">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom_uploading.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#uploading-filelist").append($fileDom_uploading),handleStatus(item);var params={size:item.size,lastModifiedDate:item.lastModifiedDate,name:item.name};null!=$scope.box&&$.get($scope.box+"/box/checkBreakpoints",params,function(data){data.data&&(item.loaded=data.data,$("#uploading-"+item.id+" .plupload-file-status").html(100*(item.loaded/item.size).toFixed(2)+"%"))}),$("#"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e),$scope.uploadTextType()}),$("#uploading-"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e)})}else uploader.removeFile(item)}),"one"==$rootScope.bsiStep&&($rootScope.bsiStep="two"),$scope.uploadTextType(),$rootScope.$apply()}),uploader.bind("FileUploaded",function(uploader,file,response){if(null==$scope.box){JSON.parse(response.response);uploader.setOption("multipart_params",{originalName:file.name,tagId:1,batch:$rootScope.bsiBatch,size:file.size,lastModifiedDate:file.lastModifiedDate,uniqueName:file.id}),$.post(CONTEXT_PATH+"/oss/upload/newfile",{objectKey:file.objectKey},function(data){console.log(data)})}$("#"+file.id+" .percent").html("上传完成"),handleStatus(file)}),uploader.bind("FilesRemoved",function(uploader,files){$rootScope.$apply(),files.length<=0&&($scope.bsiBatch="")}),uploader.bind("UploadComplete",function(uploader,files){files.length>0?(waveLoading.setProgress(100),$scope.uploadPercent=100):(waveLoading.init({haveInited:!1}),waveLoading.draw(),document.querySelector("#upload-progress").height=document.querySelector("#upload-progress").height),$(".step-one-content").removeClass("hide"),$(".step-two-content").addClass("hide"),$(".step-three-content").addClass("hide"),$("#bsi-one-to-two").removeClass("active"),$("#bsi-two-to-three").removeClass("active"),$(".step-two").removeClass("active"),$(".step-three").removeClass("active"),$("#batch-info").val(""),uploader.splice(),$rootScope.bsiFinished=!0,$rootScope.bsiStep="one",$scope.bsiBatch="",$rootScope.bsiUploader.destroy(),$rootScope.bsiUploader=void 0,$("#uploading-filelist .plupload_done").remove(),$("#bsi-upload-modal").modal("hide")}),uploader.bind("BeforeUpload",function(uploader,file){if(null==$scope.box){var object=$.ajax({url:CONTEXT_PATH+"/oss/upload/postPolicy",async:!1,data:"name="+file.name+"&oName=ddd"+file.id}).responseText;object=JSON.parse(object),uploader.setOption({url:"https://"+object.host,chunk_size:0,multipart_params:{key:object.dir+file.id+object.ext,policy:object.policy,OSSAccessKeyId:object.accessid,success_action_status:"200",signature:object.signature,"x-oss-meta-name":file.name,"x-oss-meta-batch":$rootScope.bsiBatch,"x-oss-meta-tagId":$("#tag-info").val()}}),file.objectKey=object.dir+file.id+object.ext}else uploader.setOption({chunk_size:"1mb",multipart_params:{userId:window.userId,lastModifiedDate:file.lastModifiedDate,size:file.size,originalName:file.name,name:file.name,tagId:$("#tag-info").val(),batch:$("#batch-info").val(),needSplit:$("#need-split:checked").val()}})}),uploader.bind("Error",function(uploader,error){"-602"==error.code&&alert("当前队列已存在文件【"+error.file.name+"】，请勿重复添加！")}),$rootScope.bsiUploader=uploader})};window.onbeforeunload=function(){if($rootScope.bsiUploader){var qp=$rootScope.bsiUploader.total,percent=qp.percent;if(qp.size>0&&percent<100&&percent>0)return"数据正在上传，您确定要关闭页面吗?"}},$scope.beginBsiUpload=function(){$(".step-three-content").removeClass("hide"),$(".step-one-content").addClass("hide"),$(".step-two-content").addClass("hide"),$("#bsi-one-to-two").addClass("active"),$("#bsi-two-to-three").addClass("active"),$(".step-two").addClass("active"),$(".step-three").addClass("active"),$("#tags-review").html($rootScope.bsiBatch),"three"!=$rootScope.bsiStep&&($("#upload-filelist").html(""),$rootScope.bsiUploader.start(),$rootScope.bsiStep="three",waveLoading.init({haveInited:!0,target:document.querySelector("#upload-progress"),color:"rgba(40, 230, 200, 0.6)",showText:!1}),waveLoading.draw(),waveLoading.setProgress(0))},$scope.closeUploadModal=function(){$rootScope.bsiUploader&&$rootScope.bsiUploader.files.length<=0&&($(".step-one-content").removeClass("hide"),$(".step-two-content").addClass("hide"),$("#bsi-one-to-two").removeClass("active"),$(".step-two").removeClass("active"),$(".step-three-content").addClass("hide"),$("#bsi-two-to-three").removeClass("active"),$(".step-three").removeClass("active"));var text=$("body .breadcrumb").text();text.indexOf("数据")>=0?$scope.itemBtnToggleActive($("#to-data-a")):text.indexOf("报告")>=0&&$scope.itemBtnToggleActive($("#to-report-a"))}}),celloudApp.controller("bsiCommon",function($scope,$rootScope){$scope.box=null,$rootScope.bsiUploader?(waveLoading.init({haveInited:!0,target:document.querySelector("#upload-progress"),color:"rgba(40, 230, 200, 0.6)",showText:!1}),waveLoading.draw(),waveLoading.setProgress($rootScope.bsiUploader.total.percent)):$rootScope.bsiFinished&&(waveLoading.init({haveInited:!0,target:document.querySelector("#upload-progress"),color:"rgba(40, 230, 200, 0.6)",showText:!1}),waveLoading.draw(),waveLoading.setProgress(100)),$rootScope.sortIcon=function(params){0==params.sort&&("asc"==params.sortDate?$(".sort-date-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):$(".sort-date-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc")),1==params.sort&&("asc"==params.sortBatch?$(".sort-batch-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):$(".sort-batch-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc")),2==params.sort&&("asc"==params.sortName?$(".sort-name-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):$(".sort-name-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc")),3==params.sort&&("asc"==params.sortPeriod?$(".sort-period-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):$(".sort-period-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc"))}}),celloudApp.controller("bsiReportDataController",function($scope,$rootScope,$routeParams,bsiService){$scope.params={dataKey:$routeParams.dataKey,projectId:$routeParams.projectId,appId:$routeParams.appId,batch:"null"==$routeParams.batch?null:$routeParams.batch,dataIndex:$routeParams.dataIndex},$rootScope.thisReport=$routeParams.dataKey,$scope.batchPageQuery=function(params){bsiService.getBatchPageList(params).success(function(dataMap){$scope.batchPageList=dataMap.batchPageList,dataMap.dataIndexFlag&&($scope.dataIndex=dataMap.dataIndex)})},$scope.batchPageQueryBtn=function(currentPage){$scope.batchBtnParams=angular.copy($scope.batchParams),$scope.batchBtnParams.page=currentPage,$scope.batchBtnParams.dataIndex=0,$scope.batchBtnParams.dataKey=null,$scope.batchPageQuery($scope.batchBtnParams)},bsiService.getBSIPatientReport($scope.params).success(function(dataMap){if($scope.bsi=dataMap.bsi,$scope.data=dataMap.data,$scope.sample=void 0==dataMap.sample?{sampleName:""}:dataMap.sample,$rootScope.tab=void 0==$rootScope.tab?"patient":$rootScope.tab,$scope.havestrain="",$scope.changeTab=function(tab){$rootScope.tab=tab},$scope.bsi&&($scope.batchParams={page:1,batch:$scope.data.batch,appId:$scope.bsi.appId,dataKey:$scope.bsi.dataKey,dataIndex:$scope.params.dataIndex}),$scope.batchPageQuery($scope.batchParams),$scope.bsi&&$scope.bsi.species_20){for(var i=0;i<$scope.bsi.species_20.length;i++)$scope.havestrain+=$scope.bsi.species_20[i].species_zh+",";$scope.havestrain=$scope.havestrain.substr(0,$scope.havestrain.length-1)}$scope.getRowspan=function(val1,val2,val3){var val0=1;return null!=val1&&val0++,null!=val2&&val0++,null!=val3&&val0++,val0},$scope.reportPrev=function(currentPage){if(currentPage>0){$scope.params;window.location.href="index#/product/bactive/rdata/"+$scope.params.dataKey+"/"+$scope.params.projectId+"/"+$scope.params.appId+"/"+$scope.data.batch+"/"+currentPage}},$scope.reportNext=function(currentPage){var rowCount=$scope.batchPageList.page.rowCount;if(currentPage=parseInt(currentPage),currentPage<=rowCount){$scope.params;window.location.href="index#/product/bactive/rdata/"+$scope.params.dataKey+"/"+$scope.params.projectId+"/"+$scope.params.appId+"/"+$scope.data.batch+"/"+currentPage}}})}),celloudApp.controller("bsiReportController",function($scope,$rootScope,$routeParams,$location,bsiService){$rootScope.appId=$routeParams.appId,$scope.bsiReportParams={page:$routeParams.page,size:$routeParams.size,condition:"all"==$routeParams.condition?null:$routeParams.condition,sort:$routeParams.sort,sortBatch:"all"==$routeParams.sortBatch?"asc":$routeParams.sortBatch,sortName:"all"==$routeParams.sortName?"asc":$routeParams.sortName,sortPeriod:"all"==$routeParams.sortPeriod?"asc":$routeParams.sortPeriod,sortDate:"all"==$routeParams.sortDate?"desc":$routeParams.sortDate,reportType:0,batch:"all"==$routeParams.batch?null:$routeParams.batch,period:"all"==$routeParams.period?null:$routeParams.period,beginDate:"all"==$routeParams.begin?null:$routeParams.begin,endDate:"all"==$routeParams.end?null:$routeParams.end,distributed:null,sampleName:null,appId:$rootScope.appId},$rootScope.goReportList=function(){var appId=$routeParams.appId,page=$scope.bsiReportParams.page,size=$scope.bsiReportParams.size,condition=null==$scope.bsiReportParams.condition||""==$scope.bsiReportParams.condition?"all":$scope.bsiReportParams.condition,sort=$scope.bsiReportParams.sort,sortBatch="all"==$scope.bsiReportParams.sortBatch?"asc":$scope.bsiReportParams.sortBatch,sortName="all"==$scope.bsiReportParams.sortName?"asc":$scope.bsiReportParams.sortName,sortPeriod="all"==$scope.bsiReportParams.sortPeriod?"asc":$scope.bsiReportParams.sortPeriod,sortDate="all"==$scope.bsiReportParams.sortDate?"desc":$scope.bsiReportParams.sortDate,batch=null==$scope.bsiReportParams.batch?"all":$scope.bsiReportParams.batch,period=null==$scope.bsiReportParams.period?"all":$scope.bsiReportParams.period,beginDate=null==$scope.bsiReportParams.beginDate?"all":$scope.bsiReportParams.beginDate,endDate=null==$scope.bsiReportParams.endDate?"all":$scope.bsiReportParams.endDate;$location.path("/product/bactive/report/"+appId+"/"+page+"/"+size+"/"+beginDate+"/"+endDate+"/"+period+"/"+batch+"/"+condition+"/"+sort+"/"+sortBatch+"/"+sortName+"/"+sortPeriod+"/"+sortDate)},$scope.pageQuery=function(){bsiService.reportPageQuery($scope.bsiReportParams).success(function(dataMap){$scope.batchList=dataMap.batchList,$scope.pageList=dataMap.pageList,$scope.periodMap=dataMap.periodMap,$scope.nowDate=dataMap.nowDate,$rootScope.goReportList()})},$scope.conditionFind=function(){$scope.bsiReportParams.condition=$("#condition-input").val(),$scope.bsiReportParams.page=1,$scope.pageQuery()},$scope.conditionSearch=function($event){13==$event.keyCode&&$scope.conditionFind()},$scope.reportBatchSearch=function(batchId){$("#batch-sl").hasClass("select-more")||($scope.bsiReportParams.batch="'"+$("#"+batchId).next().find("span").text()+"'",$scope.bsiReportParams.page=1,$scope.pageQuery(),$("#selected-batch span").html($("#"+batchId).next().find("span").text()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"))},$scope.clearSlBatch=function(){$("#selected-batch").addClass("hide"),$("#to-sl-batch").removeClass("hide"),$("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-lists").find(".multisl-btns").addClass("hide"),$scope.bsiReportParams.batch=null,$scope.bsiReportParams.page=1,$scope.pageQuery()},$scope.batchMore=function(){$("#batch-lists").hasClass("show-more")?($("#batch-lists").removeClass("show-more"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")):($("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"))},$scope.batchMultiselect=function(){$(".selector-line").removeClass("select-more"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$(".selector-line .checkbox").removeClass("checkbox-ed").addClass("checkbox-un").addClass("hide"),$(".selector-line").find("[name='sl-confirm']").addClass("disabled"),$(".selector-line").find("[name='sl-confirm']").attr("disabled",!0),$(".selector-line").find(".multisl-btns").addClass("hide");var selectorline=$("#batch-sl");selectorline.addClass("select-more"),selectorline.find(".sl-val").addClass("show-more"),selectorline.find(".checkbox").removeClass("hide"),selectorline.find(".multisl-btns").removeClass("hide"),$("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$("#batch-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$("#batch-more").addClass("disabled"),$("#batch-more").attr("disabled",!0)},$scope.batchLists=function(batchId){$("#"+batchId).toggleClass("checkbox-un"),$("#"+batchId).toggleClass("checkbox-ed"),$("#batch-lists .checkbox-ed").size()>0?($("#report-multibatch-search").removeClass("disabled"),$("#report-multibatch-search").attr("disabled",!1)):($("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0))},$scope.reportMultibatchSearch=function(){var show_val=[];$("#batch-lists .checkbox-ed").each(function(){null==$scope.bsiReportParams.batch?$scope.bsiReportParams.batch="'"+$(this).next().text()+"'":$scope.bsiReportParams.batch+=",'"+$(this).next().text()+"'",show_val.push($(this).next().text())}),$scope.pageQuery(),$("#selected-batch span").html(show_val.toString()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"),$("#batch-sl").removeClass("select-more"),$("#batch-lists").removeClass("show-more"),$("#batch-lists").find(".checkbox").addClass("hide"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")},$scope.resetBatchMultiSelect=function(){var selectorline=$("#batch-sl");selectorline.removeClass("select-more"),selectorline.find(".sl-val").removeClass("show-more"),selectorline.find(".checkbox").addClass("hide").addClass("checkbox-un").removeClass("checkbox-ed"),selectorline.find(".multisl-btns").addClass("hide"),$("#batch-more").hasClass("disabled")&&($("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down"))},$scope.reportPeriodSearch=function(periodId){$("#period-sl").hasClass("select-more")||($scope.bsiReportParams.period=$("#"+periodId).next().find("input").val(),$scope.bsiReportParams.page=1,$scope.pageQuery(),$("#selected-period span").html($("#"+periodId).next().find("span").text()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"))},$scope.clearSlPeriod=function(){$("#selected-period").addClass("hide"),$("#to-sl-period").removeClass("hide"),$scope.bsiReportParams.period=null,$scope.pageQuery()},$scope.periodMultiselect=function(){$(".selector-line").removeClass("select-more"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$(".selector-line .checkbox").removeClass("checkbox-ed").addClass("checkbox-un").addClass("hide"),$(".selector-line").find("[name='sl-confirm']").addClass("disabled"),$(".selector-line").find("[name='sl-confirm']").attr("disabled",!0),$(".selector-line").find(".multisl-btns").addClass("hide");var selectorline=$("#period-sl");selectorline.addClass("select-more"),selectorline.find(".sl-val").addClass("show-more"),selectorline.find(".checkbox").removeClass("hide"),selectorline.find(".multisl-btns").removeClass("hide")},$scope.periodLists=function(periodId){$("#"+periodId).toggleClass("checkbox-un"),$("#"+periodId).toggleClass("checkbox-ed"),$("#period-lists .checkbox-ed").size()>0?($("#report-multiperiod-search").removeClass("disabled"),$("#report-multiperiod-search").attr("disabled",!1)):($("#report-multiperiod-search").addClass("disabled"),$("#report-multiperiod-search").attr("disabled",!0))},$scope.reportMultiperiodSearch=function(){var show_val=[];$("#period-lists .checkbox-ed").each(function(){null==$scope.bsiReportParams.period?$scope.bsiReportParams.period=$(this).next().find("input[type='hidden']").val():$scope.bsiReportParams.period+=","+$(this).next().find("input[type='hidden']").val(),show_val.push($(this).next().find("span").html())}),$scope.pageQuery(),$("#selected-period span").html(show_val.toString()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"),$("#period-sl").removeClass("select-more"),$("#period-sl").find(".checkbox").addClass("hide"),$("#period-sl").find(".multisl-btns").addClass("hide"),$("#period-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un")},$scope.resetPeriodMultiSelect=function(){var selectorline=$("#period-sl");selectorline.removeClass("select-more"),selectorline.find(".sl-val").removeClass("show-more"),selectorline.find(".checkbox").addClass("hide").addClass("checkbox-un").removeClass("checkbox-ed"),selectorline.find(".multisl-btns").addClass("hide"),$("#batch-more").hasClass("disabled")&&($("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down"))},$scope.dateQuery=function(){$scope.bsiReportParams.beginDate=$("#report-begindate-search").val(),$scope.bsiReportParams.endDate=$("#report-enddate-search").val(),$scope.pageQuery()},$scope.distributeQuery=function(){var distribute=$("#distribute");distribute.find(".sl-judge-no").hasClass("hide")?(distribute.find(".sl-judge-no").removeClass("hide"),distribute.find(".sl-judge-yes").addClass("hide"),$scope.bsiReportParams.distributed=1):(distribute.find(".sl-judge-yes").removeClass("hide"),distribute.find(".sl-judge-no").addClass("hide"),$scope.bsiReportParams.distributed=0),$scope.pageQuery()},$scope.sortDate=function(){$scope.bsiReportParams.sort=0,$scope.bsiReportParams.sortDate="desc"==$scope.bsiReportParams.sortDate?"asc":"desc",$rootScope.sortIcon($scope.bsiReportParams),$scope.pageQuery()},$scope.sortBatch=function(){$scope.bsiReportParams.sort=1,$scope.bsiReportParams.sortBatch="asc"==$scope.bsiReportParams.sortBatch?"desc":"asc",$rootScope.sortIcon($scope.bsiReportParams),$scope.pageQuery()},$scope.sortName=function(){$scope.bsiReportParams.sort=2,$scope.bsiReportParams.sortName="asc"==$scope.bsiReportParams.sortName?"desc":"asc",$rootScope.sortIcon($scope.bsiReportParams),$scope.pageQuery()},$scope.sortPeriod=function(){$scope.bsiReportParams.sort=3,$scope.bsiReportParams.sortPeriod="asc"==$scope.bsiReportParams.sortPeriod?"desc":"asc",$rootScope.sortIcon($scope.bsiReportParams),$scope.pageQuery()},$scope.pageSizeQuery=function(){$scope.bsiReportParams.size=$("#page-size-sel").val(),$scope.bsiReportParams.page=1,$scope.pageQuery()},$scope.reRun=function(dataKey,appId,projectId){bsiService.reportReRun(dataKey,appId,projectId).success(function(){$scope.pageQuery()})},$scope.paginationBtn=function(currentPage){$scope.bsiReportParams.page=currentPage,$scope.pageQuery()},$scope.periodError=function(dataName){$("#run-error-data").html(dataName),$("#running-error-modal").modal("show")},$scope.pageQuery()}),celloudApp.controller("bsiDataController",function($scope,$rootScope,$routeParams,bsiService){$rootScope.appId=$routeParams.appId,$scope.params={page:1,size:$("#page-size-sel").val(),condition:null,sort:0,sortBatch:"asc",sortName:"asc",sortDate:"desc",appId:$routeParams.appId},$scope.pageQuery=function(){bsiService.dataPageQuery($scope.params).success(function(dataMap){$scope.pageList=dataMap.pageList})},$scope.conditionFind=function(){$scope.params.condition=$("#condition-input").val(),$scope.params.page=1,$scope.pageQuery()},$scope.conditionSearch=function($event){13==$event.keyCode&&$scope.conditionFind()},$scope.paginationBtn=function(currentPage){$scope.params.page=currentPage,$scope.pageQuery()},$scope.sortDate=function(){$scope.params.sort=0,$scope.params.sortDate="desc"==$scope.params.sortDate?"asc":"desc",$rootScope.sortIcon($scope.params),$scope.pageQuery()},$scope.sortBatch=function(){$scope.params.sort=1,$scope.params.sortBatch="asc"==$scope.params.sortBatch?"desc":"asc",$rootScope.sortIcon($scope.params),$scope.pageQuery()},$scope.sortName=function(){$scope.params.sort=2,$scope.params.sortName="asc"==$scope.params.sortName?"desc":"asc",$rootScope.sortIcon($scope.params),$scope.pageQuery()},$scope.pageSizeQuery=function(){$scope.params.size=$("#page-size-sel").val(),$scope.params.page=1,$scope.pageQuery()},$scope.pageQuery()})}();
!function(){celloudApp.service("companyService",function($resource,$http){this.pageQueryUser=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"GET",url:"company/userInfo",params:{currentPage:currentPage,pageSize:pageSize}})},this.updateUserState=function(userId,state){return $http({method:"POST",url:"company/updateUserState",params:{userId:userId,state:state}})},this.sendRegisterEmail=function(email,kaptcha,apps,roles){return $http({method:"POST",url:"user/sendRegistEmail",params:{email:email,kaptcha:kaptcha,apps:apps,roles:roles}})},this.sendCellphoneCaptcha=function(cellphone,captcha,apps,roles,truename){return $http({method:"POST",url:"user/sendCellphoneCaptcha",params:{cellphone:cellphone,captcha:captcha,truename:truename,apps:apps,roles:roles}})},this.getCompanyInfo=function(){return $http({method:"GET",url:"company"})},this.updateCompanyInfo=function(company){return $http({method:"POST",url:"company",data:$.param(company),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getAppList=function(){return $http({method:"GET",url:"app/getRightAppList"})},this.getRoleList=function(){return $http({method:"GET",url:"user/findRoles"})},this.toAddApp=function(userId){return $http({method:"GET",url:"app/toAddApp",params:{userId:userId}})},this.addApp=function(userId,apps){return $http({method:"POST",url:"app/grantApp",params:{userId:userId,apps:apps}})},this.toRemoveApp=function(userId){return $http({method:"GET",url:"app/toRemoveApp",params:{userId:userId}})},this.removeApp=function(userId,apps){return $http({method:"POST",url:"app/deleteApp",params:{userId:userId,apps:apps}})},this.toAddRole=function(userId){return $http({method:"GET",url:"user/toAddRole",params:{userId:userId}})},this.addRole=function(userId,roles){return $http({method:"POST",url:"user/addRole",params:{userId:userId,roles:roles}})},this.toRemoveRole=function(userId){return $http({method:"GET",url:"user/toRemoveRole",params:{userId:userId}})},this.removeRole=function(userId,roles){return $http({method:"POST",url:"user/removeRole",params:{userId:userId,roles:roles}})},this.pageQueryKey=function(currentPage,pageSize){return pageSize=pageSize||20,$http({method:"GET",url:"key/keys",params:{currentPage:currentPage,pageSize:pageSize}})},this.saveKey=function(){return $http({method:"POST",url:"key/keys",params:{}})},this.removeKey=function(id){return $http({method:"DELETE",url:"key/keys/"+id,params:{}})},this.updateKey=function(id,state){return $http({method:"PUT",url:"key/keys/"+id,params:{state:state}})},this.checkCellphone=function(){return $http({method:"GET",url:"key/checkCellphone",params:{}})},this.sendCaptcha=function(){return $http({method:"GET",url:"key/sendCaptcha",params:{}})},this.authenticationCellphone=function(captcha){return $http({method:"POST",url:"key/authenticationCellphone",params:{captcha:captcha}})},this.getKey=function(id){return $http({method:"GET",url:"key/keys/"+id,params:{}})},this.getAuthenFlag=function(){return $http({method:"GET",url:"key/getAuthenFlag",params:{}})},this.getSecretJson=function(){return $http({method:"GET",url:"key/getSecretJson",params:{}})},this.removeSecret=function(id){return $http({method:"GET",url:"key/removeSecret",params:{id:id}})}})}();
!function(){celloudApp.controller("companyUserController",function($scope,companyService){$scope.pageInfo={currentPage:1,pageSize:20},$scope.pageQuery=function(currentPage,pageSize){$scope.pageInfo.currentPage=currentPage||$scope.pageInfo.currentPage,$scope.pageInfo.pageSize=pageSize||$scope.pageInfo.pageSize,companyService.pageQueryUser($scope.pageInfo.currentPage,$scope.pageInfo.pageSize).success(function(userList){$scope.userList=userList})},$scope.updateUserState=function(userId,state){companyService.updateUserState(userId,state).success(function(data,status){204==status&&(0==state?$.alert("禁用成功"):$.alert("启用成功"),$scope.pageQuery($scope.pageInfo.currnetPage,$scope.pageInfo.pageSize)),500==status&&(0==state?$.alert("禁用失败"):$.alert("启用失败"))})},$scope.sendEmail=function(){var apps=new Array;$("#userAddForm").find("input[name='app']:checked").each(function(){apps.push($(this).val())});var roles=new Array;$("#userAddForm").find("input[name='role']:checked").each(function(){roles.push($(this).val())}),$("#submit").prop("disabled",!0),companyService.sendRegisterEmail($scope.email,$scope.kaptcha,apps,roles).success(function(data,status){204==status&&($("#company-addUser-modal").modal("hide"),$.alert("发送成功!"))}).error(function(data,status){400==status&&($scope.emailError=data.emailError,$scope.kaptchaError=data.kaptchaError,$("img[name=kaptchaImage]").eq(1).click())})},$scope.sendCellphoneCaptcha=function(){var apps=new Array;$("#userCellphoneAddForm").find("input[name='cellphone-app']:checked").each(function(){apps.push($(this).val())});var roles=new Array;$("#userCellphoneAddForm").find("input[name='cellphone-role']:checked").each(function(){roles.push($(this).val())}),$("#submit").prop("disabled",!0),companyService.sendCellphoneCaptcha($scope.email,$scope.captcha,apps,roles,$scope.truename).success(function(data,status){204==status&&($("#company-cellphone-addUser-modal").modal("hide"),$.alert("发送成功!"))}).error(function(data,status){400==status&&($scope.cellphoneError=data.cellphoneError,$scope.kaptchaError=data.kaptchaError,$("img[name=kaptchaImage]").eq(0).click())})},$scope.toAddApp=function(userId){$scope.addApp.isShow=!1,$scope.userId=userId,companyService.toAddApp(userId).success(function(data){$scope.appList=data})},$scope.addApp=function(){var apps=new Array;return $("#appAddForm").find("input[name='app']:checked").each(function(){apps.push($(this).val())}),0==apps.length?void($scope.addApp.isShow=!0):($scope.addApp.isShow=!1,$("#submit").prop("disabled",!0),void companyService.addApp($scope.userId,apps).success(function(data,status){200==status&&($("#company-addApp-modal").modal("hide"),$.alert("追加成功!"))}).error(function(data,status){$("#company-addApp-modal").modal("hide"),$.alert("追加失败!")}))},$scope.toRemoveApp=function(userId){$scope.removeApp.isShow=!1,$scope.userId=userId,companyService.toRemoveApp(userId).success(function(data){$scope.appList=data})},$scope.removeApp=function(){var apps=new Array;return $("#removeAppForm").find("input[name='app']:checked").each(function(){apps.push($(this).val())}),0==apps.length?void($scope.removeApp.isShow=!0):($scope.removeApp.isShow=!1,$("#submit").prop("disabled",!0),void companyService.removeApp($scope.userId,apps).success(function(data,status){200==status&&($("#company-removeApp-modal").modal("hide"),$.alert("删除成功!"))}).error(function(data,status){$("#company-removeApp-modal").modal("hide"),$.alert("删除失败!")}))},$scope.toAddRole=function(userId){$scope.addRole.isShow=!1,$scope.userId=userId,companyService.toAddRole(userId).success(function(data){$scope.roleList=data})},$scope.addRole=function(){var roles=new Array;return $("#roleAddForm").find("input[name='role']:checked").each(function(){roles.push($(this).val())}),0==roles.length?void($scope.addRole.isShow=!0):($scope.addRole.isShow=!1,$("#submit").prop("disabled",!0),void companyService.addRole($scope.userId,roles).success(function(data,status){200==status&&($("#company-addRole-modal").modal("hide"),$.alert("追加成功!"))}).error(function(data,status){$("#company-addRole-modal").modal("hide"),$.alert("追加失败!")}))},$scope.toRemoveRole=function(userId){$scope.removeRole.isShow=!1,$scope.userId=userId,companyService.toRemoveRole(userId).success(function(data){$scope.roleList=data})},$scope.removeRole=function(){var roles=new Array;return $("#roleRemoveForm").find("input[name='role']:checked").each(function(){roles.push($(this).val())}),0==roles.length?void($scope.removeRole.isShow=!0):($scope.removeRole.isShow=!1,$("#submit").prop("disabled",!0),void companyService.removeRole($scope.userId,roles).success(function(data,status){200==status&&($("#company-removeRole-modal").modal("hide"),$.alert("删除成功!"))}).error(function(data,status){$("#company-removeRole-modal").modal("hide"),$.alert("删除失败!")}))},$scope.clearState=function(){$scope.emailError=null,$scope.kaptchaError=null,$scope.cellphoneError=null},$scope.showAddUserForm=function(){$("img[name=kaptchaImage]").click(),companyService.getAppList().success(function(data){$scope.appList=data}),companyService.getRoleList().success(function(data){$scope.roleList=data}),$scope.userAddForm.$setPristine(),$scope.email="",$scope.kaptcha="",$scope.truename="",$scope.captcha="",$scope.clearState()},$("img[name=kaptchaImage]").click(function(){$(this).hide().attr("src","kaptcha?"+Math.floor(100*Math.random())).fadeIn()}),$scope.pageQuery($scope.pageInfo.currnetPage,$scope.pageInfo.pageSize)}),celloudApp.controller("companyBaseController",function($scope,companyService){companyService.getCompanyInfo().success(function(data,status){if(200==status){$scope.company=data,$scope.company_bak=angular.copy(data),$scope.province_bak=data.province,$scope.city_bak=data.city,$scope.district_bak=data.district,$scope.companyIcon_bak=data.companyIcon,$("#view").css("background-color","rgb(102, 102, 102)"),$("#view").css("background-repeat","no-repeat"),$("#view").css("background-position","center center"),$("#view").css("background-size","contain"),$("#view").css("background-image","url("+$scope.company.companyIcon+")"),_init_area($scope.province_bak,$scope.city_bak,$scope.district_bak);new bjj.PhotoClip("#clipArea",{size:[120,50],outputSize:[120,50],file:"#file",view:"#view",ok:"#clipBtn",loadStart:function(){console.log("照片读取中")},loadComplete:function(){console.log("照片读取完成")},clipFinish:function(dataURL){$scope.company.companyIcon=dataURL}})}}).error(function(data,status){}),$scope.reset=function(){$scope.company=angular.copy($scope.company_bak),$("#view").css("background-image","url("+$scope.company.companyIcon+")"),_init_area($scope.province_bak,$scope.city_bak,$scope.district_bak)},$scope.updateCompanyInfo=function(){$scope.company.province=$("#s_province").val(),$scope.company.city=$("#s_city").val(),$scope.company.district=$("#s_county").val(),companyService.updateCompanyInfo($scope.company).success(function(data,status){204==status&&$.alert("修改成功")}).error(function(data,status){400==status&&$.alert("您填写的数据有误, 请核查后再提交"),500==status&&$.alert("提交失败, 请联系管理员")})}}),celloudApp.controller("companyKeyController",function($scope,$rootScope,companyService,userService){$scope.pageInfo={currentPage:1,pageSize:20},$scope.pageQuery=function(currentPage,pageSize){$scope.pageInfo.currentPage=currentPage||$scope.pageInfo.currentPage,$scope.pageInfo.pageSize=pageSize||$scope.pageInfo.pageSize,companyService.pageQueryKey($scope.pageInfo.currentPage,$scope.pageInfo.pageSize).success(function(keyList,status){200==status&&($scope.keyList=keyList)})},$scope.toAuthen=function(modalName){$scope.modalName=modalName,companyService.checkCellphone().success(function(data,status){200==status&&($scope.cellphone=data,$scope.errorInfo="",$("#company-showKey").modal("show"))})},$scope.add=function(){$rootScope.authenFlag?companyService.saveKey().success(function(data,status){201==status&&($.alert("创建成功"),$scope.pageQuery())}).error(function(data,status){500==status&&$.alert("创建失败")}):$scope.toAuthen("add")},$scope.remove=function(id){$rootScope.authenFlag?$.confirm("确定要删除该Secret吗?","确认框",function(){companyService.removeKey(id).success(function(data,status){204==status&&($.alert("删除成功"),$scope.pageQuery())}).error(function(data,status){500==status&&$.alert("删除失败")})}):($scope.removeId=id,$scope.toAuthen("remove"))},$scope.update=function(id,state){$rootScope.authenFlag?(state=0==state?1:0,companyService.updateKey(id,state).success(function(data,status){$.alert("更改状态成功"),$scope.pageQuery()}).error(function(data,status){500==status&&$.alert("更改状态失败")})):($scope.updateId=id,$scope.updateState=state,$scope.toAuthen("update"))},$scope.showSecret=function(id){$rootScope.authenFlag?companyService.getKey(id).success(function(data,status){$scope.secretJson[data.id]=data.keySecret,$scope.pageQuery($scope.pageInfo.currnetPage,$scope.pageInfo.pageSize)}).error(function(data,status){$.alert("服务器错误")}):($scope.authenId=id,$scope.toAuthen("show"))},$scope.hideModal=function(){$("#company-showKey").modal("hide"),$scope.btnFlag=!0},$("#company-showKey").on("hidden.bs.modal",function(e){$scope.btnFlag&&($scope.btnFlag=!1,window.location.href=CONTEXT_PATH+"/index#/user/base")}),$scope.sendCaptcha=function(){companyService.sendCaptcha().success(function(data,status){if(200==status){time=60,$("#captchaButton").prop("disabled",!0),$("#captchaButton").html("重新发送(<span id='times'>60</span>)");var setinterval=setInterval(function(){time--,0==time?($("#captchaButton").prop("disabled",!1),clearInterval(setinterval),$("#captchaButton").html("重新发送")):$("#times").html(time)},1e3)}}).error(function(data,status){500==status&&($scope.errorInfo="请勿频繁获取验证码")})},$scope.authenticationCellphone=function(){companyService.authenticationCellphone($scope.captcha).success(function(data,status){200==status&&($rootScope.authenFlag=!0,$("#company-showKey").modal("hide"),"show"==$scope.modalName?$scope.showSecret($scope.authenId):"add"==$scope.modalName?$scope.add():"update"==$scope.modalName?$scope.update($scope.updateId,$scope.updateState):"remove"==$scope.modalName&&$scope.remove($scope.removeId))}).error(function(data,status){$scope.errorInfo=data})},$scope.getAuthenFlag=function(){companyService.getAuthenFlag().success(function(data,status){1==data?$rootScope.authenFlag=!0:$rootScope.authenFlag=!1})},$scope.hideSecret=function(id){delete $scope.secretJson[id],$scope.pageQuery()},$scope.errorInfo="",$scope.getAuthenFlag(),$scope.secretJson={},$scope.pageQuery($scope.pageInfo.currnetPage,$scope.pageInfo.pageSize)})}();