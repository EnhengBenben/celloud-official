var utils={};!function($){$.extend({format:function(str,step,splitor){str=str.toString();var len=str.length;if(len>step){var l1=len%step,l2=parseInt(len/step),arr=[],first=str.substr(0,l1);""!=first&&arr.push(first);for(var i=0;i<l2;i++)arr.push(str.substr(l1+i*step,step));str=arr.join(splitor)}return str}})}(jQuery),utils._stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},utils.formatDate=function(size){var ss=parseInt(size);if(0===ss)return"00:00:00";if(/\D/.test(ss))return"N/A";ss=parseInt(size);var radix=60,mm=0,hh=0;return ss>radix&&(mm=parseInt(ss/radix),ss=parseInt(ss%radix),mm>radix&&(hh=parseInt(mm/radix),mm=parseInt(mm%radix))),hh>0&&hh<10?result="0"+parseInt(hh):hh>=10?result=parseInt(hh):hh<=0&&(result="00"),result+=":",mm>0&&mm<10?result+="0"+parseInt(mm):mm>=10?result+=parseInt(mm):mm<=0&&(result+="00"),result+=":",ss>0&&ss<10?result+="0"+parseInt(ss):ss>=10?result+=parseInt(ss):ss<=0&&(result+="00"),result},utils.getExt=function(fileName){var result=/\.[^\.]+/.exec(fileName);return result},utils.isConfigure=function(fileName){return".txt"==utils.getExt(fileName)||".lis"==utils.getExt(fileName)},utils.setDocSize=function(){var winWidth=$(window).width(),docWidth=$(document).width(),winHeight=$(window).height(),docHeight=$(document).height();winWidth>=docWidth?($(".bgContainer").width(winWidth),$(".longbackground").width(winWidth),$("#bg").width(winWidth)):($(".bgContainer").width(docWidth),$(".longbackground").width(docWidth),$("#bg").width(docWidth)),winHeight>=docHeight?($(".bgContainer").height(winHeight),$(".longbackground").height(winHeight),$("#bg").height(winHeight),$(".container").height(winHeight)):($(".bgContainer").height(docHeight),$(".longbackground").height(docHeight),$("#bg").height(docHeight),$(".container").height(docHeight)),$(".bgContainer").css("overflow","hidden")},utils.checkPlaceholder=function(){var input=document.createElement("input"),isPlaceholder="placeholder"in input;isPlaceholder||$(document).ready(function(){if(!isPlaceholder){$("input").not("input[type='password']").each(function(){""==$(this).val()&&""!=$(this).attr("placeholder")&&($(this).val($(this).attr("placeholder")),$(this).addClass("placeholder"),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")}),$(this).blur(function(){""==$(this).val()&&$(this).val($(this).attr("placeholder"))}))});var pwdField=$("input[type=password]"),pwdVal=pwdField.attr("placeholder");pwdField.after('<input id="pwdPlaceholder" type="text" class="pwd" value='+pwdVal+' autocomplete="off" />');var pwdPlaceholder=$("#pwdPlaceholder");pwdField.val()?(pwdPlaceholder.hide(),pwdField.show()):(pwdPlaceholder.show(),pwdField.hide()),pwdPlaceholder.focus(function(){pwdPlaceholder.hide(),pwdField.show(),pwdField.focus()}),pwdField.blur(function(){""==pwdField.val()&&(pwdPlaceholder.show(),pwdField.hide())})}})},utils.splitDataByInfo=function(data,splitStr,number){var reStr="(.{"+number+"}|.*)",reg=new RegExp(reStr,"g"),dataArray=data.match(reg);dataArray.pop();for(var i=(dataArray.length+1,0);i<dataArray.length;i+=2)dataArray.splice(i+1,0,splitStr);dataArray.pop();var str=dataArray.join("");return str},utils.loadBaiduTongji=function(){var host=window.location.host;if(host.indexOf("www.celloud.cn")>=0){!function(){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?f6b04d06932c0fc1578e79be222599f4",hm.async="async",hm.defer="defer";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)}()}},utils.loadBaiduTongji(),utils.setDocSize(),$(window).resize(function(){utils.setDocSize()}),utils.stopBubble=function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0};
function drawScatter(id,totaldata,thisdata,title,xAxisName,yAxisName){require(["echarts","echarts/chart/scatter"],function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);option={title:{text:title,subtext:"结果来自: CelLoud全部数据",y:0},grid:{y:60},tooltip:{trigger:"axis",showDelay:0,formatter:function(params){return params.value.length>1?params.seriesName+" :<br/>"+params.value[0]+" "+params.value[1]+" ":params.seriesName+" :<br/>"+params.name+" : "+params.value+" "},axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},legend:{data:["全部数据","当前数据"]},toolbox:{show:!0,feature:{dataZoom:{show:!0},restore:{show:!0}}},xAxis:[{type:"value",name:xAxisName,scale:!0,axisLabel:{formatter:"{value} "}}],yAxis:[{type:"value",name:yAxisName,scale:!0,axisLabel:{formatter:"{value} "}}],series:[{name:"全部数据",type:"scatter",data:totaldata,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{name:"当前数据",type:"scatter",data:thisdata,symbol:"star",symbolSize:10,markPoint:{data:[{type:"average",name:"当前数据平均值"}]}}]},myChart.setOption(option,!0)})}$.reportChar={},$.reportChar.draw={_require:function(chartName,option,id){require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}}),require(["echarts","echarts/chart/"+chartName],function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);myChart.setOption(option,!0)})},_requireMulti:function(chartName,option,id){require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}});var chartArr=new Array;chartArr.push("echarts");for(var i=0;i<chartName.length;i++)chartArr.push("echarts/chart/"+chartName[i]);require(chartArr,function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);myChart.setOption(option,!0)})},circularGraphDataOptions:{dataStyle:{normal:{label:{show:!1},labelLine:{show:!1}}},placeHolderStyle:{normal:{color:"rgba(0,0,0,0)",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"rgba(0,0,0,0)"}},legendData:null,seriesData:null},circularGraph:function(id,title,subTitle,data){$.reportChar.circularGraphSeriesData(data),option={title:{text:title,subtext:subTitle,sublink:"",x:"center",y:"center",itemGap:5,textStyle:{color:"rgba(30,144,255,0.8)",fontFamily:"微软雅黑",fontSize:16,fontWeight:"bolder"}},tooltip:{show:!0,formatter:"{b}"},legend:{orient:"vertical",x:$("#"+id).width()/2-10,y:30,itemGap:6,data:$.reportChar.draw.circularGraphDataOptions.legendData},series:$.reportChar.draw.circularGraphDataOptions.seriesData},$.reportChar.draw._require("pie",option,id)},echartsShowPie:function(id,title,data){var option={title:{text:title,x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{type:"pie",radius:"55%",center:["50%","60%"],data:data,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};$.reportChar.draw._require("pie",option,id)},echartsShowBar:function(id,title,X,Y,rotate,width,height){var option={tooltip:{trigger:"axis"},legend:{data:[title],top:15},calculable:!0,xAxis:[{type:"category",data:X,position:"bottom",axisLabel:{rotate:rotate}}],yAxis:[{type:"value",name:"样本数量"}],series:[{name:title,type:"bar",data:Y,barWidth:20}],color:["#feabac"],grid:{width:width,height:height}};$.reportChar.draw._require("bar",option,id)},echartsShowHBVType:function(id,hbvType,currentType,rotate){var option={title:{text:"基因型分类总览表",subtext:"数据来源:CelLoud全部HBV数据",x:"center"},tooltip:{trigger:"axis"},legend:{data:["HBV基因型","当前数据基因型"],y:340},calculable:!0,xAxis:[{type:"category",data:["A","B","C","D","E","F","G","H","比对失败","异常数据"],position:"bottom",axisLabel:{rotate:rotate}}],yAxis:[{type:"value",name:"基因型数量(个)"}],series:[{name:"HBV基因型",type:"bar",data:eval(hbvType),barWidth:30},{name:"当前数据基因型",type:"scatter",data:eval(currentType),barWidth:30,symbol:"triangle"}],grid:{width:800,height:250},color:["#00cccc","#ff0000"]};$.reportChar.draw._requireMulti(["scatter","bar"],option,id)},singleBar:function(id,title,subTitle,data,yAxisName,seriesName){for(var zrColor=require("zrender/tool/color"),_xariaData=new Array,_seriesData=new Array,i=0;i<data.length;i++){var key=data[i][0],value=data[i][1],num_value=""!=value?parseInt(value):0;_xariaData.push(key),_seriesData.push(num_value)}option={title:{x:"center",text:title,subtext:"",textStyle:{color:"rgba(30,144,255,0.8)",fontFamily:"微软雅黑",fontSize:16,fontWeight:"bolder"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},calculable:!0,xAxis:[{type:"category",axisLabel:{rotate:10,margin:3,interval:0,textStyle:{align:"right"}},data:_xariaData}],yAxis:[{type:"value",name:yAxisName}],series:[{name:seriesName,type:"bar",itemStyle:{normal:{color:function(params){return zrColor.lift("#87cefa",.02*params.dataIndex)},label:{show:!0,position:"top",formatter:"{c}"}}},data:_seriesData}]},$.reportChar.draw._require("bar",option,id)},echartsShowScatter:function(id,title,multi,single){var option={title:{text:title,x:"center"},grid:{width:220},tooltip:{trigger:"item",axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},legend:{data:["All data","This one"],x:300,y:180},xAxis:[{type:"value",scale:!0,min:0,max:2,splitNumber:2,name:"序号",nameLocation:"middle",nameGap:20,splitLine:{show:!1}}],yAxis:[{type:"value",scale:!0,axisLabel:{formatter:"{value}"},name:"值"}],series:[{name:"All data",type:"scatter",data:multi},{name:"This one",type:"scatter",data:single}]};$.reportChar.draw._require("scatter",option,id)}},$.reportChar.circularGraphSeriesData=function(list){var o=$.reportChar.draw.circularGraphDataOptions;o.legendData=new Array,o.seriesData=new Array;for(var radius_inner=120,radius_outer=140,i=0;i<list.length;i++){var _key=list[i][0],_value=list[i][1],num_value=""!=_value?parseInt(_value):0,data_name=_value+"% "+_key;o.legendData.push(data_name),o.seriesData.push({name:_key,type:"pie",clockWise:!1,radius:[radius_inner,radius_outer],center:["45%","50%"],itemStyle:o.dataStyle,data:[{value:num_value,name:data_name},{value:100-num_value,name:data_name,tooltip:null,itemStyle:o.placeHolderStyle}]}),radius_inner>0&&(radius_inner-=20,radius_outer-=20)}};var macarons_theme={color:["#2ec7c9","#9a7fd1","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#b6a2de","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],title:{textStyle:{fontWeight:"normal",color:"#008acd"}},dataRange:{itemWidth:15,color:["#5ab1ef","#e0ffff"]},toolbox:{color:["#1e90ff","#1e90ff","#1e90ff","#1e90ff"],effectiveColor:"#ff4500"},tooltip:{backgroundColor:"rgba(50,50,50,0.5)",axisPointer:{type:"line",lineStyle:{color:"#008acd"},crossStyle:{color:"#008acd"},shadowStyle:{color:"rgba(200,200,200,0.2)"}}},dataZoom:{dataBackgroundColor:"#efefff",fillerColor:"rgba(154,127,209,0.2)",handleColor:"#008acd"},grid:{borderColor:"#eee"},categoryAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},polar:{axisLine:{lineStyle:{color:"#ddd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}},splitLine:{lineStyle:{color:"#ddd"}}},timeline:{lineStyle:{color:"#008acd"},controlStyle:{normal:{color:"#008acd"},emphasis:{color:"#008acd"}},symbol:"emptyCircle",symbolSize:3},bar:{itemStyle:{normal:{barBorderRadius:5},emphasis:{barBorderRadius:5}}},line:{smooth:!0,symbol:"emptyCircle",symbolSize:3},k:{itemStyle:{normal:{color:"#d87a80",color0:"#2ec7c9",lineStyle:{color:"#d87a80",color0:"#2ec7c9"}}}},scatter:{symbol:"circle",symbolSize:4},radar:{symbol:"emptyCircle",symbolSize:3},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#d87a80"}}},emphasis:{areaStyle:{color:"#fe994e"}}}},force:{itemStyle:{normal:{linkStyle:{color:"#1e90ff"}}}},chord:{itemStyle:{normal:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{axisLine:{lineStyle:{color:[[.2,"#2ec7c9"],[.8,"#5ab1ef"],[1,"#d87a80"]],width:10}},axisTick:{splitNumber:10,length:15,lineStyle:{color:"auto"}},splitLine:{length:22,lineStyle:{color:"auto"}},pointer:{width:5}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}};
var map={};map.TTT="F",map.TCT="S",map.TAT="Y",map.TGT="C",map.TTC="F",map.TCC="S",map.TAC="Y",map.TGC="C",map.TTA="L",map.TCA="S",map.TAA="",map.TGA="",map.TTG="L",map.TCG="S",map.TAG="",map.TGG="W",map.CTT="L",map.CCT="P",map.CAT="H",map.CGT="R",map.CTC="L",map.CCC="P",map.CAC="H",map.CGC="R",map.CTA="L",map.CCA="P",map.CAA="Q",map.CGA="R",map.CTG="L",map.CCG="P",map.CAG="Q",map.CGG="R",map.ATT="I",map.ACT="T",map.AAT="N",map.AGT="S",map.ATC="I",map.ACC="T",map.AAC="N",map.AGC="S",map.ATA="I",map.ACA="T",map.AAA="K",map.AGA="R",map.ATG="M",map.ACG="T",map.AAG="K",map.AGG="R",map.GTT="V",map.GCT="A",map.GAT="D",map.GGT="G",map.GTC="V",map.GCC="A",map.GAC="D",map.GGC="G",map.GTA="V",map.GCA="A",map.GAA="E",map.GGA="G",map.GTG="V",map.GCG="A",map.GAG="E",map.GGG="G";
var messageUtils=function(messageUtils){function bindEvents(){self.ws.onopen=function(){console.log("websocket connect is opened : "+new Date),clearTimeouts();for(var listener in self.openListeners)$.isFunction(self.openListeners[listener])&&self.openListeners[listener]()},self.ws.onmessage=function(e){var message=JSON.parse(e.data),channels=self.messageChannels[message.channel]||[];if(channels.length<=0)return void console.log("no listener for channel: "+message.channel);for(var channel in channels)$.isFunction(channels[channel])&&channels[channel](message.message)},self.ws.onclose=function(){console.log("websocket connect is closed : "+new Date);for(var listener in self.closeListeners)$.isFunction(self.closeListeners[listener])&&self.closeListeners[listener]()},self.ws.onerror=function(event){console.log("websocket error : "+new Date),console.log(event),console.log(event.data)}}function clearTimeouts(){for(var t in self.timeouts)clearTimeout(self.timeouts[t]);self.timeouts=[]}var self=messageUtils||{};self.messageChannels={listenerNumbers:0},self.openListeners={listenerNumbers:0},self.closeListeners={listenerNumbers:0},self.timeouts={},self.addOpenListener=function(listener){self.openListeners[self.openListeners.listenerNumbers]=listener,self.openListeners.listenerNumbers=self.openListeners.listenerNumbers+1},self.addCloseListener=function(listener){self.closeListeners[self.closeListeners.listenerNumbers]=listener,self.closeListeners.listenerNumbers=self.closeListeners.listenerNumbers+1},self.subscribe=function(channel,callback){var channels=self.messageChannels[channel]||{listenerNumbers:0};$.isFunction(callback)&&(channels[channels.listenerNumbers]=callback,channels.listenerNumbers=channels.listenerNumbers+1,self.messageChannels[channel]=channels)};var openWebSocket=function(){var contextPath=window.CONTEXT_PATH||window.contextPath||"",protocol="https:"==window.location.protocol?"wss://":"ws://",hostname=window.location.hostname,port=window.location.port?":"+window.location.port:"",wsUrl=protocol+hostname+port+contextPath+"/websocket/message",ws=null;return ws="WebSocket"in window?new WebSocket(wsUrl):window.MozWebSocket?new MozWebSocket(wsUrl):new SockJS(contextPath+"/sockjs/message")};self.ws=openWebSocket(),bindEvents();var createNotification=function(title,message,options){var defaultOptions={icon:CONTEXT_PATH+"/images/icon/portrait.png"};return options=$.extend({},defaultOptions,options),options.body=message,new Notification(title,options)};return self.notify=function(title,message,options,events){if(!("Notification"in window))return void console.log("This browser does not support desktop notification");var notification=null;if("granted"===Notification.permission?notification=createNotification(title,message,options):"default"===Notification.permission&&Notification.requestPermission(function(permission){"granted"===permission&&(notification=createNotification(title,message,options))}),null!=notification){var defaultEvents={onclick:function(){notification.close()}};events=$.extend({},defaultEvents,events),$.isFunction(events.onclick)&&(notification.onclick=events.onclick)}},self}(messageUtils);messageUtils.addOpenListener(function(){}),messageUtils.addCloseListener(function(){}),messageUtils.subscribe("userMessage",function(data){console.log("消息来了!")});
!function($){var defaults={delay:3e3},messages=[],showNext=function(){$("#alerts").children().length<5&&messages.length>0&&show(messages.shift())},show=function(message){message.msg=message.msg||"";var $alert=$('<div class="alert message-alert alert-dismissible fade in" role="alert"><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><span>'+message.msg+"</span></div>");$alert.addClass("alert-"+message.type),$alert.on("closed.bs.alert",function(){close($alert)}),$("#alerts").append($alert),setTimeout(function(){close($alert)},message.delay||defaults.delay)},close=function($alert){$alert.remove(),showNext()},push=function(msg,type,delay){messages.push({msg:msg,type:type,delay:delay}),showNext()};$.extend({success:function(msg,delay){push(msg,"success",delay)},info:function(msg,delay){push(msg,"info",delay)},warn:function(msg,delay){push(msg,"warning",delay)},danger:function(msg,delay){push(msg,"danger",delay)},alert:function(msg,delay){push(msg,"success",delay)}})}(jQuery);
!function($){var show=function(type,title,message,callback){$("#confirm-modal-div").html()?$("#confirm-modal-div").html(""):$("BODY").append('<div id="confirm-modal-div"></div>');var $alert=$('<div id="confirm-modal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" role="alert"></div>');$alert.addClass(type+"-modal");var $dialog=$('<div class="modal-dialog modal-sm"></div>'),$content=$('<div class="modal-content"></div>'),$header=$('<div class="modal-header"><button type="button" class="close" aria-label="Close" id="close-confirm"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><h4 class="modal-title">'+title+"</h4></div>"),$body=$('<div class="modal-body"></div>'),$h5=$("<h5></h5>"),$footer=$('<div class="modal-footer"><button type="reset" class="btn btn-cancel -low pull-left" data-dismiss="modal" id="confirm-cancle">取消</button><button type="submit" class="btn -low pull-right" id="confirm-ok">确定</button></div>');switch($h5.append($('<i class="fa fa-exclamation-circle" aria-hidden="true"></i>')),$h5.append($("<span>"+message+"</span>")),$body.append($h5),$content.append($header),$content.append($body),type){case"confirm":$content.append($footer),$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert),$("#confirm-ok").click(function(){hide(),callback()}),$("#confirm-cancle").click(function(){hide()});break;case"tips":$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert)}$("#close-confirm").click(function(){hide()})},hide=function(){$("#confirm-modal").modal("hide")},confirm=function(message,title,callback){null==title&&(title="确认框"),show("confirm",title,message,function(result){callback&&callback(result)})},tips=function(message,title){null==title&&(title="提示框"),show("tips",title,message,null)};$.extend({confirm:function(message,title,callback){confirm(message,title,callback)},tips:function(message,title){tips(message,title)}})}(jQuery);
!function(){window.celloudApp=angular.module("celloudApp",["ngRoute","ngResource","ngSanitize"])}();
var appStore=function(appStore){var self=appStore||{};return self.introNext=0,self.sortFiled=null,self.sortType=null,self.getMyApp=function(){$.get("app/myApps",{},function(responseText){$("#myAppDiv").html(responseText)})},self.toSclassifyApp=function(pid,pname){$("#secondClassifyName").parent().addClass("hide"),$("#appClassifyUl li").removeClass("active"),$("#classifypidLi"+pid).addClass("active"),$.get("app/toSclassifyApp",{paramId:pid},function(responseText){$("#sclassify").html(responseText),1==hasNavi&&null!=intro&&0==self.introNext&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","bottom"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2)),1==hasNavi&&null!=intro&&1==self.introNext&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","left"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(3)),self.introNext=1}),$("#defaultPid").val(pid),$("#defaultPname").val(pname)},self.initApp=function(){self.getMyApp();var pid=$("#defaultPid").val(),pname=$("#defaultPname").val();self.toSclassifyApp(pid,pname)},self.sortApp=function(){$("#sort-listUl li").removeClass("current"),"a.create_date"==self.sortFiled?($("#sortByCreateDate").addClass("current"),"desc"==self.sortType?$("#sortByCreateDate i").removeClass("up").addClass("down"):$("#sortByCreateDate i").removeClass("down").addClass("up")):$("#defaultSort").addClass("current")},self.toMoreApp=function(pid,sid,pageNum,isParent){currentPage=pageNum,$("#rootClassifyName").unbind("click"),$("#secondClassifyName").unbind("click"),$.get("app/toMoreAppList",{classifyId:sid,classifyPid:pid,classifyFloor:isParent,size:pageAppNum,page:currentPage,condition:self.sortFiled,type:self.sortType},function(responseText){$("#appMain").html(responseText),0==pid?$("#rootClassifyName").html($("#pid"+sid).html()):$("#rootClassifyName").html($("#pid"+pid).html()),0==sid||0==pid?$("#secondClassifyName").html("全部"):$("#secondClassifyName").html($("#sid"+sid).html()),$("#rootClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}),"全部"==$("#secondClassifyName").html()?$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}):$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,sid,pageNum,isParent)}),$("#secondClassifyName").parent().removeClass("hide"),$("#sortByCreateDate").bind("click",function(){self.sortFiled="a.create_date","desc"==self.sortType?self.sortType="asc":self.sortType="desc",self.toMoreApp(pid,sid,1,isParent)}),$("#defaultSort").bind("click",function(){self.sortFiled=null,self.sortType=null}),self.sortApp(),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2))})},self.toAppDetail=function(id){$.get("app/appDetail",{paramId:id},function(responseText){$("#appMain").html(responseText),window.scrollTo(0,0),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","right"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2),$("#manageAppBtns .btn").removeAttr("href"),$("#manageAppBtns .btn").removeAttr("onclick"),$("#manageAppBtns").bind("click",function(){1==hasNavi&&null!=intro&&($("#toUploadMenu").attr("data-step",3),intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(3)),$("#manageAppBtns").unbind("click")}))})},self.toAppMoreDetail=function(id){$("#toAppMoreDetailUl li").removeClass("select"),$("#"+id).addClass("select")},self.addApp=function(id){$.get("app/addApp",{paramId:id},function(responseText){responseText>0&&($("#toAddApp").attr("onclick","appStore.removeApp("+id+")"),$("#toAddApp").html('<i class="fa fa-minus"></i>&nbsp;取消添加'),$("#toAddApp").removeClass("btn-celloud-success").addClass("btn-celloud-close"),self.getMyApp(),self.refreshProduct())})},self.removeApp=function(id){$.get("app/removeApp",{paramId:id},function(responseText){if(responseText>0){var appId=$("#app-detail-appId").val();appId==id&&($("#toAddApp").attr("onclick","appStore.addApp("+id+")"),$("#toAddApp").html('<i class="fa fa-plus"></i>&nbsp;添加'),$("#toAddApp").removeClass("btn-celloud-close").addClass("btn-celloud-success")),self.getMyApp(),self.refreshProduct()}})},self.refreshProduct=function(){var appElement=document.querySelector("[ng-controller=sidebarController]"),element=angular.element(appElement),$scope=element.scope();$scope.refreshUserProduct()},self}(appStore);
var $base={sortIcon:function(sortDate,sortBatch,sortName,sortPeriod){"asc"==sortDate?$("#sort-date-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):"desc"==sortDate&&$("#sort-date-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc"),"asc"==sortBatch?$("#sort-batch-icon").removeClass("fa-sort-desc").addClass("fa-sort-asc"):"desc"==sortBatch&&$("#sort-batch-icon").removeClass("fa-sort-asc").addClass("fa-sort-desc"),"asc"==sortName?$("#sort-name-icon").removeClass("fa-sort-desc").addClass("fa-sort-asc"):"desc"==sortName&&$("#sort-name-icon").removeClass("fa-sort-asc").addClass("fa-sort-desc"),"asc"==sortPeriod?$("#sort-period-icon").removeClass("fa-sort-desc").addClass("fa-sort-asc"):"desc"==sortPeriod&&$("#sort-period-icon").removeClass("fa-sort-asc").addClass("fa-sort-desc")},itemBtnToggleActive:function(obj){$("#common-menu .treeview").removeClass("-active"),$(obj).parent().addClass("-active"),$("#menu-name").html($(obj).data("menu"))}};
function bigFigure(src){$("img[id='imageFullScreen']").css("width",960),$("img[id='imageFullScreen']").css("height",144),showZoom(src)}function bigOrigin(src,id){var width=$("#"+id).width(),height=$("#"+id).height();$("img[id='imageFullScreen']").css("width",1.5*width),$("img[id='imageFullScreen']").css("height",1.5*height),showZoom(src)}function bigReplace(src){alert("ddddddddddddddddd"),$("img[id='imageFullScreen']").css("width",1050),$("img[id='imageFullScreen']").css("height",157.5),showZoom(src)}
!function($){$.extend({NV:function(name){var NV={},UA=navigator.userAgent.toLowerCase();NV.ua=UA;try{NV.name=-[1]?UA.indexOf("msie")>-1?"ie":UA.indexOf("rv:")>-1&&UA.indexOf("like gecko")>-1>0?"ie":UA.indexOf("firefox")>0?"firefox":UA.indexOf("chrome")>0?"chrome":window.opera?"opera":window.openDatabase?"safari":"unkonw":"ie"}catch(e){}try{NV.version="ie"==NV.name?UA.indexOf("msie")>0?UA.match(/msie ([\d.]+)/)[1]:UA.match(/rv:([\d.]+)\) like gecko/)[1]:"firefox"==NV.name?UA.match(/firefox\/([\d.]+)/)[1]:"chrome"==NV.name?UA.match(/chrome\/([\d.]+)/)[1]:"opera"==NV.name?UA.match(/opera.([\d.]+)/)[1]:"safari"==NV.name?UA.match(/version\/([\d.]+)/)[1]:"0"}catch(e){}try{NV.shell=UA.indexOf("360ee")>-1?"360极速浏览器":UA.indexOf("360se")>-1?"360安全浏览器":UA.indexOf("se")>-1?"搜狗浏览器":UA.indexOf("aoyou")>-1?"遨游浏览器":UA.indexOf("theworld")>-1?"世界之窗浏览器":UA.indexOf("worldchrome")>-1?"世界之窗极速浏览器":UA.indexOf("greenbrowser")>-1?"绿色浏览器":UA.indexOf("qqbrowser")>-1?"QQ浏览器":"ie"==NV.name?"IE 浏览器":"firefox"==NV.name?"火狐浏览器":"chrome"==NV.name?"谷歌浏览器":"opera"==NV.name?"Opera 浏览器":"safari"==NV.name?"Safari 浏览器":"未知或无壳"}catch(e){}switch(name){case"ua":case"UA":br=NV.ua;break;case"name":br=NV.name;break;case"version":br=NV.version;break;case"shell":br=NV.shell;break;default:br=NV}return br}})}(jQuery);
$(function(){$("#condition-find").unbind("click"),$("#condition-find").on("click",function(){$.data_.options.condition=$("#condition-input").val(),$.data_.find.condition()})});
var uploadPercent=0;$(function(){$.report.find.main(0),$("#to-sample-a").on("click",function(){$.base.itemBtnToggleActive($(this)),$.sample.main()}),$("#to-upload-a").on("click",function(){$.base.itemBtnToggleActive($(this)),$(".plupload_filelist li").hasClass("plupload_droptext")&&($("#batch-info").val(""),$("#batch-div").removeClass("hide"),$("#upload-content").addClass("upload-step-one")),$("#upload-modal").modal("show"),uploadPercent>=100&&(waveLoading.setProgress(0),document.querySelector("#upload-progress").height=document.querySelector("#upload-progress").height)}),$("#to-report-a").on("click",function(){$.report.find.main(0),$.base.itemBtnToggleActive($(this)),$("#report-list-li").removeClass("hide")}),$("body").on("click",'[data-click="report-list"]',function(){$.report.find.main(1),$(this).addClass("active"),$.base.itemBtnToggleActive($("#to-report-a"))}),$("#to-data-a").on("click",function(){$.data_.find.condition(),$.base.itemBtnToggleActive($(this))}),$("#next-step").on("click",function(){$(".step-one-content").addClass("hide"),$(".step-two-content").removeClass("hide"),$("#one-to-two").addClass("active"),$(".step-two").addClass("active"),$.upload.uploadTextType()}),$("#batch-info").on("keyup",function(e){e=e||window.event,"13"==e.keyCode&&$("#next-step").click()}),$("#condition-input").on("keyup",function(e){e=e||window.event,"13"==e.keyCode&&$("#condition-find").click()}),$("body").on("click",".table>tbody .checkbox",function(){$(this).toggleClass("checkbox-un"),$(this).toggleClass("checkbox-ed")})}),$.base={sortIcon:function(sortDate,sortBatch,sortName,sortPeriod){"asc"==sortDate?$("#sort-date-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):"desc"==sortDate&&$("#sort-date-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc"),"asc"==sortBatch?$("#sort-batch-icon").removeClass("fa-sort-desc").addClass("fa-sort-asc"):"desc"==sortBatch&&$("#sort-batch-icon").removeClass("fa-sort-asc").addClass("fa-sort-desc"),"asc"==sortName?$("#sort-name-icon").removeClass("fa-sort-desc").addClass("fa-sort-asc"):"desc"==sortName&&$("#sort-name-icon").removeClass("fa-sort-asc").addClass("fa-sort-desc"),"asc"==sortPeriod?$("#sort-period-icon").removeClass("fa-sort-desc").addClass("fa-sort-asc"):"desc"==sortPeriod&&$("#sort-period-icon").removeClass("fa-sort-asc").addClass("fa-sort-desc")},itemBtnToggleActive:function(obj){$("#common-menu .item-btn").removeClass("active"),$(obj).addClass("active")}},$.sample={main:function(){$("#container").load("pages/bsi/sample_main.jsp",function(){$.sample.sampleList(),$("#sample-add-a").on("click",function(){$.sample.addSample()}),$("#sample-input").on("keyup",function(e){e=e||window.event,"13"==e.keyCode&&$("#sample-add-a").click()}),$("#close-s-error").on("click",function(){$.sample.errorTips.hide()}),$("#sample-commit-a").on("click",function(){$.sample.commitSamples()}),$("#sample-reset").on("click",function(){$.sample.deleteList()}),$("body").on("click","[data-click='del-sample']",function(){$.sample.deleteOne($(this).data("id"))})})},sampleList:function(){$.get("sample/bsi/sampleList",{},function(response){$("#sample-list-tbody").html(response)})},addSample:function(){var sampleName=$("#sample-input").val();""!=sampleName.trim()&&$.get("sample/bsi/addSample",{sampleName:sampleName},function(result){1==result?($.sample.sampleList(),$("#sample-input").val("")):2==result&&$.sample.errorTips.show()})},commitSamples:function(){var param=$("#sample-form").serialize();param.length>0&&$.post("sample/bsi/commitSamples",param,function(result){$.sample.sampleList()})},deleteOne:function(id){$.post("sample/bsi/deleteOne",{sampleId:id},function(result){result>0&&$.sample.sampleList()})},deleteList:function(){var param=$("#sample-form").serialize();param.length>0&&$.post("sample/bsi/deleteList",param,function(result){result>0&&$.sample.sampleList()})},errorTips:{show:function(){$("#sample-error").removeClass("hide")},hide:function(){$("#sample-error").addClass("hide")}}},$.upload={uploadTextType:function(){$("#uploading-filelist").children().length>2?$(".upload-text").addClass("hide"):$(".upload-text").removeClass("hide")}},$.report={options:{condition:null,sort:0,sortBatch:"asc",sortName:"asc",sortPeriod:"asc",sortDate:"desc",pageSize:$("#page-size-sel").val(),reportType:0,batch:null,period:null,beginDate:null,endDate:null,distributed:null,sampleName:null},find:{main:function(type){$.get("report/bsi/reportMain",function(response){$("#container").html(response),0==type?$.report.find.all():$.report.find.pagination(),$("#condition-find").unbind("click"),$("#condition-find").on("click",function(){$.report.options.condition=$("#condition-input").val(),$.report.find.condition()}),$("body").on("click","[data-click='report-check-all']",function(){$(this).hasClass("checkbox-ed")?($(this).removeClass("checkbox-ed").addClass("checkbox-un"),$(".table>tbody .checkbox,.pagination .checkbox").removeClass("checkbox-ed").addClass("checkbox-un")):($(this).removeClass("checkbox-un").addClass("checkbox-ed"),$(".table>tbody .checkbox,.pagination .checkbox").addClass("checkbox-ed").removeClass("checkbox-un"))}),$("body").on("click","[data-click='report-batch-search']",function(){$("#batch-sl").hasClass("select-more")||($.report.options.batch="'"+$(this).text()+"'",$.report.find.condition(),$("#selected-batch span").html($(this).text()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"))}),$("body").on("click","[data-click='report-period-search']",function(){$("#period-sl").hasClass("select-more")||($.report.options.period=$(this).find("input").val(),$.report.find.condition(),$("#selected-period span").html($(this).find("span").html()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"))}),$("body").on("click","[data-click='report-date-search']",function(){$.report.options.beginDate=$("#report-begindate-search").val(),$.report.options.endDate=$("#report-enddate-search").val(),$.report.find.condition()}),$("body").on("click","[data-click='report-distributed-search']",function(){$(this).find(".sl-judge-no").hasClass("hide")?($(this).find(".sl-judge-no").removeClass("hide"),$(this).find(".sl-judge-yes").addClass("hide"),$.report.options.distributed=1):($(this).find(".sl-judge-yes").removeClass("hide"),$(this).find(".sl-judge-no").addClass("hide"),$.report.options.distributed=0),$.report.find.condition()}),$("#batch-more").on("click",function(){$("#batch-lists").hasClass("show-more")?($("#batch-lists").removeClass("show-more"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")):($("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"))}),$("body").on("click","[data-click='report-select-more']",function(){$(".selector-line").removeClass("select-more"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$(".selector-line .checkbox").removeClass("checkbox-ed").addClass("checkbox-un").addClass("hide"),$(".selector-line").find("[name='sl-confirm']").addClass("disabled"),$(".selector-line").find("[name='sl-confirm']").attr("disabled",!0),$(".selector-line").find(".multisl-btns").addClass("hide");var selectorline=$(this).parent().parent().parent();$(selectorline).addClass("select-more"),$(selectorline).find(".sl-val").addClass("show-more"),$(selectorline).find(".checkbox").removeClass("hide"),$(selectorline).find(".multisl-btns").removeClass("hide")}),$("#batch-multiselect").on("click",function(){$("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$("#batch-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$("#batch-more").addClass("disabled"),$("#batch-more").attr("disabled",!0)}),$("#batch-lists .sl-val-content").on("click",function(){$(this).find(".checkbox").toggleClass("checkbox-un"),$(this).find(".checkbox").toggleClass("checkbox-ed"),$("#batch-lists .checkbox-ed").size()>0?($("#report-multibatch-search").removeClass("disabled"),$("#report-multibatch-search").attr("disabled",!1)):($("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0))}),$("#report-multibatch-search").on("click",function(){var show_val=[];$("#batch-lists .checkbox-ed").each(function(){null==$.report.options.batch?$.report.options.batch="'"+$(this).next().text()+"'":$.report.options.batch+=",'"+$(this).next().text()+"'",show_val.push($(this).next().text())}),$.report.find.condition(),$("#selected-batch span").html(show_val.toString()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"),$("#batch-sl").removeClass("select-more"),$("#batch-lists").removeClass("show-more"),$("#batch-lists").find(".checkbox").addClass("hide"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")}),$("#clear-sl-batch").on("click",function(){$("#selected-batch").addClass("hide"),$("#to-sl-batch").removeClass("hide"),$.report.options.batch=null,$("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-lists").find(".multisl-btns").addClass("hide"),$.report.find.condition()}),$("#period-lists .sl-val-content").on("click",function(){$(this).find(".checkbox").toggleClass("checkbox-un"),$(this).find(".checkbox").toggleClass("checkbox-ed"),$("#period-lists .checkbox-ed").size()>0?($("#report-multiperiod-search").removeClass("disabled"),$("#report-multiperiod-search").attr("disabled",!1)):($("#report-multiperiod-search").addClass("disabled"),$("#report-multiperiod-search").attr("disabled",!0))}),$("#report-multiperiod-search").on("click",function(){var show_val=[];$("#period-lists .checkbox-ed").each(function(){null==$.report.options.period?$.report.options.period=$(this).next().find("input[type='hidden']").val():$.report.options.period+=","+$(this).next().find("input[type='hidden']").val(),show_val.push($(this).next().find("span").html())}),$.report.find.condition(),$("#selected-period span").html(show_val.toString()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"),$("#period-sl").removeClass("select-more"),$("#period-sl").find(".checkbox").addClass("hide"),$("#period-sl").find(".multisl-btns").addClass("hide"),$("#period-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un")}),$("#clear-sl-period").on("click",function(){$("#selected-period").addClass("hide"),$("#to-sl-period").removeClass("hide"),$.report.options.period=null,$.report.find.condition()}),$("body").on("click","[data-click='reset-multiselect']",function(){var selectorline=$(this).parent().parent().parent().parent();$(selectorline).removeClass("select-more"),$(selectorline).find(".sl-val").removeClass("show-more"),$(selectorline).find(".checkbox").addClass("hide").addClass("checkbox-un").removeClass("checkbox-ed"),$(selectorline).find(".multisl-btns").addClass("hide"),$("#batch-more").hasClass("disabled")&&$("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$.report.options.batch=null,$.report.options.period=null})})},all:function(){$.get("report/bsi/reportList",function(response){$.report.loadlist(response),$.report.options={condition:null,sort:0,sortBatch:"asc",sortName:"asc",sortPeriod:"asc",sortDate:"desc",pageSize:$("#page-size-sel").val(),reportType:0,batch:null,period:null,beginDate:null,endDate:null,distributed:null,sampleName:null}})},condition:function(){var options=$.report.options;$.get("report/bsi/searchReportList",{sampleName:options.sampleName,batch:options.batch,period:options.period,beginDate:options.beginDate,endDate:options.endDate,condition:options.condition,sort:options.sort,sortDate:options.sortDate,sortPeriod:options.sortPeriod,sortBatch:options.sortBatch,sortName:options.sortName,size:options.pageSize},function(response){$.report.loadlist(response)})},pagination:function(currentPage){var options=$.report.options;$.get("report/bsi/searchReportList",{sampleName:options.sampleName,batch:options.batch,period:options.period,beginDate:options.beginDate,endDate:options.endDate,page:currentPage,condition:options.condition,sort:options.sort,sortDate:options.sortDate,sortPeriod:options.sortPeriod,sortBatch:options.sortBatch,sortName:options.sortName,size:options.pageSize},function(response){$.report.loadlist(response)})}},loadlist:function(response){$("#report-list").html(response),$("#sample-selector").val($.report.options.sampleName),$("#sample-selector").on("keyup",function(e){e=e||window.event,"13"==e.keyCode&&($.report.options.sampleName=$("#sample-selector").val(),$.report.find.condition())}),$("#data-list-tbody").find("td[name='data-name-td']").each(function(){var _data=$(this).attr("title");if(_data.length>40){var newData=utils.splitDataByInfo(_data,"\r\n",40);$(this).attr("title",newData)}}),$.base.sortIcon($.report.options.sortDate,$.report.options.sortBatch,$.report.options.sortName,$.report.options.sortPeriod),$("#pagination-task").on("click","a",function(e){var page,id=$(this).attr("id"),currentPage=parseInt($("#current-page-hide").val()),totalPage=parseInt($("#total-page-hide").val());void 0==id?page=$(this).html():id.indexOf("prev")>=0?page=1==currentPage?1:currentPage-1:id.indexOf("next")>=0?(page=currentPage+1,page=currentPage==totalPage?currentPage:currentPage+1):id.indexOf("first")>=0?page=1:id.indexOf("last")>=0&&(page=totalPage),$.report.find.pagination(page)}),$("#sort-date").on("click",function(e){$.report.options.sort=0,$.report.options.sortDate="desc"==$.report.options.sortDate?"asc":"desc",$.report.find.condition()}),$("#sort-batch").on("click",function(e){$.report.options.sort=1,$.report.options.sortBatch="desc"==$.report.options.sortBatch?"asc":"desc",$.report.find.condition()}),$("#sort-name").on("click",function(e){$.report.options.sort=2,$.report.options.sortName="desc"==$.report.options.sortName?"asc":"desc",$.report.find.condition()}),$("#sort-period").on("click",function(e){$.report.options.sort=3,$.report.options.sortPeriod="desc"==$.report.options.sortPeriod?"asc":"desc",$.report.find.condition()}),$("#page-size-sel").on("change",function(e){$.report.options.pageSize=$("#page-size-sel").val(),$.report.find.condition()})},reRun:function(dataKey,appId,projectId){$.get("data/reRun",{dataKey:dataKey,appId:appId,projectId:projectId},function(result){$.report.find.condition()})},detail:{option:{batchPage:1},patient:function(dataKey,projectId,appId,reportIndex,currentPage){var options=$.report.options;$.post("report/getBSIPatientReport",{sampleName:options.sampleName,reportIndex:reportIndex,dataKey:dataKey,projectId:projectId,appId:appId,page:currentPage,condition:options.condition,sort:options.sort,sortDate:options.sortDate,sortPeriod:options.sortPeriod,sortBatch:options.sortBatch,sortName:options.sortName,size:options.pageSize},function(response){$("#container").html(response)})},analy:function(dataKey,projectId,appId){$.get("report/getBSIAnalyReport",{dataKey:dataKey,projectId:projectId,appId:appId},function(response){$("#myTabContent").html(response)})},prev:function(currentPage){if(currentPage>1){var options=$.report.options;$.post("report/getPrevOrNextBSIReport",{sampleName:options.sampleName,batch:options.batch,period:options.period,beginDate:options.beginDate,endDate:options.endDate,isPrev:!0,page:currentPage-1,condition:options.condition,sort:options.sort,sortDate:options.sortDate,sortPeriod:options.sortPeriod,sortBatch:options.sortBatch,sortName:options.sortName},function(response){null!=response&&""!=response&&$("#container").html(response)})}},next:function(currentPage){var totalPage=$("#total-page-hide").val();if(currentPage=parseInt(currentPage),currentPage<totalPage){var options=$.report.options;$.post("report/getPrevOrNextBSIReport",{sampleName:options.sampleName,batch:options.batch,period:options.period,beginDate:options.beginDate,endDate:options.endDate,isPrev:!1,page:currentPage+1,totalPage:totalPage,condition:options.condition,sort:options.sort,sortDate:options.sortDate,sortPeriod:options.sortPeriod,sortBatch:options.sortBatch,sortName:options.sortName},function(response){null!=response&&""!=response&&$("#container").html(response)})}}},period:{error:function(dataName){$("#run-error-data").html(dataName),$("#running-error-modal").modal("show")}}},$.data_={options:{condition:null,sort:0,sortBatch:"asc",sortName:"asc",sortDate:"desc",pageSize:$("#page-size-sel").val()},find:{all:function(){$.get("data/bsiDataList",function(response){$.data_.loadlist(response)})},condition:function(){var options=$.data_.options;$.get("data/bsiDataList",{batch:options.batch,period:options.period,beginDate:options.beginDate,endDate:options.endDate,condition:options.condition,sort:options.sort,sortDate:options.sortDate,sortBatch:options.sortBatch,sortName:options.sortName,size:options.pageSize},function(response){$.data_.loadlist(response)})},pagination:function(currentPage){var options=$.data_.options;$.get("data/bsiDataList",{page:currentPage,condition:options.condition,sort:options.sort,sortDate:options.sortDate,sortBatch:options.sortBatch,sortName:options.sortName,size:options.pageSize},function(response){$.data_.loadlist(response)})}},loadlist:function(response){$("#container").html(response),$("#data-list-tbody").find("td[name='data-name-td']").each(function(){var _data=$(this).attr("title");if(_data.length>40){var newData=utils.splitDataByInfo(_data,"\r\n",40);$(this).attr("title",newData)}});var options=$.data_.options;$.base.sortIcon(options.sortDate,options.sortBatch,options.sortName,null),$("#pagination-data").on("click","a",function(e){var page,id=$(this).attr("id"),currentPage=parseInt($("#current-page-hide").val()),totalPage=parseInt($("#total-page-hide").val());void 0==id?page=$(this).html():id.indexOf("prev")>=0?page=1==currentPage?1:currentPage-1:id.indexOf("next")>=0?(page=currentPage+1,page=currentPage==totalPage?currentPage:currentPage+1):id.indexOf("first")>=0?page=1:id.indexOf("last")>=0&&(page=totalPage),$.data_.find.pagination(page)}),$("#sort-date").on("click",function(e){$.data_.options.sort=0,$.data_.options.sortDate="desc"==$.data_.options.sortDate?"asc":"desc",$.data_.find.condition()}),$("#sort-batch").on("click",function(e){$.data_.options.sort=1,$.data_.options.sortBatch="desc"==$.data_.options.sortBatch?"asc":"desc",$.data_.find.condition()}),$("#sort-name").on("click",function(e){$.data_.options.sort=2,$.data_.options.sortName="desc"==$.data_.options.sortName?"asc":"desc",$.data_.find.condition()}),$("#page-size-sel").on("change",function(e){$.data_.options.pageSize=$("#page-size-sel").val(),$.data_.find.condition()})}};
$.dataReport={navList:function(){$.post("report/bsi/batchReportList",{batch:$("#data-batch").html(),appId:$("#appid-hide").val(),dataKey:$("#datakey-hide").val()},function(response){$.dataReport.loadNavList(response)})},paginNavList:function(currentPage){$.report.detail.option.batchPage=currentPage,$.post("report/bsi/batchReportList",{batch:$("#data-batch").html(),appId:$("#appid-hide").val(),dataKey:$("#datakey-hide").val(),page:currentPage},function(response){$.dataReport.loadNavList(response)})},loadNavList:function(response){$("#report-pagination").html(response),$("#reportbatch"+$("#datakey-hide").val()).addClass("active"),$("#pagination-data-report").on("click","a",function(e){var page,id=$(this).attr("id"),currentPage=parseInt($("#batch-current-page-hide").val()),totalPage=parseInt($("#batch-total-page-hide").val());void 0==id?page=$(this).html():id.indexOf("prev")>=0?page=1==currentPage?1:currentPage-1:id.indexOf("next")>=0?(page=currentPage+1,page=currentPage==totalPage?currentPage:currentPage+1):id.indexOf("first")>=0?page=1:id.indexOf("last")>=0&&(page=totalPage),$.dataReport.paginNavList(page)})}},$(function(){1==$.report.options.reportType&&($("#analy-tab").tab("show"),$("#print-analy-a").removeClass("hide"),$("#print-patient-a").addClass("hide")),$("#patient-tab").click(function(e){e.preventDefault(),$(this).tab("show"),$("#print-patient-a").removeClass("hide"),$("#print-analy-a").addClass("hide"),$.report.options.reportType=0}),$("#analy-tab").click(function(e){e.preventDefault(),$(this).tab("show"),$("#print-analy-a").removeClass("hide"),$("#print-patient-a").addClass("hide"),$.report.options.reportType=1}),$.dataReport.paginNavList($.report.detail.option.batchPage)});
var fileUpload=function(fileUpload){var self=fileUpload||{};self.refreshSession=function(){$.get("uploadFile/checkAdminSessionTimeOut")},$(function(){function getSize(fileSize){var unit="b";return fileSize>1e3&&(fileSize/=1e3,unit="kb"),fileSize>1e3&&(fileSize/=1e3,unit="mb"),fileSize.toFixed(2)+unit}function handleStatus(file){var actionClass,iconClass;file.status==plupload.DONE&&(actionClass="plupload_done",iconClass="fa fa-check-circle"),file.status==plupload.FAILED&&(actionClass="plupload_failed",iconClass="fa fa-exclamation-triangle"),file.status!=plupload.QUEUED&&file.status!=plupload.UPLOADING||(actionClass="plupload_delete",iconClass="fa fa-times-circle-o");var icon=$("#uploading-"+file.id).attr("class",actionClass).find("i").attr("class",iconClass);file.hint&&icon.attr("title",file.hint)}var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:["plupload-content","upload-more"],url:"../uploadFile/uploadManyFile",chunk_size:"1mb",dragdrop:!0,unique_names:!0,drop_element:"upload-filelist",filters:{max_file_size:"3gb",prevent_duplicates:!0,mime_types:[{title:"bam",extensions:"bam"},{title:"ab1",extensions:"ab1"},{title:"abi",extensions:"abi"},{title:"fasta",extensions:"fasta"},{title:"fastq",extensions:"fastq"},{title:"tsv",extensions:"tsv"},{title:"gz",extensions:"gz"},{title:"lis",extensions:"lis"},{title:"txt",extensions:"txt"}]},max_retries:5,multiple_queues:!0,flash_swf_url:"//cdn.bootcss.com/plupload/2.1.8/Moxie.swf"});uploader.init(),uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval("self.refreshSession()",6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("UploadProgress",function(uploader,file){waveLoading.setProgress(uploader.total.percent),uploadPercent=uploader.total.percent,$("#uploading-"+file.id+" .plupload-file-status").html(file.percent+"%"),$("#uploading-"+file.id+" .plupload-file-surplus").html(utils.formatDate((file.size-file.loaded)/uploader.total.bytesPerSec)),handleStatus(uploader.total.percent)}),uploader.bind("FilesAdded",function(uploader,files){$.get("uploadFile/checkAdminSessionTimeOut",function(response){response||uploader.destroy()}),$.each(files,function(index,item){var $fileDom=$('<li class="plupload_delete" id="'+item.id+'">');$fileDom.append($('<div class="plupload-file-name"><span>'+item.name+"</span></div>")),$fileDom.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#upload-filelist").append($fileDom);var $fileDom_uploading=$('<li id="uploading-'+item.id+'">');$fileDom_uploading.append($('<div class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></div>")),$fileDom_uploading.append($('<div class="plupload-file-size">'+getSize(item.size)+"</div>")),$fileDom_uploading.append($('<div class="plupload-file-surplus">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-status">_</div>')),$fileDom_uploading.append($('<div class="plupload-file-action"><a href="#" style="display: block;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></div>')),$fileDom_uploading.append($('<div class="plupload-clearer"></div>&nbsp;</li>')),$("#uploading-filelist").append($fileDom_uploading),handleStatus(item),$("#"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e),$.upload.uploadTextType()}),$("#uploading-"+item.id+".plupload_delete a").click(function(e){$("#"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e)})}),$.upload.uploadTextType()}),uploader.bind("FileUploaded",function(uploader,file,response){var res=response.response;"1"!=res&&$.get("data/run",JSON.parse(res),function(result){$.report.find.condition()}),handleStatus(file)}),uploader.bind("UploadComplete",function(uploader,files){files.length>0?(waveLoading.setProgress(100),uploadPercent=100):(waveLoading.init({haveInited:!1}),waveLoading.draw(),document.querySelector("#upload-progress").height=document.querySelector("#upload-progress").height),$(".step-one-content").removeClass("hide"),$(".step-two-content").addClass("hide"),$(".step-three-content").addClass("hide"),$("#one-to-two").removeClass("active"),$("#two-to-three").removeClass("active"),$(".step-two").removeClass("active"),$(".step-three").removeClass("active"),$("#batch-info").val(""),uploader.splice(),$("#uploading-filelist .plupload_done").remove(),$("#upload-modal").modal("hide")}),uploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{originalName:file.name,tagId:$("#tag-info").val(),batch:$("#batch-info").val(),needSplit:$("#need-split:checked").val()})}),uploader.bind("Error",function(uploader,error){"-602"==error.code&&alert("当前队列已存在文件【"+error.file.name+"】，请勿重复添加！")}),$("#begin-upload").on("click",function(){uploader.files.length>0&&($("#upload-filelist").html(""),uploader.start(),$(".step-three-content").removeClass("hide"),$(".step-one-content").addClass("hide"),$(".step-two-content").addClass("hide"),$("#two-to-three").addClass("active"),$(".step-three").addClass("active"),$("#tags-review").html($("#batch-info").val()),waveLoading.init({haveInited:!0,target:document.querySelector("#upload-progress"),color:"rgba(40, 230, 200, 0.6)",showText:!1}),waveLoading.draw(),waveLoading.setProgress(0))}),$("#close-upload-modal").on("click",function(){uploader.files.length<=0&&($(".step-one-content").removeClass("hide"),$(".step-two-content").addClass("hide"),$("#one-to-two").removeClass("active"),$(".step-two").removeClass("active"),$(".step-three-content").addClass("hide"),$("#two-to-three").removeClass("active"),$(".step-three").removeClass("active"));var text=$("body .breadcrumb").text();text.indexOf("收样")>=0?$.base.itemBtnToggleActive($("#to-sample-a")):text.indexOf("数据")>=0?$.base.itemBtnToggleActive($("#to-data-a")):text.indexOf("报告")>=0&&$.base.itemBtnToggleActive($("#to-report-a"))})})}(fileUpload);
function showSeq(seq){$("#showSeq").html(seq),$("#seqModal").modal("show")}function showGeneResult(result){$("#showGeneResult").html(result),$("#geneResultModal").modal("show")}function showSysInfo(){var SystemCountURL="count/systemCount";$.get(SystemCountURL,function(data){var monthData=data.monthData,monthSize=data.monthSize,monthReport=data.monthReport,monthApp=data.monthApp,appRum=data.appRum,size=data.size,fileNum=data.fileNum,weekFile=data.weekData,weekReport=data.weekReport,weekApp=data.weekApp;console.log(size),console.log(fileNum),$("#run_File_Num").html(fileNum.runFileNum),$("#unRun_Num").html(parseInt(fileNum.fileNum)-parseInt(fileNum.runFileNum));var max=0,min=2;$.each(monthSize,function(i,item){var tmp=parseInt(item.size);max=tmp>max?tmp:max,min=tmp<min?tmp:min});var ustr="(MB)",len=0,mid=max+min;console.log(mid),console.log(max),console.log(min),mid>>30>0?(len=30,ustr="(GB)"):mid>>20>0?(len=20,ustr="(MB)"):mid>>10>0&&(len=10,ustr="(KB)"),$.each(monthSize,function(i,item){monthSize[i].size=parseFloat((item.size/(2<<len)).toFixed(2))});try{buildView("size_month_id",monthSize,"time","size","数据大小"+ustr,"line",0,12),buildView("size_week_id",weekFile,"time","size","数据大小"+ustr,"line",0,12)}catch(e){console.log(e)}try{buildView("data_month_id",monthData,"time","num","数据量","line",0,12),buildView("data_week_id",weekFile,"time","fileNum","数据量","line",0,12)}catch(e){console.log(e)}try{buildView("report_week_id",weekReport,"time","reportNum","报告数量","line",0,12),buildView("app_run_id",appRum,"app_name","runNum","运行次数","line",0,12),buildView("report_month_id",monthReport,"time","reportNum","报告数量","line",0,12)}catch(e){console.log(e)}try{buildView("app_month_id",monthApp,"time","num","运行次数","line",0,12),buildView("app_week_id",weekApp,"time","runNum","运行次数","line",0,12)}catch(e){console.log(e)}})}function buildView(id,list,xPer,yPer,seriesName,typex,position,showNum){var x=new Array(list.length),y=new Array(list.length);$.each(list,function(index,item){x[index]=item[xPer],y[index]=item[yPer]}),makeOptionScrollUnit(id,x,y,seriesName,typex,position,showNum)}function makeOptionScrollUnit(id,xAxis,yAxis,seriesName,typex,position,showNum){var length=xAxis.length,option=null;if(showNum<length)if(position<100){var len=position+showNum/length*100;option=makeOptionScroll("",xAxis,yAxis,seriesName,typex,position,len)}else{var len=showNum/length*100;option=makeOptionScroll("",xAxis,yAxis,seriesName,typex,100-len,100)}else option=makeOption("",xAxis,yAxis,seriesName,typex);require(["echarts","echarts/chart/line","echarts/chart/bar"],function(es){var eview=es.init(document.getElementById(id));eview.setOption(option)})}function makeOptionScroll(title,xAxis,yAxis,seriesName,typex,startZoom,endZoom){var opt=makeOption(title,xAxis,yAxis,seriesName,typex);return opt.dataZoom={show:!0,realtime:!0,start:startZoom,end:endZoom},opt}function makeOption(title,xAxis,yAxis,seriesName,typex){for(var max=0,i=0;i<xAxis.length&&(max=max>xAxis[i].length?max:xAxis[i].length,!(max>8));i++);(null==title||title.length<1)&&(title="");var opt={title:{text:title,subtext:""},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:[seriesName]},toolbox:{show:!0,feature:{dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:[{type:"category",data:xAxis,scale:!0,lenght:15,axisLabel:{show:!0,interval:"auto",rotate:0,margin:8,formatter:"{value}",textStyle:{color:"blue",fontFamily:"sans-serif",fontSize:12,fontStyle:"italic",fontWeight:"bold"}}}],yAxis:[{type:"value",axisLabel:{show:!0,interval:"auto",rotate:0,margin:18,formatter:"{value}",textStyle:{color:"green",fontFamily:"verdana",fontSize:10,fontStyle:"normal",fontWeight:"bold"}}}],dataZoom:{show:!1},series:[{name:seriesName,type:typex,data:yAxis,itemStyle:{normal:{label:{show:!0}}},markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}}]};if(max>=8&&(opt.xAxis[0].axisLabel.rotate=30),seriesName.indexOf("大小")>0){var len=seriesName.length,ustr=seriesName.substring(len-3,len-1);opt.yAxis[0].axisLabel.formatter="{value}"+ustr}return opt}$(document).ready(function(){var opts={lines:13,length:28,width:14,radius:42,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"40%",left:"45%"};spinner=new Spinner(opts);var target=document.getElementById("appMain");spinner.spin(target);var companyId=$("#sessionCompanyId").val();6==companyId?$.get("count/pgsCount",function(responseText){$("#countDiv").html(responseText);var url=$("#downUrl").val();url&&($("#_down").attr("href",url),$("#_down").removeClass("hide")),spinner.stop()}):3==companyId?$.get("count/hbvCount",function(responseText){$("#countDiv").html(responseText);var url=$("#downUrl").val();url&&($("#_down").attr("href",url),$("#_down").removeClass("hide")),spinner.stop()}):33==companyId&&$.get("count/cmpCount",function(responseText){$("#countDiv").html(responseText);var url=$("#downUrl").val();$("#_down").attr("href",url),spinner.stop()})});
function _init_data(){$.dataManager.options={condition:null,pageSize:$("#data-page-size-sel").val(),sort:0,sortDateType:"desc",sortNameType:"asc",checkedIds:[],checkedNames:[],runAppIds:[]},$.dataManager.find={all:function(){$.get("data/dataAllList.action",function(response){$.dataManager.loadlist(response)})},condition:function(){var options=$.dataManager.options;$.get("data/dataList.action",{condition:options.condition,size:options.pageSize,sort:options.sort,sortDateType:options.sortDateType,sortNameType:options.sortNameType},function(response){$.dataManager.loadlist(response)})},pagination:function(currentPage){var options=$.dataManager.options;$.get("data/dataList.action",{page:currentPage,condition:options.condition,size:options.pageSize,sort:options.sort,sortDateType:options.sortDateType,sortNameType:options.sortNameType},function(response){$.dataManager.loadlist(response)})}},$.dataManager.run={showModal:function(){$("#run-btn").attr("disabled","true"),$.dataManager.options.runAppIds=[];var o=$.dataManager.options,checkedIds=o.checkedIds,checkedNames=o.checkedNames,dataIds="";if(0==checkedIds.length)return void $.dataManager.showTipModal("请选择至少一条数据");for(var dataLi="",hasConfigure=!1,i=0;i<checkedIds.length;i++){var fileName=checkedNames[i],fileId=checkedIds[i];utils.isConfigure(fileName)?hasConfigure=!0:dataIds+=fileId+",",dataLi+='<li class="types-options data-select" title="点击删除" name="to-run-data" data-dataid="'+checkedIds[i]+'">'+fileName+"</li>"}dataIds=dataIds.substring(0,dataIds.length-1);var dataLength=checkedIds.length;return""==dataIds&&hasConfigure?void $.dataManager.showTipModal("请选择有效数据"):void $.get("data/getFormatByDataIds.action",{dataIds:dataIds},function(result){result==-1?$.dataManager.showTipModal("所选数据格式不统一"):$.get("data/getRunApp.action",{formatId:result},function(appList){var appLi="",noAPP=0;if(0==appList.length)appLi+="<li class='types-options'>没有可运行的APP</li>";else{for(var _checkConfigure=!0,i=0;i<appList.length;i++){var appId=appList[i].appId,appName=appList[i].appName,dataNum=appList[i].dataNum;if(hasConfigure&&113!=appId)break;dataNum<=dataLength&&((109==appId||110==appId||111==appId||112==appId||113==appId||126==appId||127==appId||128==appId)&&dataNum<dataLength||(appLi+='<li class="types-options" title="点击选中" name="to-run-app" data-appid="'+appId+'" >'+appName+"</li>",noAPP++)),113==appId&&(_checkConfigure=!1)}if(hasConfigure&&_checkConfigure)return void $.dataManager.showTipModal("所选数据格式不统一")}$("#apps-data-ul").html(appLi),$("#added-data-ul").html(dataLi),$("#run-modal").modal("show")})})},removeToRunData:function(Obj){var _dataId=$(Obj).data("dataid"),checkedIds=$.dataManager.options.checkedIds;$.dataManager.checkData.noCheck(_dataId),$("#chk"+_dataId).prop("checked",!1),$(Obj).remove(),0==checkedIds.length&&($("#run-btn").attr("disabled",!0),$("#run-modal").modal("hide"),$.dataManager.editBtn.disable())},updateRunApp:function(Obj){var appId=$(Obj).data("appid"),appName=$(Obj).html(),o=$.dataManager.options;if($(Obj).hasClass("selected")){var runAppIds=o.runAppIds;o.runAppIds.splice($.inArray(appId,runAppIds),1),$(Obj).removeClass("selected"),0==o.runAppIds.length&&$("#run-btn").attr("disabled",!0)}else{for(var checkedIds=o.checkedIds,dataIds=new Array,i=0;i<checkedIds.length;i++)dataIds.push(checkedIds[i]);if(0==dataIds.length)return;$.get("data/checkDataRunningApp.action",{dataIds:dataIds.toString(),appId:appId},function(dataIdList){if(dataIdList.length>0){for(var dataNames="",i=0;i<dataIdList.length;i++)dataNames+=$("#filename-"+dataIdList[i]).val()+"<br>";return void $.dataManager.showTipModal("以下数据正在运行APP："+appName+"<br>"+dataNames+"<br>请选择其他APP或删除选中数据")}110==appId||111==appId||112==appId||126==appId||127==appId||128==appId?($("#run-error-text").html("运行"+appName+"需确定所选数据为配对数据！<input type='hidden' id='appId-hide' value='"+appId+"'><br>(配对格式:aaa<span class='text-red'>1</span>.fastq&nbsp;&nbsp;&nbsp;aaa<span class='text-red'>2</span>.fastq)"),$("#run-error-modal").modal("show")):113==appId?($("#run-error-text").html("运行"+appName+"需注意以下文件格式:<input type='hidden' id='appId-hide' value='"+appId+"'><br>配对数据格式：<br><div style='padding-left:83px'>aaa<span class='text-red'>1</span>.fastq</div><div style='padding-left:83px'>aaa<span class='text-red'>2</span>.fastq</div><br>参数文件格式：index.<span class='text-red'>txt</span>"),$("#run-error-modal").modal("show")):($(Obj).addClass("selected"),$("#run-btn").removeAttr("disabled"),$.dataManager.options.runAppIds.push(appId))})}},confirmRunApp:function(){var appId=$("#appId-hide").val();$("#apps-data-ul li[data-appid="+appId+"]").addClass("selected"),$("#run-btn").removeAttr("disabled"),$.dataManager.options.runAppIds.push(appId)},beginRun:function(){var o=$.dataManager.options,checkedIds=o.checkedIds,addedApps=o.runAppIds,appIds="",dataIds=[];if($.each(checkedIds,function(i,el){$.inArray(el,dataIds)===-1&&dataIds.push(el)}),0!=dataIds.length){$("#run-error-text").html("");for(var i=0;i<addedApps.length;i++)appIds+=addedApps[i]+",";appIds=appIds.substring(0,appIds.length-1),$.get("data/run",{dataIds:dataIds.toString(),appIds:appIds},function(result){"1"==result?$.dataManager.showTipModal("您的余额不足，请充值后再运行"):result.length>1?$.dataManager.showTipModal("以下APP运行失败：<br>"+result):($.dataManager.find.condition(),$("#run-modal").modal("hide"))})}}},$.dataManager.updateData={showBatchEditModal:function(){$.dataManager.updateData.strainList("#batch-editdatas-strain"),$("#each-editdata-modal").modal("hide"),$("#batch-editdata-form")[0].reset(),$("#batch-editdata-error").addClass("hide"),$("#batch-editdatas-strain").val(""),$("#batch-editdata-modal").modal("show"),$("#save-batch-data").on("click",function(){$.dataManager.updateData.saveBatchEdit()})},saveBatchEdit:function(){for(var checkedIds=$.dataManager.options.checkedIds,dataIds="",i=0;i<checkedIds.length;i++)dataIds+=checkedIds[i]+",";dataIds=dataIds.substring(0,dataIds.length-1),$("#batch-editdataIds-hide").val(dataIds),$.post("data/batchEditDataByIds.action",$("#batch-editdata-form").serialize(),function(flag){flag>0?($.dataManager.find.condition(),$("#batch-editdata-modal").modal("hide")):$("#batch-editdata-error").removeClass("hide")})},showEachEditModal:function(){for(var checkedIds=$.dataManager.options.checkedIds,dataIds="",i=0;i<checkedIds.length;i++)dataIds+=checkedIds[i]+",";dataIds=dataIds.substring(0,dataIds.length-1),$.get("data/toEachEditDatas.action",{dataIds:dataIds},function(response){$("#each-editdatas-div").html(response),$.dataManager.updateData.strainList("input[class='strain']"),$("#batch-editdata-modal").modal("hide"),$("#each-editdata-modal").modal("show"),$("#save-each-data").on("click",function(){$.dataManager.updateData.saveEachEdit()})})},saveEachEdit:function(){$.post("data/eachEditDataByIds.action",$("#each-editdata-form").serialize(),function(result){result>0?($.dataManager.find.condition(),$("#each-editdata-modal").modal("hide")):$("#each-updatedata-error").removeClass("hide")})},strainList:function(Obj){$.get("data/getStrainList.action",{},function(result){$.dataManager.setSelect2Info(Obj,result)})}},$.dataManager.deleteData=function(){$.dataManager.showTipModal("确定要删除选中数据吗？"),$("#check-true").one("click",function(){for(var checkedIds=$.dataManager.options.checkedIds,dataIds="",i=0;i<checkedIds.length;i++)dataIds+=checkedIds[i]+",";dataIds=dataIds.substring(0,dataIds.length-1),$.get("data/delete.action",{dataIds:dataIds},function(data){"104"==data.code?$.dataManager.find.condition():$.dataManager.showTipModal(data.message)})}),$("#check-flase").one("click",function(){$("#check-true").unbind("click")})},$.dataManager.setSelect2Info=function(objId,data){$(objId).select2({placeholder:"请选择样本类型/物种",allowClear:!0,createSearchChoice:function(term,data){if(0===$(data).filter(function(){return 0===this.text.localeCompare(term)}).length)return{id:term,text:term}},data:data})},$.dataManager.loadlist=function(response){$("#data-list-div").html(response),$("#data-list-tbody").find("td[name='data-name-td']").each(function(){var _data=$(this).attr("title");if(_data.length>40){var newData=utils.splitDataByInfo(_data,"\r\n",40);$(this).attr("title",newData)}}),$.dataManager.sortIcon();var o=$.dataManager.options;o.checkedIds=[],o.checkedNames=[],$.dataManager.editBtn.disable(),$("input[name='data-checkone']").on("click",function(){$.dataManager.checkOneData($(this),25)}),$("#data-checkall").on("click",function(){$.dataManager.checkAll($(this),"data-checkone",25)}),$("#pagination-data").on("click","a",function(e){var id=$(this).attr("id"),currentPage=parseInt($("#data-current-page-hide").val()),page=null==id?$(this).html():"prev-page-data"==id?currentPage-1:currentPage+1;$.dataManager.find.pagination(page)}),$("#data-page-size-sel").on("change",function(){$.dataManager.options.pageSize=$(this).val(),$.dataManager.find.condition()}),$("#data-sort-name").on("click",function(e){$.dataManager.options.sort=1,$.dataManager.options.sortNameType="desc"==$.dataManager.options.sortNameType?"asc":"desc",$.dataManager.find.condition()}),$("#data-sort-createdate").on("click",function(e){$.dataManager.options.sort=0,$.dataManager.options.sortDateType="desc"==$.dataManager.options.sortDateType?"asc":"desc",$.dataManager.find.condition()}),null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","bottom"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2),$("#manage-data-btns a").attr("disabled",!0),$("#manage-data-btns a").unbind("click"),$("#manage-data-btns").on("click",function(){null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","bottom"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(8),$("#manage-data-btns").unbind("click"))}))},$.dataManager.sortIcon=function(){var sort=$.dataManager.options.sort,sortNameType=$.dataManager.options.sortNameType,sortDateType=$.dataManager.options.sortDateType;1==sort?($("#data-sort-createdate").removeClass("a-green-normal").addClass("a-gray"),$("#data-sort-name").removeClass("a-gray").addClass("a-green-normal")):($("#data-sort-name").removeClass("a-green-normal").addClass("a-gray"),$("#data-sort-createdate").removeClass("a-gray").addClass("a-green-normal")),"asc"==sortNameType?$("#data-sort-name-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):"desc"==sortNameType&&$("#data-sort-name-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc"),"asc"==sortDateType?$("#data-sort-date-icon").removeClass("fa-sort-amount-desc").addClass("fa-sort-amount-asc"):"desc"==sortDateType&&$("#data-sort-date-icon").removeClass("fa-sort-amount-asc").addClass("fa-sort-amount-desc")},$.dataManager.checkOneData=function(obj,num){var _checked=$(obj).prop("checked"),_dataId=$(obj).val();_checked?$.dataManager.options.checkedIds.length>=num?($.dataManager.showTipModal("最多允许同时操作"+num+"条数据！"),$(obj).prop("checked",!1)):$.dataManager.checkData.isCheck(_dataId):$.dataManager.checkData.noCheck(_dataId),$.dataManager.editBtn.update()},$.dataManager.checkAll=function(obj,name,num){var _checked=$(obj).prop("checked");if($.dataManager.options.checkedIds=new Array,$.dataManager.options.checkedNames=new Array,_checked){var choicearr=document.getElementsByName(name),_checkedLength=num;choicearr.length<=num?_checkedLength=choicearr.length:$.dataManager.showTipModal("最多允许同时操作"+num+"条数据！");for(var i=0;i<_checkedLength;i++){$(choicearr[i]).prop("checked",!0);var dataId=$(choicearr[i]).val();$.dataManager.checkData.isCheck(dataId)}$.dataManager.options.checkedIds.length>0&&$.dataManager.editBtn.show()}else $("[name='"+name+"']").prop("checked",!1),$.dataManager.editBtn.disable()},$.dataManager.checkData={isCheck:function(dataId){$.dataManager.options.checkedIds.push(dataId),$.dataManager.options.checkedNames.push($("#filename-"+dataId).val())},noCheck:function(dataId){$("#data-checkall").prop("checked",!1);var index=$.inArray(dataId.toString(),$.dataManager.options.checkedIds);$.dataManager.options.checkedIds.splice(index,1),$.dataManager.options.checkedNames.splice(index,1)}},$.dataManager.showTipModal=function(text){$("#tip-text").html(text),$("#tip-modal").modal("show")},$.dataManager.editBtn={update:function(){var _checkedIds=$.dataManager.options.checkedIds;_checkedIds.length>0?$.dataManager.editBtn.show():$.dataManager.editBtn.disable()},show:function(){$("#del-data-btn").attr("disabled",!1),$("#manage-data-btn").attr("disabled",!1),$("#del-data-btn").removeClass("disabled"),$("#manage-data-btn").removeClass("disabled")},disable:function(){$("#del-data-btn").attr("disabled",!0),$("#manage-data-btn").attr("disabled",!0),$("#del-data-btn").addClass("disabled"),$("#manage-data-btn").addClass("disabled")}}}$.dataManager={},$.ajaxSetup({cache:!1}),$(function(){_init_data(),$.dataManager.find.all(),$("#data-condition-find").on("click",function(){$.dataManager.options.condition=$("#data-condition-input").val(),$.dataManager.find.condition()}),$("#data-condition-input").on("keyup",function(e){e=e||window.event,"13"==e.keyCode&&$("#data-condition-find").click()}),$("#run-app-btn").on("click",function(){$("#run-btn").html("运行"),$.dataManager.run.showModal()}),$("#del-data-btn").on("click",function(){$.dataManager.deleteData()}),$("#manage-data-btn").on("click",function(){$.dataManager.updateData.showBatchEditModal()}),$("#to-batch-editdata-modal").on("click",function(){$.dataManager.updateData.showBatchEditModal()}),$("#to-each-editdata-modal").on("click",function(){$.dataManager.updateData.showEachEditModal()}),$("#confirm-run").on("click",function(){$.dataManager.run.confirmRunApp()}),$("#run-btn").on("click",function(){$("#run-btn").attr("disabled",!0),$("#run-btn").html("您已经运行，请耐心等待！"),$.dataManager.run.beginRun()}),$("#tip-modal-head").mouseover(function(){$("#tip-modal-content").draggable()}),$("#tip-modal-head").mouseout(function(){$("#tip-modal-content").draggable("destroy")}),$("#run-error-head").mouseover(function(){$("#run-error-content").draggable()}),$("#run-error-head").mouseover(function(){$("#run-error-content").draggable("destroy")}),$("#added-data-ul").on("click","li",function(e){$.dataManager.run.removeToRunData($(this))}),$("#apps-data-ul").on("click","li",function(e){"没有可运行的APP"!=$(this).text()&&$.dataManager.run.updateRunApp($(this))})});
function init_expense(){$.expense.pay={page:{recharge:{currentPage:1,pageSize:20}},showTipModal:function(text){$("#tip-text").html(text),$("#invoice-tip-modal").modal("show")},expenseList:function(){$.get("expense/toRunExpenseList",{},function(response){$.expense.pay.loadlist(response)})},pagination:function(currentPage){$.get("expense/toRunExpenseList",{page:currentPage},function(response){$.expense.pay.loadlist(response)})},pageRechargeList:function(currentPage,pageSize){currentPage=currentPage||1,pageSize=pageSize||$.expense.pay.page.recharge.pageSize,$.expense.pay.page.recharge.currentPage=currentPage,$.expense.pay.page.recharge.pageSize=pageSize,$("#expense-content").load(CONTEXT_PATH+"/pay/recharge/list",{currentPage:currentPage,pageSize:pageSize})},pageInvoiceList:function(currentPage){currentPage=currentPage||1,$("#expense-content").load(CONTEXT_PATH+"/invoice/list",{currentPage:currentPage,pageSize:20})},recharge:function(){$("#tip-modal").modal("hide"),$("#expense-content").load(CONTEXT_PATH+"/pay/recharge")},tab:{"to-pay-detail":function(){$.expense.pay.expenseList()},"to-recharge":function(){$.expense.pay.recharge()},"to-recharge-record":function(){$.expense.pay.pageRechargeList()},"to-invoice":function(){$.expense.pay.pageInvoiceList()}},loadlist:function(response){$("#expense-content").html(response),$("#pay-list-tbody").find("span").each(function(){var _data=$(this).attr("title");if(_data.length>40){var newData=utils.splitDataByInfo(_data,"\r\n",40);$(this).attr("title",newData)}}),$("#pagination-pay").on("click","a",function(e){var id=$(this).attr("id"),currentPage=parseInt($("#expense-current-page-hide").val()),page=null==id?$(this).html():"prev-page-expense"==id?currentPage-1:currentPage+1;$.expense.pay.pagination(page)})}},$("#expense-box li").click(function(){var $self=$(this);$self.siblings().removeClass("active"),$self.addClass("active"),$("#secondClassifyName").html($self.text());var id=$self.attr("id");$.expense.pay.tab[id]()}),$("#expense-content").on("click","#onlineRechargeRadio",function(){$("#onlineRecharge").removeClass("hide"),$("#companyTransfer").addClass("hide")}),$("#expense-content").on("click","#companyTransferRadio",function(){$("#companyTransfer").removeClass("hide"),$("#onlineRecharge").addClass("hide")}),$("#expense-content").on("submit","#rechargeForm",function(){var $self=$("#rechargeForm"),$group=$self.find("#moneyGroup"),payType=$self.find("#pay_type_alipay").is(":checked");$group.removeClass("has-error"),$group.find(".text-danger").hide();var money=$self.find("input[name='money']").val();return $.isNumeric(money)&&1*money==.01?($self.attr("action",$self.attr("action")+(payType?"alipay":"jdpay")),$("#tip-modal").modal("show"),!0):$.isNumeric(money)?1*money<10?($("#money-min").show(),$group.addClass("has-error"),!1):1*money%1!=0?($("#money-int").show(),$group.addClass("has-error"),!1):1*money>1e4?($("#money-max").show(),$group.addClass("has-error"),!1):($("#tip-modal").modal("show"),$self.find("input[name='money']").val(parseInt(money)),$self.attr("action",$self.attr("action")+(payType?"alipay":"jdpay")),!0):($("#money-number").show(),$group.addClass("has-error"),!1)})}$.expense={},$.ajaxSetup({cache:!1}),$(function(){init_expense()});
var experiment=function(experiment){var self=experiment||{},PAGE=1;self.getDoingPageList=function(page){PAGE=page,self.getPageList(PAGE)},self.getPageList=function(page){$("#doneExp").addClass("hide"),$("#doneTab").removeClass("active"),$("#doingExp").removeClass("hide"),$("#doingTab").addClass("active"),$("#subtitle").html("Doing"),$.get("experiment/getPageList",{page:PAGE},function(response){$("#doingLoadDiv").html(response)})};var DONEPAGE=1,SAMPLE=0;self.changeSample=function(id,obj){$(".samples").removeClass("_datered"),$(obj).addClass("_datered"),SAMPLE=id,self.changeDonePage(1)};var METHOD=0;self.changeMethod=function(id,obj){$(".methods").removeClass("_datered"),$(obj).addClass("_datered"),METHOD=id,self.changeDonePage(1)};var STEP=0;self.changeStep=function(id,obj){$(".steps").removeClass("_datered"),$(obj).addClass("_datered"),STEP=id,self.changeDonePage(1)};var START=null,END=null;self.changeDate=function(){return START=$("#_startDate").val(),END=$("#_endDate").val(),START&&END&&START>END?($("#_alertSpan").css("display",""),void $("#_alertSpan").html("起始日期不能大于结束日期")):($("#_alertSpan").css("display","none"),$("#_alertSpan").html(""),null!=START&&""!=START&&(START+=" 00:00:00"),null!=END&&""!=END&&(END+=" 23:59:59"),void self.changeDonePage(1))},self.clearDoneCondition=function(){$(".samples").removeClass("_datered"),$(".methods").removeClass("_datered"),$(".steps").removeClass("_datered"),$("#_alertSpan").css("display","none"),$("#_alertSpan").html(""),SAMPLE=0,METHOD=0,STEP=0,START=null,END=null,$("#_startDate").val(""),$("#_endDate").val(""),self.changeDonePage(1)},self.changeDonePage=function(page){DONEPAGE=page,self.getDonePageList(DONEPAGE)},self.getDonePageList=function(page){$("#doneExp").removeClass("hide"),$("#doneTab").addClass("active"),$("#doingExp").addClass("hide"),$("#doingTab").removeClass("active"),$("#subtitle").html("Done"),$.get("experiment/getDonePageList",{page:DONEPAGE,sampleId:SAMPLE,methodId:METHOD,stepId:STEP,start:START,end:END},function(response){$("#doneLoadDiv").html(response)})},self.toAddExp=function(){$.get("experiment/toAddExp",function(response){$("#addExp").html(response),$("#addExp").modal("show")})};var isChangeName=!1;return self.changeName=function(){var originNum=$("#expOriginNum").val(),expnumber=$("#expnumber").val();isChangeName=expnumber!=originNum},self.toEditExp=function(id){isChangeName=!1,$.get("experiment/toEditExp",{expId:id},function(response){$("#addExp").html(response),$("#addExp").modal("show")})},self.closeExperiment=function(){jConfirm("确认要关闭该实验吗?","关闭实验",function(result){result&&($("#expState").val(1),$.get("experiment/updateExperiment",$("#exp-add-form").serialize(),function(flag){1==flag?($("#addExp").modal("hide"),self.getDoingPageList(1)):self.showError("关闭失败！")}))})},self.hideEditError=function(){$("#expErrorInfo").html(""),$("#exp-add-error").addClass("hide")},self.updateExperiment=function(){if(self.validateBaseInfo()){var number=$("#expnumber").val().trim();$.get("experiment/checkNumber",{num:number},function(flag){isChangeName&&0==flag||!isChangeName&&1==flag?$.get("experiment/updateExperiment",$("#exp-add-form").serialize(),function(flag){if(1==flag){var fileId=$("#expFileId").val();0==fileId&&$("#dataStep").val()==$("#stepSelect").val()?($("#exp-add-form").find("input").attr("readonly","readonly"),self.showError("保存成功！正在检索与本实验相匹配的数据，请稍等！"),$.get("experiment/getDataByAnotherName",{anotherName:number},function(response){$("#showData").html(response),$("#showData").removeClass("hide"),$("#expEditSubmit").addClass("hide"),$("#expBindDataSubmit").removeClass("hide"),self.showError("保存成功！请选择数据后再点击一次保存！")})):($("#addExp").modal("hide"),self.getDoingPageList(PAGE))}else self.showError("修改失败！")}):self.showError("编号不能和已有的doing状态的编号相同！")})}},self.expBindData=function(){if(self.validateBaseInfo()){var number=$("#expnumber").val().trim();$.get("experiment/checkNumber",{num:number},function(flag){if(flag<=1){var file_id=$("input[type='radio']:checked").val(),dataKey=$("input[type='radio']:checked").next().val();$("#expFileId").val(file_id),$("#expDataKey").val(dataKey),$.get("experiment/updateExperiment",$("#exp-add-form").serialize(),function(flag){1==flag?($("#addExp").modal("hide"),self.getDoingPageList(PAGE)):self.showError("修改失败！")})}else self.showError("编号不能和已有的doing状态的编号相同！")})}},self.validateBaseInfo=function(){var number=$("#expnumber").val().trim();if(!number)return void self.showError("编号不能为空！");if(number.length>22)return void self.showError("编号长度不能大于22个字符！");var expCon=$("#expCon").val();if(isNaN(expCon))return void self.showError("浓度必须为数字！");var expLibCon=$("#expLibCon").val();if(isNaN(expLibCon))return void self.showError("库浓度必须为数字！");var expSeqIndex=$("#expSeqIndex").val().trim();if(expSeqIndex.length>22)return void self.showError("Index长度不能大于22个字符！");var other=$("#expOther").val().trim();return other.length>125?void self.showError("其他长度不能大于125个字符！"):($("#exp-add-error").addClass("hide"),!0)},self.showError=function(info){$("#expErrorInfo").html(info),$("#exp-add-error").removeClass("hide")},self.addExperiment=function(){if(self.validateBaseInfo()){var number=$("#expnumber").val().trim();$.get("experiment/checkNumber",{num:number},function(flag){0==flag?$.get("experiment/addExperiment",$("#exp-add-form").serialize(),function(flag){1==flag?($("#addExp").modal("hide"),self.getDoingPageList(PAGE)):self.showError("保存失败！")}):self.showError("编号不能和已有的doing状态的编号相同！")})}},self.selectSeqIndex=function(val){if($("#expSeqIndex").children().remove(),$("#s2id_expSeqIndex span").text("--请选择--"),$("#expSeqIndex").append("<option value='0'>--请选择--</option>"),14==val||15==val)for(var i=1;i<=96;i++)$("#expSeqIndex").append("<option value='"+i+"'>"+i+"</option>");else if(16==val){for(var i=1;i<=9;i++)$("#expSeqIndex").append("<option value='S503N70"+i+"'>S503N70"+i+"</option>");$("#expSeqIndex").append("<option value='S503N710'>S503N710</option>"),$("#expSeqIndex").append("<option value='S503N711'>S503N711</option>"),$("#expSeqIndex").append("<option value='S503N712'>S503N712</option>");for(var i=1;i<=9;i++)$("#expSeqIndex").append("<option value='S504N70"+i+"'>S504N70"+i+"</option>");$("#expSeqIndex").append("<option value='S504N710'>S504N710</option>"),$("#expSeqIndex").append("<option value='S504N711'>S504N711</option>"),$("#expSeqIndex").append("<option value='S504N712'>S504N712</option>")}},self}(experiment);$(document).ready(function(){$.ajaxSetup({cache:!1}),experiment.getDoingPageList(1)});
function clearForm(){$("#toOther").removeClass("active"),$("#toMe").addClass("active"),$("#otherSay").hide(),$("#selfSay").show(),null!=userName&&""!=userName&&"null"!=userName?$("#userName").val(userName):$("#userName").val(""),$("#email").val(""),$("#emailSpanInfo").html(""),$("#title").val(""),editor.setContent(""),$("#userNameSpanInfo").html(""),$("#titleSpanInfo").html(""),$("#contentSpanInfo").html(""),$("#submitSpanInfo").html(""),$("#chkUsername").prop("checked",!1),$("#userName").attr("disabled",!1)}function validateFeed(){var result=!0,userName=$.trim($("#userName").val()),email=$.trim($("#email").val()),title=$.trim($("#title").val()),content=$.trim(editor.getContentTxt());if(""==userName?(result=!1,$("#userNameSpanInfo").html("请输入用户名")):$("#userNameSpanInfo").html(""),""!=email){var emailregex=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;emailregex.test(email)?$("#emailSpanInfo").html(""):(result=!1,$("#emailSpanInfo").html("邮箱格式不正确"))}return""!=title&&(title.length<4||title.length>30?(result=!1,$("#titleSpanInfo").html("请输入4~30个字符的标题")):$("#titleSpanInfo").html("")),""==content?(result=!1,$("#contentSpanInfo").html("请输入10~10000个字符的内容")):content.length<10||content.length>1e4?(result=!1,$("#contentSpanInfo").html("请输入10~10000个字符的内容")):$("#contentSpanInfo").html(""),result}function submitFeedBack(){if(validateFeed()){var userName=$.trim($("#userName").val()),title=$.trim($("#title").val()),content=editor.getContent(),email=$.trim($("#email").val());$.post("feedback/save",{username:userName,email:email,title:title,content:content,_method:"put"},function(flag){flag?($("#submitSpanInfo").html("非常感谢您的反馈！专业人员正在快马加鞭的处理，请耐心等候哦~~"),$(".submitBtn").attr("disabled","disabled")):$("#submitSpanInfo").html("保存失败")})}}$.ajaxSetup({cache:!1}),$("#chkUsername").click(function(){var checked=$(this).prop("checked");checked?($("#userName").val("匿名"),$("#userName").attr("disabled",!0),$("#userNameSpanInfo").html("")):(null!=userName&&""!=userName&&"null"!=userName?$("#userName").val(userName):$("#userName").val(""),$("#userName").attr("disabled",!1))});
var feedbacks=function(feedbacks){var self=feedbacks||{};self.currentPage=1;var uploader=null,resetFeedbackFormState=function(){var $form=$("#feedbackCreateForm");$form.find(".form-group").removeClass("has-error"),$form.find("[name=attachments]").remove(),$("#attachmentUploading").siblings("img").remove(),self.initUploader(),$form.find(".help-block").html("")},validateFeedback=function(){var $form=$("#feedbackCreateForm");$form.find(".form-group").removeClass("has-error"),$form.find(".help-block").html("");var $title=$form.find("[name=title]"),title=$.trim($title.val()),$content=($title.parent(".form-group"),$form.find("[name=content]")),content=$.trim($content.val());return title?title.length>30||title.length<4?($title.parents(".form-group:first").addClass("has-error"),$title.parents(".form-group:first").find(".help-block").html("请输入4-30字符的标题！"),$title.focus().val(title),!1):content?!(content.length>1e3||content.length<10)||($content.parents(".form-group:first").addClass("has-error"),$content.parents(".form-group:first").find(".help-block").html("请输入10-1000字符的内容！"),$content.focus().val(content),!1):($content.parents(".form-group:first").addClass("has-error"),$content.parents(".form-group:first").find(".help-block").html("请输入内容！"),$content.focus().val(content),!1):($title.parents(".form-group:first").addClass("has-error"),$title.parents(".form-group:first").find(".help-block").html("请输入标题！"),$title.focus().val(title),!1)},validateReply=function(){var value=$("#feedbackReplyContent").val();return!!$.trim(value)||($("#feedbackReplyBtn").attr("disabled","disabled"),!1)};return self.initUploader=function(){uploader&&uploader.destroy(),uploader=new plupload.Uploader({browse_button:"uploadAttachmentBtn",url:"../feedback/attach",container:"attachmentContainer",chunk_size:"1mb",file_data_name:"file",filters:{max_file_size:"2mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}],prevent_duplicates:!0},multi_selection:!1,flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",init:{PostInit:function(){$("#feedbackCreateForm").find("#attachment-group").removeClass("hide"),$("#feedbackCreateForm").find("#attachment-group").show(),$("#feedbackCreateForm").find("#warning-group").hide()},FilesAdded:function(up,files){$("#attachmentUploading").show(),uploader=up,up.start()},QueueChanged:function(up){uploader=up,up.disableBrowse(up.files.length>=5)},FileUploaded:function(up,file,response){uploader=up,$("#attachmentUploading").hide();var $img=$("<img />");$img.attr("src","feedback/attach/temp?file="+response.response),$img.addClass("img-thumbnail"),$img.addClass("feedback-attachment"),$img.click(function(){self.showAttachment(response.response,file.id)}),$img.attr("name","feedback_attachment_"+response.response);var $input=$('<input type="hidden" name="attachments"/>');$input.val(response.response),$("#attachmentUploading").before($img),$("#feedbackCreateForm").append($input)}}}),uploader.init()},self.create=function(){if(validateFeedback()){var $button=$("#addQa").find(".modal-footer button.btn-primary");$button.attr("disabled","disabled");var $form=$("#feedbackCreateForm"),url=$form.attr("action");$.post(url,$form.serialize(),function(data){data.success&&($("#addQa").modal("hide"),$button.removeAttr("disabled"),self.page(1))})}},self.showForm=function(){$("#feedbackCreateForm")[0].reset(),resetFeedbackFormState(),$("#addQa").modal("show")},self.showAttachment=function(filename,temp){var $delButton=$("#showAttachment").find(".modal-footer button.btn-danger");temp?$delButton.show():$delButton.hide(),$("#showAttachment").find(".modal-body input[name='attachment_file_id']").val(temp?temp:""),$("#showAttachment").find(".modal-body input[name='attachment_file_name']").val(temp?filename:""),$delButton.click(function(){var id=$("#showAttachment").find(".modal-body input[name='attachment_file_id']").val(),name=$("#showAttachment").find(".modal-body input[name='attachment_file_name']").val();self.removeAttachment(id,name)});var url="feedback/attach"+(temp?"/temp":"")+"?file="+filename;$("#showAttachment").find(".modal-body img").attr("src",url),$("#showAttachment").find(".modal-body a").attr("href",url),$("#showAttachment").modal("show")},self.removeAttachment=function(id,filename){$("#attachmentUploading").siblings("img[name='feedback_attachment_"+filename+"']").remove(),$("#feedbackCreateForm").find("input[name='attachments']").each(function(index,item){$(this).val()==filename&&$(this).remove()});var file=uploader.getFile(id);uploader.removeFile(file),$("#showAttachment").modal("hide")},self.attach=function(){},self.reloadFeedback=function(id){$.get("feedback/list",{currentPage:self.currentPage},function(data){var $feedbackList=$(data),$feedbackOld=$("#feedbackList").find(".list-group-item[feedback_id="+id+"]"),$feedbackNew=$feedbackList.find(".list-group-item[feedback_id="+id+"]");$feedbackOld.html($feedbackNew.html()),self.detail(id)})},self.page=function(page){self.currentPage=page,$("#feedbackList").load("feedback/list",{currentPage:page},function(data){var $item=$("#feedbackList").find(".list-group-item[feedback_id]:first"),id=$item.attr("feedback_id");id&&self.detail(id)})},self.detail=function(id){var $item=$("#feedbackList").find(".list-group-item[feedback_id="+id+"]");$item.addClass("bg-gray"),$item.siblings(".list-group-item").removeClass("bg-gray"),$("#feedbackDetail").load("feedback/"+id,function(){self.listReplies(id)})},self.listReplies=function(id){$("#feedbackReplyList").load("feedback/replies/"+id)},self.reply=function(){if(validateReply()){var $form=$("#feedbackReplyForm"),url=$form.attr("action");$.post(url,$form.serialize(),function(data){data.success&&(self.listReplies(data.data),$("#feedbackReplyBtn").attr("disabled","disabled"),$("#feedbackReplyContent").val(""))})}},self.solve=function(id){jConfirm("确认要关闭这个问题吗?","问题反馈",function(result){result&&$.post("feedback/solve/"+id,function(data){data.success?self.reloadFeedback(id):jAlert(data.message)})})},$(document).on("keyup","#feedbackReplyContent",function(e){var value=$(this).val();$.trim(value)?$("#feedbackReplyBtn").removeAttr("disabled"):$("#feedbackReplyBtn").attr("disabled","disabled")}),self}(feedbacks);feedbacks.initUploader(),feedbacks.page(1);
function clearForm(){$("#toOther").removeClass("active"),$("#toMe").addClass("active"),$("#otherSay").hide(),$("#selfSay").show(),null!=userName&&""!=userName&&"null"!=userName?$("#userName").val(userName):$("#userName").val(""),$("#email").val(""),$("#emailSpanInfo").html(""),$("#title").val(""),$("#userNameSpanInfo").html(""),$("#titleSpanInfo").html(""),$("#contentSpanInfo").html(""),$("#submitSpanInfo").html(""),$("#chkUsername").prop("checked",!1),$("#userName").attr("disabled",!1)}function validateFeed(){var result=!0,userName=$.trim($("#userName").val()),email=$.trim($("#email").val()),title=$.trim($("#title").val()),content=$.trim($("#content").val());if(""==userName?(result=!1,$("#userNameSpanInfo").html("请输入用户名")):$("#userNameSpanInfo").html(""),""!=email){var emailregex=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;emailregex.test(email)?$("#emailSpanInfo").html(""):(result=!1,$("#emailSpanInfo").html("邮箱格式不正确"))}return""!=title&&(title.length<4||title.length>30?(result=!1,$("#titleSpanInfo").html("请输入4~30个字符的标题")):$("#titleSpanInfo").html("")),""==content?(result=!1,$("#contentSpanInfo").html("请输入10~10000个字符的内容")):content.length<10||content.length>1e4?(result=!1,$("#contentSpanInfo").html("请输入10~10000个字符的内容")):$("#contentSpanInfo").html(""),result}function submitFeedBack(){if(validateFeed()){var userName=$.trim($("#userName").val()),title=$.trim($("#title").val()),content=$.trim($("#content").val()),email=$.trim($("#email").val());$.post("feedback/save",{username:userName,email:email,title:title,content:content,_method:"put"},function(flag){flag?($("#submitSpanInfo").html("感谢您的反馈！我们正在快马加鞭的处理，请耐心等候哦~~"),$(".submitBtn").attr("disabled","disabled")):$("#submitSpanInfo").html("保存失败")})}}$.ajaxSetup({cache:!1}),$("#chkUsername").click(function(){var checked=$(this).prop("checked");checked?($("#userName").val("匿名"),$("#userName").attr("disabled",!0),$("#userNameSpanInfo").html("")):(null!=userName&&""!=userName&&"null"!=userName?$("#userName").val(userName):$("#userName").val(""),$("#userName").attr("disabled",!1))});
var datafileUpload=function(datafileUpload){var self=datafileUpload||{},session_user=$("#fileDataSessionUserIdHidden").val();session_user||(window.top.location="login"),Date.prototype.format=function(format){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(format)&&(format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return format},self.refreshSession=function(){$.get("uploadFile/checkAdminSessionTimeOut")},$(function(){$("#fileUploadDiv").html("<p>您的浏览器未安装 Flash, Silverlight, Gears, BrowserPlus 或者支持 HTML5 .</p>"),$("#fileUploadDiv").pluploadQueue({url:"../uploadFile/uploadManyFile",chunk_size:"1mb",file_data_name:"file",filters:{max_file_size:"10gb",mime_types:[{title:"bam",extensions:"bam"},{title:"ab1",extensions:"ab1"},{title:"abi",extensions:"abi"},{title:"fasta",extensions:"fasta"},{title:"fastq",extensions:"fastq"},{title:"tsv",extensions:"tsv"},{title:"gz",extensions:"gz"},{title:"lis",extensions:"lis"},{title:"txt",extensions:"txt"}]},flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",headers:{Authorization:""},max_retries:5,unique_names:!0,multiple_queues:!0});var uploader=$("#fileUploadDiv").pluploadQueue();uploader.bind("Init",function(){null!=intro&&(uploader.disableBrowse(!0),intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(4),$("#toaddfilediv").one("click",function(){intro.setOption("tooltipPosition","bottom"),intro.goToStep(5),uploader.disableBrowse(!1)}),$("#tobeginfilediv").one("click",function(){intro.goToStep(6)}))}),uploader.bind("Browse",function(){$.get("uploadFile/checkAdminSessionTimeOut",function(response){response||uploader.destroy()})}),uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval("self.refreshSession()",6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("FilesAdded",function(uploader,files){for(var i in files)$("#"+files[i].id+" div.plupload_file_name span").attr("data-toggle","tooltip").attr("data-placement","bottom").attr("title",files[i].name);$("[data-toggle='tooltip']").tooltip()}),$("._start_custom").click(function(){$.get("uploadFile/checkAdminSessionTimeOut",function(response){response?uploader.start():uploader.destroy()})}),window.onbeforeunload=function(){var qp=uploader.total,percent=qp.percent;if(qp.size>0&&percent<100&&percent>0)return"数据正在上传，您确定要关闭页面吗?"}})}(datafileUpload);
var userHelp=function(userHelp){var self=userHelp||{};return self.openPage=function(page){$("#mainDIV").load(page)},self}(userHelp);
function isScrollBottom(obj){return obj.scrollTop+obj.clientHeight===obj.scrollHeight}function animateIt(x,id){var css=$(id).attr("class");$(id).removeClass().addClass("animated "+x+" "+css).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass().addClass(css)})}$(function(){$(".panel").css({height:$(window).height()}),$(".subMenu").outerWidth()<$(".animateDiv").outerWidth()&&($(".panel").css({width:$(".animateDiv").outerWidth()+6}),$(".login").css({right:"80px"})),$(".diary img").css({height:$(window).height()-300}),$.scrollify({section:".panel"}),$(".scroll").click(function(e){e.preventDefault(),$.scrollify("move",$(this).attr("href"))}),$.scrollify({section:"section",sectionName:"section-name",easing:"easeOutExpo",scrollSpeed:500,offset:0,scrollbars:!0,before:function(){},after:function(){}})}),$("img").lazyload(),$(document).ready(function(){$("#toTop").trigger("click"),$(".subMenu").smint({scrollSpeed:1e3})}),setTimeout(function(){$("#img_c").removeClass("none"),animateIt("zoomIn fadeIn","#img_c")},10),setTimeout(function(){$("#img_l1").removeClass("none"),animateIt("lightSpeedIn","#img_l1")},500),setTimeout(function(){$("#img_l2").removeClass("none"),animateIt("bounceIn","#img_l2")},900),setTimeout(function(){$("#img_r1").removeClass("none"),animateIt("rotateInDownLeft","#img_r1")},500),setTimeout(function(){$("#img_r2").removeClass("none"),animateIt("bounceIn","#img_r2")},900),setTimeout(function(){$("#img_l3").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l3")},1200),setTimeout(function(){$("#img_l33").removeClass("none"),animateIt("bounceIn","#img_l33")},1400),setTimeout(function(){$("#img_r3").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r3")},1200),setTimeout(function(){$("#img_r33").removeClass("none"),animateIt("bounceIn","#img_r33")},1400),setTimeout(function(){$("#img_l4").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l4")},1200),setTimeout(function(){$("#img_l44").removeClass("none"),animateIt("bounceIn","#img_l44")},1300),setTimeout(function(){$("#img_r4").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r4")},1200),setTimeout(function(){$("#img_r44").removeClass("none"),animateIt("bounceIn","#img_r44")},1300),setTimeout(function(){$("#img_l5").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l5")},1200),setTimeout(function(){$("#img_l55").removeClass("none"),animateIt("bounceIn","#img_l55")},1500),setTimeout(function(){$("#img_r5").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r5")},1200),setTimeout(function(){$("#img_r6").removeClass("none"),animateIt("bounceIn","#img_r6")},1700),setTimeout(function(){$("#img_l6").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l6")},1200),setTimeout(function(){$("#img_l7").removeClass("none"),animateIt("bounceIn","#img_l7")},1800),setTimeout(function(){$("#img_l8").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l8")},2e3),setTimeout(function(){$("#img_l88").removeClass("none"),animateIt("bounceIn","#img_l88")},2300),setTimeout(function(){$("#img_l9").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l9")},2e3),setTimeout(function(){$("#img_l99").removeClass("none"),animateIt("bounceIn","#img_l99")},2200),setTimeout(function(){$("#img_l10").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l10")},2e3),setTimeout(function(){$("#img_l100").removeClass("none"),animateIt("bounceIn","#img_l100")},2300),setTimeout(function(){$("#img_l11").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l11")},2600),setTimeout(function(){$("#img_l12").removeClass("none"),animateIt("bounceIn","#img_l112")},3e3),setTimeout(function(){$("#img_l13").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l13")},3400),setTimeout(function(){$("#img_l133").removeClass("none"),animateIt("bounceIn","#img_l133")},3700),setTimeout(function(){$("#img_l14").removeClass("none"),animateIt("rotateInUpLeft2d","#img_l14")},3400),setTimeout(function(){$("#img_l144").removeClass("none"),animateIt("bounceIn","#img_l144")},3900),setTimeout(function(){$("#img_r71").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r71")},2e3),setTimeout(function(){$("#img_r711").removeClass("none"),animateIt("bounceIn","#img_r711")},2400),setTimeout(function(){$("#img_r72").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r72")},2100),setTimeout(function(){$("#img_r722").removeClass("none"),animateIt("bounceIn","#img_r722")},2500),setTimeout(function(){$("#img_r73").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r73")},2200),setTimeout(function(){$("#img_r733").removeClass("none"),animateIt("bounceIn","#img_r733")},2600),setTimeout(function(){$("#img_r74").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r74")},2300),setTimeout(function(){$("#img_r744").removeClass("none"),animateIt("bounceIn","#img_r744")},2700),setTimeout(function(){$("#img_r75").removeClass("none"),animateIt("rotateInUpLeft2d","#img_r75")},2400),setTimeout(function(){$("#img_r755").removeClass("none"),animateIt("bounceIn","#img_r755")},2800);var scrollFunc=function(e){setTimeout(function(){},1e3);var direct=0;e=e||window.event,e.wheelDelta?direct=e.wheelDelta:e.detail&&(direct=-e.detail),direct<0&&(setTimeout(function(){animateIt("bounceInDown","#result1")},100),$("#s0").hasClass("active")&&setTimeout(function(){animateIt("bounceInDown","#result1")},100),$("#s1").hasClass("active")&&(setTimeout(function(){animateIt("zoomIn","#result1")},100),setTimeout(function(){animateIt("zoomIn","#rupdate")},100),setTimeout(function(){animateIt("zoomIn","#rreport")},1500),setTimeout(function(){animateIt("zoomIn","#ranalysis")},800)))};document.addEventListener&&document.addEventListener("DOMMouseScroll",scrollFunc,!1),window.onmousewheel=document.onmousewheel=scrollFunc;
$.lAlert=function(text){$("#tip-text").html(text),$("#check-true").one("click",function(){$("#tip-modal").hide()}),$("#tip-modal").show()},$.lConfirm=function(text,callback){$("#confirm-text").html(text),$("#confirm-flase").one("click",function(){$("#confirm-modal").hide()}),"function"==typeof callback&&$("#confirm-true").one("click",function(){$("#confirm-modal").hide(),callback()}),$("#confirm-modal").show()};
function showUpload(){$.main.show.uploadDIV(),""==$("#uploadDIV").html()&&$("#uploadDIV").load("pages/upload/upload.jsp"),$.get("uploadFile/checkAdminSessionTimeOut")}function showExperiment(){$.main.show.mainDIV(),$.get("experiment/getExperimentDict",function(response){$("#mainDIV").html(response)})}function showReport(){$.main.show.mainDIV(),null!=intro&&1==hasNavi&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.setOptions({steps:[{step:9,img:"endintro.png",intro:""}]}),intro.start(9)),$("#mainDIV").load("pages/report/report_main.jsp")}function showAppStore(){$.main.show.mainDIV(),$.get("app/toAppStore",{},function(responseText){$("#mainDIV").html(responseText)})}function showCount(){$.main.show.mainDIV(),$("#mainDIV").load("pages/count/count_main.jsp")}function showNotice(){$.main.show.mainDIV(),$("#mainDIV").load(CONTEXT_PATH+"/notice/list/notice")}function showMessage(){$.main.show.mainDIV(),$("#mainDIV").load(CONTEXT_PATH+"/notice/list/message")}function showUserSetting(){$.main.show.mainDIV(),$("#mainDIV").load(CONTEXT_PATH+"/message/category/setting")}function showUser(){$.main.show.mainDIV(),$(".treeview").removeClass("active"),$("#accountManage").addClass("active"),$("#mainDIV").load("user/info")}function showFeedback(){$.main.show.mainDIV(),$(".treeview").removeClass("active"),$("#feedbackManage").addClass("active"),$("#mainDIV").load("feedback/main")}function showHelp(){$.main.show.mainDIV(),$(".treeview").removeClass("active"),$("#toHelpMenu").addClass("active"),$("#mainDIV").load("pages/help/help_question.jsp")}$.main={};var intro,hasNavi;$.main.show={mainDIV:function(){$("#dataReportDIV").addClass("hide"),$("#uploadDIV").addClass("hide"),$("#mainDIV").removeClass("hide")},uploadDIV:function(){$("#dataReportDIV").addClass("hide"),$("#mainDIV").addClass("hide"),$("#uploadDIV").removeClass("hide")},dataReportDIV:function(){$("#mainDIV").addClass("hide"),$("#uploadDIV").addClass("hide"),$("#dataReportDIV").removeClass("hide")}},$(function(){$.ajaxSetup({complete:function(request,textStatus){var sessionstatus=request.getResponseHeader("sessionstatus");"timeout"==sessionstatus&&jAlert("登录超时,请重新登录！","登录超时",function(){window.location.href="login"})},cache:!1}),userCount.showUserCount(),hasNavi=$("#user-navigation-hide").val(),1==hasNavi&&(intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start()),$("#to-data-main").on("click",function(e){$.main.show.mainDIV(),$("#mainDIV").load("pages/data/data_main.jsp")}),$("#to-expense-model").on("click",function(){$.get("user/balances",{},function(result){$("#total-consumption").html(result)})}),$("#to-expense-main").on("click",function(){$.main.show.mainDIV(),$("#mainDIV").load("pages/expense/expense_main.jsp",function(){$("#to-pay-detail").click()})}),$("#to-recharge-main").on("click",function(){$.main.show.mainDIV(),$("#mainDIV").load("pages/expense/expense_main.jsp",function(){$("#to-recharge").click()})})}),require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}});var userCount=function(userCount){var self=userCount||{};return self.lineModal=function(id,legend,xdata,ydata,yname,unit){require(["echarts","echarts/chart/line"],function(ec){var myChart=ec.init(document.getElementById(id)),option={tooltip:{trigger:"axis",show:!0},legend:{data:[yname]},xAxis:[{type:"category",data:xdata}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"+("undefined"==typeof unit?"":unit)}}],series:[{name:yname,type:"line",data:ydata,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]}}]};myChart.setOption(option)})},self.fileDayCount=function(){$.get("count/fileDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-data-day-chart","日上传文件统计",eval(x),y,"日上传文件数量")})},self.fileMonthCount=function(){$.get("count/fileMonthCount",function(data){$("#count-data-month-chart").width($("#count-data-day-chart").width());var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?(self.lineModal("count-data-month-chart","月上传文件统计",eval(x),y,"月上传文件数量"),self.fileDayCount()):$("#count-data-charts").hide()})},self.fileSizeDayCount=function(){$.get("count/fileSizeDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.substring(0,x.length-1),x+="]",self.lineModal("count-source-day-chart","日资源占用量统计",eval(x),y,"日上传文件大小",unit)})},self.fileSizeMonthCount=function(){$.get("count/fileSizeMonthCount",function(data){$("#count-source-month-chart").width($("#count-source-day-chart").width());var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?(self.lineModal("count-source-month-chart","月资源占用量统计",eval(x),y,"月上传文件大小",unit),self.fileSizeDayCount()):$("#count-source-charts").hide()})},self.reportDayCount=function(){$.get("count/reportDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-report-day-chart","日报告统计",eval(x),y,"日生成的报告个数")})},self.reportMonthCount=function(){$.get("count/reportMonthCount",function(data){$("#count-report-month-chart").width($("#count-report-day-chart").width());var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?(self.lineModal("count-report-month-chart","月报告统计",eval(x),y,"月生成的报告个数"),self.reportDayCount()):$("#count-report-charts").hide()})},self.appDayCount=function(){$.get("count/appDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-app-day-chart","日已添加APP运行次数",eval(x),y,"日APP运行次数")})},self.appMonthCount=function(){$.get("count/appMonthCount",function(data){$("#count-app-month-chart").width($("#count-app-day-chart").width());var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?(self.lineModal("count-app-month-chart","月已添加APP运行次数",eval(x),y,"月APP运行次数"),self.appDayCount()):$("#count-app-charts").hide()})},self.showUserCount=function(){$.main.show.mainDIV(),$.get("count/loginCount",function(response){$("#mainDIV").html(response),self.fileMonthCount(),self.fileSizeMonthCount(),self.reportMonthCount(),self.appMonthCount()})},self.toDataMain=function(){$("#to-data-main").trigger("click")},self.toReportMain=function(){$(".treeview").removeClass("active"),$("#toReportMenu").addClass("active"),showReport()},self.toAppStore=function(){$(".treeview").removeClass("active"),$("#toAppStoreMenu").addClass("active"),showAppStore()},self}(userCount);$("#messages-menu").load(CONTEXT_PATH+"/notice/lastUnread/message"),$("#notices-menu").load(CONTEXT_PATH+"/notice/lastUnread/notice"),messageUtils.subscribe("userMessage",function(data){$("#messages-menu").load(CONTEXT_PATH+"/notice/lastUnread/message"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close(),$("#messages-menu").addClass("open")}})}),messageUtils.subscribe("userNotice",function(data){$("#notices-menu").load(CONTEXT_PATH+"/notice/lastUnread/notice"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close(),$("#notices-menu").addClass("open")}})});
function drawScatter(id,totaldata,thisdata,title,xAxisName,yAxisName){require(["echarts","echarts/chart/scatter"],function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);option={title:{text:title,subtext:"结果来自: CelLoud全部数据",y:0},grid:{y:60},tooltip:{trigger:"axis",showDelay:0,formatter:function(params){return params.value.length>1?params.seriesName+" :<br/>"+params.value[0]+" "+params.value[1]+" ":params.seriesName+" :<br/>"+params.name+" : "+params.value+" "},axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},legend:{data:["全部数据","当前数据"]},toolbox:{show:!0,feature:{dataZoom:{show:!0},restore:{show:!0}}},xAxis:[{type:"value",name:xAxisName,scale:!0,axisLabel:{formatter:"{value} "}}],yAxis:[{type:"value",name:yAxisName,scale:!0,axisLabel:{formatter:"{value} "}}],series:[{name:"全部数据",type:"scatter",data:totaldata,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]}},{name:"当前数据",type:"scatter",data:thisdata,symbol:"star",symbolSize:10,markPoint:{data:[{type:"average",name:"当前数据平均值"}]}}]},myChart.setOption(option,!0)})}function _init_data(){$.dataManager.options={condition:null,page:1,pageSize:20,sort:0,dataMax:25,sortDateType:"desc",sortNameType:"asc",checkedIds:[],validIds:0,isRun:0,isTag:0,isBSI:0,isRocky:0,isPair:0},$.dataManager.checkOneData=function(obj){var _checked=$(obj).prop("checked"),_dataId=$(obj).val(),_isRun=$(obj).attr("is_run"),_isTag=$(obj).attr("is_tag"),_isBSI=$(obj).attr("is_bsi"),_isRocky=$(obj).attr("is_rocky"),_isPair=$(obj).attr("is_pair");_checked?($.dataManager.checkData.isCheck(_dataId),"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun+1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag+1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI+1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky+1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair+1,$.dataManager.options.validIds=$.dataManager.options.validIds+1):$.dataManager.options.validIds=$.dataManager.options.validIds+1):($.dataManager.checkData.noCheck(_dataId),"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun-1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag-1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI-1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky-1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair-1,$.dataManager.options.validIds=$.dataManager.options.validIds-1):$.dataManager.options.validIds=$.dataManager.options.validIds-1),$.dataManager.editBtn.update()},$.dataManager.checkAll=function(obj,name){var _checked=$(obj).prop("checked");if($.dataManager.options.checkedIds=new Array,_checked){for(var choicearr=document.getElementsByName(name),_checkedLength=choicearr.length,i=0;i<_checkedLength;i++)if(0==$(choicearr[i]).prop("disabled")){if(0==$(choicearr[i]).prop("checked")){var _isRun=$(choicearr[i]).attr("is_run"),_isTag=$(choicearr[i]).attr("is_tag"),_isBSI=$(choicearr[i]).attr("is_bsi"),_isRocky=$(choicearr[i]).attr("is_rocky"),_isPair=$(choicearr[i]).attr("is_pair");"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun+1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag+1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI+1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky+1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair+1,$.dataManager.options.validIds=$.dataManager.options.validIds+1):$.dataManager.options.validIds=$.dataManager.options.validIds+1}$(choicearr[i]).prop("checked",!0);var dataId=$(choicearr[i]).val();$.dataManager.checkData.isCheck(dataId)}$.dataManager.options.checkedIds.length>0&&$.dataManager.editBtn.show()}else $("[name='"+name+"']").prop("checked",!1),$.dataManager.options.isRun=0,$.dataManager.options.isTag=0,$.dataManager.options.isBSI=0,$.dataManager.options.isRocky=0,$.dataManager.options.isPair=0,$.dataManager.options.validIds=0,$.dataManager.editBtn.disable()},$.dataManager.cleanCheckbox=function(name){$("input[type='checkbox'][name='"+name+"']").prop("checked",!1)},$.dataManager.refreshDataList=function(name){$.dataManager.options.checkedIds=new Array,$.dataManager.options.isRun=0,$.dataManager.options.isTag=0,$.dataManager.options.isBSI=0,$.dataManager.options.isRocky=0,$.dataManager.options.isPair=0,$.dataManager.options.validIds=0,$.dataManager.editBtn.update(),$.dataManager.cleanCheckbox("demo-checkbox1")},$.dataManager.checkData={isCheck:function(dataId){$.dataManager.options.checkedIds.push(dataId),$("input[name='data-checkone']").length==$.dataManager.options.checkedIds.length&&$("#data-checkall").prop("checked",!0)},noCheck:function(dataId){$("#data-checkall").prop("checked",!1);var index=$.inArray(dataId.toString(),$.dataManager.options.checkedIds);$.dataManager.options.checkedIds.splice(index,1)}},$.dataManager.editBtn={update:function(){var _checkedIds=$.dataManager.options.checkedIds;_checkedIds.length>0?$.dataManager.editBtn.show():$.dataManager.editBtn.disable()},show:function(){$(".data-operate").attr("disabled",!1),$(".data-operate").removeClass("btn-cancel")},disable:function(){$(".data-operate").attr("disabled",!0),$(".data-operate").addClass("btn-cancel")}}}var utils={};!function($){$.extend({format:function(str,step,splitor){str=str.toString();var len=str.length;if(len>step){var l1=len%step,l2=parseInt(len/step),arr=[],first=str.substr(0,l1);""!=first&&arr.push(first);for(var i=0;i<l2;i++)arr.push(str.substr(l1+i*step,step));str=arr.join(splitor)}return str}})}(jQuery),utils._stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},utils.formatDate=function(size){var ss=parseInt(size);if(0===ss)return"00:00:00";if(/\D/.test(ss))return"N/A";ss=parseInt(size);var radix=60,mm=0,hh=0;return ss>radix&&(mm=parseInt(ss/radix),ss=parseInt(ss%radix),mm>radix&&(hh=parseInt(mm/radix),mm=parseInt(mm%radix))),hh>0&&hh<10?result="0"+parseInt(hh):hh>=10?result=parseInt(hh):hh<=0&&(result="00"),result+=":",mm>0&&mm<10?result+="0"+parseInt(mm):mm>=10?result+=parseInt(mm):mm<=0&&(result+="00"),result+=":",ss>0&&ss<10?result+="0"+parseInt(ss):ss>=10?result+=parseInt(ss):ss<=0&&(result+="00"),result},utils.getExt=function(fileName){var result=/\.[^\.]+/.exec(fileName);return result},utils.isConfigure=function(fileName){return".txt"==utils.getExt(fileName)||".lis"==utils.getExt(fileName)},utils.setDocSize=function(){var winWidth=$(window).width(),docWidth=$(document).width(),winHeight=$(window).height(),docHeight=$(document).height();winWidth>=docWidth?($(".bgContainer").width(winWidth),$(".longbackground").width(winWidth),$("#bg").width(winWidth)):($(".bgContainer").width(docWidth),$(".longbackground").width(docWidth),$("#bg").width(docWidth)),winHeight>=docHeight?($(".bgContainer").height(winHeight),$(".longbackground").height(winHeight),$("#bg").height(winHeight),$(".container").height(winHeight)):($(".bgContainer").height(docHeight),$(".longbackground").height(docHeight),$("#bg").height(docHeight),$(".container").height(docHeight)),$(".bgContainer").css("overflow","hidden")},utils.checkPlaceholder=function(){var input=document.createElement("input"),isPlaceholder="placeholder"in input;isPlaceholder||$(document).ready(function(){if(!isPlaceholder){$("input").not("input[type='password']").each(function(){""==$(this).val()&&""!=$(this).attr("placeholder")&&($(this).val($(this).attr("placeholder")),$(this).addClass("placeholder"),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")}),$(this).blur(function(){""==$(this).val()&&$(this).val($(this).attr("placeholder"))}))});var pwdField=$("input[type=password]"),pwdVal=pwdField.attr("placeholder");pwdField.after('<input id="pwdPlaceholder" type="text" class="pwd" value='+pwdVal+' autocomplete="off" />');var pwdPlaceholder=$("#pwdPlaceholder");pwdField.val()?(pwdPlaceholder.hide(),pwdField.show()):(pwdPlaceholder.show(),pwdField.hide()),pwdPlaceholder.focus(function(){pwdPlaceholder.hide(),pwdField.show(),pwdField.focus()}),pwdField.blur(function(){""==pwdField.val()&&(pwdPlaceholder.show(),pwdField.hide())})}})},utils.splitDataByInfo=function(data,splitStr,number){var reStr="(.{"+number+"}|.*)",reg=new RegExp(reStr,"g"),dataArray=data.match(reg);dataArray.pop();for(var i=(dataArray.length+1,0);i<dataArray.length;i+=2)dataArray.splice(i+1,0,splitStr);dataArray.pop();var str=dataArray.join("");return str},utils.loadBaiduTongji=function(){var host=window.location.host;host.indexOf("www.celloud.cn")>=0&&!function(){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?f6b04d06932c0fc1578e79be222599f4",hm.async="async",hm.defer="defer";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)}()},utils.loadBaiduTongji(),utils.setDocSize(),$(window).resize(function(){utils.setDocSize()}),utils.stopBubble=function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0},$.reportChar={},$.reportChar.draw={_require:function(chartName,option,id){require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}}),require(["echarts","echarts/chart/"+chartName],function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);myChart.setOption(option,!0)})},_requireMulti:function(chartName,option,id){require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}});var chartArr=new Array;chartArr.push("echarts");for(var i=0;i<chartName.length;i++)chartArr.push("echarts/chart/"+chartName[i]);require(chartArr,function(ec){var myChart=ec.init(document.getElementById(id),macarons_theme);myChart.setOption(option,!0)})},circularGraphDataOptions:{dataStyle:{normal:{label:{show:!1},labelLine:{show:!1}}},placeHolderStyle:{normal:{color:"rgba(0,0,0,0)",label:{show:!1},labelLine:{show:!1}},emphasis:{color:"rgba(0,0,0,0)"}},legendData:null,seriesData:null},circularGraph:function(id,title,subTitle,data){$.reportChar.circularGraphSeriesData(data),option={title:{text:title,subtext:subTitle,sublink:"",x:"center",y:"center",itemGap:5,textStyle:{color:"rgba(30,144,255,0.8)",fontFamily:"微软雅黑",fontSize:16,fontWeight:"bolder"}},tooltip:{show:!0,formatter:"{b}"},legend:{orient:"vertical",x:$("#"+id).width()/2-10,y:30,itemGap:6,data:$.reportChar.draw.circularGraphDataOptions.legendData},series:$.reportChar.draw.circularGraphDataOptions.seriesData},$.reportChar.draw._require("pie",option,id)},echartsShowPie:function(id,title,data){var option={title:{text:title,x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{type:"pie",radius:"55%",center:["50%","60%"],data:data,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};$.reportChar.draw._require("pie",option,id)},echartsShowBar:function(id,title,X,Y,rotate,width,height){var option={tooltip:{trigger:"axis"},legend:{data:[title],top:15},calculable:!0,xAxis:[{type:"category",data:X,position:"bottom",axisLabel:{rotate:rotate}}],yAxis:[{type:"value",name:"样本数量"}],series:[{name:title,type:"bar",data:Y,barWidth:20}],color:["#feabac"],grid:{width:width,height:height}};$.reportChar.draw._require("bar",option,id)},echartsShowHBVType:function(id,hbvType,currentType,rotate){var option={title:{text:"基因型分类总览表",subtext:"数据来源:CelLoud全部HBV数据",x:"center"},tooltip:{trigger:"axis"},legend:{data:["HBV基因型","当前数据基因型"],y:340},calculable:!0,xAxis:[{type:"category",data:["A","B","C","D","E","F","G","H","比对失败","异常数据"],position:"bottom",axisLabel:{rotate:rotate}}],yAxis:[{type:"value",name:"基因型数量(个)"}],series:[{name:"HBV基因型",type:"bar",data:eval(hbvType),barWidth:30},{name:"当前数据基因型",type:"scatter",data:eval(currentType),barWidth:30,symbol:"triangle"}],grid:{width:800,height:250},color:["#00cccc","#ff0000"]};$.reportChar.draw._requireMulti(["scatter","bar"],option,id)},singleBar:function(id,title,subTitle,data,yAxisName,seriesName){for(var zrColor=require("zrender/tool/color"),_xariaData=new Array,_seriesData=new Array,i=0;i<data.length;i++){var key=data[i][0],value=data[i][1],num_value=""!=value?parseInt(value):0;_xariaData.push(key),_seriesData.push(num_value)}option={title:{x:"center",text:title,subtext:"",textStyle:{color:"rgba(30,144,255,0.8)",fontFamily:"微软雅黑",fontSize:16,fontWeight:"bolder"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},calculable:!0,xAxis:[{type:"category",axisLabel:{rotate:10,margin:3,interval:0,textStyle:{align:"right"}},data:_xariaData}],yAxis:[{type:"value",name:yAxisName}],series:[{name:seriesName,type:"bar",itemStyle:{normal:{color:function(params){return zrColor.lift("#87cefa",.02*params.dataIndex)},label:{show:!0,position:"top",formatter:"{c}"}}},data:_seriesData}]},$.reportChar.draw._require("bar",option,id)},echartsShowScatter:function(id,title,multi,single){var option={title:{text:title,x:"center"},grid:{width:220},tooltip:{trigger:"item",axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},legend:{data:["All data","This one"],x:300,y:180},xAxis:[{type:"value",scale:!0,min:0,max:2,splitNumber:2,name:"序号",nameLocation:"middle",nameGap:20,splitLine:{show:!1}}],yAxis:[{type:"value",scale:!0,axisLabel:{formatter:"{value}"},name:"值"}],series:[{name:"All data",type:"scatter",data:multi},{name:"This one",type:"scatter",data:single}]};$.reportChar.draw._require("scatter",option,id)}},$.reportChar.circularGraphSeriesData=function(list){var o=$.reportChar.draw.circularGraphDataOptions;o.legendData=new Array,o.seriesData=new Array;for(var radius_inner=120,radius_outer=140,i=0;i<list.length;i++){var _key=list[i][0],_value=list[i][1],num_value=""!=_value?parseInt(_value):0,data_name=_value+"% "+_key;o.legendData.push(data_name),o.seriesData.push({name:_key,type:"pie",clockWise:!1,radius:[radius_inner,radius_outer],center:["45%","50%"],itemStyle:o.dataStyle,data:[{value:num_value,name:data_name},{value:100-num_value,name:data_name,tooltip:null,itemStyle:o.placeHolderStyle}]}),radius_inner>0&&(radius_inner-=20,radius_outer-=20)}};var macarons_theme={color:["#2ec7c9","#9a7fd1","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#b6a2de","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"],title:{textStyle:{fontWeight:"normal",color:"#008acd"}},dataRange:{itemWidth:15,color:["#5ab1ef","#e0ffff"]},toolbox:{color:["#1e90ff","#1e90ff","#1e90ff","#1e90ff"],effectiveColor:"#ff4500"},tooltip:{backgroundColor:"rgba(50,50,50,0.5)",axisPointer:{type:"line",lineStyle:{color:"#008acd"},crossStyle:{color:"#008acd"},shadowStyle:{color:"rgba(200,200,200,0.2)"}}},dataZoom:{dataBackgroundColor:"#efefff",fillerColor:"rgba(154,127,209,0.2)",handleColor:"#008acd"},grid:{borderColor:"#eee"},categoryAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitLine:{lineStyle:{color:["#eee"]}}},valueAxis:{axisLine:{lineStyle:{color:"#008acd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.1)","rgba(200,200,200,0.1)"]}},splitLine:{lineStyle:{color:["#eee"]}}},polar:{axisLine:{lineStyle:{color:"#ddd"}},splitArea:{show:!0,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(200,200,200,0.2)"]}},splitLine:{lineStyle:{color:"#ddd"}}},timeline:{lineStyle:{color:"#008acd"},controlStyle:{normal:{color:"#008acd"},emphasis:{color:"#008acd"}},symbol:"emptyCircle",symbolSize:3},bar:{itemStyle:{normal:{barBorderRadius:5},emphasis:{barBorderRadius:5}}},line:{smooth:!0,symbol:"emptyCircle",symbolSize:3},k:{itemStyle:{normal:{color:"#d87a80",color0:"#2ec7c9",lineStyle:{color:"#d87a80",color0:"#2ec7c9"}}}},scatter:{symbol:"circle",symbolSize:4},radar:{symbol:"emptyCircle",symbolSize:3},map:{itemStyle:{normal:{areaStyle:{color:"#ddd"},label:{textStyle:{color:"#d87a80"}}},emphasis:{areaStyle:{color:"#fe994e"}}}},force:{itemStyle:{normal:{linkStyle:{color:"#1e90ff"}}}},chord:{itemStyle:{normal:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}},emphasis:{borderWidth:1,borderColor:"rgba(128, 128, 128, 0.5)",chordStyle:{lineStyle:{color:"rgba(128, 128, 128, 0.5)"}}}}},gauge:{axisLine:{lineStyle:{color:[[.2,"#2ec7c9"],[.8,"#5ab1ef"],[1,"#d87a80"]],width:10}},axisTick:{splitNumber:10,length:15,lineStyle:{color:"auto"}},splitLine:{length:22,lineStyle:{color:"auto"}},pointer:{width:5}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}},map={};map.TTT="F",map.TCT="S",map.TAT="Y",map.TGT="C",map.TTC="F",map.TCC="S",map.TAC="Y",map.TGC="C",map.TTA="L",map.TCA="S",map.TAA="",map.TGA="",map.TTG="L",map.TCG="S",map.TAG="",map.TGG="W",map.CTT="L",map.CCT="P",map.CAT="H",map.CGT="R",map.CTC="L",map.CCC="P",map.CAC="H",map.CGC="R",map.CTA="L",map.CCA="P",map.CAA="Q",map.CGA="R",map.CTG="L",map.CCG="P",map.CAG="Q",map.CGG="R",map.ATT="I",map.ACT="T",map.AAT="N",map.AGT="S",map.ATC="I",map.ACC="T",map.AAC="N",map.AGC="S",map.ATA="I",map.ACA="T",map.AAA="K",map.AGA="R",map.ATG="M",map.ACG="T",map.AAG="K",map.AGG="R",map.GTT="V",map.GCT="A",map.GAT="D",map.GGT="G",map.GTC="V",map.GCC="A",map.GAC="D",map.GGC="G",map.GTA="V",map.GCA="A",map.GAA="E",map.GGA="G",map.GTG="V",map.GCG="A",map.GAG="E",map.GGG="G";var messageUtils=function(messageUtils){function bindEvents(){self.ws.onopen=function(){console.log("websocket connect is opened : "+new Date),clearTimeouts();for(var listener in self.openListeners)$.isFunction(self.openListeners[listener])&&self.openListeners[listener]()},self.ws.onmessage=function(e){var message=JSON.parse(e.data),channels=self.messageChannels[message.channel]||[];if(channels.length<=0)return void console.log("no listener for channel: "+message.channel);for(var channel in channels)$.isFunction(channels[channel])&&channels[channel](message.message)},self.ws.onclose=function(){console.log("websocket connect is closed : "+new Date);for(var listener in self.closeListeners)$.isFunction(self.closeListeners[listener])&&self.closeListeners[listener]()},self.ws.onerror=function(event){console.log("websocket error : "+new Date),console.log(event),console.log(event.data)}}function clearTimeouts(){for(var t in self.timeouts)clearTimeout(self.timeouts[t]);self.timeouts=[]}var self=messageUtils||{};self.messageChannels={listenerNumbers:0},self.openListeners={listenerNumbers:0},self.closeListeners={listenerNumbers:0},self.timeouts={},self.addOpenListener=function(listener){self.openListeners[self.openListeners.listenerNumbers]=listener,self.openListeners.listenerNumbers=self.openListeners.listenerNumbers+1},self.addCloseListener=function(listener){self.closeListeners[self.closeListeners.listenerNumbers]=listener,self.closeListeners.listenerNumbers=self.closeListeners.listenerNumbers+1},self.subscribe=function(channel,callback){var channels=self.messageChannels[channel]||{listenerNumbers:0};$.isFunction(callback)&&(channels[channels.listenerNumbers]=callback,channels.listenerNumbers=channels.listenerNumbers+1,self.messageChannels[channel]=channels)};var openWebSocket=function(){var contextPath=window.CONTEXT_PATH||window.contextPath||"",protocol="https:"==window.location.protocol?"wss://":"ws://",hostname=window.location.hostname,port=window.location.port?":"+window.location.port:"",wsUrl=protocol+hostname+port+contextPath+"/websocket/message",ws=null;return ws="WebSocket"in window?new WebSocket(wsUrl):window.MozWebSocket?new MozWebSocket(wsUrl):new SockJS(contextPath+"/sockjs/message")};self.ws=openWebSocket(),bindEvents();var createNotification=function(title,message,options){var defaultOptions={icon:CONTEXT_PATH+"/images/icon/portrait.png"};return options=$.extend({},defaultOptions,options),options.body=message,new Notification(title,options)};return self.notify=function(title,message,options,events){if(!("Notification"in window))return void console.log("This browser does not support desktop notification");var notification=null;if("granted"===Notification.permission?notification=createNotification(title,message,options):"default"===Notification.permission&&Notification.requestPermission(function(permission){"granted"===permission&&(notification=createNotification(title,message,options))}),null!=notification){var defaultEvents={onclick:function(){notification.close()}};events=$.extend({},defaultEvents,events),$.isFunction(events.onclick)&&(notification.onclick=events.onclick)}},self}(messageUtils);messageUtils.addOpenListener(function(){}),messageUtils.addCloseListener(function(){}),messageUtils.subscribe("userMessage",function(data){console.log("消息来了!")}),!function($){var defaults={delay:3e3},messages=[],showNext=function(){$("#alerts").children().length<5&&messages.length>0&&show(messages.shift())},show=function(message){message.msg=message.msg||"";var $alert=$('<div class="alert message-alert alert-dismissible fade in" role="alert"><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><span>'+message.msg+"</span></div>");$alert.addClass("alert-"+message.type),$alert.on("closed.bs.alert",function(){close($alert)}),$("#alerts").append($alert),setTimeout(function(){close($alert)},message.delay||defaults.delay)},close=function($alert){$alert.remove(),showNext()},push=function(msg,type,delay){messages.push({msg:msg,type:type,delay:delay}),showNext()};$.extend({success:function(msg,delay){push(msg,"success",delay)},info:function(msg,delay){push(msg,"info",delay)},warn:function(msg,delay){push(msg,"warning",delay)},danger:function(msg,delay){push(msg,"danger",delay)},alert:function(msg,delay){push(msg,"success",delay)}})}(jQuery),!function($){var show=function(type,title,message,callback){$("#confirm-modal-div").html()?$("#confirm-modal-div").html(""):$("BODY").append('<div id="confirm-modal-div"></div>');var $alert=$('<div id="confirm-modal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" role="alert"></div>');$alert.addClass(type+"-modal");var $dialog=$('<div class="modal-dialog modal-sm"></div>'),$content=$('<div class="modal-content"></div>'),$header=$('<div class="modal-header"><button type="button" class="close" aria-label="Close" id="close-confirm"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><h4 class="modal-title">'+title+"</h4></div>"),$body=$('<div class="modal-body"></div>'),$h5=$("<h5></h5>"),$footer=$('<div class="modal-footer"><button type="reset" class="btn btn-cancel -low pull-left" data-dismiss="modal" id="confirm-cancle">取消</button><button type="submit" class="btn -low pull-right" id="confirm-ok">确定</button></div>');switch($h5.append($('<i class="fa fa-exclamation-circle" aria-hidden="true"></i>')),$h5.append($("<span>"+message+"</span>")),$body.append($h5),$content.append($header),$content.append($body),type){case"confirm":$content.append($footer),$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert),$("#confirm-ok").click(function(){hide(),callback()}),$("#confirm-cancle").click(function(){hide()});break;case"tips":$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert)}$("#close-confirm").click(function(){hide()})},hide=function(){$("#confirm-modal").modal("hide")},confirm=function(message,title,callback){null==title&&(title="确认框"),show("confirm",title,message,function(result){callback&&callback(result)})},tips=function(message,title){null==title&&(title="提示框"),show("tips",title,message,null)};$.extend({confirm:function(message,title,callback){confirm(message,title,callback)},tips:function(message,title){tips(message,title)}})}(jQuery),!function(){window.celloudApp=angular.module("celloudApp",["ngRoute","ngResource","ngSanitize"])}(),!function(){celloudApp.directive("diHref",["$location","$route",function($location,$route){return function(scope,element,attrs){scope.$watch("diHref",function(){attrs.diHref&&(element.attr("href",attrs.diHref),element.bind("click",function(event){scope.$apply(function(){$location.path()==attrs.diHref.substr(attrs.diHref.indexOf("#/")+1)&&$route.reload()})}))})}}])}(),!function(){celloudApp.directive("pagination",function(){return{restrict:"E",replace:!0,scope:{page:"=",change:"&"},templateUrl:"pages/partial/_partial_pagination_template.jsp",controller:function($scope){$scope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p}}}})}(),!function(){celloudApp.service("uploadService",function($resource){this.getProductTags=function(){return $resource("uploadFile/getProductTag")}})}(),!function(){function getUploadingCount(uploader){for(var count=0,i=0;i<uploader.files.length;i++)5!=uploader.files[i].status&&count++;return count}function getSize(fileSize){var unit="b";return fileSize>1e3&&(fileSize/=1e3,unit="kb"),fileSize>1e3&&(fileSize/=1e3,unit="mb"),fileSize.toFixed(2)+unit}function handleStatus(file){var actionClass,iconClass;file.status==plupload.DONE&&(actionClass="plupload_done",iconClass="fa fa-check-circle"),file.status==plupload.FAILED&&(actionClass="plupload_failed",iconClass="fa fa-exclamation-triangle"),file.status!=plupload.QUEUED&&file.status!=plupload.UPLOADING||(actionClass="plupload_delete",iconClass="fa fa-times-circle-o");var icon=$("#uploading-"+file.id).attr("class",actionClass).find("i").attr("class",iconClass);file.hint&&icon.attr("title",file.hint)}celloudApp.controller("fileUpload",function($route,$location,$scope,$rootScope,uploadService){$scope.step="one",$rootScope.getProTags=function(){"one"==$scope.step&&($scope.upload.splice(),$rootScope.tags=uploadService.getProductTags().query())},$scope.nextStep=function(){$scope.step="two"},$scope.beginUpload=function(){$scope.step="three",$scope.upload.start()},$scope.uploadMore=function(){var count=getUploadingCount($scope.upload);0==count&&($scope.step="two")};var initUploader=function(button){var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:button,url:"../uploadFile/uploadManyFile",chunk_size:"1mb",dragdrop:!0,unique_names:!0,drop_element:"plupload-content",filters:{max_file_size:"3gb",prevent_duplicates:!0,mime_types:[{title:"bam",extensions:"bam"},{title:"ab1",extensions:"ab1"},{title:"abi",extensions:"abi"},{title:"fasta",extensions:"fasta"},{title:"fastq",extensions:"fastq"},{title:"tsv",extensions:"tsv"},{title:"gz",extensions:"gz"},{title:"lis",extensions:"lis"},{title:"txt",extensions:"txt"}]},max_retries:5,multiple_queues:!0,flash_swf_url:"//cdn.bootcss.com/plupload/2.1.8/Moxie.swf"});return uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval(function(){$.get("uploadFile/checkAdminSessionTimeOut")},6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("UploadProgress",function(uploader,file){$("#uploading-"+file.id+" .plupload-file-status").html(file.percent+"%"),$("#uploading-"+file.id+" .plupload-file-surplus").html(utils.formatDate((file.size-file.loaded)/uploader.total.bytesPerSec)),$("#uploading-"+file.id+" .plupload_file_speed").html(getSize(uploader.total.bytesPerSec)+"/s")}),uploader.bind("FilesAdded",function(uploader,files){$scope.isCancel=!1,$.get("uploadFile/checkAdminSessionTimeOut",function(response){response||uploader.destroy()}),$.each(files,function(index,item){var $fileDom_upload=$('<tr class="plupload_delete" id="upload-'+item.id+'">');$fileDom_upload.append($('<td class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></td>")),$fileDom_upload.append($('<td class="plupload-file-size">'+getSize(item.size)+"</td>")),$fileDom_upload.append($('<td class="plupload-file-action"><a href="#" style="display: block;line-height: 30px;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></td>')),$fileDom_upload.append($("</tr>")),$("#upload-list-tbody").append($fileDom_upload);var $fileDom_uploading=$('<tr class="plupload_delete" id="uploading-'+item.id+'">');$fileDom_uploading.append($('<td class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></td>")),$fileDom_uploading.append($('<td class="plupload-file-status">_</td>')),$fileDom_uploading.append($('<td class="plupload-file-surplus">_</td>')),$fileDom_uploading.append($('<td class="plupload_file_speed">_</td>')),$fileDom_uploading.append($('<td class="plupload-file-action"><a href="#" style="display: block;line-height: 30px;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></td>')),$fileDom_uploading.append($("</tr>")),$("#uploading-list-tbody").append($fileDom_uploading),handleStatus(item),$("#upload-"+item.id+".plupload_delete a").click(function(e){$("#upload-"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e),$scope.$apply()}),$("#uploading-"+item.id+".plupload_delete a").click(function(e){var count=getUploadingCount(uploader);1==count&&5!=item.status&&($scope.isCancel=!0),$("#upload-"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e)})}),$scope.$apply()}),uploader.bind("FileUploaded",function(uploader,file,response){var res=response.response;"1"!=res&&$.get("data/run",JSON.parse(res),function(result){$.report.find.condition()}),handleStatus(file)}),uploader.bind("UploadComplete",function(uploader,files){$scope.step="one",$scope.isCancel||($("#upload-list-tbody").children().remove(),$("#uploading-list-tbody").children().remove(),$("#upload-modal").modal("hide"),"/data"==$location.path()&&$route.reload())}),uploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{originalName:file.name,tagId:$scope.tagSelected.tagId,batch:$scope.batch})}),uploader.bind("Error",function(uploader,error){"-602"==error.code&&alert("当前队列已存在文件【"+error.file.name+"】，请勿重复添加！")}),uploader};$("#upload-modal").on("hidden.bs.modal",function(e){"three"!=$scope.step&&($("#upload-list-tbody").children().remove(),$("#uploading-list-tbody").children().remove(),$scope.step="one",$scope.$apply())}),$scope.upload=initUploader(["plupload-content","uploadMore"]),$scope.upload.init(),window.onbeforeunload=function(){var qp=$scope.upload.total,percent=qp.percent;if(qp.size>0&&percent<100&&percent>0)return"数据正在上传，您确定要关闭页面吗?"}})}(),!function(){celloudApp.service("appService",function($http){this.toAppStore=function(){return $http({method:"POST",url:"app/toAppStore",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getMyApp=function(){return $http({method:"POST",url:"app/myApps"})},this.toSclassifyApp=function(pid,pname){return $http({method:"POST",url:"app/toSclassifyApp",data:$.param({paramId:pid}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getAppDetail=function(pid){return $http({method:"POST",url:"app/appDetail",data:$.param({paramId:pid}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}(),!function(){celloudApp.controller("toAppStore",function($route,$scope,appService){$scope.toSclassifyApp=function(pid,pname){appService.toSclassifyApp(pid,pname).success(function(data){$("#appClassifyUl li").removeClass("active"),$("#classifypidLi"+pid).addClass("active"),$scope.classifyAppMap=data.classifyAppMap,$scope.sclassifys=data.sclassifys})},$scope.toAppDetail=function(id){$.get("app/appDetail",{paramId:id},function(responseText){$("#appMain").html(responseText),window.scrollTo(0,0),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","right"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2),$("#manageAppBtns .btn").removeAttr("href"),$("#manageAppBtns .btn").removeAttr("onclick"),$("#manageAppBtns").bind("click",function(){1==hasNavi&&null!=intro&&($("#toUploadMenu").attr("data-step",3),intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),
intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(3)),$("#manageAppBtns").unbind("click")}))})},$scope.toMoreApp=function(pid,sid,pageNum,isParent){currentPage=pageNum,$("#rootClassifyName").unbind("click"),$("#secondClassifyName").unbind("click"),$.get("app/toMoreAppList",{classifyId:sid,classifyPid:pid,classifyFloor:isParent,size:pageAppNum,page:currentPage,condition:self.sortFiled,type:self.sortType},function(responseText){$("#appMain").html(responseText),0==pid?$("#rootClassifyName").html($("#pid"+sid).html()):$("#rootClassifyName").html($("#pid"+pid).html()),0==sid||0==pid?$("#secondClassifyName").html("全部"):$("#secondClassifyName").html($("#sid"+sid).html()),$("#rootClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}),"全部"==$("#secondClassifyName").html()?$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}):$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,sid,pageNum,isParent)}),$("#secondClassifyName").parent().removeClass("hide"),$("#sortByCreateDate").bind("click",function(){self.sortFiled="a.create_date","desc"==self.sortType?self.sortType="asc":self.sortType="desc",self.toMoreApp(pid,sid,1,isParent)}),$("#defaultSort").bind("click",function(){self.sortFiled=null,self.sortType=null}),self.sortApp(),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2))})},$scope.removeApp=function(id){$.get("app/removeApp",{paramId:id},function(responseText){responseText>0&&appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()})})},$scope.refreshProduct=function(){var appElement=document.querySelector("[ng-controller=sidebarController]"),element=angular.element(appElement),$scope=element.scope();$scope.refreshUserProduct()},appService.toAppStore().success(function(data){$scope.pclassifys=data,appService.getMyApp().success(function(data){$scope.appList=data;var pid=$scope.pclassifys[0].classifyId,pname=$scope.pclassifys[0].classifyName;$scope.toSclassifyApp(pid,pname)})})}),celloudApp.controller("toAppDetail",function($routeParams,$route,$scope,appService){appService.getAppDetail($routeParams.pid).success(function(data){$scope.app=data.app,$scope.screenList=data.screenList,window.scrollTo(0,0),appService.getMyApp().success(function(data){$scope.appList=data})}),$scope.refreshProduct=function(){var appElement=document.querySelector("[ng-controller=sidebarController]"),element=angular.element(appElement),$scope=element.scope();$scope.refreshUserProduct()},$scope.toAppMoreDetail=function(id){$("#toAppMoreDetailUl li").removeClass("select"),$("#"+id).addClass("select")},$scope.addApp=function(id){$.get("app/addApp",{paramId:id},function(responseText){responseText>0&&($scope.app.isAdded=1,appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()}))})},$scope.removeApp=function(id){$.get("app/removeApp",{paramId:id},function(responseText){responseText>0&&($scope.app.appId==id&&($scope.app.isAdded=0),appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()}))})}})}(),celloudApp.filter("substring",function(){return function(input){return input>50?input.substring(0,50)+"...":input}}),celloudApp.filter("emptyText",function(){return function(input,other){return null==input||""==input?other:input}}),!function(){celloudApp.service("expenseService",function($http){this.pageQueryConsume=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"expense/toRunExpenseList",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryRecharge=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"pay/recharge/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryInvoice=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"invoice/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getInvoiceById=function(invoiceId){return $http({method:"POST",url:"invoice/detail",data:$.param({id:invoiceId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.apply=function(params){return $http({method:"POST",url:"invoice/apply",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.toRecharge=function(){return $http({method:"POST",url:"pay/recharge",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}(),!function(){celloudApp.controller("pageQueryConsume",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryConsume=function(currentPage,pageSize){expenseService.pageQueryConsume(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryConsume(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryConsume(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryConsume($routeParams.page,$rootScope.pageSize)}),celloudApp.controller("pageQueryRecharge",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryRecharge=function(currentPage,pageSize){expenseService.pageQueryRecharge(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList,$("input[name=checkAll]").prop("checked",!1)})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryRecharge(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryRecharge(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryRecharge($routeParams.page,$rootScope.pageSize),$scope.reset=function(){$scope.invoiceForm={}},$("input[name=checkAll]").click(function(){$(this).prop("checked")?$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").prop("checked",!0):$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").prop("checked",!1)}),$scope.rechargeIds=function(){$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").length==$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]:checked").length?$("#checkAll").prop("checked",!0):$("#checkAll").prop("checked",!1)},$scope.applyInvoice=function(){var rechargeIds=$("input[name='rechargeIds']:checked"),money=0;if(rechargeIds.length<1)return $rootScope.errorInfo="请选择至少一条记录",void $("#tips-modal").modal("show");if(rechargeIds.each(function(){money+=parseFloat($(this).parent().parent().siblings().eq(0).html())}),money<100&&.02!=money)return $rootScope.errorInfo="最少申请100元",void $("#tips-modal").modal("show");$("#apply-invoice-modal").modal("show"),$("#money").attr("value",money);var ids=new Array;rechargeIds.each(function(){ids.push($(this).val())}),$("#rechargeIds").val(ids.join(","))},$scope.apply=function(){$("#invoiceSubmit").prop("disabled",!0),$scope.invoiceForm.invoiceType=$("input[name=invoiceType]:checked").val(),$scope.invoiceForm.rechargeIds=$("#rechargeIds").val(),expenseService.apply($scope.invoiceForm).success(function(data){$("#apply-invoice-modal").modal("hide"),data>0?($.alert("申请成功!"),$scope.pageQueryRecharge(1,10)):$.alert("发生未知错误,请联系管理员!")}),$("#invoiceSubmit").prop("disabled",!1)},$scope.length=0,$scope.invoiceForm={}}),celloudApp.controller("pageQueryInvoice",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryInvoice=function(currentPage,pageSize){expenseService.pageQueryInvoice(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryInvoice(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryInvoice(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryInvoice($routeParams.page,$rootScope.pageSize),$scope.showInvoiceDetail=function(invoiceId){expenseService.getInvoiceById(invoiceId).success(function(invoiceDetail){$scope.invoiceDetail=invoiceDetail})}}),celloudApp.controller("toRecharge",function($scope,$rootScope,expenseService){expenseService.toRecharge().success(function(data){$scope.balance=data}),$scope.tab="pay_tab_alipay",$scope.pay_type="online",$scope.rechargeForm={money:10},$scope.checkMoney=function(){var money=$scope.rechargeForm.money;return $.isNumeric(money)?1*money<10&&1*money!=.01?($scope.moneyError="充值金额要大于10元哦！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):1*money>1e4?($scope.moneyError="大于10000元的充值金额，请使用公司转账方式充值！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):money!=parseInt(money)&&.01!=money?($scope.moneyError="请输入整数金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):$.isNumeric(money)?($scope.checkFlag=!1,$scope.checkSubmit=!1,!0):void 0:($scope.moneyError="请正确输入充值金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1)},$scope.sumbitRecharge=function(){var payWay=$("input[name=pay-way]:checked").val(),action=CONTEXT_PATH+"/pay/recharge/"+payWay;$("#rechargeForm").attr("action",action),$rootScope.errorInfo="请在新打开的页面完成支付操作！",$("#tips-modal").modal("show")}})}(),!function(){celloudApp.service("samplingService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getSamplingList").query()},self.getProductTags=function(){return $resource("uploadFile/getProductTag").query()},self.sampling=function(sampleName,tagId,type){return $http({method:"POST",url:"sample/sampling",params:{sampleName:sampleName,tagId:tagId,type:type}})},self.deleteSample=function(id){return $http({method:"POST",url:"sample/bsi/deleteOne",params:{sampleId:id}})},self.commitSample=function(sampleList){var sampleIds=new Array;for(s in sampleList)void 0!=sampleList[s].sampleId&&sampleIds.push(sampleList[s].sampleId);return $http({method:"POST",url:"sample/commitSampling",params:{sampleIds:sampleIds}})}}),celloudApp.service("scanStorageService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getScanStorageSamples").get()},self.pageList=function(page,size){return $http.get("sample/getScanStorageSamples",{params:{page:page,size:size}})},self.scanStorage=function(sampleName){return $http({method:"POST",url:"sample/toScanStorage",params:{sampleName:sampleName}})},self.editRemark=function(id,remark){return $http({method:"POST",url:"sample/editRemark",params:{sampleId:id,remark:remark}})},self.remove=function(id){return $http({method:"POST",url:"sample/removeSampleLog",params:{sampleLogId:id}})}}),celloudApp.service("tokenDNAService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getTokenDnaSamples").get()},self.pageList=function(page,size){return $http.get("sample/getTokenDnaSamples",{params:{page:page,size:size}})},self.tokenDNA=function(sampleName){return $http({method:"POST",url:"sample/toTokenDNA",params:{sampleName:sampleName}})}}),celloudApp.service("buidLibraryService",function($resource,$http){var self=this;self.infos=function(){return $resource("sample/getBuidLibrarySamples").get()},self.addSample=function(sampleName,sampleList){var sindexs=new Array;for(s in sampleList)sindexs.push(sampleList[s].sindex);return $http({method:"POST",url:"sample/addSampleToLibrary",params:{sampleName:sampleName,sindexs:sindexs}})},self.addLibrary=function(libraryName,sindex,sampleList){var sampleIds=new Array;for(s in sampleList)void 0!=sampleList[s].sampleId&&sampleIds.push(sampleList[s].sampleId);return $http({method:"POST",url:"sample/addLibrary",params:{libraryName:libraryName,sindex:sindex,sampleIds:sampleIds}})},self.downloadExcel=function(ssId,storageName){return $http.get("sample/downExperExcel",{params:{ssId:ssId,storageName:storageName}})}}),celloudApp.service("storagesService",function($resource,$http,$routeParams){var self=this;self.storages=function(){return $resource("sample/getSampleStorages").get()},self.pageList=function(page,size){return $http.get("sample/getSampleStorages",{params:{page:page,size:size}})},self.sampleList=function(){return $http.get("sample/sampleListInStorage",{params:{ssId:$routeParams.ssId}})}})}(),!function(){celloudApp.controller("samplingController",function($rootScope,$scope,samplingService){$scope.sampleList=samplingService.sampleList(),$scope.productTags=samplingService.getProductTags(),$scope.typeList=["血","组织液","引流液","关节液","心包积液","胸水","脓液","脑脊液","阴道拭子","腹水","尿液","肺泡灌洗液"],$scope.addSample=function(){samplingService.sampling($scope.sampleName,$scope.selTags.tagId,$scope.type).success(function(data){2==data?$.alert("此样品信息已经收集过，请核查或者采集下一管样品信息！"):$scope.sampleList=samplingService.sampleList(),$scope.sampleName=""})},$scope.commitSample=function(){samplingService.commitSample($scope.sampleList).success(function(data){data>0?$scope.sampleList=samplingService.sampleList():$.alert("样本已提交")})},$scope.deleteSample=function(id){samplingService.deleteSample(id).success(function(data){data>0?($scope.sampleList=samplingService.sampleList(),$.alert("删除样本成功")):$.alert("删除样本失败")})}}),celloudApp.controller("scanStorageController",function($rootScope,$scope,scanStorageService){$scope.pages={page:1,pageSize:20},$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},scanStorageService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data})},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.scanStorage())},$scope.scanStorage=function(){return""==$scope.sampleName||void 0==$scope.sampleName?($.alert("请输入样本信息！"),!1):void scanStorageService.scanStorage($scope.sampleName).success(function(data){0==data?$.alert("系统中无此样本信息，请确认是已采样样本！"):data>0?$rootScope.sampleList=$scope.pageQuery($scope.page,$scope.pageSize):$.alert("此样品信息已经收集过，请核查或者采集下一管样品信息！"),$scope.sampleName=""})},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($scope.pageQuery($scope.pages.page,$scope.pages.pageSize),$.alert("样本删除成功")):$.alert("样本删除失败")})},$rootScope.sampleList=$scope.pageQuery($scope.page,$scope.pageSize)}),celloudApp.controller("tokenDNAController",function($rootScope,$scope,scanStorageService,tokenDNAService){$scope.pages={page:1,pageSize:20},$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},tokenDNAService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data})},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.tokenDNA())},$scope.tokenDNA=function(){return""==$scope.sampleName||void 0==$scope.sampleName?($.alert("请输入样本信息！"),!1):void tokenDNAService.tokenDNA($scope.sampleName).success(function(data){0==data?$.alert("此样本未入库"):data>0?$rootScope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize):$.alert("此样品信息已经收集过，请核查或者采集下一管样品信息！"),$scope.sampleName=""})},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($rootScope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize),$.alert("样本删除成功")):$.alert("样本删除失败")})},$rootScope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize)}),celloudApp.controller("buidLibraryController",function($rootScope,$scope,scanStorageService,buidLibraryService){$scope.infos=buidLibraryService.infos(),$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||""==$scope.sindex||void 0==$scope.sindex?$.alert("请输入样本信息"):$scope.addSample())},$scope.addSample=function(){var sampleList=$scope.infos.pageList.datas;sampleList.length>=12?$.tips("每个文库最多12个样本！"):""==$scope.sampleName||void 0==$scope.sampleName?$.alert("请输入样本信息"):buidLibraryService.addSample($scope.sampleName,sampleList).success(function(data){data>0?$scope.infos=buidLibraryService.infos():0==data?$.alert("此样本未提取DNA"):$.alert("此样品信息已经入库，请核查或者扫描下一管样品信息！")}),$scope.sampleName=""},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($scope.infos=buidLibraryService.infos(),$.alert("样本删除成功")):$.alert("样本删除失败")})},$scope.addLibrary=function(){buidLibraryService.addLibrary($scope.infos.libraryName,$scope.sindex,$scope.infos.pageList.datas).success(function(data){data>0?($scope.infos=buidLibraryService.infos(),$.alert("建库成功！")):($scope.repeatError=!0,$.alert("建库失败！"))})},$scope.addAndDownLibrary=function(){buidLibraryService.addLibrary($scope.infos.libraryName,$scope.sindex,$scope.infos.pageList.datas).success(function(data){if(0==data)$scope.notPrevError=!0;else if(data>0){var storageName=$scope.infos.libraryName;$scope.infos=buidLibraryService.infos(),buidLibraryService.downloadExcel(data,storageName).success(function(flag){if(1==flag)$.alert("没有正确生成Excel文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"sample/downExperExcel?ssId="+data+"&storageName="+storageName,$.alert("建库并下载成功！")}})}else $scope.repeatError=!0})}}),celloudApp.controller("storagesController",function($rootScope,$scope,storagesService,buidLibraryService){$scope.storages=storagesService.storages(),storagesService.sampleList().success(function(data){$scope.sampleList=data});var pages={page:1,pageSize:10};$scope.pageQuery=function(page,pageSize){pages={page:page,pageSize:pageSize},storagesService.pageList(page,pageSize).success(function(data){$scope.storages=data})},$scope.download=function(id,storageName){buidLibraryService.downloadExcel(id,storageName).success(function(flag){if(1==flag)$.alert("没有正确生成Excel文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"sample/downExperExcel?ssId="+id+"&storageName="+storageName,$.alert("下载Excel文件成功！")}})}}),celloudApp.controller("editSampleController",function($rootScope,$scope,scanStorageService,tokenDNAService){$scope.toEditRemark=function(id,remark){$scope.sampleId=id,$scope.remark=remark,$scope.remark_bak=remark},$scope.resetSampleRemark=function(){$scope.remark=angular.copy($scope.remark_bak)},$scope.editRemark=function(){scanStorageService.editRemark($scope.sampleId,$scope.remark).success(function(data){data>0?(1==$scope.exper_state?scanStorageService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data}):tokenDNAService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data}),$.alert("样本修改成功")):$.alert("样本修改失败"),$("#sample-remark-modal").modal("hide")})}})}(),!function(){celloudApp.service("userService",function($q,$http,$resource){this.getUserInfo=function(){return $http({method:"POST",url:"user/info",params:{}})},this.updateUserInfo=function(user){return $http({method:"POST",url:"user/updateInfo",params:{cellphone:user.cellphone}})},this.updatePassword=function(oldPassword,newPassword){return $http({method:"POST",url:"user/updatePassword",params:{oldPassword:oldPassword,newPassword:newPassword}})},this.updateEmail=function(email){return $http({method:"POST",url:"user/sendOldEmail",params:{email:email}})},this.pageQueryLog=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"user/logInfo",params:{currentPage:currentPage,pageSize:pageSize}})},this.getUserCompanyIcon=function(){return $http({method:"POST",url:"user/getCompanyIcon",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.setUserCompanyIcon=function(companyIcon){return $http({method:"POST",url:"user/setCompanyIcon",data:$.param({companyIcon:companyIcon}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}(),!function(){celloudApp.controller("updateBaseInfo",function($scope,userService){userService.getUserInfo().success(function(data){$scope.user=data,$scope.user_bak=angular.copy(data)}),$scope.updateUserInfo=function(){userService.updateUserInfo($scope.user).success(function(data){$.alert(data.message)}).error(function(data){$.alert(data.message)})},$scope.reset=function(){$scope.user=angular.copy($scope.user_bak)}}),celloudApp.controller("updatePassword",function($scope,userService){$scope.reset=function(){$scope.oldPwd="",$scope.newPwd="",$scope.confirmPwd=""},$scope.updatePassword=function(){$scope.state=!1,userService.updatePassword($scope.oldPwd,$scope.newPwd).success(function(data){$scope.code=data.code,203==$scope.code?$scope.pwdMessage=data.message:$.alert(data.message)}).error(function(data){})},$scope.checkOldPwd=function(){""==$.trim($scope.oldPwd)&&($scope.code=0)}}),celloudApp.controller("pageQueryLog",function($scope,$rootScope,$routeParams,$location,userService){$scope.pageQueryLog=function(currentPage,pageSize){userService.pageQueryLog(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryLog(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryLog(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryLog($routeParams.page,$rootScope.pageSize)}),celloudApp.controller("updateEmail",function($scope,userService){userService.getUserInfo().success(function(data){$scope.user=data}),$scope.isSend=!1,$scope.updateEmail=function(){userService.updateEmail($scope.user.email).success(function(data){1==data?$scope.sendFail=!0:0==data&&($scope.sendSuccess=!0)})}}),celloudApp.controller("setReportController",function($scope,userService){$scope.icon="",$scope.haveImage=!1,userService.getUserCompanyIcon().success(function(company){$scope.icon=company.companyIcon,""==$scope.icon?$scope.isTemp=!0:($scope.haveImage=!0,$scope.isTemp=!1,$scope.path=CONTEXT_PATH+"/user/icon?file="+$scope.icon)}),$scope.apply=function(){userService.setUserCompanyIcon($scope.icon).success(function(data){data>0&&($.alert("更新成功!"),$scope.icon="")})};var initUploader=function(button){var uploader=new plupload.Uploader({browse_button:button,url:"../user/uploadCompanyIcon",chunk_size:"2mb",file_data_name:"file",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}],prevent_duplicates:!1},multi_selection:!1,flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",init:{FilesAdded:function(uploader,files){uploader.start()}}});return uploader},unsaveUploader=initUploader("unsavedAttachmentUploadBtn");unsaveUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name})}),unsaveUploader.bind("FileUploaded",function(uploader,file,response){$scope.tempPath=CONTEXT_PATH+"/user/icon/temp?file="+response.response,$scope.icon=response.response,$scope.isTemp=!0,$scope.haveImage=!0,$scope.$apply()}),unsaveUploader.init()})}(),!function(){celloudApp.service("runService",function($resource,$http){var self=this;self.pageList=function(){var options=$.dataManager.options;return $http.get("data/dataPageListCondition?random="+(new Date).getTime(),{params:{page:options.page,size:options.pageSize,condition:options.condition,sort:options.sort,sortDateType:options.sortDateType,sortNameType:options.sortNameType}})},self.run=function(){var checkedIds=$.dataManager.options.checkedIds,dataIds=[];return $.each(checkedIds,function(i,el){$.inArray(el,dataIds)===-1&&dataIds.push(el)}),$http.get("data/runWithProject",{params:{dataIds:dataIds.toString()}})},self.deleteData=function(){for(var checkedIds=$.dataManager.options.checkedIds,dataIds="",i=0;i<checkedIds.length;i++)dataIds+=checkedIds[i]+",";return dataIds=dataIds.substring(0,dataIds.length-1),$http.get("data/delete.action",{params:{dataIds:dataIds}})},self.toEditData=function(fileId){return $http.get("data/toEditData",{params:{dataId:fileId}})},self.submitEditData=function(dataFile){return $http.get("data/updateDataAndTag",{params:{fileId:dataFile.fileId,anotherName:dataFile.anotherName,batch:dataFile.batch,tagName:dataFile.tagName}})}})}(),!function(){celloudApp.controller("dataListController",function($scope,$rootScope,$location,$routeParams,runService){$scope.pageQuery=function(page,pageSize){$.dataManager.options.condition=$scope.dataCondition,$.dataManager.options.page=page,$.dataManager.options.pageSize=pageSize,runService.pageList().success(function(response){$scope.dataList=response}),$.dataManager.refreshDataList("clean")},$scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$scope.conditionList=function(){$scope.pageQuery(1,$.dataManager.options.pageSize)},$scope.doSearch=function($event){13==$event.keyCode&&$scope.conditionList()},$scope.checkNum=function(){var checkedIds=$.dataManager.options.checkedIds;if(0==checkedIds.length)return $rootScope.errorInfo="请选择至少一条记录",$("#tips-modal").modal("show"),!1;var maxNum=$.dataManager.options.dataMax;return!(checkedIds.length>maxNum&&($rootScope.errorInfo="最多允许同时操作"+maxNum+"条数据！",$("#tips-modal").modal("show"),1))},$scope.runWithProject=function(){if($scope.checkNum())return 0!=$.dataManager.options.isRun?($rootScope.errorInfo="所勾选的数据必须不处于运行状态！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isTag?($rootScope.errorInfo="所勾选的数据必须有产品标签！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isBSI?($rootScope.errorInfo="所勾选的数据产品标签不能为百菌探！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isRocky?($rootScope.errorInfo="所勾选的数据产品标签不能为华木兰！",void $("#tips-modal").modal("show")):void(0!=$.dataManager.options.isPair?$.confirm("请保证所选数据为配对数据！","确认框",function(){$scope.run()}):$scope.run())},$scope.run=function(){var checkedIds=$.dataManager.options.checkedIds;return checkedIds.length!=$.dataManager.options.validIds?($rootScope.errorInfo="数据选择异常，请刷新页面后重新选择！",void $("#tips-modal").modal("show")):void runService.run().success(function(response){response.success?($.alert("运行成功"),$scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$.dataManager.refreshDataList()):$scope.message=response.message})},$scope.deleteData=function(){$scope.checkNum()&&$.confirm("确定要归档所选数据？","确认框",function(){runService.deleteData().success(function(response){response.success&&($scope.conditionList(),$.dataManager.refreshDataList()),$.alert(response.message)})})},$scope.toEditData=function(fileId){$scope.updateState=!1,runService.toEditData(fileId).success(function(response){for($scope.dataFile=response.file,$scope.appList=response.appList,i=0;i<$scope.appList.length;i++)if($.trim($scope.appList[i].tagName)==$.trim($scope.dataFile.tagName)){$scope.appSelected=$scope.appList[i];break}})},$scope.submitEditData=function(){var alias=$scope.dataFile.anotherName;if(null!=alias&&alias.length>50)return $scope.updateMessage="文件别名不能超过50个字符",void($scope.updateState=!0);var batch=$scope.dataFile.batch;return null!=batch&&batch.length>50?($scope.updateMessage="数据标签不能超过50个字符",void($scope.updateState=!0)):($scope.updateState=!1,$scope.dataFile.tagName=void 0==$scope.appSelected?"":$scope.appSelected.tagName,void runService.submitEditData($scope.dataFile).success(function(response){response.success&&($scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$.dataManager.refreshDataList(),$("#data-detail-modal").modal("hide")),$.alert(response.message)}))}})}(),$.dataManager={},$.ajaxSetup({cache:!1}),$(function(){_init_data()}),!function(){celloudApp.filter("hcvShowMore",function(){return function(input){return"1b"!=input&&"2a"!=input&&"3a"!=input&&"3b"!=input&&"6a"!=input?($("#_change").parent().css("display",""),"其他"):input}})}(),!function(){celloudApp.service("projectReportService",function($resource,$http){var self=this;self.getRanAPP=function(){return $resource("app/getRanAPP").get()},self.getReportList=function(){return $resource("report/getReportPageList").get()},self.getReportListCondition=function(currentPage,pageSize,belongs,start,end,appId,condition){return $http.get("report/getReportPageList?random="+(new Date).getTime(),{params:{page:currentPage,size:pageSize,condition:condition,start:start,end:end,appId:appId,belongs:belongs}})},self.changeProjectName=function(projectId,projectName){return $http.get("project/update",{params:{projectId:projectId,projectName:projectName}})},self.deleteProject=function(projectId){return $http.get("project/deleteByState",{params:{projectId:projectId}})},self.cancelProjectShare=function(projectId){return $http.get("project/deleteShare",{params:{projectId:projectId}})},self.projectShare=function(projectId,userNames){return $http.get("project/shareProject",{params:{projectId:projectId,userNames:userNames}})},self.getShareTo=function(projectId){return $http.get("project/getShareTo",{params:{projectId:projectId}})},self.downPDF=function(path){return $http.get("report/down",{params:{path:path}})}}),celloudApp.service("dataReportService",function($resource,$http){var self=this;self.getReports=function(){return $resource("report/dataReportPages").get()},self.getReportsByParams=function(currentPage,pageSize,condition,beginDate,endDate,batch,tagId,period,sort){return $http.get("report/dataReportPages",{params:{page:currentPage,size:pageSize,condition:condition,beginDate:beginDate,endDate:endDate,tagId:tagId,batch:batch,period:period,sort:sort}})},self.getSearchInfos=function(){return $resource("report/reportSearchInfo").get()},self.getDataReportInfo=function(url,dataKey,projectId,appId){return $http({method:"POST",url:url,data:$.param({dataKey:dataKey,projectId:projectId,appId:appId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}(),!function(){function viewDataReport(userId,dataKey,fileName,appId,appName,proId,proName,obj){if(81==appId||83==appId||85==appId||86==appId||87==appId||88==appId||91==appId||92==appId||93==appId||94==appId||99==appId||100==appId||101==appId||104==appId||106==appId||119==appId||120==appId||121==appId||122==appId||124==appId||125==appId)var href="#/reportpro/PGS/"+appId+"/"+dataKey+"/"+proId;else var href="#/reportpro/"+appName+"/"+appId+"/"+dataKey+"/"+proId;window.location.href=href}function getCountValue(key,id){var val,num=0;return $("#"+id).find("tr").each(function(i){0==i?$(this).find("th").each(function(j){var title=$(this).html();title==key&&(num=j)}):$(this).find("td").each(function(k){if(num==k&&(val=$(this).html(),val.indexOf(",")>0)){var reg=new RegExp(",","g");val=val.replace(reg,"")}})}),val}celloudApp.directive("loadOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("reportLoadOver")})}}}),celloudApp.directive("pgsOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("pgsLoadOver")})}}}),celloudApp.controller("egfrDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getEGFRInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(egfrInfo){$scope.egfr=egfrInfo.egfr,$scope.project=egfrInfo.project,$scope.uploadPath=egfrInfo.uploadPath;var length=$scope.egfr.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/egfrCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("krasDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getKRASInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(krasInfo){
$scope.kras=krasInfo.kras,$scope.project=krasInfo.project,$scope.uploadPath=krasInfo.uploadPath;var length=$scope.kras.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/krasCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("hcvDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getHCVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hcvInfo){$scope.hcv=hcvInfo.hcv,$scope.project=hcvInfo.project,$scope.uploadPath=hcvInfo.uploadPath,$scope.change=function(){var val=$("#_change").html();"显示更多"==val?($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#_change").html("返回")):($("#nomal").css("display","none"),$("#cfda").css("display",""),$("#_change").html("显示更多"))},$.get("count/hcvCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split(";"),k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',",Y+=n[0]==one?"{ dataLabels: { enabled: true, y: 0, crop: false, style: { fontWeight: 'bold', fontSize:16 }, }, y:"+n[1]+"},":n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","Subtype",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("brafDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBRAFInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(brafInfo){if($scope.braf=brafInfo.braf,$scope.project=brafInfo.project,$scope.uploadPath=brafInfo.uploadPath,void 0!=$scope.braf){var $table=$($scope.braf.mutationPosition);$scope.searchTable=function(){var result="";$table.find("td").each(function(){var context=$(this).html(),len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(k==-1)result+=after;else if(before!=after)result+=after;else{var search=$("#_snum").val(),r=context.substring(d+1,k);if(parseFloat(r)>parseFloat(search))result+=after;else{var l=context.indexOf("|"),r=context.indexOf("(");result+=context.substring(l+1,r)}}}),$("#searchResult").html(map[result])},$scope.searchTable()}})}),celloudApp.controller("tbRifampicinDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBRifampicinInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbrifampicinInfo){$scope.tbrifampicin=tbrifampicinInfo.tbrifampicin,$scope.project=tbrifampicinInfo.project,$scope.uploadPath=tbrifampicinInfo.uploadPath,$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.tbrifampicin.report).find("td").each(function(){var context=$(this).html();if(search){var len=context.indexOf("-"),d=context.indexOf(","),k=context.indexOf(")");if(len==-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)<parseFloat(search))$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var kl=context.indexOf("(");context=context.substring(0,kl)+context.substring(k+1,context.length),$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3));if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var c5,c=context.split("\t"),c3=c[3].substring(0,c[3].indexOf("|")),c4=(c[4].substring(0,c[3].lastIndexOf("|")-1)+c[4].substring(c[4].lastIndexOf(")")+1,c[4].length)).replace("(","");c5=c[5].indexOf("|")==-1?c[5]:c[5].substring(0,c[5].indexOf("|"));var last=c[0]+"\t"+c[1]+"\t"+c[2]+"\t"+c3+"\t"+c4+"\t"+c5;$("#_sr").append("<tr><td>"+last.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")})},$scope.searchTable(),$.get("count/tbCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("tbinhDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBINHInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbinhInfo){$scope.tbinh=tbinhInfo.tbinh,$scope.project=tbinhInfo.project,$scope.uploadPath=tbinhInfo.uploadPath;var mutant=tbinhInfo.mutant,wild=tbinhInfo.wild,neither=tbinhInfo.neither,data=[{name:"Mutant strain",value:mutant},{name:"Wild type",value:wild},{name:"No Result",value:neither}];$.reportChar.draw.echartsShowPie("_showPie","Samples Statistic",data),$scope.searchTable=function(numId,sourceId,resultId){var search=$("#"+numId).val();$("#"+resultId).html("");var i=0;"r1"==sourceId?$table=$($scope.tbinh.position):$table=$($scope.tbinh.mutationPosition),$table.find("td").each(function(){var context=$(this).html();if(""==search)i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var len=context.lastIndexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&(i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>"))}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),i++,$("#"+resultId).append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}}}),0==i&&$("#"+resultId).append("<tr><td style='color:red'>没有符合筛选条件的结果</tr></td>")},$scope.searchTable("_snum1","r1","_sr1"),$scope.searchTable("_snum2","r2","_sr2")})}),celloudApp.controller("hbvDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.change1=function(){$("#nomal").css("display",""),$("#cfda").css("display","none")},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display","")},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("oncogeneDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getOncogeneInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(oncogeneInfo){$scope.oncogene=oncogeneInfo.oncogene,$scope.project=oncogeneInfo.project,$scope.uploadPath=oncogeneInfo.uploadPath})}),celloudApp.controller("dpdDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getDpdInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(dpdInfo){$scope.dpd=dpdInfo.dpd,$scope.project=dpdInfo.project,$scope.uploadPath=dpdInfo.uploadPath,$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.dpd.mutationPosition).find("td").each(function(){var context=$(this).html();if(""==search)$("#_sr").append("<tr><td>"+context+"</tr></td>");else{var len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),$("#_sr").append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else $("#_sr").append("<tr><td>"+context+"</tr></td>")}}})},$scope.searchTable()})}),celloudApp.controller("abinjDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getABINJInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(abinjInfo){$scope.abinj=abinjInfo.abinj,$scope.project=abinjInfo.project,$scope.uploadPath=abinjInfo.uploadPath})}),celloudApp.controller("ugtDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getUGTInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(ugtInfo){$scope.ugt=ugtInfo.ugt,$scope.project=ugtInfo.project,$scope.uploadPath=ugtInfo.uploadPath})}),celloudApp.controller("16sDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/get16SInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(s16Info){$scope.s16=s16Info.s16,$scope.project=s16Info.project,$scope.uploadPath=s16Info.uploadPath;var $table=$("<div>"+$scope.s16.resultTable+"</div>");$table.find("tr").each(function(i){0==i?length=$(this).find("td").length:(tdlength=$(this).find("td").length,tdlength<length&&$(this).children("td").eq(1).attr("colspan",5))}),$scope.s16.resultTable=$table.html()})}),celloudApp.controller("translateDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTranslateInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(translateInfo){$scope.translate=translateInfo.translate,$scope.project=translateInfo.project,$scope.uploadPath=translateInfo.uploadPath})}),celloudApp.controller("gddDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getGDDInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(gddInfo){$scope.gdd=gddInfo.cmp,$scope.project=gddInfo.project,$scope.uploadPath=gddInfo.uploadPath})}),celloudApp.controller("cmpDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getCMPInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(cmpInfo){$scope.cmp=cmpInfo.cmp,$scope.project=cmpInfo.project,$scope.uploadPath=cmpInfo.uploadPath})}),celloudApp.controller("bsiDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBSIInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(bsiInfo){$scope.bsi=bsiInfo.bsi,$scope.project=bsiInfo.project,$scope.uploadPath=bsiInfo.uploadPath,$scope.tab="patient";for(var havestrain="",i=0;i<$scope.bsi.species_20.length;i++)havestrain+=$scope.bsi.species_20[i].species_zh+",";$scope.havestrain=havestrain.substr(0,havestrain.length-1),$scope.getRowspan=function(val1,val2,val3){var val0=1;return null!=val1&&val0++,null!=val2&&val0++,null!=val3&&val0++,val0}})}),celloudApp.controller("rockyDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getRockyInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(rockyInfo){$scope.rocky=rockyInfo.rocky,$scope.project=rockyInfo.project,$scope.uploadPath=rockyInfo.uploadPath})}),celloudApp.controller("splitDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getSplitInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(splitInfo){$scope.split=splitInfo.split,$scope.project=splitInfo.project,$scope.uploadPath=splitInfo.uploadPath;var printReport={main:function(method,param){$.get(method,param,function(responseText){var obj=window.open("");obj.document.write(responseText),obj.document.close()})},mongoParam:function(projectId,dataKey,appId){var _param={projectId:projectId,dataKey:dataKey,appId:appId};return _param}};$scope.printSplit=function(projectId,dataKey,appId){printReport.main("report/printSplitReport",printReport.mongoParam(projectId,dataKey,appId))},$.get("count/splitCompare",{id:splitInfo.splitId},function(data){var totalSource=JSON.stringify(data.totalSource),totalSample=JSON.stringify(data.totalSample),thisSource=JSON.stringify(data.thisSource),thisSample=JSON.stringify(data.thisSample);console.log("totalSource: "+totalSource),console.log("totalSample: "+totalSample),console.log("thisSource: "+thisSource),console.log("thisSample: "+thisSample),drawScatter("sourceCharDiv",eval(totalSource),eval(thisSource),"Split源数据同比图","平均质量","序列总数"),drawScatter("sampleCharDiv",eval(totalSample),eval(thisSample),"Split分离结果数据同比图","平均质量","序列总数")})})}),celloudApp.controller("pgsDataReportController",function($scope,$routeParams,$compile,dataReportService){$scope.$on("pgsLoadOver",function(){var num=0;$("#reportDiv").find("td").each(function(){var result=$(this).text();num%4==0&&$(this).css("min-width","90px"),num%4==1&&$(this).css("min-width","55px"),num%4==2&&result.length>85&&($(this).html(result.substring(0,84)+"..."),$(this).attr("title",result)),num%4==3&&(result.length>39&&($(this).html(result.substring(0,38)+"..."),$(this).attr("title",result)),$(this).css("width","300px")),$(this).css("padding-left","20px"),$(this).css("text-align","left"),num++});var trTotal=0,tr=0,count=1,need=!1;$("#reportDiv").find("tr").each(function(){var tdVal=$(this).children("td").eq(0).html();if(tdVal.toLowerCase().indexOf("chr")==-1)$(this).children("td").eq(2).remove(),$(this).children("td").eq(2).remove(),tr=trTotal-count,count++,need=!0;else if(need){var rowTr=$("#reportTable tr").eq(tr);$(rowTr).children("td").eq(0).attr("rowspan",count),$(rowTr).children("td").eq(0).css("vertical-align","middle"),$(rowTr).children("td").eq(1).attr("rowspan",count),$(rowTr).children("td").eq(1).css("vertical-align","middle"),count=1,need=!1}trTotal++})}),dataReportService.getDataReportInfo("report/getPgsInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(pgsInfo){function showEdditError(info){$("#edit-conclusionErrorInfo").html(info),$("#edit-conclusion-error").removeClass("hide")}$scope.pgs=pgsInfo.pgs,$scope.experiment=pgsInfo.experiment,$scope.project=pgsInfo.project,$scope.uploadPath=pgsInfo.uploadPath,$scope.editShowConclusion=function(){$("#edit-conclusion-error").addClass("hide"),$("#editReportConclusion").modal("show")},$scope.saveConclusion=function(){var qualified=$("#reportConclusion").find("input:radio[name='qualified']:checked").val();return qualified?void $.get("experiment/updateExperiment",$("#reportConclusionForm").serialize(),function(flag){1==flag?(showAddError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#reportConclusion").modal("hide")},2e3)):showAddError("保存失败！")}):void showAddError("请选择是否合格！")},$scope.editSaveConclusion=function(){var qualified=$("#editReportConclusion").find("input:radio[name='qualified']:checked").val();if(!qualified)return void showEdditError("请选择是否合格！");var remarks=$("#editReportConclusion").find("textarea[name='remarks']").val();return remarks.length>125?void showEdditError("备注长度不能大于125个字符！！"):void $.get("experiment/updateExperiment",$("#editReportConclusionForm").serialize(),function(flag){1==flag?(showEdditError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#editReportConclusion").modal("hide")},2e3)):showEdditError("保存失败！")})},$scope.showModal=function(id){$("#"+id).modal("show")};var appId=$scope.pgs.appId;$.get("count/pgsCompare",{appId:appId,columns:charMap[appId]},function(data){var sp=data.split(";");$("#charResult").html("");for(var i=1;i<sp.length;i++){var big=0,div=$("<div id='char"+i+"' class='col-lg-5' style='width: 410px;height:400px;'></div>");$("#charDiv").append(div);for(var ev=sp[i].split(":"),one=getCountValue(ev[0],"_table"),value=ev[1].split(","),context="[",k=0;k<value.length-1;k++)context+="[1,"+value[k]+"],",value[k]>one&&big++;context+="]";var percent=0;percent="Duplicate"==ev[0]||"Duplicate(%)"==ev[0]||"*SD"==ev[0]?Math.round(big/value.length*100):100-Math.round(big/value.length*100),$("#charResult").append("本数据的 "+ev[0]+" 打败了 <span class='green'>"+percent+"%</span> 的数据；");var single="[[2,"+one+"]]";$.reportChar.draw.echartsShowScatter("char"+i,ev[0],eval(context),eval(single))}})})}),celloudApp.controller("projectReportController",function($scope,$rootScope,$routeParams,$location,projectReportService){$scope.companyId=companyId,$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,tokenSeparators:[","," "]}),$scope.ranAppList=projectReportService.getRanAPP();var options={page:1,pageSize:10,belongs:1,start:null,end:null,app:0,condition:null};$scope.pageQuery=function(currentPage,pageSize){var belongs=options.belongs,start=options.start,end=options.end,app=options.app,condition=options.condition;options.pageSize=pageSize,projectReportService.getReportListCondition(currentPage,pageSize,belongs,start,end,app,condition).success(function(dataList){$scope.dataList=dataList})},$scope.pageQuery(options.page,options.pageSize),$scope.changeBelongs=function(id){$(".belongs").removeClass("active"),$("#belongs"+id).addClass("active"),options.belongs=id,$scope.pageQuery(1,options.pageSize)};var START=null,END=null;$scope.changeDate=function(flag){if($("#_searchDate").val(""),$("#_endDate").val(""),$(".changeDate").removeClass("active"),$("#changeDate"+flag).addClass("active"),0==flag)START=null,END=null;else{var d=new Date,date=new Date(d.getTime()-864e5*flag),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();START=year+"-"+mounth+"-"+day,END=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()}$scope.dateQuery()},$scope.chooseDate=function(){return $(".changeDate").removeClass("active"),START=$("#_searchDate").val(),END=$("#_endDate").val(),START&&END?START>END?void $.alert("起始时间不能大于结束时间"):void $scope.dateQuery():void $.alert("请同时选择起始时间和结束时间")},$scope.dateQuery=function(){null!=START&&(START+=" 00:00:00"),null!=END&&(END+=" 23:59:59"),options.start=START,options.end=END,$scope.pageQuery(1,options.pageSize)},$scope.changeApp=function(appId){$(".changeApp").removeClass("active"),$("#changeApp"+appId).addClass("active"),options.app=appId,$scope.pageQuery(1,options.pageSize)},$scope.changeCondition=function(){options.condition=$scope.reportCondition,$scope.pageQuery(1,options.pageSize)},$scope.toChangePname=function(projectId){$("#showPname"+projectId).addClass("hide"),$("#changePname"+projectId).removeClass("hide")},$scope.changePname=function(projectId){var name=$("#updatePname"+projectId).val(),oldName=$("#pnameSpan"+projectId).text().trim();return name==oldName?($("#showPname"+projectId).removeClass("hide"),void $("#changePname"+projectId).addClass("hide")):void projectReportService.changeProjectName(projectId,name).success(function(response){response.success&&(name.length>13&&(name=name.substring(0,12)+"..."),$("#pnameSpan"+projectId).html(name),$("#showPname"+projectId).removeClass("hide"),$("#changePname"+projectId).addClass("hide")),$scope.message=response.message,$scope.state=!0})},$scope.cancelProjectShare=function(projectId){$.confirm("确定要删除该项目？","确认框",function(){projectReportService.cancelProjectShare(projectId).success(function(response){response.success&&$scope.pageQuery(1,options.pageSize),$.alert(response.message)})})},$scope.downPDF=function(userId,appId,projectId){var path=userId+"/"+appId+"/"+projectId+"/"+projectId+".pdf";projectReportService.downPDF(path).success(function(flag){if(1==flag)$.alert("没有可以下载的pdf文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"report/down?path="+path}})},$scope.toShareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,$scope.updateState=!1,$("#shareProjectSelect").html("")},$scope.shareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,projectReportService.getShareTo(projectId).success(function(data){$scope.updateState=!1,$("#shareProjectSelect").html(""),$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,data:data,tokenSeparators:[","," "]})})},$scope.saveShareProject=function(){var proId=$scope.shareProjectId,data=$("#shareProjectSelect").select2("data"),userNames="";$.each(data,function(id,value){userNames+=value.text+","}),userNames=userNames.toLowerCase(),userNames=userNames.substring(0,userNames.length-1),projectReportService.projectShare(proId,userNames).success(function(response){function hideModal(){$("#project-share-modal").modal("hide"),$scope.pageQuery(options.page,options.pageSize),$scope.updateState=!1}$scope.updateMessage=response.message,$scope.updateState=!0,response.success&&setTimeout(hideModal,1500)})},$scope.removePro=function(projectId){$.confirm("确定要删除该项目吗？","确认框",function(){projectReportService.deleteProject(projectId).success(function(flag){1==flag?($scope.pageQuery(1,options.pageSize),$.alert("项目报告删除成功")):$.alert("项目报告删除失败")})})},$scope.$on("reportLoadOver",function(){$("#_show").find(".projectContext").each(function(){var info=$.trim($(this).prev().html()).split(","),appId=info[0],appName=info[1],proId=info[2],userId=info[3],proName=$("#pnameSpan"+proId).html(),length=0,th_size=0,td_size=0,tr_size=$(this).find("tr").length;$(this).find("table").addClass("table table-main info-table data-report-table"),$(this).find("tr").each(function(j){0==j?th_size=$(this).children().length:td_size=$(this).children().length;var trc=$(this).children().length;"80"==appId&&(0==j&&(length=$(this).children().length),length>6&&j>1&&j%2==0&&($(this).addClass("_HCVTR"),$(this).css("display","none"),$(this).children().attr("colspan","7"),$(this).children().css("word-break","break-all"))),$(this).mouseover(function(){$(this).find("a").addClass("link_hover")}),$(this).mouseout(function(){$(this).find("a").removeClass("link_hover")}),$(this).find("td").each(function(i){if("90"==appId)if(1!=i)4==trc?0==i&&$(this).addClass("hide"):$(this).addClass("hide");else if($(this).css("border-left","none"),j>0){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if("128"==appId||"127"==appId||"126"==appId||"118"==appId||"117"==appId||"114"==appId||"113"==appId||"112"==appId||"111"==appId||"110"==appId||"109"==appId||"106"==appId||"107"==appId||"108"==appId||"105"==appId||"82"==appId||"84"==appId||"89"==appId||"73"==appId||"1"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId&&"126"!=appId&&"127"!=appId&&"128"!=appId&&(fileName=fileName.substring(0,30)+"..."),"114"!=appId&&"118"!=appId?$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+fileName+"</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"82"==appId&&"不敏感"==$(this).html()&&$(this).addClass("red")}if("91"==appId||"95"==appId||"92"==appId||"93"==appId||"94"==appId||"86"==appId||"87"==appId||"88"==appId||"81"==appId||"83"==appId||"85"==appId||"96"==appId||"97"==appId||"98"==appId||"99"==appId||"100"==appId||"101"==appId||"102"==appId||"103"==appId||"104"==appId||"116"==appId||"119"==appId||"120"==appId||"121"==appId||"122"==appId||"124"==appId||"125"==appId){if(j>0&&0==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).next().html()+"'>"+$(this).next().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().next().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if(1==i&&$(this).addClass("hide"),j>0&&(4==i||3==i)){var val=$(this).html();!isNaN(val)&&val>999&&$(this).html($.format(val,3,","))}}if("80"==appId){if(5==length){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","2")}if(7!=length&&8!=length||"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","5"),7==length)j>0&&j%2==1&&0==i&&($(this).addClass("sub"),$(this).html("<a id='dataSpan"+proId+$(this).html()+"'>"+$(this).html()+"</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link"));else if(8==length&&(1==i&&$(this).css("border-left","none"),0!=j&&j%2!=1||0!=i||$(this).addClass("hide"),j>0&&j%2==1&&1==i)){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link")}}if("11"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),
$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none")}td_size<th_size&&i==td_size-1&&$(this).attr("colspan",th_size-td_size+1)})});var minTdNum=5;"128"!=appId&&"127"!=appId&&"126"!=appId&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId||(minTdNum=4);var rdataNum=$("#rdataNum"+proId).html();if(("114"==appId||"118"==appId)&&tr_size-1<rdataNum){var num=Number(rdataNum)-tr_size+1,height=30*(5-tr_size),adHtml="<tr><td colspan='"+th_size+"' style='border-left-style: none;vertical-align: middle;height:"+height+"px' align='center'><img src='/celloud/images/report/running.png' title='正在运行...'/><br>"+num+"个数据正在运行...</td></tr>";$(this).find("tbody").append(adHtml)}else if(tr_size<minTdNum){var num=5-tr_size;for(i=0;i<num;i++){var adHtml="<tr>";for(j=0;j<th_size-1;j++)adHtml+="<td></td>";adHtml+="</tr>",$(this).find("tbody").append(adHtml)}}})})}),celloudApp.controller("dataReportController",function($scope,projectReportService,dataReportService){$scope.searchInfo=dataReportService.getSearchInfos(),$scope.reportList=dataReportService.getReports();var options={page:1,pageSize:20,beginDate:null,endDate:null,tagId:null,period:null,batch:null,condition:null,sort:"desc"},paramQuqery=function(){dataReportService.getReportsByParams(options.page,options.pageSize,options.condition,options.beginDate,options.endDate,options.batch,options.tagId,options.period,options.sort).success(function(dataList){$scope.reportList=dataList})};$scope.pageQuery=function(page,pageSize){options.page=page,options.pageSize=pageSize,paramQuqery()},$scope.tagsQuery=function(tagId){$(".tagsQuery").removeClass("active"),$("#tagsQuery"+tagId).addClass("active"),options.tagId=tagId,options.page=1,paramQuqery()},$scope.batchsQuery=function(batch){$(".batchsQuery").removeClass("active"),$("#batchsQuery"+batch).addClass("active"),options.batch=batch,options.page=1,paramQuqery()},$scope.periodQuery=function(period){$(".periodQuery").removeClass("active"),$("#periodQuery"+period).addClass("active"),options.period=period,options.page=1,paramQuqery()},$scope.fullDateQuery=function(days){if($(".fullDateQuery").removeClass("active"),$("#fullDateQuery"+days).addClass("active"),0==days)options.beginDate=null,options.endDate=null;else{var d=new Date,date=new Date(d.getTime()-864e5*days),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();options.beginDate=year+"-"+mounth+"-"+day+" 00:00:00",options.endDate=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59"}options.page=1,paramQuqery()},$scope.chooseDate=function(){$(".fullDateQuery").removeClass("active");var d=new Date,begin=$("#begin-date").val(),end=$("#end-date").val();return end=end?end:d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(),begin?begin>end?void $.tips("请确认开始时间  < 结束时间！","时间错误"):(options.beginDate=begin+" 00:00:00",options.endDate=end+" 23:59:59",options.page=1,void paramQuqery()):void $.tips("请选择开始时间！","时间错误")}})}(),!function(){celloudApp.service("mibReportService",function($resource,$http){var self=this;self.reportInfo=function(dataKey,projectId,appId){return $http.get("report/getMIBReportInfo",{params:{dataKey:dataKey,projectId:projectId,appId:appId}})}})}(),!function(){celloudApp.controller("mibReportController",function($scope,$routeParams,mibReportService){mibReportService.reportInfo($routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(mibInfo){$scope.mib=mibInfo.mib,console.log(eval(mibInfo.genusDistributionInfo)),void 0!=mibInfo.readsDistributionInfo&&$.reportChar.draw.circularGraph("reads-distribution-char","Reads","Distribution",mibInfo.readsDistributionInfo),void 0!=mibInfo.familyDistributionInfo&&$.reportChar.draw.circularGraph("family-distribution-char","Family","Distribution",mibInfo.familyDistributionInfo),void 0!=mibInfo.genusDistributionInfo&&$.reportChar.draw.singleBar("genus-distribution-char","Top 10 genus distribution","",mibInfo.genusDistributionInfo,"Depth","Depth")})})}(),!function(){celloudApp.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"pages/overview/overview.jsp"}).when("/user/base",{templateUrl:"pages/user/user_base.jsp",controller:"updateBaseInfo"}).when("/user/pwd",{templateUrl:"pages/user/user_pwdreset.jsp",controller:"updatePassword"}).when("/user/log",{templateUrl:"pages/user/user_log.jsp",controller:"pageQueryLog"}).when("/user/log/p:page",{templateUrl:"pages/user/user_log.jsp",controller:"pageQueryLog"}).when("/user/report",{templateUrl:"pages/user/user_reportset.jsp"}).when("/user/email",{templateUrl:"pages/user/user_emailreset.jsp",controller:"updateEmail"}).when("/user/set",{templateUrl:"pages/user/user_reportset.jsp",controller:"setReportController"}).when("/count",{templateUrl:"pages/count/count_main.jsp"}).when("/data",{templateUrl:"pages/data/data_list.jsp",controller:"dataListController"}).when("/expense/consume",{templateUrl:"pages/expense/expense_consume.jsp",controller:"pageQueryConsume"}).when("/expense/consume/p:page",{templateUrl:"pages/expense/expense_consume.jsp",controller:"pageQueryConsume"}).when("/expense/paydetail",{templateUrl:"pages/expense/expense_pay.jsp",controller:"toRecharge"}).when("/expense/paylist",{templateUrl:"pages/expense/expense_paylist.jsp",controller:"pageQueryRecharge"}).when("/expense/paylist/p:page",{templateUrl:"pages/expense/expense_paylist.jsp",controller:"pageQueryRecharge"}).when("/expense/invoice",{templateUrl:"pages/expense/expense_invoicelist.jsp",controller:"pageQueryInvoice"}).when("/expense/invoice/p:page",{templateUrl:"pages/expense/expense_invoicelist.jsp",controller:"pageQueryInvoice"}).when("/feedback",{templateUrl:"pages/feedback/feedback_main.jsp",controller:"feedbackController"}).when("/notices",{templateUrl:"pages/notice/notices.jsp",controller:"noticeController"}).when("/messages",{templateUrl:"pages/notice/messages.jsp",controller:"messageController"}).when("/message/setting",{templateUrl:"pages/notice/notice_set.jsp",controller:"settingController"}).when("/reportdata",{templateUrl:"pages/report/report_data.jsp",controller:"dataReportController"}).when("/reportpro",{templateUrl:"pages/report/report_project.jsp",controller:"projectReportController"}).when("/reportpro/EGFR/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_egfr.jsp",controller:"egfrDataReportController"}).when("/reportpro/KRAS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_kras.jsp",controller:"krasDataReportController"}).when("/reportpro/HCV_Genotype/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_hcv.jsp",controller:"hcvDataReportController"}).when("/reportpro/BRAF/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_braf.jsp",controller:"brafDataReportController"}).when("/reportpro/TB-Rifampicin/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_tbrifampicin.jsp",controller:"tbRifampicinDataReportController"}).when("/reportpro/TB-INH/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_tbinh.jsp",controller:"tbinhDataReportController"}).when("/reportpro/HBV_SNP2/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_hbv.jsp",controller:"hbvDataReportController"}).when("/reportpro/oncogene/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_oncogene.jsp",controller:"oncogeneDataReportController"}).when("/reportpro/DPD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_dpd.jsp",controller:"dpdDataReportController"}).when("/reportpro/ABI_NJ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_abinj.jsp",controller:"abinjDataReportController"}).when("/reportpro/UGT/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_ugt.jsp",controller:"ugtDataReportController"}).when("/reportpro/16S/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_16s.jsp",controller:"16sDataReportController"}).when("/reportpro/translate_simplified/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_translate.jsp",controller:"translateDataReportController"}).when("/reportpro/PGS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_pgs.jsp",controller:"pgsDataReportController"}).when("/reportpro/GDD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_gdd.jsp",controller:"gddDataReportController"}).when("/reportpro/AccuSeqΩ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_gdd.jsp",controller:"gddDataReportController"}).when("/reportpro/CMP/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportpro/AccuSeqα/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportpro/CMP_199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportpro/AccuSeqα199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportdata/split/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_split.jsp",controller:"splitDataReportController"}).when("/reportdata/BSI/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_bsi.jsp",controller:"bsiDataReportController"}).when("/reportdata/rocky/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_rocky.jsp",controller:"rockyDataReportController"}).when("/app",{templateUrl:"pages/app/app_main.jsp",controller:"toAppStore"}).when("/app/detail/:pid",{templateUrl:"pages/app/app_detail_main.jsp",controller:"toAppDetail"}).when("/reportdata/bsi",{templateUrl:"pages/report/report_data_bsi.jsp"}).when("/reportdata/MIB/:appId/:dataKey/:proId",{templateUrl:"pages/report/report_data_mib.jsp",controller:"mibReportController"}).when("/reportpro/MIB/:appId/:dataKey/:proId",{templateUrl:"pages/report/report_data_mib.jsp",controller:"mibReportController"}).when("/sampling",{templateUrl:"pages/experiment_scan/sampling.jsp",controller:"samplingController"}).when("/experiment/scanStorage",{templateUrl:"pages/experiment_scan/scan_storage.jsp",controller:"scanStorageController"}).when("/experiment/tokenDNA",{templateUrl:"pages/experiment_scan/token_dna.jsp",controller:"tokenDNAController"}).when("/experiment/createLibrary",{templateUrl:"pages/experiment_scan/create_library.jsp",controller:"buidLibraryController"}).when("/experiment/libraryList",{templateUrl:"pages/experiment_scan/library_list.jsp",controller:"storagesController"}).when("/experiment/libraryList/:ssId",{templateUrl:"pages/experiment_scan/library_detail.jsp",controller:"storagesController"}).otherwise({redirectTo:"/"})})}(),!function(){celloudApp.factory("tipsModalService",function(){$("#tips-modal").modal("show")}),celloudApp.service("commonService",function($resource){var self=this;self.getUserInfo=function(){return $resource("user/info")},self.messages=$resource("notice/lastUnread/message"),self.notices=$resource("notice/lastUnread/notice"),self.getProduct=function(){return $resource("app/getProduct?random="+(new Date).getTime())}})}(),!function(){var intro;celloudApp.controller("sidebarController",function($scope,$location,$rootScope,$timeout,commonService){$("#imageFullScreen").smartZoom({containerClass:"zoomableContainer"});var revise=$(document).width()-$(".sidebar-menu").width();$("#pageContent").css("width",revise+"px"),$(".sidebar-menu").resize(function(){revise=$(document).width()-$(this).width(),$("#pageContent").css("width",revise+"px")}),$rootScope.showZoom=function(src){var bh=$("body").height(),bw=$("body").width();$("#imageFullScreen").smartZoom({containerClass:"zoomableContainer"}),$("#imageFullScreen").attr("src",src),$("#fullbg").css({height:bh,width:bw,display:"block"}),$("#closeZoom").css("display","block"),$("#pageContent").show()},$rootScope.closeZoom=function(){$("#imageFullScreen").smartZoom("destroy"),$("#fullbg,#pageContent,#closeZoom").hide()},$rootScope.bigFigure=function(src){$("img[id='imageFullScreen']").css("width",960),$("img[id='imageFullScreen']").css("height",144),$rootScope.showZoom(src)},$rootScope.bigOrigin=function(src,id){var width=$("#"+id).width(),height=$("#"+id).height();$("img[id='imageFullScreen']").css("width",1.5*width),$("img[id='imageFullScreen']").css("height",1.5*height),$rootScope.showZoom(src)},$rootScope.bigReplace=function(src){$("img[id='imageFullScreen']").css("width",1050),$("img[id='imageFullScreen']").css("height",157.5),$rootScope.showZoom(src)},$scope.isActive=function(viewLocation){return"/"!=viewLocation?$location.path().indexOf(viewLocation)>=0:viewLocation===$location.path()},$rootScope.collapsed=!1,$scope.toggleCollapse=function(){$scope.collapsed?$scope.collapsed=!1:$scope.collapsed=!0},$rootScope.errorInfo="",$scope.refreshUserProduct=function(){$rootScope.userProduct=commonService.getProduct().get()},$rootScope.userProduct=commonService.getProduct().get(),$rootScope.userInfo=commonService.getUserInfo().get(),$rootScope.messages=commonService.messages.get(),$rootScope.notices=commonService.notices.get(),$rootScope.tipsModal=function(info){$rootScope.errorInfo=info,$("#tips-modal").modal("show")},$rootScope.changeChevronType=function(chevronType){return chevronType=!chevronType},$rootScope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p},messageUtils.subscribe("userMessage",function(data){$rootScope.messages=commonService.messages.get(),console.log("监听userMessage"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close()}})}),messageUtils.subscribe("userNotice",function(data){$rootScope.notices=commonService.notices.get(),console.log("监听userNotice"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close()}})}),$timeout(function(){1==window.navigation&&(intro=introJs(),intro.setOption("tooltipPosition","bottom"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.start())},1e3)})}(),!function(){celloudApp.filter("collapsedFilter",function(){return function(collapsed){return collapsed?"collapsed":""}}),celloudApp.filter("logoMiniFilter",function(){return function(collapsed){return collapsed?"mini":""}}),celloudApp.filter("collapsedIconFilter",function(){return function(collapsed){return collapsed?"right-indent-icon":"left-indent-icon"}}),celloudApp.filter("proSidebarLeftFilter",function(){return function(collapsed){return collapsed?"":"large-left"}}),celloudApp.filter("chevronTypeFaFilter",function(){return function(chevronType){return chevronType?"fa fa-chevron-down":"fa fa-chevron-up"}}),celloudApp.filter("chevronTypeTextFilter",function(){return function(chevronType){return chevronType?"更多":"收起"}}),celloudApp.filter("chevronTypeDivFilter",function(){return function(chevronType){return chevronType?"":"more"}}),celloudApp.filter("contextLengthFilter",function(){return function(context,length){return context.length<=length?context:context.substring(0,length)+"..."}}),celloudApp.filter("getResultByCompare",function(){return function(input,compare,r1,r2){return input!=compare?r1:r2}}),celloudApp.filter("fileSizeFormat",function(){return function(size){return 0==size?0:size<1024&&size>0?size+"B":size<1048576&&size>=1024?(temp=size/1024,temp.toFixed(2)+"KB"):size<1073741824&&size>=1048576?(temp=size/1048576,temp.toFixed(2)+"MB"):size>=1073741824?(temp=size/1073741824,temp.toFixed(2)+"GB"):"文件大小异常"}}),celloudApp.filter("trustHtml",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]),celloudApp.filter("taskPeriodFilter",function(){return function(period){return 0==period?"等待分析":1==period?"分析中":2==period?"完成":3==period?"数据不完整":4==period?"异常终止":5==period?"送样中":6==period?"实验中":""}})}(),!function(){celloudApp.service("loginCount",function($http){var self=this;self.loginCount=function(){return $http.get("count/loginCount")}})}(),!function(){celloudApp.controller("overviewCount",function($scope,loginCount){var width=($(window).width()-300)/2,height=width/2.5;$(".count-box-body").width(width),$(".count-box-body").height(height),$("body").scrollTop(0),loginCount.loginCount().success(function(response){$scope.map=response,userCount.fileDayCount(),userCount.fileMonthCount(),userCount.fileSizeDayCount(),userCount.fileSizeMonthCount(),userCount.reportDayCount(),userCount.reportMonthCount(),userCount.appDayCount(),userCount.appMonthCount()})})}(),require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}});var userCount=function(userCount){var self=userCount||{};return self.lineModal=function(id,legend,xdata,ydata,yname,unit){require(["echarts","echarts/chart/line"],function(ec){var myChart=ec.init(document.getElementById(id)),option={tooltip:{trigger:"axis",show:!0},legend:{data:[yname]},xAxis:[{type:"category",data:xdata}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"+("undefined"==typeof unit?"":unit)}}],series:[{name:yname,type:"line",data:ydata,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]}}]};myChart.setOption(option)})},self.fileDayCount=function(){$.get("count/fileDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-data-day-chart","日上传文件统计",eval(x),y,"日上传文件数量")})},self.fileMonthCount=function(){$.get("count/fileMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-data-month-chart","月上传文件统计",eval(x),y,"月上传文件数量"):$("#count-data-charts").hide()})},self.fileSizeDayCount=function(){$.get("count/fileSizeDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.substring(0,x.length-1),x+="]",self.lineModal("count-source-day-chart","日资源占用量统计",eval(x),y,"日上传文件大小",unit)})},self.fileSizeMonthCount=function(){$.get("count/fileSizeMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-source-month-chart","月资源占用量统计",eval(x),y,"月上传文件大小",unit):$("#count-source-charts").hide()})},self.reportDayCount=function(){$.get("count/reportDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-report-day-chart","日报告统计",eval(x),y,"日生成报告个数")})},self.reportMonthCount=function(){$.get("count/reportMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-report-month-chart","月报告统计",eval(x),y,"月生成报告个数"):$("#count-report-charts").hide()})},self.appDayCount=function(){$.get("count/appDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-app-day-chart","日已添加APP运行次数",eval(x),y,"日APP运行次数")})},self.appMonthCount=function(){$.get("count/appMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-app-month-chart","月已添加APP运行次数",eval(x),y,"月APP运行次数"):$("#count-app-charts").hide()})},self.dayMonthSwitch=function(idShow,idHide){$("#count-"+idShow+"-chart").removeClass("hide"),$("#"+idShow+"-span").addClass("active"),$("#count-"+idHide+"-chart").addClass("hide"),$("#"+idHide+"-span").removeClass("active")},self}(userCount);!function(){celloudApp.service("noticeService",function($resource){var actions={listNotices:{method:"get",params:{type:"notice",currentPage:"1",pageSize:"10"}},listMessage:{method:"get",params:{type:"message",currentPage:"1",pageSize:"10"}},read:{url:"notice/read",method:"post",params:{noticeIds:"@noticeIds"}},readNotices:{url:"notice/readAll/notice",method:"post"},readMessage:{url:"notice/readAll/message",method:"post"},deleteNotice:{url:"notice/delete",method:"post",params:{noticeIds:"@noticeIds"}}};return $resource("notice/list/:type",{},actions)}),celloudApp.service("messageService",function($resource,$http){this.getUserSetting=function(){return $resource("message/category/setting")},this.insertUserSetting=function(targetName,targetVal,relatId){return $http({method:"POST",url:"message/category/insert",data:$.param({targetName:targetName,targetVal:targetVal,relatId:relatId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.updateUserSetting=function(targetName,targetVal,relatId){return $http({method:"POST",url:"message/category/update",data:$.param({targetName:targetName,targetVal:targetVal,relatId:relatId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}(),!function(){celloudApp.controller("messageController",function($scope,$rootScope,noticeService,commonService){var pages={page:1,pageSize:10};$scope.removeState=!1,$scope.readState=!1;var checkedNotices=[];$scope.read=function(){var noticeIds=[];for(i in checkedNotices)0==checkedNotices[i].readState&&noticeIds.push(checkedNotices[i].noticeId);noticeService.read({noticeIds:noticeIds},function(){reload(null,null)})},$scope.changePage=function(page,pageSize){pages={page:page,pageSize:pageSize},noticeService.listMessage({currentPage:page,pageSize:pageSize},function(data){$scope.messages=data,$scope.chkall=!1,$scope.checkAllState=!1,checkedNotices=[],changeState()})},$scope.changePage(pages.page,pages.pageSize),$scope.readAll=function(){noticeService.readMessage(function(){reload(null,null)})},$scope.readMessage=function(){noticeService.readMessage(function(){reload(null,null)})},$scope.remove=function(){var noticeIds=[];for(i in checkedNotices)noticeIds.push(checkedNotices[i].noticeId);noticeService.deleteNotice({noticeIds:noticeIds},function(){reload(1,null)})},$scope.checkAll=function(state){state?($scope.chkall=!0,checkedNotices=$scope.messages.datas):($scope.chkall=!1,checkedNotices=[]),changeState()},$scope.checkOne=function(notice,state){alert(state),state?checkedNotices.push(notice):checkedNotices=removeNotice(checkedNotices,notice),changeState()};var changeState=function(){$scope.removeState=checkedNotices.length>0;var flag=!1;for(i in checkedNotices)if(0==checkedNotices[i].readState){flag=!0;break}$scope.readState=flag},removeNotice=function(notices,notice){var index=-1;for(i in notices)if(notices[i].noticeId==notice.noticeId){index=i;break}return index!=-1&&notices.splice(index,1),notices},reload=function(page,pageSize){$scope.messages=noticeService.listMessage({currentPage:page||pages.page,pageSize:pageSize||pages.pageSize}),checkedNotices=[],$rootScope.messages=commonService.messages.get(),changeState()}}),celloudApp.controller("settingController",function($scope,messageService){$scope.userMessageCategoryList=messageService.getUserSetting().query(),$scope.updateMessageCategory=function(flag,mcId,targetName,targetVal){var index=this.$index;0==flag?messageService.insertUserSetting(targetName,targetVal,mcId).success(function(data){$scope.userMessageCategoryList[index].flag=1,$scope.userMessageCategoryList[index][targetName.toLocaleLowerCase()]=targetVal}):messageService.updateUserSetting(targetName,targetVal,mcId).success(function(data){$scope.userMessageCategoryList[index][targetName.toLocaleLowerCase()]=targetVal})}})}(),!function(){celloudApp.controller("noticeController",function($scope,$rootScope,noticeService,commonService){var pages={page:1,pageSize:10};$scope.noticeRemoveState=!1,$scope.noticeReadState=!1;var checkedNotices=[];$scope.changePage=function(page,pageSize){pages={page:page,pageSize:pageSize},noticeService.listNotices({currentPage:page,pageSize:pageSize},function(data){$scope.notices=data,checkedNotices=[],$scope.chkall=!1,$scope.checkNoticeAllState=!1,changeNoticeState()})},$scope.changePage(pages.page,pages.pageSize),$scope.readNotices=function(){var noticeIds=[];for(i in checkedNotices)0==checkedNotices[i].readState&&noticeIds.push(checkedNotices[i].noticeId);noticeService.read({noticeIds:noticeIds},function(){reload(null,null)})},$scope.readAllNotices=function(){noticeService.readNotices(function(){reload(null,null)})},$scope.deleteNotice=function(){var noticeIds=[];for(i in checkedNotices)noticeIds.push(checkedNotices[i].noticeId);noticeService.deleteNotice({noticeIds:noticeIds},function(){reload(1,null)})},$scope.checkNoticeAll=function(state){state?($scope.chkall=!0,checkedNotices=$scope.notices.datas):($scope.chkall=!1,checkedNotices=[]),changeNoticeState()},$scope.checkNoticeOne=function(notice,state){state?checkedNotices.push(notice):checkedNotices=removeNotice(checkedNotices,notice),changeNoticeState()};var changeNoticeState=function(){$scope.noticeRemoveState=checkedNotices.length>0;var flag=!1;for(i in checkedNotices)if(0==checkedNotices[i].readState){flag=!0;break}$scope.noticeReadState=flag},removeNotice=function(notices,notice){var index=-1;for(i in notices)if(notices[i].noticeId==notice.noticeId){index=i;break}return index!=-1&&notices.splice(index,1),notices},reload=function(page,pageSize){$scope.notices=noticeService.listNotices({currentPage:page||pages.page,pageSize:pageSize||pages.pageSize}),checkedNotices=[],$rootScope.notices=commonService.notices.get(),changeNoticeState()}})}(),!function(){celloudApp.service("feedbackService",function($resource){var actions={listAll:{method:"get"},reply:{url:"feedback/reply/:id",method:"put",params:{id:"@id",content:"@content"}},solve:{url:"feedback/solve/:id",method:"post",params:{id:"@id"}},list:{url:"feedback/list",method:"get"},save:{url:"feedback/create",method:"put",params:{title:"@title",content:"@content",attachList:"@attachments"}},deleteAttach:{url:"feedback/attach/delete",method:"post",params:{name:"@name",_method:"delete",attachId:"@attachId"}}};return $resource("feedback/:id",{id:"@id"},actions)})}(),!function(){celloudApp.controller("feedbackController",function($scope,feedbackService){var loadFeedbacks=function(){$scope.feedbacks=feedbackService.list(function(data){data.datas.length>0&&$scope.change(data.datas[0].id)})};loadFeedbacks(),$scope.change=function(id){$scope.current=feedbackService.get({id:id})},$scope.solve=function(id){feedbackService.solve({id:id},function(){$scope.change(id)})},$scope.reply=function(id,content){content&&feedbackService.reply({id:id,content:content},function(){$scope.change(id),$scope.replyContent=""})},$scope.replyKeyUp=function($event){13==$event.keyCode&&$scope.reply($scope.current.id,$scope.replyContent)},$scope.saveFeedback=function(isValid){isValid&&feedbackService.save({title:$scope.unsavedFeedback.title,content:$scope.unsavedFeedback.content,attachments:$scope.unsavedAttachments},function(){$scope.unsavedAttachments=[],$("#new-qa-modal").modal("hide"),loadFeedbacks(),$scope.resetCreateForm()})},$scope.resetCreateForm=function(){$scope.unsavedFeedback=angular.copy({}),$scope.unsavedAttachments=[],unsaveUploader.splice(0,unsaveUploader.files.length)},$scope.deleteAttach=function(attachId,name){feedbackService.deleteAttach({name:name,attachId:attachId},function(data){$.alert(data.message),$("#attachmentModal").modal("hide"),$scope.currentAttach=null,$scope.change($scope.current.id)})},$scope.showAttach=function(attach){$scope.currentAttach=attach,$("#attachmentModal").modal("show")};var initUploader=function(button){var uploader=new plupload.Uploader({browse_button:button,url:"../feedback/attach",chunk_size:"2mb",file_data_name:"file",filters:{max_file_size:"2mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}]},multi_selection:!1,flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",init:{FilesAdded:function(uploader,files){uploader.start()},QueueChanged:function(uploader){uploader.disableBrowse(uploader.files.length>=5)}}});return uploader},unsaveUploader=initUploader("unsavedAttachmentUploadBtn");unsaveUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name})}),unsaveUploader.bind("FileUploaded",function(uploader,file,response){var attachments=$scope.unsavedAttachments||[];attachments.push(response.response),$scope.unsavedAttachments=attachments,$scope.$apply()}),unsaveUploader.init();var savedUploader=initUploader("attachmentUploadBtn");savedUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name,feedbackId:$scope.current.id})}),savedUploader.bind("FileUploaded",function(uploader,file,response){$scope.change($scope.current.id)}),savedUploader.init()})}();
function _init(){$.AdminLTE.layout={activate:function(){var _this=this;_this.fix(),_this.fixSidebar(),$(window,".wrapper").resize(function(){_this.fix(),_this.fixSidebar()})},fix:function(){var neg=$(".main-header").outerHeight()+$(".main-footer").outerHeight(),window_height=$(window).height(),sidebar_height=$(".main-sidebar").height();if($("body").hasClass("fixed"))$(".content-wrapper, .right-side").css("min-height",window_height-$(".main-footer").outerHeight());else{var postSetWidth;window_height>=sidebar_height?($(".content-wrapper, .right-side").css("min-height",window_height),postSetWidth=window_height-neg):($(".content-wrapper, .right-side").css("min-height",sidebar_height),postSetWidth=sidebar_height);var controlSidebar=$($.AdminLTE.options.controlSidebarOptions.selector);"undefined"!=typeof controlSidebar&&controlSidebar.height()>postSetWidth&&$(".content-wrapper, .right-side").css("min-height",controlSidebar.height())}},fixSidebar:function(){return $("body").hasClass("fixed")?("undefined"==typeof $.fn.slimScroll&&console&&console.error("Error: the fixed layout requires the slimscroll plugin!"),void($.AdminLTE.options.sidebarSlimScroll&&"undefined"!=typeof $.fn.slimScroll&&($(".sidebar").slimScroll({destroy:!0}).height("auto"),$(".sidebar").slimscroll({height:$(window).height()-$(".main-header").height()+"px",color:"rgba(0,0,0,0.2)",size:"3px"})))):void("undefined"!=typeof $.fn.slimScroll&&$(".sidebar").slimScroll({destroy:!0}).height("auto"))}},$.AdminLTE.closeSidebar=function(){var screenSizes=$.AdminLTE.options.screenSizes;$(window).width()>screenSizes.sm-1&&$("body").addClass("sidebar-collapse")},$.AdminLTE.pushMenu={activate:function(toggleBtn){var screenSizes=$.AdminLTE.options.screenSizes;$(toggleBtn).on("click",function(e){e.preventDefault(),$(window).width()>screenSizes.sm-1?$("body").toggleClass("sidebar-collapse"):$("body").hasClass("sidebar-open")?($("body").removeClass("sidebar-open"),$("body").removeClass("sidebar-collapse")):$("body").addClass("sidebar-open")}),$(".content-wrapper").click(function(){$(window).width()<=screenSizes.sm-1&&$("body").hasClass("sidebar-open")&&$("body").removeClass("sidebar-open")}),($.AdminLTE.options.sidebarExpandOnHover||$("body").hasClass("fixed")&&$("body").hasClass("sidebar-mini"))&&this.expandOnHover()},expandOnHover:function(){var _this=this,screenWidth=$.AdminLTE.options.screenSizes.sm-1;$(".main-sidebar").hover(function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-collapse")&&$(window).width()>screenWidth&&_this.expand()},function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-expanded-on-hover")&&$(window).width()>screenWidth&&_this.collapse()})},expand:function(){$("body").removeClass("sidebar-collapse").addClass("sidebar-expanded-on-hover")},collapse:function(){$("body").hasClass("sidebar-expanded-on-hover")&&$("body").removeClass("sidebar-expanded-on-hover").addClass("sidebar-collapse")}},$.AdminLTE.tree=function(menu){var _this=this;$("li a",$(menu)).on("click",function(e){var $this=$(this),checkElement=$this.next();if($(".treeview").removeClass("active"),$this.parent("li").addClass("active"),checkElement.is(".treeview-menu")&&checkElement.is(":visible"))checkElement.slideUp("normal",function(){checkElement.removeClass("menu-open")}),checkElement.parent("li").removeClass("active");else if(checkElement.is(".treeview-menu")&&!checkElement.is(":visible")){var parent=$this.parents("ul").first(),ul=parent.find("ul:visible").slideUp("normal");ul.removeClass("menu-open");var parent_li=$this.parent("li");checkElement.slideDown("normal",function(){checkElement.addClass("menu-open"),parent.find("li.active").removeClass("active"),parent_li.addClass("active"),_this.layout.fix()})}checkElement.is(".treeview-menu")&&e.preventDefault()})},$.AdminLTE.controlSidebar={activate:function(){var _this=this,o=$.AdminLTE.options.controlSidebarOptions,sidebar=$(o.selector),btn=$(o.toggleBtnSelector);btn.on("click",function(e){e.preventDefault(),sidebar.hasClass("control-sidebar-open")||$("body").hasClass("control-sidebar-open")?_this.close(sidebar,o.slide):_this.open(sidebar,o.slide)});var bg=$(".control-sidebar-bg");_this._fix(bg),$("body").hasClass("fixed")?_this._fixForFixed(sidebar):$(".content-wrapper, .right-side").height()<sidebar.height()&&_this._fixForContent(sidebar)},open:function(sidebar,slide){slide?sidebar.addClass("control-sidebar-open"):$("body").addClass("control-sidebar-open")},close:function(sidebar,slide){slide?sidebar.removeClass("control-sidebar-open"):$("body").removeClass("control-sidebar-open")},_fix:function(sidebar){var _this=this;$("body").hasClass("layout-boxed")?(sidebar.css("position","absolute"),sidebar.height($(".wrapper").height()),$(window).resize(function(){_this._fix(sidebar)})):sidebar.css({position:"fixed",height:"auto"})},_fixForFixed:function(sidebar){sidebar.css({position:"fixed","max-height":"100%",overflow:"auto","padding-bottom":"50px"})},_fixForContent:function(sidebar){$(".content-wrapper, .right-side").css("min-height",sidebar.height())}},$.AdminLTE.boxWidget={selectors:$.AdminLTE.options.boxWidgetOptions.boxWidgetSelectors,icons:$.AdminLTE.options.boxWidgetOptions.boxWidgetIcons,activate:function(){var _this=this;$(_this.selectors.collapse).on("click",function(e){e.preventDefault(),_this.collapse($(this))}),$(_this.selectors.remove).on("click",function(e){e.preventDefault(),_this.remove($(this))})},collapse:function(element){var _this=this,box=element.parents(".box").first(),box_content=box.find("> .box-body, > .box-footer");box.hasClass("collapsed-box")?(element.children(":first").removeClass(_this.icons.open).addClass(_this.icons.collapse),box_content.slideDown(300,function(){box.removeClass("collapsed-box")})):(element.children(":first").removeClass(_this.icons.collapse).addClass(_this.icons.open),box_content.slideUp(300,function(){box.addClass("collapsed-box")}))},remove:function(element){var box=element.parents(".box").first();box.slideUp()}}}$.AdminLTE={},$.AdminLTE.options={navbarMenuSlimscroll:!0,navbarMenuSlimscrollWidth:"3px",navbarMenuHeight:"200px",sidebarToggleSelector:"[data-toggle='offcanvas']",sidebarPushMenu:!0,sidebarSlimScroll:!0,sidebarExpandOnHover:!1,enableBoxRefresh:!0,enableBSToppltip:!0,BSTooltipSelector:"[data-toggle='tooltip']",enableControlSidebar:!0,controlSidebarOptions:{toggleBtnSelector:"[data-toggle='control-sidebar']",selector:".control-sidebar",slide:!0},enableBoxWidget:!0,boxWidgetOptions:{boxWidgetIcons:{collapse:"fa-minus",open:"fa-plus",remove:"fa-times"},boxWidgetSelectors:{remove:'[data-widget="remove"]',collapse:'[data-widget="collapse"]'}},screenSizes:{xs:480,sm:768,md:992,lg:1200}},$(function(){"undefined"!=typeof AdminLTEOptions&&$.extend(!0,$.AdminLTE.options,AdminLTEOptions);var o=$.AdminLTE.options;_init(),$.AdminLTE.layout.activate(),$.AdminLTE.tree(".sidebar"),o.enableControlSidebar&&$.AdminLTE.controlSidebar.activate(),o.navbarMenuSlimscroll&&"undefined"!=typeof $.fn.slimscroll&&$(".navbar .menu").slimscroll({height:o.navbarMenuHeight,alwaysVisible:!1,size:o.navbarMenuSlimscrollWidth}).css("width","100%"),o.sidebarPushMenu&&$.AdminLTE.pushMenu.activate(o.sidebarToggleSelector),o.enableBSToppltip&&$("body").tooltip({selector:o.BSTooltipSelector}),o.enableBoxWidget&&$.AdminLTE.boxWidget.activate(),o.enableFastclick&&"undefined"!=typeof FastClick&&FastClick.attach(document.body),$('.btn-group[data-toggle="btn-toggle"]').each(function(){var group=$(this);$(this).find(".btn").on("click",function(e){group.find(".btn.active").removeClass("active"),$(this).addClass("active"),e.preventDefault()})})}),function($){$.fn.boxRefresh=function(options){function start(box){box.append(overlay),settings.onLoadStart.call(box)}function done(box){box.find(overlay).remove(),settings.onLoadDone.call(box)}var settings=$.extend({trigger:".refresh-btn",source:"",onLoadStart:function(box){},onLoadDone:function(box){}},options),overlay=$('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');return this.each(function(){if(""===settings.source)return void(console&&console.log("Please specify a source first - boxRefresh()"));var box=$(this),rBtn=box.find(settings.trigger).first();rBtn.on("click",function(e){e.preventDefault(),start(box),box.find(".box-body").load(settings.source,function(){done(box)})})})}}(jQuery);
var notices=function(object){var self=object||{},page={message:{currentPage:1,pageSize:10},notice:{currentPage:1,pageSize:10}};return self.pageMessage=function(currentPage,pageSize){pageSize=pageSize||10,page.message.currentPage=currentPage,page.message.pageSize=pageSize;var url=CONTEXT_PATH+"/notice/list/message";$("#userMessage").load(url+" #userMessage",{currentPage:currentPage,pageSize:pageSize})},self.pageNotice=function(currentPage,pageSize){pageSize=pageSize||5,page.notice.currentPage=currentPage,page.notice.pageSize=pageSize;var url=CONTEXT_PATH+"/notice/list/notice";$("#userNotice").load(url+" #userNotice",{currentPage:currentPage,pageSize:pageSize},function(){self.showNotice()})},self.showUserMessage=function(){$("#userMessageTab").siblings().removeClass("active"),$("#userMessageTab").addClass("active"),$("#userMessage").siblings().addClass("hide"),$("#userMessage").removeClass("hide"),$("#subtitle").html("系统消息"),self.pageMessage()},self.showUserNotice=function(){$("#userNoticeTab").siblings().removeClass("active"),$("#userNoticeTab").addClass("active"),$("#userNotice").siblings().addClass("hide"),$("#userNotice").removeClass("hide"),$("#subtitle").html("站内消息"),self.pageNotice()},self.showNotice=function(noticeId){var $noticeBtn=null;noticeId?$noticeBtn=$("#userNotice .list-group button.list-group-item[_data_notice_id='"+noticeId+"']"):($noticeBtn=$("#userNotice .list-group button.list-group-item:first"),noticeId=$noticeBtn.attr("_data_notice_id")),$noticeBtn.addClass("bg-gray");var $badge=$noticeBtn.find(".badge");$badge.removeClass("fa-folder-o"),$badge.addClass("fa-folder-open-o"),$badge.addClass("bg-gray"),$noticeBtn.removeClass("unread"),$noticeBtn.siblings().removeClass("bg-gray"),$("#noticeDetail").load(CONTEXT_PATH+"/notice/detail",{noticeId:noticeId},function(data){$("#notices-menu").load(CONTEXT_PATH+"/notice/lastUnread/notice")})},self.deleteNotice=function(noticeId){window.confirm("确定要删除这条站内消息吗？")&&$.post(CONTEXT_PATH+"/notice/delete",{noticeIds:noticeId},function(response){response.success&&self.pageNotice(page.notice.currentPage,page.notice.pageSize)})},self.readMessage=function(){$.post(CONTEXT_PATH+"/notice/read",$("#messageListForm").serialize(),function(response){response.success&&(self.pageMessage(page.message.currentPage,page.message.pageSize),$("#messages-menu").load(CONTEXT_PATH+"/notice/lastUnread/message"))})},self.readAllMessage=function(){$.post(CONTEXT_PATH+"/notice/readAll/message",{},function(response){response.success&&(self.pageMessage(page.message.currentPage,page.message.pageSize),$("#messages-menu").load(CONTEXT_PATH+"/notice/lastUnread/message"))})},self.readAllNotice=function(){$.post(CONTEXT_PATH+"/notice/readAll/notice",{},function(response){response.success&&(self.pageNotice(page.message.currentPage,page.message.pageSize),$("#messages-menu").load(CONTEXT_PATH+"/notice/lastUnread/notice"))})},self.deleteMessage=function(){window.confirm("确定要删除选中的所有消息吗？")&&$.post(CONTEXT_PATH+"/notice/delete",$("#messageListForm").serialize(),function(response){response.success&&(self.pageMessage(page.message.currentPage,page.message.pageSize),$("#messages-menu").load(CONTEXT_PATH+"/notice/lastUnread/message"))})},$(".mainpage").on("click","#messageListCheckAll",function(){$(this).is(":checked")?$("#messageListForm [name='noticeIds']").prop("checked",!0):$("#messageListForm [name='noticeIds']").removeAttr("checked"),$("#messageListForm [name='noticeIds']:first").change()}),$(".mainpage").on("click","#messageListForm [name='noticeIds']",function(){$(this).is(":checked")?0==$("#messageListForm input[name='noticeIds']:not(:checked)").length&&$("#messageListCheckAll").prop("checked",!0):$("#messageListCheckAll").removeAttr("checked")}),$(".mainpage").on("change","#messageListForm [name='noticeIds']",function(){0!=$("#messageListForm input[name='noticeIds']:checked").length?$("#messageDeleteBtn").removeAttr("disabled"):$("#messageDeleteBtn").attr("disabled","disabled"),0!=$("#messageListForm tr[read-state='0'] input[name='noticeIds']:checked").length?$("#messageReadBtn").removeAttr("disabled"):$("#messageReadBtn").attr("disabled","disabled")}),$(".create-switch").bootstrapSwitch({onColor:"success",offColor:"danger",onText:"开",offText:"关",onSwitchChange:function(event,state){var flag=$(this).parents("tr").find("input[name='flag']").val();if(0==flag){var $tr=$(this).parents("tr"),obj0=$tr.find("input:eq(0)"),email=1==obj0.prop("disabled")?2:0==obj0.prop("checked")?0:1,obj1=$tr.find("input:eq(1)"),window=1==obj1.prop("disabled")?2:0==obj1.prop("checked")?0:1,obj2=$tr.find("input:eq(2)"),wechat=1==obj2.prop("disabled")?2:0==obj2.prop("checked")?0:1,messageCategoryId=$tr.find("input:eq(3)").val(),data=email+","+window+","+wechat+","+messageCategoryId;$.post("message/category/insert",{data:data},function(data){data>0&&$tr.find("input[name='flag']").val(1)})}else{var targetName=$(this).attr("name"),targetVal=0==$(this).prop("checked")?0:1,relatId=$(this).parents("tr").find("input[name='messageCategoryId']").val();$.post("message/category/update",{targetName:targetName,targetVal:targetVal,relatId:relatId},function(data){})}}}),self}(notices);
function checkPeriod(projectId){$.get("report/checkPgsProject",{projectId:projectId},function(flag){return 3==flag||(jAlert("该项目尚未运行完毕"),!1)})}function downPDF(userId,appId,projectId){var path=userId+"/"+appId+"/"+projectId+"/"+projectId+".pdf";$.get("report/down",{path:path},function(flag){if(1==flag)jAlert("没有可以下载的pdf文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"report/down?path="+path}})}function initReportDetail(){submitSearch();var _num=0;$.get("app/getRanAPP",function(appList){var total=appList.length,context="";if(total<9){for(var i=0;i<total;i++){var id=appList[i].app_id,name=appList[i].app_name;_num>1&&_num%8==0&&(context+="<br/>"),_num++,context+=APP==id?"<a href='javascript:void(0)' class='capp _appred' onclick='changeApp("+id+",this)' id='_app"+id+"'>"+name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;":"<a href='javascript:void(0)' class='capp' onclick='changeApp("+id+",this)' id='_app"+id+"'>"+name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;"}$("#showMore").attr("style","display:none"),$("#showAppDiv").html(context)}else{for(var i=0;i<8;i++){var id=appList[i].app_id,name=appList[i].app_name;_num>1&&_num%8==0&&i>0&&(context+="<br/>"),_num++,context+=APP==id?"<a href='javascript:void(0)' class='capp _appred' onclick='changeApp("+id+",this)' id='_app"+id+"'>"+name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;":"<a href='javascript:void(0)' class='capp' onclick='changeApp("+id+",this)' id='_app"+id+"'>"+name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;"}context+="</div>",$("#showAppDiv").html(context),context="<div class='moreApp' style='margin-top:-20px;margin-left: 80px;'>",_num=0;for(var i=8;i<appList.length;i++){var id=appList[i].app_id,name=appList[i].app_name;_num%9==0&&(context+="<br/>"),_num++,context+=APP==id?"<a href='javascript:void(0)' class='capp _appred' onclick='changeApp("+id+",this)' id='_app"+id+"'>"+name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;":"<a href='javascript:void(0)' class='capp' onclick='changeApp("+id+",this)' id='_app"+id+"'>"+name+"</a>&nbsp;&nbsp;&nbsp;&nbsp;"}context+="</div>",$("#appList").html(context)}})}function toProjectReport(){$.main.show.mainDIV()}function cancelProjectShare(projectId){jConfirm("确定删除该分享来的项目报告吗？","确认提示框",function(r){r&&$.get("project/deleteShare",{projectId:projectId},function(response){response?(currentPage=1,submitSearch()):jAlert("删除分享来的项目报告失败")})})}function removePro(proId){jConfirm("确定删除该项目报告吗？","确认提示框",function(r){r&&$.get("project/deleteByState",{projectId:proId},function(flag){1==flag?(currentPage=1,submitSearch()):jAlert("项目报告删除失败")})})}function showConclusion(){$("#conclusion-error").addClass("hide"),$("#reportConclusion").find("input:radio[name='qualified']:checked").attr("checked",!1),$("#reportConclusion").find("textarea[name='remarks']").val(""),$("#reportConclusion").modal("show")}function saveConclusion(){var qualified=$("#reportConclusion").find("input:radio[name='qualified']:checked").val();return qualified?void $.get("experiment/updateExperiment",$("#reportConclusionForm").serialize(),function(flag){1==flag?(showAddError("保存成功，请重新打开数据报告！"),setTimeout("hidModal('reportConclusion')",5e3)):showAddError("保存失败！")}):void showAddError("请选择是否合格！")}function hidModal(id){$("#"+id).modal("hide")}function showAddError(info){$("#conclusionErrorInfo").html(info),$("#conclusion-error").removeClass("hide")}function editShowConclusion(){$("#edit-conclusion-error").addClass("hide"),$("#editReportConclusion").modal("show")}function editSaveConclusion(){var qualified=$("#editReportConclusion").find("input:radio[name='qualified']:checked").val();if(!qualified)return void showEdditError("请选择是否合格！");var remarks=$("#editReportConclusion").find("textarea[name='remarks']").val();return remarks.length>125?void showEdditError("备注长度不能大于125个字符！！"):void $.get("experiment/updateExperiment",$("#editReportConclusionForm").serialize(),function(flag){1==flag?(showEdditError("保存成功，请重新打开数据报告！"),setTimeout("hidModal('editReportConclusion')",5e3)):showEdditError("保存失败！")})}function showEdditError(info){$("#edit-conclusionErrorInfo").html(info),$("#edit-conclusion-error").removeClass("hide")}function changeFileName(){FILENAME=$("#_fileName").val(),currentPage=1}function changeDate(flag,obj){if($(".cdate").removeClass("_datered"),"allTime"==flag)$("#_searchDate").val(""),$("#_endDate").val(""),$(obj).addClass("_datered"),START=null,END=null,isTIMETRUE=!0;else if(0!=flag){$("#_searchDate").val(""),$("#_endDate").val(""),$(obj).addClass("_datered");var d=new Date,date=new Date(d.getTime()+864e5*flag),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();START=year+"-"+mounth+"-"+day,END=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(),isTIMETRUE=!0}else isTIMETRUE=!1;$("#_alertSpan").css("display","none"),$("#_alertSpan").html(""),currentPage=1,null!=START&&(START+=" 00:00:00"),null!=END&&(END+=" 23:59:59"),isTIMETRUE&&submitSearch()}function changeApp(appId,obj){$(".capp").removeClass("_appred"),$(obj).addClass("_appred"),APP=appId,currentPage=1,submitSearch()}function changeBelongs(belongs,obj){$(".belongs").removeClass("_datered"),$(obj).addClass("_datered"),BELONGS=belongs,currentPage=1,submitSearch()}function changePageSize(){pageSize=$("#proPageRecordSel").val(),currentPage=1,submitSearch()}function changePage(page){currentPage=page,submitSearch()}function submitSearch(){if(!isTIMETRUE){if(START=$("#_searchDate").val(),END=$("#_endDate").val(),!START&&END||START&&!END)return $("#_alertSpan").css("display",""),void $("#_alertSpan").html("请同时选择起始时间和结束时间");if(START>END)return $("#_alertSpan").css("display",""),void $("#_alertSpan").html("起始日期不能大于结束日期");null!=START&&""!=START&&(START+=" 00:00:00"),null!=END&&""!=END&&(END+=" 23:59:59")}var pattern=/[`~!@#\$%\^\&\*\(\)\+<>\?:"\{\},\.\\\/;'\[\]]/im;if(pattern.test(FILENAME))return $("#_dataAlertSpan").css("display",""),void $("#_dataAlertSpan").html("输入框禁止输入特殊字符");$("#_dataAlertSpan").css("display","none"),$("#_dataAlertSpan").html(""),spinner=new Spinner(opts);var target=document.getElementById("reportLoading");spinner.spin(target),$.get("report/getReportPageList",{belongs:BELONGS,appId:APP,start:START,end:END,condition:FILENAME,size:pageSize,page:currentPage},function(responseText){$("#selfReportDiv").html(responseText),$("body").scrollTop(0),loadReportList(),spinner.stop()})}function loadReportList(){$("#_show").find(".no").each(function(){var info=$.trim($(this).prev().html()).split(","),appId=info[0],appName=info[1],proId=info[2],userId=info[3],proName=$("#pnameSpan"+proId).html(),length=0,th_size=0,td_size=0,tr_size=$(this).find("tr").length;$(this).find("tr").each(function(j){0==j?th_size=$(this).children().length:td_size=$(this).children().length;var trc=$(this).children().length;"80"==appId&&(0==j&&(length=$(this).children().length),length>6&&j>1&&j%2==0&&($(this).addClass("_HCVTR"),$(this).css("display","none"),$(this).children().attr("colspan","7"),$(this).children().css("word-break","break-all"))),$(this).mouseover(function(){$(this).find("span").addClass("link_hover")}),$(this).mouseout(function(){$(this).find("span").removeClass("link_hover")}),$(this).find("td").each(function(i){if("90"==appId)if(param={fileName:$.trim($(this).html()),dataKey:$.trim($(this).prev().html()),softwareId:appId,softwareName:appName,userId:userId,obj:$(this),proId:proId,proName:proName},1!=i)4==trc?0==i&&$(this).addClass("none"):$(this).addClass("none");else if($(this).css("border-left","none"),j>0){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<span id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</span>"),$(this).find("span").bind("click",param,viewDataReport),$(this).find("span").addClass("link")}if("128"==appId||"127"==appId||"126"==appId||"118"==appId||"117"==appId||"114"==appId||"113"==appId||"112"==appId||"111"==appId||"110"==appId||"109"==appId||"106"==appId||"107"==appId||"108"==appId||"105"==appId||"82"==appId||"84"==appId||"89"==appId||"73"==appId||"1"==appId){if(param={fileName:$.trim($(this).html()),dataKey:$.trim($(this).prev().html()),softwareId:appId,softwareName:appName,userId:userId,obj:$(this),proId:proId,proName:proName},j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId&&"126"!=appId&&"127"!=appId&&"128"!=appId&&(fileName=fileName.substring(0,30)+"..."),"114"!=appId&&"118"!=appId?$(this).html("<span id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</span>"):$(this).html("<span id='dataSpan"+proId+$(this).prev().html()+"'>"+fileName+"</span>"),$(this).find("span").bind("click",param,viewDataReport),$(this).find("span").addClass("link")}0==i&&$(this).addClass("none"),1==i&&$(this).css("border-left","none"),"82"==appId&&"不敏感"==$(this).html()&&$(this).addClass("red")}if("91"==appId||"95"==appId||"92"==appId||"93"==appId||"94"==appId||"86"==appId||"87"==appId||"88"==appId||"81"==appId||"83"==appId||"85"==appId||"96"==appId||"97"==appId||"98"==appId||"99"==appId||"100"==appId||"101"==appId||"102"==appId||"103"==appId||"104"==appId||"116"==appId||"119"==appId||"120"==appId||"121"==appId||"122"==appId||"124"==appId||"125"==appId){if(j>0&&0==i){param={fileName:$.trim($(this).html()),dataKey:$.trim($(this).next().html()),softwareId:appId,softwareName:appName,userId:userId,obj:$(this),proId:proId,proName:proName},$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<span id='dataSpan"+proId+$(this).next().html()+"'>"+$(this).next().html()+" （"+fileName+"）</span>"),$(this).find("span").bind("click",param,viewDataReport),$(this).find("span").addClass("link")}if(1==i&&$(this).addClass("none"),j>0&&(4==i||3==i)){var val=$(this).html();!isNaN(val)&&val>999&&$(this).html($.format(val,3,","))}}if("80"==appId){if(5==length){if(param={fileName:$.trim($(this).html()),dataKey:$.trim($(this).prev().html()),softwareId:appId,softwareName:appName,userId:userId,obj:$(this),proId:proId,proName:proName},j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<span id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</span>"),$(this).find("span").bind("click",param,viewDataReport),$(this).find("span").addClass("link")}0==i&&$(this).addClass("none"),1==i&&$(this).css("border-left","none"),"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","2")}if(7!=length&&8!=length||"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","5"),7==length)j>0&&j%2==1&&0==i&&($(this).addClass("sub"),$(this).html("<span id='dataSpan"+proId+$(this).html()+"'>"+$(this).html()+"</span>"),$(this).find("span").bind("click",viewNext),$(this).find("span").addClass("link"));else if(8==length&&(1==i&&$(this).css("border-left","none"),0!=j&&j%2!=1||0!=i||$(this).addClass("none"),j>0&&j%2==1&&1==i)){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<span id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</span>"),$(this).find("span").bind("click",viewNext),$(this).find("span").addClass("link")}}if("11"==appId){if(param={fileName:$.trim($(this).html()),projectId:proId,softwareId:appId,softwareName:appName,userId:userId,obj:$(this),proId:proId,proName:proName,dataKey:$(this).prev().html()},j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<span id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</span>"),$(this).find("span").bind("click",param,viewDataReport),$(this).find("span").addClass("link")}0==i&&$(this).addClass("none"),1==i&&$(this).css("border-left","none")}td_size<th_size&&i==td_size-1&&$(this).attr("colspan",th_size-td_size+1)})});var minTdNum=5;"128"!=appId&&"127"!=appId&&"126"!=appId&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId||(minTdNum=4);var rdataNum=$("#rdataNum"+proId).html();if(("114"==appId||"118"==appId)&&tr_size-1<rdataNum){var num=Number(rdataNum)-tr_size+1,height=30*(5-tr_size),adHtml="<tr><td colspan='"+th_size+"' style='border-left-style: none;vertical-align: middle;height:"+height+"px' align='center'><img src='/celloud/images/report/running.png' title='正在运行...'/><br>"+num+"个数据正在运行...</td></tr>";$(this).find("tbody").append(adHtml)}else if(tr_size<minTdNum){var num=5-tr_size;for(i=0;i<num;i++){var adHtml="<tr>";for(j=0;j<th_size-1;j++)adHtml+="<td></td>";adHtml+="</tr>",$(this).find("tbody").append(adHtml)}}})}function showSuper(obj,divId){$("#"+divId).attr("class")?($(obj).html('收起  <i id="sortCreateDate" class="fa fa-angle-double-up"></i>'),$("#"+divId).removeClass("none")):($("#"+divId).addClass("none"),$(obj).html('更多  <i id="sortCreateDate" class="fa fa-angle-double-down"></i>'))}function viewDataReport(event){$("#dataReportDIV").load("pages/report/report_data_main.jsp"),$("#reportResultDiv").html(""),$.main.show.dataReportDIV(),"undefined"!=typeof spinner&&spinner.stop(),dataReportParam=event;var softwareId=event.data.softwareId,fileName=event.data.fileName,dataKey=event.data.dataKey,softwareName=event.data.softwareName,userId=event.data.userId,obj=event.data.obj,proId=event.data.proId,proName=event.data.proName;obj.children(":first").addClass("link_visited"),$("#fileNameH4").html("APP："+softwareName),$("#proforReport").html(proName),$("#fileListUl").html(""),spinner=new Spinner(opts);var target=document.getElementById("reportLoading");spinner.spin(target),$.get("data/getDatasInProject",{projectId:proId},function(fileList){$("#fileListUl").append("<button type='button' id='prevA' class='btn btn-success'><span class='fa fa-sort-asc'></span></button>");var fileNames=new Array,newList="";if(110==softwareId||111==softwareId||112==softwareId||113==softwareId||126==softwareId||127==softwareId||128==softwareId){$.each(fileList,function(index,item){utils.isConfigure(item.fileName)||fileNames.push(item.fileName)}),newList="[{",fileNames.sort();for(var fileId_n="fileId:",fileName_n=",fileName:'",dataKey_n=",dataKey:'",i=0;i<fileNames.length;i++)fileName_n+=fileNames[i],i<fileNames.length-1&&(fileName_n+="_&_");$.each(fileList,function(index,item){fileNames[0]==item.fileName&&(fileId_n+=item.fileId,dataKey_n+=item.dataKey)}),newList+=fileId_n+fileName_n+"'"+dataKey_n+"'}]",newList=eval(newList)}else newList=fileList;$.each(newList,function(index,item){var inner="",obj1=$("#dataSpan"+proId+item.dataKey);0==index&&(dataItem0=item,obj1=$("#dataSpan"+proId+dataItem0.dataKey));var isActive="";item.dataKey==dataKey&&(isActive="active",reportIdNow="fileA"+proId+item.fileId),inner+="<button type='button' class='btn btn-success "+isActive+"' style='font-size:12px;' id='fileA"+proId+item.fileId+"' title='"+item.fileName+"'>"+(item.fileName.length>15?item.fileName.substring(0,15)+"...":item.fileName)+"</button>",$("#fileListUl").append(inner),$("#fileA"+proId+item.fileId).bind("click",function(){viewADataReport(item.dataKey,item.fileName,userId,softwareId,item.fileId,proId,obj1),$.get("report/clickItemDataReport",{},function(state){})})}),$("#fileListUl").append("<button type='button' id='nextA' class='btn btn-success'><span class='caret'></span></button>"),$("#prevA").bind("click",function(){var preId=$("#"+reportIdNow).prev().attr("id");return"prevA"==preId?void jAlert("已经是第一条数据"):($("#fileListUl").find("#"+preId).trigger("click"),$("#fileListUl").removeClass("active"),$("#"+preId).addClass("active"),void $.get("report/prevDataReport",{},function(state){}))}),$("#nextA").bind("click",function(){var nextId=$("#"+reportIdNow).next().attr("id");return"nextA"==nextId?void jAlert("已经是最后一条数据"):($("#fileListUl").find("#"+nextId).trigger("click"),$("#fileListUl").removeClass("active"),$("#"+nextId).addClass("active"),void $.get("report/nextDataReport",{},function(state){}))})}),viewADataReport(dataKey,fileName,userId,softwareId,0,proId,obj.children(":first"))}function viewADataReport(dataKey,fileName,userId,softwareId,fileId,proId,obj){reportIdNow="fileA"+proId+fileId,obj.addClass("link_visited"),0!=fileId&&($("#fileListUl").find(".active").removeClass("active"),$("#fileListUl").removeClass("active"),$("#"+reportIdNow).addClass("active")),$.get("report/"+appMethod[softwareId],{projectId:proId,dataKey:dataKey,appId:softwareId},function(responseText){if(toDataReport(responseText,softwareId,charMap[softwareId],DATAPATH),114==softwareId||118==softwareId){var mib_readsDisInfo=$("#reads-distribution-char").text(),mib_familyDisInfo=$("#family-distribution-char").text(),min_genusDisInfo=$("#genus-distribution-char").text();""!=mib_readsDisInfo&&$.reportChar.draw.circularGraph("reads-distribution-char","Reads","Distribution",eval("("+mib_readsDisInfo+")")),""!=mib_familyDisInfo&&$.reportChar.draw.circularGraph("family-distribution-char","Family","Distribution",eval("("+mib_familyDisInfo+")")),""!=min_genusDisInfo&&$.reportChar.draw.singleBar("genus-distribution-char","Top 10 genus distribution","",eval("("+min_genusDisInfo+")"),"Depth","Depth")}})}function toDataReport(responseText,appId,columns,DATAPATH){if($("#reportResultDiv").html(responseText),105==appId){var mutant=$("#_hidMutant").val(),wild=$("#_hidWild").val(),neither=$("#_hidNeither").val(),data=[{name:"Mutant strain",value:mutant},{name:"Wild type",value:wild},{name:"No Result",value:neither}];$.reportChar.draw.echartsShowPie("_showPie","Samples Statistic",data)}if(81==appId||83==appId||85==appId||86==appId||87==appId||88==appId||91==appId||92==appId||93==appId||94==appId||119==appId||120==appId||121==appId||122==appId||124==appId||125==appId){var T=0,M=0;$("#_table").find("th").each(function(i){"Total_Reads"==$(this).html()&&(T=i),"Map_Reads"==$(this).html()&&(M=i)}),$("#_table").find("td").each(function(i){if(i==T||i==M){var n=$(this).html();isNaN(n)||$(this).html($.format(n,3,","))}}),$.get("count/pgsCompare",{appId:appId,columns:columns},function(data){var sp=data.split(";");$("#charResult").html("");for(var i=1;i<sp.length;i++){var big=0,div=$("<div id='char"+i+"' class='col-lg-5' style='width: 410px;height:400px;'></div>");$("#charDiv").append(div);for(var ev=sp[i].split(":"),one=getCountValue(ev[0],"_table"),value=ev[1].split(","),context="[",k=0;k<value.length-1;k++)context+="[1,"+value[k]+"],",value[k]>one&&big++;context+="]";var percent=0;percent="Duplicate"==ev[0]||"Duplicate(%)"==ev[0]||"*SD"==ev[0]?Math.round(big/value.length*100):100-Math.round(big/value.length*100),$("#charResult").append("本数据的 "+ev[0]+" 打败了 <span class='green'>"+percent+"%</span> 的数据；");var single="[[2,"+one+"]]";$.reportChar.draw.echartsShowScatter("char"+i,ev[0],eval(context),eval(single))}})}if(80==appId&&$.get("count/hcvCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split(";"),k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',",Y+=n[0]==one?"{ dataLabels: { enabled: true, y: 0, crop: false, style: { fontWeight: 'bold', fontSize:16 }, }, y:"+n[1]+"},":n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","Subtype",eval(X),eval(Y),0,500,300)}),82==appId&&$.get("count/hbvCompare",{appId:appId,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)}),90==appId&&$.get("count/tbCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),89==appId){var length=$("#seq_length").val();0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/krasCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})}if(84==appId){var length=$("#seq_length").val();0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/egfrCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})}spinner.stop()}function getCountValue(key,id){var val,num=0;return $("#"+id).find("tr").each(function(i){0==i?$(this).find("th").each(function(j){var title=$(this).html();title==key&&(num=j)}):$(this).find("td").each(function(k){if(num==k&&(val=$(this).html(),val.indexOf(",")>0)){var reg=new RegExp(",","g");val=val.replace(reg,"")}})}),val}function toShareModal(proId,proName,fileCount){$("#shareProPrompt").html(""),$("#proIdHidden").val(proId),$("#proNameSpan").html("项目名称："+proName),$("#proDataCountSpan").html(fileCount),$("#proSel").select2({minimumInputLength:1,query:function(query){var data={results:[{id:query.term,text:query.term}]};query.callback(data)},multiple:!0}),$("#proSel").val(""),$("#shareProjectModal").modal("show")}function shareModal(proId,owner,proName,fileCount){$("#proOwnerHidden").val(owner),$("#shareProPrompt").html(""),$("#proIdHidden").val(proId),$("#proNameSpan").html("项目名称："+proName),$("#proDataCountSpan").html(fileCount),$("#proSel").select2({minimumInputLength:1,query:function(query){var data={results:[{id:query.term,text:query.term}]};query.callback(data)},multiple:!0}),$.get("project/getShareTo",{projectId:proId},function(data){data.length>0&&$("#proSel").select2("data",data)}),$("#proSel").val(""),$("#shareProjectModal").modal("show")}function saveShareProject(){var proId=$("#proIdHidden").val(),data=$("#proSel").select2("data"),empty=!1;if($.each(data,function(index,item){var id=$.trim(item.id);""==id&&(empty=!0)}),empty)return void $("#shareProPrompt").html("用户名不能有空值！");var userNames="";return $.each(data,function(id,value){userNames+=value.text+","}),userNames=userNames.toLowerCase(),sessionUserName=sessionUserName.toLowerCase(),userNames.substring(0,userNames.length-1)==sessionUserName||userNames.indexOf(sessionUserName,0)!=-1?void $("#shareProPrompt").html("项目不能共享给自己！"):void $.get("project/shareProject",{projectId:proId,userNames:userNames},function(data){""==data?($("#shareProjectModal").modal("hide"),submitSearch()):$("#shareProPrompt").html("<br/>"+data)})}function viewNext(){var obj=$(this).parent().parent().next();obj.attr("style")?($("._HCVTR").css("display","none"),obj.css("display",""),obj.children().html()||obj.children().html("Low_Quality")):obj.css("display","none")}function toChangePname(id){$("#showPname"+id).addClass("none"),$("#changePname"+id).removeClass("none")}function changePname(id){var name=$("#updatePname"+id).val(),oldName=$("#pnameSpan"+id).text().trim();name==oldName?($("#showPname"+id).removeClass("none"),$("#changePname"+id).addClass("none")):$.get("project/update",{projectId:id,projectName:name},function(flag){flag&&(name.length>13&&(name=name.substring(0,12)+"..."),$("#pnameSpan"+id).html(name),$("#showPname"+id).removeClass("none"),$("#changePname"+id).addClass("none"),dataReportParam.data.proId==id&&(dataReportParam.data.proName=name,$("#proforReport").html(name)))})}function printSplit(projectId,dataKey,appId){printReport.main("report/printSplitReport",printReport.mongoParam(projectId,dataKey,appId))}$.ajaxSetup({cache:!1});var opts={lines:13,length:28,width:14,radius:42,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},spinner,spinnerTotal,param=null,START=null,END=null,APP=0,FILENAME=null,currentPage=1,pageSize=10,isTIMETRUE=!0,BELONGS=1,close=0,dataReportParam,dataItem0,obj0,reportIdNow,printReport={main:function(method,param){$.get(method,param,function(responseText){var obj=window.open("");obj.document.write(responseText),obj.document.close()})},mongoParam:function(projectId,dataKey,appId){var _param={projectId:projectId,dataKey:dataKey,appId:appId};return _param}};
var appMethod={};appMethod[1]="get16SReport",appMethod[11]="getABINJReport",appMethod[89]="getKRASReport",appMethod[90]="getTBRifampicinReport",appMethod[73]="getTranslateReport",appMethod[80]="getHCVReport",appMethod[82]="getHBVReport",appMethod[84]="getEGFRReport",appMethod[85]="getPgsReport",appMethod[86]="getPgsReport",appMethod[87]="getPgsReport",appMethod[88]="getPgsReport",appMethod[91]="getPgsReport",appMethod[92]="getPgsReport",appMethod[93]="getPgsReport",appMethod[94]="getPgsReport",appMethod[104]="getPgsReport",appMethod[105]="getTBINHReport",appMethod[106]="getDPDReport",appMethod[107]="getBRAFReport",appMethod[108]="getUGTReport",appMethod[110]="getCMPReport",appMethod[111]="getCMPReport",appMethod[112]="getGDDReport",appMethod[113]="getSplitReport",appMethod[114]="getMIBReport",appMethod[116]="getPgsReport",appMethod[117]="getOncogeneReport",appMethod[118]="getBSIReport",appMethod[119]="getPgsReport",appMethod[120]="getPgsReport",appMethod[121]="getPgsReport",appMethod[122]="getPgsReport",appMethod[124]="getPgsReport",appMethod[125]="getPgsReport",appMethod[126]="getCMPReport",appMethod[127]="getCMPReport",appMethod[128]="getGDDReport";
function showReport(){var proId=$("#proIdHidden").val(),report=$("#reportHidden").val();null==proId||""==proId||"null"==proId?($("#tab2").css({display:"block"}),$("#tab1").css({display:"none"}),$("#liData").addClass("active"),$("#liPro").removeClass("active"),$("#liPro").attr("style","display:none;"),$("#tab2").html(report)):($("#tab1").css({display:"block"}),$("#tab2").css({display:"none"}),$("#liPro").addClass("active"),$("#liData").removeClass("active"),$("#liData").attr("style","display:none;"),$("#tab1").html(report))}function showProReport(){$("#tab1").css({display:"block"}),$("#tab2").css({display:"none"}),$("#liPro").addClass("active"),$("#liData").removeClass("active")}function showDataReport(){$("#tab2").css({display:"block"}),$("#tab1").css({display:"none"}),$("#liData").addClass("active"),$("#liPro").removeClass("active")}function viewDataReport(userId,dataKey,softwareName,softwareId){$("#liData").attr("style",""),showDataReport(),$.get("getPath.action",{},function(responseText){var toolsPath=responseText.split(",")[0];$.get("getFileNameByDataKey.action",{dataKey:dataKey},function(rFileName){var newPath=toolsPath+"Procedure!readReport?fileName="+rFileName+"&userId="+userId+"&appId="+softwareId+"&dataKey="+dataKey+"&projectId=";$.get("getDataReport.action",{url:newPath},function(responseText){$("#tab2").html(responseText);var height=$("#tab2").children().height();height>380&&($(".tab-content").css("height",height+20),$("#tab2").children().resize(function(){var height=$("#tab2").children().height();$(".tab-content").css("height",height+20)})),10!=softwareId&&76!=softwareId||showAmcharts()})})})}function showAmcharts(){for(var responseText=$("#tableValue").html(),data=responseText.split("@"),i=0;i<data.length-1;i++){var dataList=eval("("+data[i]+")");getGcCharts(dataList.str,"amcharts"+i)}var dataList=eval("("+data[data.length-1]+")");getGcCharts(dataList.str,"amcharts")}function getGcCharts(data,divId){var gcChart=new AmCharts.AmSerialChart;gcChart.dataProvider=data,gcChart.categoryField="Length",gcChart.marginRight=0,gcChart.marginTop=0,gcChart.autoMarginOffset=0,gcChart.columnWith=10,gcChart.depth3D=7,gcChart.angle=30,gcChart.columnWidth=.4,gcChart.columnSpacing=5;var categoryAxis=gcChart.categoryAxis;categoryAxis.labelRotation=0,categoryAxis.dashLength=1,categoryAxis.gridPosition="start";var valueAxis=new AmCharts.ValueAxis;valueAxis.dashLength=5,gcChart.addValueAxis(valueAxis);var graph=new AmCharts.AmGraph;graph.valueField="Distinct",graph.balloonText="Distinct: [[value]]",graph.type="column",graph.lineAlpha=0,graph.fillAlphas=1,graph.lineColor=["#4682B4","#4682B4"],gcChart.addGraph(graph);var graph2=new AmCharts.AmGraph;graph2.valueField="Total",graph2.balloonText="Total: [[value]]",graph2.type="column",graph2.lineAlpha=0,graph2.fillAlphas=1,graph2.lineColor=["#CD3333","#CD3333"],gcChart.addGraph(graph2),gcChart.write(divId)}$.ajaxSetup({cache:!1});
var rockyData=function(rockyData){var self=rockyData||{};return $(document).off("click","#rocky_data_page [data-click='pagination-btn']"),$(document).off("change","#rocky_data_page #page-size-sel"),$(document).off("keyup","#data-sample-filter"),$(document).off("keyup","#data-condition-input"),$(document).off("change","#rocky_data_page #page-size-sel"),$(document).off("click","#data-condition-find"),$(document).off("click","a[id^='dataSortBtn-']"),$(document).on("click","a[id^='dataSortBtn-']",function(){var id=$(this).attr("id"),sort=id.split("-"),sidx=sort[1],sord=sort[2]||"desc",size=$("#rocky_data_page #page-size-sel").val(),sample=self.filter.param.sample,condition=self.filter.param.condition;self.pageDatas(1,size,sample,condition,sidx,sord)}),$(document).on("keyup","#data-sample-filter",function(event){13==event.keyCode&&self.filter.sample($(this).val())}),$(document).on("keyup","#data-condition-input",function(event){13==event.keyCode&&self.filter.condition($(this).val())}),$(document).on("click","#data-condition-find",function(event){self.filter.condition($("#data-condition-input").val())}),$(document).on("change","#rocky_data_page #page-size-sel",function(){var sample=self.filter.param.sample,condition=self.filter.param.condition,sidx=self.sort.sidx,sord=self.sort.sord;self.pageDatas(1,$(this).val(),sample,condition,sidx,sord)}),$(document).on("click","#rocky_data_page [data-click='pagination-btn']",function(){var page=$(this).data("page"),size=$("#rocky_data_page #page-size-sel").val(),sample=self.filter.param.sample,condition=self.filter.param.condition,sidx=self.sort.sidx,sord=self.sort.sord;self.pageDatas(page,size,sample,condition,sidx,sord)}),self.sort={},self.pageDatas=function(page,size,sample,condition,sidx,sord,f){var params={page:page,size:size};sample?(params.sample=sample,self.filter.param={sample:sample}):condition?(params.condition=condition,self.filter.param={condition:condition}):self.filter.param={},sidx&&sord&&(params.sidx=sidx,params.sord=sord,self.sort={sidx:sidx,sord:sord});var url=contextPath+"/data/rocky/list";$("#container").load(url,params,function(){$.isFunction(f)&&f()})},self.filter={sample:function(sample){var size=$("#rocky_data_page #page-size-sel").val();$("#data-condition-input").val("");var sidx=self.sort.sidx,sord=self.sort.sord;self.pageDatas(1,size,sample,null,sidx,sord,function(){var val=$("#data-sample-filter").val();$("#data-sample-filter").focus().val(val)})},condition:function(condition){var size=$("#rocky_data_page #page-size-sel").val(),sidx=self.sort.sidx,sord=self.sort.sord;self.pageDatas(1,size,null,condition,sidx,sord)},param:{}},self}(window.rockyData);
$(function(){var timeout=!1;$.ajaxSetup({complete:function(request,textStatus){var sessionstatus=request.getResponseHeader("sessionstatus");"timeout"!=sessionstatus||timeout||(timeout=!0,alert("登录超时,请重新登录！"),window.location.href=contextPath+"/login")},cache:!1}),$("#logoutBtn").click(function(){window.location.href=contextPath+"/logout"}),$(".common-sidebar").on("click","a",function(){$base.itemBtnToggleActive($(this))}),$("#upload-next").on("click",function(){$upload.stepTwo()}),$("#to-sample-a").on("click",function(){var url=contextPath+"/sample/rocky/sampleList";$("#container").load(url,{},function(){$("#container").removeClass("hide"),$("#upload-container").addClass("hide")}),$("#container").removeClass("hide"),$("#upload-container").addClass("hide"),$("#common-menu-center").load("pages/rocky/sample/sample_menu_sampleinfo.jsp"),$("#common-menu-right").load("pages/rocky/sample/sample_menu_btns.jsp")}),$("#to-upload-a").on("click",function(){$("#upload-container").removeClass("hide"),$("#container").addClass("hide"),$("#common-menu-center").html(""),$("#common-menu-right").html("")}),$("#to-data-a").on("click",function(){var url=contextPath+"/data/rocky/list";$("#container").load(url,{},function(){rockyData.filter.param={},$("#container").removeClass("hide"),$("#upload-container").addClass("hide")}),$("#common-menu-center").html(""),$("#common-menu-right").load("pages/rocky/data/data_menu_search.jsp")}),$("#to-report-a").on("click",function(){var url=contextPath+"/report/rocky/reportMain";$("#container").load(url,function(){rockyReport.params={},$("#container").removeClass("hide"),$("#upload-container").addClass("hide")}),$("#common-menu-center").html(""),$("#common-menu-right").load("pages/rocky/report/report_menu_search.jsp")}),$("#to-upload-a").trigger("click")});
$(function(){$("#printBtn").click(function(){$("#printBtns").hide(),$(".main-container").css("padding","0px"),$(".affix").parent().removeClass("col-xs-2").hide(),$(".affix").parent().siblings().removeClass("col-xs-10").addClass("col-xs-12"),$("#rockyBaseInfoForm input[type='text']").each(function(index,item){var $this=$(this),$label=$("<span>"+$this.val()+"</span>");$label.css({"text-align":"left","font-weight":"normal","white-space":"normal"}),$label.attr("name",$this.attr("name")),$label.attr("class",$this.attr("class")),$label.css("display","normal"),$this.hide(),$this.after($label)}),window.print(),$("#printBtns").show(),$(".affix").parent().addClass("col-xs-2").show(),$(".affix").parent().siblings().removeClass("col-xs-12").addClass("col-xs-10"),$(".main-container").css("padding","0px 45px 0px 70px"),$("#rockyBaseInfoForm input[type='text']").show(),$("#rockyBaseInfoForm span[name]").remove()}),$("#saveBtn").click(function(){var url=$("#rockyBaseInfoForm").attr("action");$.post(url,$("#rockyBaseInfoForm").serialize(),function(){alert("保存成功！")})}),$("#resetBtn").click(function(){$("#rockyBaseInfoForm")[0].reset()})});
var $report={showReport:function(dataKey,projectId,appId){$("#common-menu-right").html("");var url=contextPath+"/report/rocky/data/report";$("#container").load(url,{dataKey:dataKey,appId:appId,projectId:projectId})}},rockyReport=function(rockyReport){var self=rockyReport||{};return $(document).off("click","#rocky_report_page [data-click='pagination-btn']"),$(document).off("change","#rocky_report_page #page-size-sel"),$(document).off("click","#report-condition-find"),$(document).off("keyup","#report-sample-filter"),$(document).off("keyup","#report-condition-input"),$(document).off("click","a[id^='reportSortBtn-']"),$(document).on("click","#batch-more",function(){$("#batch-lists").hasClass("show-more")?($("#batch-lists").removeClass("show-more"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")):($("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"))}),$(document).on("click","#batch-multiselect",function(){$("#batch-lists").addClass("show-more"),$("#batch-more span").html("收起"),$("#batch-more i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$("#batch-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$("#batch-more").addClass("disabled"),$("#batch-more").attr("disabled",!0)}),$(document).on("click","[data-click='reset-multiselect']",function(){var selectorline=$(this).parent().parent().parent().parent();$(selectorline).removeClass("select-more"),$(selectorline).find(".sl-val").removeClass("show-more"),$(selectorline).find(".checkbox").addClass("hide").addClass("checkbox-un").removeClass("checkbox-ed"),$(selectorline).find(".multisl-btns").addClass("hide"),$("#batch-more").hasClass("disabled")&&($("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down"))}),$(document).on("click","[data-click='report-select-more']",function(){"batch-multiselect"!=$(this).attr("id")&&($("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")),$(".selector-line").removeClass("select-more"),$("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0),$(".selector-line .checkbox").removeClass("checkbox-ed").addClass("checkbox-un").addClass("hide"),$(".selector-line").find("[name='sl-confirm']").addClass("disabled"),$(".selector-line").find("[name='sl-confirm']").attr("disabled",!0),$(".selector-line").find(".multisl-btns").addClass("hide");var selectorline=$(this).parent().parent().parent();$(selectorline).addClass("select-more"),$(selectorline).find(".sl-val").addClass("show-more"),$(selectorline).find(".checkbox").removeClass("hide"),$(selectorline).find(".multisl-btns").removeClass("hide")}),$(document).on("click","#batch-lists .sl-val-content",function(){$(this).find(".checkbox").toggleClass("checkbox-un"),$(this).find(".checkbox").toggleClass("checkbox-ed"),$("#batch-lists .checkbox-ed").size()>0?($("#report-multibatch-search").removeClass("disabled"),$("#report-multibatch-search").attr("disabled",!1)):($("#report-multibatch-search").addClass("disabled"),$("#report-multibatch-search").attr("disabled",!0))}),$(document).on("click","#period-lists .sl-val-content",function(){$(this).find(".checkbox").toggleClass("checkbox-un"),$(this).find(".checkbox").toggleClass("checkbox-ed"),$("#period-lists .checkbox-ed").size()>0?($("#report-multiperiod-search").removeClass("disabled"),$("#report-multiperiod-search").attr("disabled",!1)):($("#report-multiperiod-search").addClass("disabled"),$("#report-multiperiod-search").attr("disabled",!0))}),$("body").on("click","[data-click='report-date-search']",function(){self.pageReports({beginDate:$("#report-begindate-search").val(),endDate:$("#report-enddate-search").val()})}),$("body").on("click","[data-click='report-batch-search']",function(){$("#batch-sl").hasClass("select-more")||(self.pageReports({batches:[$(this).text()]}),$("#selected-batch span").html($(this).text()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"))}),$(document).on("click","#clear-sl-batch",function(){$("#selected-batch").addClass("hide"),$("#to-sl-batch").removeClass("hide"),$("#batch-more").removeClass("disabled"),$("#batch-more").attr("disabled",!1),$("#batch-lists").find(".multisl-btns").addClass("hide"),self.pageReports({batches:[]})}),$("body").on("click","[data-click='report-period-search']",function(){$("#period-sl").hasClass("select-more")||(self.pageReports({periods:[$(this).find("input").val()]}),$("#selected-period span").html($(this).find("span").html()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"))}),$(document).on("click","#clear-sl-period",function(){$("#selected-period").addClass("hide"),$("#to-sl-period").removeClass("hide"),self.pageReports({periods:[]})}),$(document).on("click","#report-multibatch-search",function(){var show_val=[];$("#batch-lists .checkbox-ed").each(function(){show_val.push($(this).next().text())}),self.pageReports({batches:show_val}),$("#selected-batch span").html(show_val.toString()),$("#selected-batch").removeClass("hide"),$("#to-sl-batch").addClass("hide"),$("#batch-sl").removeClass("select-more"),$("#batch-lists").removeClass("show-more"),$("#batch-lists").find(".checkbox").addClass("hide"),$("#batch-more span").html("更多"),$("#batch-more i").removeClass("fa-chevron-up").addClass("fa-chevron-down")}),$(document).on("click","#report-multiperiod-search",function(){var show_val=[],periods=[];$("#period-lists .checkbox-ed").each(function(){periods.push($(this).next().find("input[type='hidden']").val()),show_val.push($(this).next().find("span").html())}),self.pageReports({periods:periods}),$("#selected-period span").html(show_val.toString()),$("#selected-period").removeClass("hide"),$("#to-sl-period").addClass("hide"),$("#period-sl").removeClass("select-more"),$("#period-sl").find(".checkbox").addClass("hide"),$("#period-sl").find(".multisl-btns").addClass("hide"),$("#period-lists .checkbox").removeClass("checkbox-ed").addClass("checkbox-un")}),$(document).on("click","a[id^='reportSortBtn-']",function(){var id=$(this).attr("id"),sort=id.split("-");self.pageReports({sidx:sort[1],sord:sort[2]||"desc"})}),$(document).on("change","#rocky_report_page #page-size-sel",function(){self.pageReports({size:$(this).val()})}),$(document).on("keyup","#report-sample-filter",function(event){13==event.keyCode&&($("#report-condition-input").val(""),self.pageReports({sample:$(this).val(),condition:null},function(){var val=$("#report-sample-filter").val();$("#report-sample-filter").focus().val(val)}))}),$(document).on("keyup","#report-condition-input",function(event){13==event.keyCode&&self.pageReports({condition:$(this).val(),sample:null})}),$(document).on("click","#report-condition-find",function(event){self.pageReports({condition:$("#report-condition-input").val(),sample:null})}),$(document).on("click","#rocky_report_page [data-click='pagination-btn']",function(){self.pageReports({page:$(this).data("page")})}),self.sort={},self.params={},self.changeSettings=function(options){self.params=self.params||{},options.sample?(delete self.params.condition,self.params={sample:options.sample}):options.condition&&(delete self.params.sample,self.params={condition:options.condition}),options.sidx&&options.sord&&(self.sort={sidx:options.sidx,sord:options.sord}),"batches"in options&&(self.params.batches=options.batches),"periods"in options&&(self.params.periods=options.periods),"beginDate"in options&&(self.params.beginDate=options.beginDate),"endDate"in options&&(self.params.endDate=options.endDate)},self.pageReports=function(options,f){var params={page:1,size:$("#rocky_report_page #page-size-sel").val()||20,sidx:self.sort.sidx,sord:self.sort.sord,sample:self.params.sample,beginDate:self.params.beginDate,endDate:self.params.endDate,condition:self.params.condition,batches:self.params.batches,periods:self.params.periods};self.changeSettings(options),$.extend(params,options);var temp=[];for(var key in params){var param=params[key];if($.isArray(param))for(var t in param)temp.push(key+"="+$.trim(param[t]));else param&&temp.push(key+"="+params[key])}var url=contextPath+"/report/rocky/reportMain #rocky-report-list";$("#rocky-report-list").load(url,temp.join("&"),function(){$.isFunction(f)&&f()})},self}(window.rockyReport);
var rockySamples=function(samples){var self=samples||{};return $(document).off("click","#sampleAddBtn"),$(document).on("click","#sampleAddBtn",function(){self.add()}),$(document).off("click","#sample-commit"),$(document).on("click","#sample-commit",function(){self.commit()}),$(document).off("click","#sample-cancel"),$(document).on("click","#sample-cancel",function(){self.cancel()}),$(document).off("click","[data-click='del-sample']"),$(document).on("click","[data-click='del-sample']",function(){self.del($(this).data("id"))}),$(document).on("click","#close-error",function(){self.error.hide()}),$(document).off("keyup","#sampleInput"),$(document).on("keyup","#sampleInput",function(event){13==event.keyCode&&self.add()}),self.add=function(){var sampleName=$("#sampleInput").val();sampleName=$.trim(sampleName),""!=sampleName&&$.get(contextPath+"/sample/rocky/addSample",{sampleName:sampleName},function(result){1==result?(self.list(),$("#sampleInput").val("")):2==result&&(self.error.show(),$("#sampleInput").select())})},self.error={show:function(){$("#sample-error").removeClass("hide")},hide:function(){$("#sample-error").addClass("hide")}},self.commit=function(){var params=$("#sample-form").serialize();params.length<=0||$.post(contextPath+"/sample/rocky/commitSamples",params,function(result){self.list()})},self.list=function(){var url=contextPath+"/sample/rocky/sampleList";url+=" #rocky-sample-list tr",$("#rocky-sample-list").load(url,function(){$("#sampleInput").select(),self.error.hide()})},self.del=function(sampleId){$.post(contextPath+"/sample/rockey/deleteList",{sampleIds:sampleId},function(result){self.list()})},self.cancel=function(){var param=$("#sample-form").serialize();param.length<=0||$.post(contextPath+"/sample/rockey/deleteList",param,function(result){self.list()})},self}(rockySamples||{});
var $upload={stepOne:function(){$(".steps").addClass("hide"),$("#upload-nav-step-three").addClass("not-reached"),$("#upload-nav-step-two").addClass("not-reached"),$("#upload-step-one").removeClass("hide"),$(".step-line").addClass("not-reached"),$(".tips").addClass("hide"),$("#batch-info-input").val(""),$("#upload-tip-one").removeClass("hide")},stepTwo:function(){$(".steps").addClass("hide"),$(".step-line").addClass("not-reached"),$("#upload-nav-line-one").removeClass("not-reached"),$("#upload-nav-step-two").removeClass("not-reached"),$("#upload-step-two").removeClass("hide"),$(".tips").addClass("hide"),$("#upload-tip-two").removeClass("hide")},stepThree:function(){$(".steps").addClass("hide"),$("#upload-step-three").removeClass("hide"),$("#upload-nav-line-one").removeClass("not-reached"),$("#upload-nav-line-two").removeClass("not-reached"),$("#upload-nav-step-three").removeClass("not-reached"),$(".tips").addClass("hide"),$("#upload-tip-three").removeClass("hide")}},rockyUpload=function(rockyUpload){function getSize(fileSize){if(!fileSize)return"";var unit="b";return fileSize>1e3&&(fileSize/=1e3,unit="kb"),fileSize>1e3&&(fileSize/=1e3,unit="mb"),fileSize.toFixed(2)+unit}var self=rockyUpload||{};return self.refreshSession=function(){$.get("uploadFile/checkAdminSessionTimeOut")},self.init=function(){var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:"plupload-content",url:contextPath+"/uploadFile/rocky",chunk_size:"1mb",drop_element:"plupload-content",filters:{max_file_size:"3gb",prevent_duplicates:!0,mime_types:[{title:"fastq",extensions:"fastq"},{title:"gz",extensions:"gz"}]},max_retries:5,multiple_queues:!0,flash_swf_url:"//cdn.bootcss.com/plupload/2.1.8/Moxie.swf"});uploader.init(),$(document).on("click","[data-click='del-upload-file']",function(){var id=$(this).data("id");$("#"+id).remove();var file=uploader.getFile(id);uploader.removeFile(file)}),uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval("self.refreshSession()",6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("UploadProgress",function(uploader,file){$("#"+file.id+" .percent").html(file.percent+"%"),$("#"+file.id+" .spead").html(getSize(uploader.total.bytesPerSec)+"/s"),$("#"+file.id+" .surplus").html(utils.formatDate((file.size-file.loaded)/uploader.total.bytesPerSec))}),uploader.bind("FilesAdded",function(uploader,files){$("#upload-list-table").removeClass("hide"),$.each(files,function(index,item){var $fileDom=$('<tr id="'+item.id+'"></tr>');$fileDom.append($('<td class="filename">'+item.name+"</td>")),$fileDom.append($('<td class="percent">等待上传</td>')),$fileDom.append($('<td class="surplus">---</td>')),$fileDom.append($('<td class="spead">---</td>')),$fileDom.append($('<td><a data-click="del-upload-file" data-id="'+item.id+'"  href="javascript:void(0)"><i class="fa fa-times-circle" aria-hidden="true"></i></a></td>')),$("#upload-list-tbody").append($fileDom)}),uploader.start()}),uploader.bind("BeforeUpload",function(uploader,file){$("#"+file.id+" .percent").html("正在上传"),uploader.setOption("multipart_params",{tagId:$("#tag-info-input").val(),batch:$("#batch-info-input").val(),uniqueName:file.id})}),uploader.bind("FileUploaded",function(uploader,file,response){var res=JSON.parse(response.response);$("#"+file.id+" .percent").html("上传完成"),"true"==res.run&&(delete res.run,$.get(contextPath+"/data/run",JSON.parse(response.response),function(result){console.log(result)}))}),uploader.bind("UploadComplete",function(uploader,files){uploader.splice(0,uploader.files.length),$("#upload-list-tbody").html(""),$("#upload-list-table").addClass("hide"),$upload.stepThree()})},rockyUpload.init(),self}(rockyUpload||{});
function CreateScript(file){var new_element;new_element=document.createElement("script"),new_element.setAttribute("type","text/javascript"),new_element.setAttribute("src",file),document.body.appendChild(new_element)}function secPWD(password){var modulus=$.trim($("#modulusHidden").val()),exponent=$.trim($("#exponentHidden").val()),key=RSAUtils.getKeyPair(exponent,"",modulus);return RSAUtils.encryptedString(key,password)}function getCookie(name){var arr=document.cookie.match(new RegExp("(^| )"+name+"=([^;]*)(;|$)"));return null!=arr?unescape(arr[2]):null}function delCookie(name){var exp=new Date;exp.setTime(exp.getTime()-1);var cval=getCookie(name);null!=cval&&(document.cookie=name+"="+cval+";expires="+exp.toGMTString())}document.write("<script src='plugins/baidu.js'></script>"),$(document).ready(function(){function checkForm(){$(".error").html("");var username=$.trim($("#username").val());if(""==username||username==$.trim($("#username").attr("placeholder")))return $(".error").html("请输入用户名！"),$("#username").val("").focus(),!1;var password=$.trim($("#password").val());if(""==password)return $(".error").html("请输入密码！"),$("#password").focus(),!1;if($("#captcha").length>=1){var captcha=$.trim($("#captcha").val());if(""==captcha||captcha==$.trim($("#captcha").attr("placeholder")))return $(".error").html("请输入验证码！"),$("#captcha").val().focus(),!1}var newPassword=$("#tempPassword").val();return newPassword&&$("input[name='newPassword']").val(secPWD(newPassword)),delCookie("username"),delCookie("password"),!0}var wid=$(window).width(),per=50*(1-553/wid);$(".loginWrapper").css("left",per+"%"),$.ajaxSetup({cache:!1}),$("#kaptchaImage").click(function(){$(this).hide().attr("src","kaptcha.jpg?"+Math.floor(100*Math.random())).fadeIn()}),error=$("#info").val(),""!=error?$(".error").html(error):$(".error").html("");var checked=$("#checked").val();"true"==checked?(document.getElementById("remPass").className="btn-login checkbox-ed",tmpRem=1,document.getElementById("isRem").value=1):(document.getElementById("remPass").className="btn-login checkbox-un",tmpRem=0,document.getElementById("isRem").value=0);var tmpRem=0;$("#submit").click(function(){checkForm()&&$("#loginForm").submit()}),$("#submit").keydown(function(e){13==e.keyCode&&$("#submit").click()}),document.onkeydown=function(e){var ev=document.all?window.event:e;13==ev.keyCode&&$("#submit").click()},$("#password").keyup(function(event){$("#tempPassword").val($("#password").val())}),$("#password").change(function(){$("#tempPassword").val($("#password").val())}),$("#remPass").click(function(){0==tmpRem?(document.getElementById("remPass").className="btn-login checkbox-ed",tmpRem=1,document.getElementById("isRem").value=1,$("#checked").val(!0)):(document.getElementById("remPass").className="btn-login checkbox-un",tmpRem=0,document.getElementById("isRem").value=0,$("#checked").val(!1),$("#password").val(""),checked=$("#checked").val())})});
function initUploadDetail(){spinner.stop(),$("#saveAnotherName").click(function(){for(var anotherdata="",i=0;i<resultData.length;i++){var data=resultData[i].split(","),id=data[0].substring(1,data[0].length),anotherName=$("#anotherName"+data[0].substring(1,data[0].length)).val();anotherdata+=id+","+anotherName+";"}$.get("data!changeAnotherName",{dataIds:anotherdata.substring(0,anotherdata.length-1)},function(flag){flag>0?($("#anotherNameModal").modal("hide"),$("#anotherNameBody").html(""),$("#fileUpload").uploadify("cancel","*"),$("#progress").html(""),$("#progressTd").css("display","none"),resultData=[]):$("#saveAnotherNameDiv").html("别名修改失败...")})}),$("#closeModal").click(function(){$("#anotherNameModal").modal("hide"),$("#anotherNameBody").html(""),$("#fileUpload").uploadify("cancel","*"),$("#progress").html(""),$("#progressTd").css("display","none"),resultData=[]})}function hasFlashVersion(rv){var pv=flashVersion(),v=rv.split(".");return v[0]=parseInt(v[0],10),v[1]=parseInt(v[1],10),v[2]=parseInt(v[2],10),pv[0]>v[0]||pv[0]==v[0]&&pv[1]>v[1]||pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]}function flashVersion(){var version=[0,0,0],win=window,nav=navigator;if("undefined"!=typeof nav.plugins&&"object"==typeof nav.plugins["Shockwave Flash"])d=nav.plugins["Shockwave Flash"].description,d&&(d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),version[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10),version[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10),version[2]=/r/.test(d)?parseInt(d.replace(/^.*r(.*)$/,"$1"),10):0);else if("undefined"!=typeof win.ActiveXObject){var a=null,fp6Crash=!1;try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(e){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),version=[6,0,21],a.AllowScriptAccess="always"}catch(e){6==version[0]&&(fp6Crash=!0)}if(!fp6Crash)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){}}if(!fp6Crash&&a)try{d=a.GetVariable("$version"),d&&(d=d.split(" ")[1].split(","),version=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}catch(e){}}return version}function refreshSession(){$.get("uploadFile/checkAdminSessionTimeOut")}var opts={lines:7,length:10,width:5,radius:10,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},spinner;$.ajaxSetup({cache:!1});var totalSize=0,resultData=[];hasFlashVersion("10.0.124")?($("#_linAlert").css("display","none"),$("#_linTable").css("display","")):($("#_linAlert").css("display",""),$("#_linTable").css("display","none"));
function validateUpdatePwd(){}function submitUpdatePwd(){if(validateUpdatePwd()){var oldPwd=$("#inputOldPassword").val(),newPwd=$("#inputNewPassword").val();$.get("validatePwd.action",{password:oldPwd},function(result){result?($("#oldPwdSpanInfo").html(""),$.get("updateUserPwd.action",{password:newPwd},function(result){$("#resetPwdSpanInfo").attr("style",""),result?$("#resetPwdSpanInfo").html("修改成功！"):$("#resetPwdSpanInfo").html("修改失败！"),setInterval(clearPwdInfo,5e3)})):(flag=!1,$("#oldPwdSpanInfo").html("原密码输入不正确"))})}}function clearPwdInfo(){$("#resetPwdSpanInfo").html("")}function submitBaseInfo(){if(validateBaseInfo()){var email=$("#inputEmail").val(),telphone=$("#inputPhone").val();$.get("user!checkUserEmailByUserId",{"user.email":email},function(flag){return flag?($("#emailSpanInfo").html("该邮箱已存在"),flag):($("#emailSpanInfo").html(""),void $.get("updateUserBaseInfo.action",{"user.email":email,"user.cellPhone":telphone},function(flag){$("#updateBaseInfoDiv").attr("style",""),flag>0?$("#updateBaseInfoDiv").html("保存成功！"):$("#updateBaseInfoDiv").html("保存失败！"),setInterval(clearBaseInfo,5e3)}))})}}function clearBaseInfo(){$("#updateBaseInfoDiv").html("")}$(document).ready(function(){$.ajaxSetup({cache:!1}),$("#emailSpanInfo").html(""),$("#phoneSpanInfo").html(""),$("#updateBaseInfoDiv").html("")});var users=function(users){var self=users||{};return self.clearActive=function(){$("#appMain").find(".baseInfo").html(""),$("#userinfo").addClass("hide"),$("#changePwd").addClass("hide"),$("#operlog").addClass("hide"),$("#changeEmail").addClass("hide"),$("#userOperaUl li").removeClass("active")},self.showChangeEmail=function(){self.clearActive(),$("#changeEmailTab").addClass("active"),$("#changeEmail").removeClass("hide"),$("#subtitle").html("更换邮箱")},self.showUserInfo=function(){self.clearActive(),$("#userinfoTab").addClass("active"),$("#userinfo").removeClass("hide"),$("#subtitle").html("基本信息")},self.showChangePwd=function(){self.clearActive(),$("#inputOldPassword").val(""),$("#inputNewPassword").val(""),$("#inputConfirmPassword").val(""),$("#changePwdTab").addClass("active"),$("#changePwd").removeClass("hide"),$("#subtitle").html("修改密码")},self.showOperaLog=function(){self.clearActive(),$("#operlogTab").addClass("active"),$("#operlog").removeClass("hide"),$("#subtitle").html("操作日志"),$.get("user/logInfo",{},function(responseText){$("#operlog").html(responseText)})},self.searchLogInfo=function(page){page&&$("#operlog").load("user/logInfo",{currentPage:page})},self.validateEmail=function(){var email=$("#inputEmail").val();if(""==email)return $("#emailSpanInfo").html("请输入邮箱"),$("#inputEmail").focus(),!1;$("#emailSpanInfo").html("");var emailregex=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return!!emailregex.test(email)||(flag=!1,$("#emailSpanInfo").html("邮箱格式不正确"),$("#inputEmail").focus(),!1)},self.validateBaseInfo=function(){var telphone=$("#inputPhone").val();if(""==telphone)return!0;if(11!=telphone.length)return $("#phoneSpanInfo").html("手机号格式不正确"),$("#inputPhone").focus(),!1;$("#phoneSpanInfo").html("");var mobileregex=/^[\d+]{11}$/;return!!mobileregex.test(telphone)||($("#phoneSpanInfo").html("手机号格式不正确"),$("#inputPhone").focus(),!1)},self.validateUpdatePwd=function(){$("#oldPwdSpanInfo").html(""),$("#newPwdSpanInfo").html(""),$("#confirmPwdSpanInfo").html("");var oldPwd=$("#inputOldPassword").val(),newPwd=$("#inputNewPassword").val(),confirmPwd=$("#inputConfirmPassword").val();if(""==oldPwd)return $("#oldPwdSpanInfo").html("请输入原密码"),$("#inputOldPassword").focus(),!1;if(""==newPwd)return $("#newPwdSpanInfo").html("请输入新密码"),$("#inputNewPassword").focus(),!1;var numberRegex=/^[\d+]{6,16}$/;if(numberRegex.test(newPwd))return $("#newPwdSpanInfo").html("密码不能全为数字"),$("#inputNewPassword").focus(),!1;var combineRegex=/^[a-zA-Z0-9_]{6,16}$/;return combineRegex.test(newPwd)?""==confirmPwd?($("#confirmPwdSpanInfo").html("请输入确认密码"),$("#inputConfirmPassword").focus(),!1):confirmPwd==newPwd||($("#confirmPwdSpanInfo").html("确认密码与新密码不一致"),$("#inputConfirmPassword").focus(),!1):($("#newPwdSpanInfo").html("密码为6-16位的字母、数字及下划线组合"),$("#inputNewPassword").focus(),!1)},self.saveBaseInfo=function(){if($("#updateBaseInfoDiv").hide(),self.validateBaseInfo()){var url=$("#userBaseInfoForm").attr("action");$.post(url,$("#userBaseInfoForm").serialize(),function(data){"202"==data.code?($("#emailSpanInfo").html("该邮箱已存在"),$("#inputEmail").focus()):($("#updateBaseInfoDiv").show(),$("#updateBaseInfoDiv").html(data.message),data.data&&($("#inputEmail").val(data.data.email),$("#inputPhone").val(data.data.cellphone),$("#userImage").attr("src",data.data.avatar),$("#userImageSmall").attr("src",data.data.avatar),$("#userImageLarge").attr("src",data.data.avatar)))})}},self.updateEmail=function(){if($("#updateEmailDiv").hide(),self.validateEmail()){var url=$("#updateEmailForm").attr("action");$.post(url,$("#updateEmailForm").serialize(),function(data){0==data?$("#emailSpanInfo").html("邮件已发送，请进入邮箱处理。"):$("#emailSpanInfo").html("邮件发送失败，请检查邮箱是否正确。")})}},self.updatePassword=function(){if($("#resetPwdSpanInfo").html(""),self.validateUpdatePwd()){var url=$("#updatePasswordForm").attr("action");$.post(url,$("#updatePasswordForm").serialize(),function(data){"203"==data.code?($("#oldPwdSpanInfo").html("原始密码错误"),$("#inputOldPassword").focus()):(data.success&&$("#updatePasswordForm")[0].reset(),$("#resetPwdSpanInfo").show(),$("#resetPwdSpanInfo").html(data.message))})}},self.showUserImages=function(){$("#userImages").modal("show")},self.chooseUserImage=function(icon){$("#userBaseInfoForm input[name='icon']").val(icon),$("#userImage").attr("src",self.getAvatar(icon)),$("#userImages").modal("hide")},self.getAvatar=function(avatar){return"images/avatar/"+avatar+".png"},self}(users);
function forwardIndex(){window.location.href="<%=request.getContextPath() %>/login"}function validateSubmitEmail(){var email=$("#inputEmail").val();if(!email)return $(".error").html("请输入邮箱"),$("#inputEmail").focus(),!1;var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!filter.test(email))return $(".error").html("您的电子邮件格式不正确"),$("#inputEmail").focus(),!1;var validateCode=$("#inputValidateCode").val();return!!validateCode||($(".error").html("请输入验证码"),$("#inputValidateCode").focus(),!1)}function submitEmail(){$(".error").html(""),validateSubmitEmail()&&$("#findPasswordForm").submit()}function closePage(){window.opener=null,window.open("","_self"),window.close()}var wid=$(window).width(),per=50*(1-553/wid);$(".loginWrapper").css("left",per+"%"),$.ajaxSetup({cache:!1}),$(document).ready(function(){$("#alertInfo").html(""),$("#kaptchaImage").click(function(){$(this).hide().attr("src","kaptcha.jpg?"+Math.floor(100*Math.random())).fadeIn()}),$(document).on("keypress","#findPasswordForm",function(e){13==e.keyCode&&submitEmail()})}),$("#logo").click(function(){window.location="home.html"});
function secPWD(password){var modulus=$.trim($("#modulusHidden").val()),exponent=$.trim($("#exponentHidden").val()),key=RSAUtils.getKeyPair(exponent,"",modulus);return RSAUtils.encryptedString(key,password)}$(document).ready(function(){function checkUnBindForm(){$(".error").html("");var password=$.trim($("#password").val());return""==password?($(".error").html("请输入密码！"),$("#password").focus(),!1):(password&&$("input[name='password']").val(secPWD(password)),!0)}function checkForm(){$(".error").html("");var username=$.trim($("#username").val());if(""==username||username==$.trim($("#username").attr("placeholder")))return $(".error").html("请输入用户名！"),$("#username").val("").focus(),!1;var password=$.trim($("#password").val());return""==password?($(".error").html("请输入密码！"),$("#password").focus(),!1):(password&&$("input[name='password']").val(secPWD(password)),!0)}$.ajaxSetup({cache:!1}),error=$("#info").val(),""!=error?$(".error").html(error):$(".error").html(""),$("#submit").click(function(){checkForm()&&$("#loginForm").submit()}),$("#unBindSubmit").click(function(){checkUnBindForm()&&$("#unBindForm").submit()})});
!function(){celloudApp.controller("toAppStore",function($route,$scope,appService){$scope.toSclassifyApp=function(pid,pname){appService.toSclassifyApp(pid,pname).success(function(data){$("#appClassifyUl li").removeClass("active"),$("#classifypidLi"+pid).addClass("active"),$scope.classifyAppMap=data.classifyAppMap,$scope.sclassifys=data.sclassifys})},$scope.toAppDetail=function(id){$.get("app/appDetail",{paramId:id},function(responseText){$("#appMain").html(responseText),window.scrollTo(0,0),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","right"),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2),$("#manageAppBtns .btn").removeAttr("href"),$("#manageAppBtns .btn").removeAttr("onclick"),$("#manageAppBtns").bind("click",function(){1==hasNavi&&null!=intro&&($("#toUploadMenu").attr("data-step",3),intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(3)),$("#manageAppBtns").unbind("click")}))})},$scope.toMoreApp=function(pid,sid,pageNum,isParent){currentPage=pageNum,$("#rootClassifyName").unbind("click"),$("#secondClassifyName").unbind("click"),$.get("app/toMoreAppList",{classifyId:sid,classifyPid:pid,classifyFloor:isParent,size:pageAppNum,page:currentPage,condition:self.sortFiled,type:self.sortType},function(responseText){$("#appMain").html(responseText),0==pid?$("#rootClassifyName").html($("#pid"+sid).html()):$("#rootClassifyName").html($("#pid"+pid).html()),0==sid||0==pid?$("#secondClassifyName").html("全部"):$("#secondClassifyName").html($("#sid"+sid).html()),$("#rootClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}),"全部"==$("#secondClassifyName").html()?$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,0,1,0)}):$("#secondClassifyName").bind("click",function(){self.toMoreApp(pid,sid,pageNum,isParent)}),$("#secondClassifyName").parent().removeClass("hide"),$("#sortByCreateDate").bind("click",function(){self.sortFiled="a.create_date","desc"==self.sortType?self.sortType="asc":self.sortType="desc",self.toMoreApp(pid,sid,1,isParent)}),$("#defaultSort").bind("click",function(){self.sortFiled=null,self.sortType=null}),self.sortApp(),1==hasNavi&&null!=intro&&(intro.exit(),intro=null,intro=introJs(),intro.setOption("tooltipPosition","auto"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!1),intro.start(),intro.goToStep(2))})},$scope.removeApp=function(id){$.get("app/removeApp",{paramId:id},function(responseText){responseText>0&&appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()})})},$scope.refreshProduct=function(){var appElement=document.querySelector("[ng-controller=sidebarController]"),element=angular.element(appElement),$scope=element.scope();$scope.refreshUserProduct()},appService.toAppStore().success(function(data){$scope.pclassifys=data,appService.getMyApp().success(function(data){$scope.appList=data;var pid=$scope.pclassifys[0].classifyId,pname=$scope.pclassifys[0].classifyName;$scope.toSclassifyApp(pid,pname)})})}),celloudApp.controller("toAppDetail",function($routeParams,$route,$scope,appService){appService.getAppDetail($routeParams.pid).success(function(data){$scope.app=data.app,$scope.screenList=data.screenList,window.scrollTo(0,0),appService.getMyApp().success(function(data){$scope.appList=data})}),$scope.refreshProduct=function(){var appElement=document.querySelector("[ng-controller=sidebarController]"),element=angular.element(appElement),$scope=element.scope();$scope.refreshUserProduct()},$scope.toAppMoreDetail=function(id){$("#toAppMoreDetailUl li").removeClass("select"),$("#"+id).addClass("select")},$scope.addApp=function(id){$.get("app/addApp",{paramId:id},function(responseText){responseText>0&&($scope.app.isAdded=1,appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()}))})},$scope.removeApp=function(id){$.get("app/removeApp",{paramId:id},function(responseText){responseText>0&&($scope.app.appId==id&&($scope.app.isAdded=0),appService.getMyApp().success(function(data){$scope.appList=data,$scope.refreshProduct()}))})}})}();
!function(){celloudApp.service("appService",function($http){this.toAppStore=function(){return $http({method:"POST",url:"app/toAppStore",headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getMyApp=function(){return $http({method:"POST",url:"app/myApps"})},this.toSclassifyApp=function(pid,pname){return $http({method:"POST",url:"app/toSclassifyApp",data:$.param({paramId:pid}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getAppDetail=function(pid){return $http({method:"POST",url:"app/appDetail",data:$.param({paramId:pid}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){var intro;celloudApp.controller("sidebarController",function($scope,$location,$rootScope,$timeout,commonService){$("#imageFullScreen").smartZoom({containerClass:"zoomableContainer"});var revise=$(document).width()-$(".sidebar-menu").width();$("#pageContent").css("width",revise+"px"),$(".sidebar-menu").resize(function(){revise=$(document).width()-$(this).width(),$("#pageContent").css("width",revise+"px")}),$rootScope.showZoom=function(src){var bh=$("body").height(),bw=$("body").width();$("#imageFullScreen").smartZoom({containerClass:"zoomableContainer"}),$("#imageFullScreen").attr("src",src),$("#fullbg").css({height:bh,width:bw,display:"block"}),$("#closeZoom").css("display","block"),$("#pageContent").show()},$rootScope.closeZoom=function(){$("#imageFullScreen").smartZoom("destroy"),$("#fullbg,#pageContent,#closeZoom").hide()},$rootScope.bigFigure=function(src){$("img[id='imageFullScreen']").css("width",960),$("img[id='imageFullScreen']").css("height",144),$rootScope.showZoom(src)},$rootScope.bigOrigin=function(src,id){var width=$("#"+id).width(),height=$("#"+id).height();$("img[id='imageFullScreen']").css("width",1.5*width),$("img[id='imageFullScreen']").css("height",1.5*height),$rootScope.showZoom(src)},$rootScope.bigReplace=function(src){$("img[id='imageFullScreen']").css("width",1050),$("img[id='imageFullScreen']").css("height",157.5),$rootScope.showZoom(src)},$scope.isActive=function(viewLocation){return"/"!=viewLocation?$location.path().indexOf(viewLocation)>=0:viewLocation===$location.path()},$rootScope.collapsed=!1,$scope.toggleCollapse=function(){$scope.collapsed?$scope.collapsed=!1:$scope.collapsed=!0},$rootScope.errorInfo="",$scope.refreshUserProduct=function(){$rootScope.userProduct=commonService.getProduct().get()},$rootScope.userProduct=commonService.getProduct().get(),$rootScope.userInfo=commonService.getUserInfo().get(),$rootScope.messages=commonService.messages.get(),$rootScope.notices=commonService.notices.get(),$rootScope.tipsModal=function(info){$rootScope.errorInfo=info,$("#tips-modal").modal("show")},$rootScope.changeChevronType=function(chevronType){return chevronType=!chevronType},$rootScope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p},messageUtils.subscribe("userMessage",function(data){$rootScope.messages=commonService.messages.get(),console.log("监听userMessage"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close()}})}),messageUtils.subscribe("userNotice",function(data){$rootScope.notices=commonService.notices.get(),console.log("监听userNotice"),messageUtils.notify(data.noticeTitle,data.noticeContext,{},{onclick:function(){var notification=this;notification.close()}})}),$timeout(function(){1==window.navigation&&(intro=introJs(),intro.setOption("tooltipPosition","bottom"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.start())},1e3)})}();
!function(){celloudApp.filter("collapsedFilter",function(){return function(collapsed){return collapsed?"collapsed":""}}),celloudApp.filter("logoMiniFilter",function(){return function(collapsed){return collapsed?"mini":""}}),celloudApp.filter("collapsedIconFilter",function(){return function(collapsed){return collapsed?"right-indent-icon":"left-indent-icon"}}),celloudApp.filter("proSidebarLeftFilter",function(){return function(collapsed){return collapsed?"":"large-left"}}),celloudApp.filter("chevronTypeFaFilter",function(){return function(chevronType){return chevronType?"fa fa-chevron-down":"fa fa-chevron-up"}}),celloudApp.filter("chevronTypeTextFilter",function(){return function(chevronType){return chevronType?"更多":"收起"}}),celloudApp.filter("chevronTypeDivFilter",function(){return function(chevronType){return chevronType?"":"more"}}),celloudApp.filter("contextLengthFilter",function(){return function(context,length){return context.length<=length?context:context.substring(0,length)+"..."}}),celloudApp.filter("getResultByCompare",function(){return function(input,compare,r1,r2){return input!=compare?r1:r2}}),celloudApp.filter("fileSizeFormat",function(){return function(size){return 0==size?0:size<1024&&size>0?size+"B":size<1048576&&size>=1024?(temp=size/1024,temp.toFixed(2)+"KB"):size<1073741824&&size>=1048576?(temp=size/1048576,temp.toFixed(2)+"MB"):size>=1073741824?(temp=size/1073741824,temp.toFixed(2)+"GB"):"文件大小异常"}}),celloudApp.filter("trustHtml",["$sce",function($sce){return function(text){return $sce.trustAsHtml(text)}}]),celloudApp.filter("taskPeriodFilter",function(){return function(period){return 0==period?"等待分析":1==period?"分析中":2==period?"完成":3==period?"数据不完整":4==period?"异常终止":5==period?"送样中":6==period?"实验中":""}})}();
!function(){celloudApp.factory("tipsModalService",function(){$("#tips-modal").modal("show")}),celloudApp.service("commonService",function($resource){var self=this;self.getUserInfo=function(){return $resource("user/info")},self.messages=$resource("notice/lastUnread/message"),self.notices=$resource("notice/lastUnread/notice"),self.getProduct=function(){return $resource("app/getProduct?random="+(new Date).getTime())}})}();
!function(){celloudApp.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"pages/overview/overview.jsp"}).when("/user/base",{templateUrl:"pages/user/user_base.jsp",controller:"updateBaseInfo"}).when("/user/pwd",{templateUrl:"pages/user/user_pwdreset.jsp",controller:"updatePassword"}).when("/user/log",{templateUrl:"pages/user/user_log.jsp",controller:"pageQueryLog"}).when("/user/log/p:page",{templateUrl:"pages/user/user_log.jsp",controller:"pageQueryLog"}).when("/user/report",{templateUrl:"pages/user/user_reportset.jsp"}).when("/user/email",{templateUrl:"pages/user/user_emailreset.jsp",controller:"updateEmail"}).when("/user/set",{templateUrl:"pages/user/user_reportset.jsp",controller:"setReportController"}).when("/count",{templateUrl:"pages/count/count_main.jsp"}).when("/data",{templateUrl:"pages/data/data_list.jsp",controller:"dataListController"}).when("/expense/consume",{templateUrl:"pages/expense/expense_consume.jsp",controller:"pageQueryConsume"}).when("/expense/consume/p:page",{templateUrl:"pages/expense/expense_consume.jsp",controller:"pageQueryConsume"}).when("/expense/paydetail",{templateUrl:"pages/expense/expense_pay.jsp",controller:"toRecharge"}).when("/expense/paylist",{templateUrl:"pages/expense/expense_paylist.jsp",controller:"pageQueryRecharge"}).when("/expense/paylist/p:page",{templateUrl:"pages/expense/expense_paylist.jsp",controller:"pageQueryRecharge"}).when("/expense/invoice",{templateUrl:"pages/expense/expense_invoicelist.jsp",controller:"pageQueryInvoice"}).when("/expense/invoice/p:page",{templateUrl:"pages/expense/expense_invoicelist.jsp",controller:"pageQueryInvoice"}).when("/feedback",{templateUrl:"pages/feedback/feedback_main.jsp",controller:"feedbackController"}).when("/notices",{templateUrl:"pages/notice/notices.jsp",controller:"noticeController"}).when("/messages",{templateUrl:"pages/notice/messages.jsp",controller:"messageController"}).when("/message/setting",{templateUrl:"pages/notice/notice_set.jsp",controller:"settingController"}).when("/reportdata",{templateUrl:"pages/report/report_data.jsp",controller:"dataReportController"}).when("/reportpro",{templateUrl:"pages/report/report_project.jsp",controller:"projectReportController"}).when("/reportpro/EGFR/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_egfr.jsp",controller:"egfrDataReportController"}).when("/reportpro/KRAS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_kras.jsp",controller:"krasDataReportController"}).when("/reportpro/HCV_Genotype/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_hcv.jsp",controller:"hcvDataReportController"}).when("/reportpro/BRAF/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_braf.jsp",controller:"brafDataReportController"}).when("/reportpro/TB-Rifampicin/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_tbrifampicin.jsp",controller:"tbRifampicinDataReportController"}).when("/reportpro/TB-INH/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_tbinh.jsp",controller:"tbinhDataReportController"}).when("/reportpro/HBV_SNP2/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_hbv.jsp",controller:"hbvDataReportController"}).when("/reportpro/oncogene/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_oncogene.jsp",controller:"oncogeneDataReportController"}).when("/reportpro/DPD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_dpd.jsp",controller:"dpdDataReportController"}).when("/reportpro/ABI_NJ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_abinj.jsp",controller:"abinjDataReportController"}).when("/reportpro/UGT/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_ugt.jsp",controller:"ugtDataReportController"}).when("/reportpro/16S/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_16s.jsp",controller:"16sDataReportController"}).when("/reportpro/translate_simplified/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_translate.jsp",controller:"translateDataReportController"}).when("/reportpro/PGS/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_pgs.jsp",controller:"pgsDataReportController"}).when("/reportpro/GDD/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_gdd.jsp",controller:"gddDataReportController"}).when("/reportpro/AccuSeqΩ/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_gdd.jsp",controller:"gddDataReportController"}).when("/reportpro/CMP/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportpro/AccuSeqα/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportpro/CMP_199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportpro/AccuSeqα199/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_cmp.jsp",controller:"cmpDataReportController"}).when("/reportdata/split/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_split.jsp",controller:"splitDataReportController"}).when("/reportdata/BSI/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_bsi.jsp",controller:"bsiDataReportController"}).when("/reportdata/rocky/:appId/:dataKey/:projectId",{templateUrl:"pages/report/report_data_rocky.jsp",controller:"rockyDataReportController"}).when("/app",{templateUrl:"pages/app/app_main.jsp",controller:"toAppStore"}).when("/app/detail/:pid",{templateUrl:"pages/app/app_detail_main.jsp",controller:"toAppDetail"}).when("/reportdata/bsi",{templateUrl:"pages/report/report_data_bsi.jsp"}).when("/reportdata/MIB/:appId/:dataKey/:proId",{templateUrl:"pages/report/report_data_mib.jsp",controller:"mibReportController"}).when("/reportpro/MIB/:appId/:dataKey/:proId",{templateUrl:"pages/report/report_data_mib.jsp",controller:"mibReportController"}).when("/sampling",{templateUrl:"pages/experiment_scan/sampling.jsp",controller:"samplingController"}).when("/experiment/scanStorage",{templateUrl:"pages/experiment_scan/scan_storage.jsp",controller:"scanStorageController"}).when("/experiment/tokenDNA",{templateUrl:"pages/experiment_scan/token_dna.jsp",controller:"tokenDNAController"}).when("/experiment/createLibrary",{templateUrl:"pages/experiment_scan/create_library.jsp",controller:"buidLibraryController"}).when("/experiment/libraryList",{templateUrl:"pages/experiment_scan/library_list.jsp",controller:"storagesController"}).when("/experiment/libraryList/:ssId",{templateUrl:"pages/experiment_scan/library_detail.jsp",controller:"storagesController"}).otherwise({redirectTo:"/"})})}();
!function(){celloudApp.controller("dataListController",function($scope,$rootScope,$location,$routeParams,runService){$scope.pageQuery=function(page,pageSize){$.dataManager.options.condition=$scope.dataCondition,$.dataManager.options.page=page,$.dataManager.options.pageSize=pageSize,runService.pageList().success(function(response){$scope.dataList=response}),$.dataManager.refreshDataList("clean")},$scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$scope.conditionList=function(){$scope.pageQuery(1,$.dataManager.options.pageSize)},$scope.doSearch=function($event){13==$event.keyCode&&$scope.conditionList()},$scope.checkNum=function(){var checkedIds=$.dataManager.options.checkedIds;if(0==checkedIds.length)return $rootScope.errorInfo="请选择至少一条记录",$("#tips-modal").modal("show"),!1;var maxNum=$.dataManager.options.dataMax;return!(checkedIds.length>maxNum)||($rootScope.errorInfo="最多允许同时操作"+maxNum+"条数据！",$("#tips-modal").modal("show"),!1)},$scope.runWithProject=function(){if($scope.checkNum())return 0!=$.dataManager.options.isRun?($rootScope.errorInfo="所勾选的数据必须不处于运行状态！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isTag?($rootScope.errorInfo="所勾选的数据必须有产品标签！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isBSI?($rootScope.errorInfo="所勾选的数据产品标签不能为百菌探！",void $("#tips-modal").modal("show")):0!=$.dataManager.options.isRocky?($rootScope.errorInfo="所勾选的数据产品标签不能为华木兰！",void $("#tips-modal").modal("show")):void(0!=$.dataManager.options.isPair?$.confirm("请保证所选数据为配对数据！","确认框",function(){$scope.run()}):$scope.run())},$scope.run=function(){var checkedIds=$.dataManager.options.checkedIds;return checkedIds.length!=$.dataManager.options.validIds?($rootScope.errorInfo="数据选择异常，请刷新页面后重新选择！",void $("#tips-modal").modal("show")):void runService.run().success(function(response){response.success?($.alert("运行成功"),$scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$.dataManager.refreshDataList()):$scope.message=response.message})},$scope.deleteData=function(){$scope.checkNum()&&$.confirm("确定要归档所选数据？","确认框",function(){runService.deleteData().success(function(response){response.success&&($scope.conditionList(),$.dataManager.refreshDataList()),$.alert(response.message)})})},$scope.toEditData=function(fileId){$scope.updateState=!1,runService.toEditData(fileId).success(function(response){for($scope.dataFile=response.file,$scope.appList=response.appList,i=0;i<$scope.appList.length;i++)if($.trim($scope.appList[i].tagName)==$.trim($scope.dataFile.tagName)){$scope.appSelected=$scope.appList[i];break}})},$scope.submitEditData=function(){var alias=$scope.dataFile.anotherName;if(null!=alias&&alias.length>50)return $scope.updateMessage="文件别名不能超过50个字符",void($scope.updateState=!0);var batch=$scope.dataFile.batch;return null!=batch&&batch.length>50?($scope.updateMessage="数据标签不能超过50个字符",void($scope.updateState=!0)):($scope.updateState=!1,$scope.dataFile.tagName=void 0==$scope.appSelected?"":$scope.appSelected.tagName,void runService.submitEditData($scope.dataFile).success(function(response){response.success&&($scope.pageQuery($.dataManager.options.page,$.dataManager.options.pageSize),$.dataManager.refreshDataList(),$("#data-detail-modal").modal("hide")),$.alert(response.message)}))}})}();
function _init_data(){$.dataManager.options={condition:null,page:1,pageSize:20,sort:0,dataMax:25,sortDateType:"desc",sortNameType:"asc",checkedIds:[],validIds:0,isRun:0,isTag:0,isBSI:0,isRocky:0,isPair:0},$.dataManager.checkOneData=function(obj){var _checked=$(obj).prop("checked"),_dataId=$(obj).val(),_isRun=$(obj).attr("is_run"),_isTag=$(obj).attr("is_tag"),_isBSI=$(obj).attr("is_bsi"),_isRocky=$(obj).attr("is_rocky"),_isPair=$(obj).attr("is_pair");_checked?($.dataManager.checkData.isCheck(_dataId),"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun+1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag+1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI+1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky+1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair+1,$.dataManager.options.validIds=$.dataManager.options.validIds+1):$.dataManager.options.validIds=$.dataManager.options.validIds+1):($.dataManager.checkData.noCheck(_dataId),"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun-1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag-1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI-1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky-1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair-1,$.dataManager.options.validIds=$.dataManager.options.validIds-1):$.dataManager.options.validIds=$.dataManager.options.validIds-1),$.dataManager.editBtn.update()},$.dataManager.checkAll=function(obj,name){var _checked=$(obj).prop("checked");if($.dataManager.options.checkedIds=new Array,_checked){for(var choicearr=document.getElementsByName(name),_checkedLength=choicearr.length,i=0;i<_checkedLength;i++)if(0==$(choicearr[i]).prop("disabled")){if(0==$(choicearr[i]).prop("checked")){var _isRun=$(choicearr[i]).attr("is_run"),_isTag=$(choicearr[i]).attr("is_tag"),_isBSI=$(choicearr[i]).attr("is_bsi"),_isRocky=$(choicearr[i]).attr("is_rocky"),_isPair=$(choicearr[i]).attr("is_pair");"true"==_isRun?$.dataManager.options.isRun=$.dataManager.options.isRun+1:"true"==_isTag?$.dataManager.options.isTag=$.dataManager.options.isTag+1:"true"==_isBSI?$.dataManager.options.isBSI=$.dataManager.options.isBSI+1:"true"==_isRocky?$.dataManager.options.isRocky=$.dataManager.options.isRocky+1:"true"==_isPair?($.dataManager.options.isPair=$.dataManager.options.isPair+1,$.dataManager.options.validIds=$.dataManager.options.validIds+1):$.dataManager.options.validIds=$.dataManager.options.validIds+1}$(choicearr[i]).prop("checked",!0);var dataId=$(choicearr[i]).val();$.dataManager.checkData.isCheck(dataId)}$.dataManager.options.checkedIds.length>0&&$.dataManager.editBtn.show()}else $("[name='"+name+"']").prop("checked",!1),$.dataManager.options.isRun=0,$.dataManager.options.isTag=0,$.dataManager.options.isBSI=0,$.dataManager.options.isRocky=0,$.dataManager.options.isPair=0,$.dataManager.options.validIds=0,$.dataManager.editBtn.disable()},$.dataManager.cleanCheckbox=function(name){$("input[type='checkbox'][name='"+name+"']").prop("checked",!1)},$.dataManager.refreshDataList=function(name){$.dataManager.options.checkedIds=new Array,$.dataManager.options.isRun=0,$.dataManager.options.isTag=0,$.dataManager.options.isBSI=0,$.dataManager.options.isRocky=0,$.dataManager.options.isPair=0,$.dataManager.options.validIds=0,$.dataManager.editBtn.update(),$.dataManager.cleanCheckbox("demo-checkbox1")},$.dataManager.checkData={isCheck:function(dataId){$.dataManager.options.checkedIds.push(dataId),$("input[name='data-checkone']").length==$.dataManager.options.checkedIds.length&&$("#data-checkall").prop("checked",!0)},noCheck:function(dataId){$("#data-checkall").prop("checked",!1);var index=$.inArray(dataId.toString(),$.dataManager.options.checkedIds);$.dataManager.options.checkedIds.splice(index,1)}},$.dataManager.editBtn={update:function(){var _checkedIds=$.dataManager.options.checkedIds;_checkedIds.length>0?$.dataManager.editBtn.show():$.dataManager.editBtn.disable()},show:function(){$(".data-operate").attr("disabled",!1),$(".data-operate").removeClass("btn-cancel")},disable:function(){$(".data-operate").attr("disabled",!0),$(".data-operate").addClass("btn-cancel")}}}$.dataManager={},$.ajaxSetup({cache:!1}),$(function(){_init_data()});
!function(){celloudApp.service("runService",function($resource,$http){var self=this;self.pageList=function(){var options=$.dataManager.options;return $http.get("data/dataPageListCondition?random="+(new Date).getTime(),{params:{page:options.page,size:options.pageSize,condition:options.condition,sort:options.sort,sortDateType:options.sortDateType,sortNameType:options.sortNameType}})},self.run=function(){var checkedIds=$.dataManager.options.checkedIds,dataIds=[];return $.each(checkedIds,function(i,el){$.inArray(el,dataIds)===-1&&dataIds.push(el)}),$http.get("data/runWithProject",{params:{dataIds:dataIds.toString()}})},self.deleteData=function(){for(var checkedIds=$.dataManager.options.checkedIds,dataIds="",i=0;i<checkedIds.length;i++)dataIds+=checkedIds[i]+",";return dataIds=dataIds.substring(0,dataIds.length-1),$http.get("data/delete.action",{params:{dataIds:dataIds}})},self.toEditData=function(fileId){return $http.get("data/toEditData",{params:{dataId:fileId}})},self.submitEditData=function(dataFile){return $http.get("data/updateDataAndTag",{params:{fileId:dataFile.fileId,anotherName:dataFile.anotherName,batch:dataFile.batch,tagName:dataFile.tagName}})}})}();
!function(){celloudApp.directive("diHref",["$location","$route",function($location,$route){return function(scope,element,attrs){scope.$watch("diHref",function(){attrs.diHref&&(element.attr("href",attrs.diHref),element.bind("click",function(event){scope.$apply(function(){$location.path()==attrs.diHref.substr(attrs.diHref.indexOf("#/")+1)&&$route.reload()})}))})}}])}();
!function(){celloudApp.directive("pagination",function(){return{restrict:"E",replace:!0,scope:{page:"=",change:"&"},templateUrl:"pages/partial/_partial_pagination_template.jsp",controller:function($scope){$scope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p}}}})}();
!function(){angular.module("celloudApp").directive("collapse-sidebar",["$location",function($location){return{restrict:"A",replace:!1,link:function(scope,elem){scope.$on("$routeChangeSuccess",function(){var hrefs=["/#"+$location.path(),"#"+$location.path(),$location.path()];angular.forEach(elem.find("a"),function(a){a=angular.element(a),-1!==hrefs.indexOf(a.attr("href"))?a.parent().addClass("active"):a.parent().removeClass("active")})})}}}])}();
!function(){celloudApp.controller("samplingController",function($rootScope,$scope,samplingService){$scope.sampleList=samplingService.sampleList(),$scope.productTags=samplingService.getProductTags(),$scope.typeList=["血","组织液","引流液","关节液","心包积液","胸水","脓液","脑脊液","阴道拭子","腹水","尿液","肺泡灌洗液"],$scope.addSample=function(){samplingService.sampling($scope.sampleName,$scope.selTags.tagId,$scope.type).success(function(data){2==data?$.alert("此样品信息已经收集过，请核查或者采集下一管样品信息！"):$scope.sampleList=samplingService.sampleList(),$scope.sampleName=""})},$scope.commitSample=function(){samplingService.commitSample($scope.sampleList).success(function(data){data>0?$scope.sampleList=samplingService.sampleList():$.alert("样本已提交")})},$scope.deleteSample=function(id){samplingService.deleteSample(id).success(function(data){data>0?($scope.sampleList=samplingService.sampleList(),$.alert("删除样本成功")):$.alert("删除样本失败")})}}),celloudApp.controller("scanStorageController",function($rootScope,$scope,scanStorageService){$scope.pages={page:1,pageSize:20},$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},scanStorageService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data})},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.scanStorage())},$scope.scanStorage=function(){return""==$scope.sampleName||void 0==$scope.sampleName?($.alert("请输入样本信息！"),!1):void scanStorageService.scanStorage($scope.sampleName).success(function(data){0==data?$.alert("系统中无此样本信息，请确认是已采样样本！"):data>0?$rootScope.sampleList=$scope.pageQuery($scope.page,$scope.pageSize):$.alert("此样品信息已经收集过，请核查或者采集下一管样品信息！"),$scope.sampleName=""})},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($scope.pageQuery($scope.pages.page,$scope.pages.pageSize),$.alert("样本删除成功")):$.alert("样本删除失败")})},$rootScope.sampleList=$scope.pageQuery($scope.page,$scope.pageSize)}),celloudApp.controller("tokenDNAController",function($rootScope,$scope,scanStorageService,tokenDNAService){$scope.pages={page:1,pageSize:20},$scope.pageQuery=function(page,pageSize){$scope.pages={page:page,pageSize:pageSize},tokenDNAService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data})},$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||$scope.tokenDNA())},$scope.tokenDNA=function(){return""==$scope.sampleName||void 0==$scope.sampleName?($.alert("请输入样本信息！"),!1):void tokenDNAService.tokenDNA($scope.sampleName).success(function(data){0==data?$.alert("此样本未入库"):data>0?$rootScope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize):$.alert("此样品信息已经收集过，请核查或者采集下一管样品信息！"),$scope.sampleName=""})},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($rootScope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize),$.alert("样本删除成功")):$.alert("样本删除失败")})},$rootScope.sampleList=$scope.pageQuery($scope.pages.page,$scope.pages.pageSize)}),celloudApp.controller("buidLibraryController",function($rootScope,$scope,scanStorageService,buidLibraryService){$scope.infos=buidLibraryService.infos(),$scope.doOnKeyPress=function($event){13==$event.keyCode&&(""==$scope.sampleName||void 0==$scope.sampleName||""==$scope.sindex||void 0==$scope.sindex?$.alert("请输入样本信息"):$scope.addSample())},$scope.addSample=function(){var sampleList=$scope.infos.pageList.datas;sampleList.length>=12?$.tips("每个文库最多12个样本！"):""==$scope.sampleName||void 0==$scope.sampleName?$.alert("请输入样本信息"):buidLibraryService.addSample($scope.sampleName,sampleList).success(function(data){data>0?$scope.infos=buidLibraryService.infos():0==data?$.alert("此样本未提取DNA"):$.alert("此样品信息已经入库，请核查或者扫描下一管样品信息！")}),$scope.sampleName=""},$scope.remove=function(id){scanStorageService.remove(id).success(function(data){data>0?($scope.infos=buidLibraryService.infos(),$.alert("样本删除成功")):$.alert("样本删除失败")})},$scope.addLibrary=function(){buidLibraryService.addLibrary($scope.infos.libraryName,$scope.sindex,$scope.infos.pageList.datas).success(function(data){data>0?($scope.infos=buidLibraryService.infos(),$.alert("建库成功！")):($scope.repeatError=!0,$.alert("建库失败！"))})},$scope.addAndDownLibrary=function(){buidLibraryService.addLibrary($scope.infos.libraryName,$scope.sindex,$scope.infos.pageList.datas).success(function(data){if(0==data)$scope.notPrevError=!0;else if(data>0){var storageName=$scope.infos.libraryName;$scope.infos=buidLibraryService.infos(),buidLibraryService.downloadExcel(data,storageName).success(function(flag){if(1==flag)$.alert("没有正确生成Excel文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"sample/downExperExcel?ssId="+data+"&storageName="+storageName,$.alert("建库并下载成功！")}})}else $scope.repeatError=!0})}}),celloudApp.controller("storagesController",function($rootScope,$scope,storagesService,buidLibraryService){$scope.storages=storagesService.storages(),storagesService.sampleList().success(function(data){$scope.sampleList=data});var pages={page:1,pageSize:10};$scope.pageQuery=function(page,pageSize){pages={page:page,pageSize:pageSize},storagesService.pageList(page,pageSize).success(function(data){$scope.storages=data})},$scope.download=function(id,storageName){buidLibraryService.downloadExcel(id,storageName).success(function(flag){if(1==flag)$.alert("没有正确生成Excel文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"sample/downExperExcel?ssId="+id+"&storageName="+storageName,$.alert("下载Excel文件成功！")}})}}),celloudApp.controller("editSampleController",function($rootScope,$scope,scanStorageService,tokenDNAService){$scope.toEditRemark=function(id,remark){$scope.sampleId=id,$scope.remark=remark,$scope.remark_bak=remark},$scope.resetSampleRemark=function(){$scope.remark=angular.copy($scope.remark_bak)},$scope.editRemark=function(){scanStorageService.editRemark($scope.sampleId,$scope.remark).success(function(data){data>0?(1==$scope.exper_state?scanStorageService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data}):tokenDNAService.pageList($scope.pages.page,$scope.pages.pageSize).success(function(data){$rootScope.sampleList=data}),$.alert("样本修改成功")):$.alert("样本修改失败"),$("#sample-remark-modal").modal("hide")})}})}();
!function(){celloudApp.service("samplingService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getSamplingList").query()},self.getProductTags=function(){return $resource("uploadFile/getProductTag").query()},self.sampling=function(sampleName,tagId,type){return $http({method:"POST",url:"sample/sampling",params:{sampleName:sampleName,tagId:tagId,type:type}})},self.deleteSample=function(id){return $http({method:"POST",url:"sample/bsi/deleteOne",params:{sampleId:id}})},self.commitSample=function(sampleList){var sampleIds=new Array;for(s in sampleList)void 0!=sampleList[s].sampleId&&sampleIds.push(sampleList[s].sampleId);return $http({method:"POST",url:"sample/commitSampling",params:{sampleIds:sampleIds}})}}),celloudApp.service("scanStorageService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getScanStorageSamples").get()},self.pageList=function(page,size){return $http.get("sample/getScanStorageSamples",{params:{page:page,size:size}})},self.scanStorage=function(sampleName){return $http({method:"POST",url:"sample/toScanStorage",params:{sampleName:sampleName}})},self.editRemark=function(id,remark){return $http({method:"POST",url:"sample/editRemark",params:{sampleId:id,remark:remark}})},self.remove=function(id){return $http({method:"POST",url:"sample/removeSampleLog",params:{sampleLogId:id}})}}),celloudApp.service("tokenDNAService",function($resource,$http){var self=this;self.sampleList=function(){return $resource("sample/getTokenDnaSamples").get()},self.pageList=function(page,size){return $http.get("sample/getTokenDnaSamples",{params:{page:page,size:size}})},self.tokenDNA=function(sampleName){return $http({method:"POST",url:"sample/toTokenDNA",params:{sampleName:sampleName}})}}),celloudApp.service("buidLibraryService",function($resource,$http){var self=this;self.infos=function(){return $resource("sample/getBuidLibrarySamples").get()},self.addSample=function(sampleName,sampleList){var sindexs=new Array;for(s in sampleList)sindexs.push(sampleList[s].sindex);return $http({method:"POST",url:"sample/addSampleToLibrary",params:{sampleName:sampleName,sindexs:sindexs}})},self.addLibrary=function(libraryName,sindex,sampleList){var sampleIds=new Array;for(s in sampleList)void 0!=sampleList[s].sampleId&&sampleIds.push(sampleList[s].sampleId);return $http({method:"POST",url:"sample/addLibrary",params:{libraryName:libraryName,sindex:sindex,sampleIds:sampleIds}})},self.downloadExcel=function(ssId,storageName){return $http.get("sample/downExperExcel",{params:{ssId:ssId,storageName:storageName}})}}),celloudApp.service("storagesService",function($resource,$http,$routeParams){var self=this;self.storages=function(){return $resource("sample/getSampleStorages").get()},self.pageList=function(page,size){return $http.get("sample/getSampleStorages",{params:{page:page,size:size}})},self.sampleList=function(){return $http.get("sample/sampleListInStorage",{params:{ssId:$routeParams.ssId}})}})}();
!function(){celloudApp.controller("pageQueryConsume",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryConsume=function(currentPage,pageSize){expenseService.pageQueryConsume(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryConsume(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryConsume(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryConsume($routeParams.page,$rootScope.pageSize)}),celloudApp.controller("pageQueryRecharge",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryRecharge=function(currentPage,pageSize){expenseService.pageQueryRecharge(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList,$("input[name=checkAll]").prop("checked",!1)})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryRecharge(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryRecharge(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryRecharge($routeParams.page,$rootScope.pageSize),$scope.reset=function(){$scope.invoiceForm={}},$("input[name=checkAll]").click(function(){$(this).prop("checked")?$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").prop("checked",!0):$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").prop("checked",!1)}),$scope.rechargeIds=function(){$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]").length==$("input[name='rechargeIds'][disabled!=disabled][type=checkbox]:checked").length?$("#checkAll").prop("checked",!0):$("#checkAll").prop("checked",!1)},$scope.applyInvoice=function(){var rechargeIds=$("input[name='rechargeIds']:checked"),money=0;if(rechargeIds.length<1)return $rootScope.errorInfo="请选择至少一条记录",void $("#tips-modal").modal("show");if(rechargeIds.each(function(){money+=parseFloat($(this).parent().parent().siblings().eq(0).html())}),money<100&&.02!=money)return $rootScope.errorInfo="最少申请100元",void $("#tips-modal").modal("show");$("#apply-invoice-modal").modal("show"),$("#money").attr("value",money);var ids=new Array;rechargeIds.each(function(){ids.push($(this).val())}),$("#rechargeIds").val(ids.join(","))},$scope.apply=function(){$("#invoiceSubmit").prop("disabled",!0),$scope.invoiceForm.invoiceType=$("input[name=invoiceType]:checked").val(),$scope.invoiceForm.rechargeIds=$("#rechargeIds").val(),expenseService.apply($scope.invoiceForm).success(function(data){$("#apply-invoice-modal").modal("hide"),data>0?($.alert("申请成功!"),$scope.pageQueryRecharge(1,10)):$.alert("发生未知错误,请联系管理员!")}),$("#invoiceSubmit").prop("disabled",!1)},$scope.length=0,$scope.invoiceForm={}}),celloudApp.controller("pageQueryInvoice",function($scope,$rootScope,$routeParams,$location,expenseService){$scope.pageQueryInvoice=function(currentPage,pageSize){expenseService.pageQueryInvoice(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryInvoice(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryInvoice(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryInvoice($routeParams.page,$rootScope.pageSize),$scope.showInvoiceDetail=function(invoiceId){expenseService.getInvoiceById(invoiceId).success(function(invoiceDetail){$scope.invoiceDetail=invoiceDetail})}}),celloudApp.controller("toRecharge",function($scope,$rootScope,expenseService){expenseService.toRecharge().success(function(data){$scope.balance=data}),$scope.tab="pay_tab_alipay",$scope.pay_type="online",$scope.rechargeForm={money:10},$scope.checkMoney=function(){var money=$scope.rechargeForm.money;return $.isNumeric(money)?1*money<10&&1*money!=.01?($scope.moneyError="充值金额要大于10元哦！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):1*money>1e4?($scope.moneyError="大于10000元的充值金额，请使用公司转账方式充值！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):money!=parseInt(money)&&.01!=money?($scope.moneyError="请输入整数金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):$.isNumeric(money)?($scope.checkFlag=!1,$scope.checkSubmit=!1,!0):void 0:($scope.moneyError="请正确输入充值金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1)},$scope.sumbitRecharge=function(){var payWay=$("input[name=pay-way]:checked").val(),action=CONTEXT_PATH+"/pay/recharge/"+payWay;$("#rechargeForm").attr("action",action),$rootScope.errorInfo="请在新打开的页面完成支付操作！",$("#tips-modal").modal("show")}})}();
celloudApp.filter("substring",function(){return function(input){return input>50?input.substring(0,50)+"...":input}}),celloudApp.filter("emptyText",function(){return function(input,other){return null==input||""==input?other:input}});
!function(){celloudApp.service("expenseService",function($http){this.pageQueryConsume=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"expense/toRunExpenseList",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryRecharge=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"pay/recharge/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryInvoice=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"invoice/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getInvoiceById=function(invoiceId){return $http({method:"POST",url:"invoice/detail",data:$.param({id:invoiceId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.apply=function(params){return $http({method:"POST",url:"invoice/apply",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.toRecharge=function(){return $http({method:"POST",url:"pay/recharge",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("feedbackController",function($scope,feedbackService){var loadFeedbacks=function(){$scope.feedbacks=feedbackService.list(function(data){data.datas.length>0&&$scope.change(data.datas[0].id)})};loadFeedbacks(),$scope.change=function(id){$scope.current=feedbackService.get({id:id})},$scope.solve=function(id){feedbackService.solve({id:id},function(){$scope.change(id)})},$scope.reply=function(id,content){content&&feedbackService.reply({id:id,content:content},function(){$scope.change(id),$scope.replyContent=""})},$scope.replyKeyUp=function($event){13==$event.keyCode&&$scope.reply($scope.current.id,$scope.replyContent)},$scope.saveFeedback=function(isValid){isValid&&feedbackService.save({title:$scope.unsavedFeedback.title,content:$scope.unsavedFeedback.content,attachments:$scope.unsavedAttachments},function(){$scope.unsavedAttachments=[],$("#new-qa-modal").modal("hide"),loadFeedbacks(),$scope.resetCreateForm()})},$scope.resetCreateForm=function(){$scope.unsavedFeedback=angular.copy({}),$scope.unsavedAttachments=[],unsaveUploader.splice(0,unsaveUploader.files.length)},$scope.deleteAttach=function(attachId,name){feedbackService.deleteAttach({name:name,attachId:attachId},function(data){$.alert(data.message),$("#attachmentModal").modal("hide"),$scope.currentAttach=null,$scope.change($scope.current.id)})},$scope.showAttach=function(attach){$scope.currentAttach=attach,$("#attachmentModal").modal("show")};var initUploader=function(button){var uploader=new plupload.Uploader({browse_button:button,url:"../feedback/attach",chunk_size:"2mb",file_data_name:"file",filters:{max_file_size:"2mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}]},multi_selection:!1,flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",init:{FilesAdded:function(uploader,files){uploader.start()},QueueChanged:function(uploader){uploader.disableBrowse(uploader.files.length>=5)}}});return uploader},unsaveUploader=initUploader("unsavedAttachmentUploadBtn");unsaveUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name})}),unsaveUploader.bind("FileUploaded",function(uploader,file,response){var attachments=$scope.unsavedAttachments||[];attachments.push(response.response),$scope.unsavedAttachments=attachments,$scope.$apply()}),unsaveUploader.init();var savedUploader=initUploader("attachmentUploadBtn");savedUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name,feedbackId:$scope.current.id})}),savedUploader.bind("FileUploaded",function(uploader,file,response){$scope.change($scope.current.id)}),savedUploader.init()})}();
!function(){celloudApp.service("feedbackService",function($resource){var actions={listAll:{method:"get"},reply:{url:"feedback/reply/:id",method:"put",params:{id:"@id",content:"@content"}},solve:{url:"feedback/solve/:id",method:"post",params:{id:"@id"}},list:{url:"feedback/list",method:"get"},save:{url:"feedback/create",method:"put",params:{title:"@title",content:"@content",attachList:"@attachments"}},deleteAttach:{url:"feedback/attach/delete",method:"post",params:{name:"@name",_method:"delete",attachId:"@attachId"}}};return $resource("feedback/:id",{id:"@id"},actions)})}();
!function(){celloudApp.controller("messageController",function($scope,$rootScope,noticeService,commonService){var pages={page:1,pageSize:10};$scope.removeState=!1,$scope.readState=!1;var checkedNotices=[];$scope.read=function(){var noticeIds=[];for(i in checkedNotices)0==checkedNotices[i].readState&&noticeIds.push(checkedNotices[i].noticeId);noticeService.read({noticeIds:noticeIds},function(){reload(null,null)})},$scope.changePage=function(page,pageSize){pages={page:page,pageSize:pageSize},noticeService.listMessage({currentPage:page,pageSize:pageSize},function(data){$scope.messages=data,$scope.chkall=!1,$scope.checkAllState=!1,checkedNotices=[],changeState()})},$scope.changePage(pages.page,pages.pageSize),$scope.readAll=function(){noticeService.readMessage(function(){reload(null,null)})},$scope.readMessage=function(){noticeService.readMessage(function(){reload(null,null)})},$scope.remove=function(){var noticeIds=[];for(i in checkedNotices)noticeIds.push(checkedNotices[i].noticeId);noticeService.deleteNotice({noticeIds:noticeIds},function(){reload(1,null)})},$scope.checkAll=function(state){state?($scope.chkall=!0,checkedNotices=$scope.messages.datas):($scope.chkall=!1,checkedNotices=[]),changeState()},$scope.checkOne=function(notice,state){alert(state),state?checkedNotices.push(notice):checkedNotices=removeNotice(checkedNotices,notice),changeState()};var changeState=function(){$scope.removeState=checkedNotices.length>0;var flag=!1;for(i in checkedNotices)if(0==checkedNotices[i].readState){flag=!0;break}$scope.readState=flag},removeNotice=function(notices,notice){var index=-1;for(i in notices)if(notices[i].noticeId==notice.noticeId){index=i;break}return index!=-1&&notices.splice(index,1),notices},reload=function(page,pageSize){$scope.messages=noticeService.listMessage({currentPage:page||pages.page,pageSize:pageSize||pages.pageSize}),checkedNotices=[],$rootScope.messages=commonService.messages.get(),changeState()}}),celloudApp.controller("settingController",function($scope,messageService){$scope.userMessageCategoryList=messageService.getUserSetting().query(),$scope.updateMessageCategory=function(flag,mcId,targetName,targetVal){var index=this.$index;0==flag?messageService.insertUserSetting(targetName,targetVal,mcId).success(function(data){$scope.userMessageCategoryList[index].flag=1,$scope.userMessageCategoryList[index][targetName.toLocaleLowerCase()]=targetVal}):messageService.updateUserSetting(targetName,targetVal,mcId).success(function(data){$scope.userMessageCategoryList[index][targetName.toLocaleLowerCase()]=targetVal})}})}();
!function(){celloudApp.controller("noticeController",function($scope,$rootScope,noticeService,commonService){var pages={page:1,pageSize:10};$scope.noticeRemoveState=!1,$scope.noticeReadState=!1;var checkedNotices=[];$scope.changePage=function(page,pageSize){pages={page:page,pageSize:pageSize},noticeService.listNotices({currentPage:page,pageSize:pageSize},function(data){$scope.notices=data,checkedNotices=[],$scope.chkall=!1,$scope.checkNoticeAllState=!1,changeNoticeState()})},$scope.changePage(pages.page,pages.pageSize),$scope.readNotices=function(){var noticeIds=[];for(i in checkedNotices)0==checkedNotices[i].readState&&noticeIds.push(checkedNotices[i].noticeId);noticeService.read({noticeIds:noticeIds},function(){reload(null,null)})},$scope.readAllNotices=function(){noticeService.readNotices(function(){reload(null,null)})},$scope.deleteNotice=function(){var noticeIds=[];for(i in checkedNotices)noticeIds.push(checkedNotices[i].noticeId);noticeService.deleteNotice({noticeIds:noticeIds},function(){reload(1,null)})},$scope.checkNoticeAll=function(state){state?($scope.chkall=!0,checkedNotices=$scope.notices.datas):($scope.chkall=!1,checkedNotices=[]),changeNoticeState()},$scope.checkNoticeOne=function(notice,state){state?checkedNotices.push(notice):checkedNotices=removeNotice(checkedNotices,notice),changeNoticeState()};var changeNoticeState=function(){$scope.noticeRemoveState=checkedNotices.length>0;var flag=!1;for(i in checkedNotices)if(0==checkedNotices[i].readState){flag=!0;break}$scope.noticeReadState=flag},removeNotice=function(notices,notice){var index=-1;for(i in notices)if(notices[i].noticeId==notice.noticeId){index=i;break}return index!=-1&&notices.splice(index,1),notices},reload=function(page,pageSize){$scope.notices=noticeService.listNotices({currentPage:page||pages.page,pageSize:pageSize||pages.pageSize}),checkedNotices=[],$rootScope.notices=commonService.notices.get(),changeNoticeState()}})}();
!function(){celloudApp.service("noticeService",function($resource){var actions={listNotices:{method:"get",params:{type:"notice",currentPage:"1",pageSize:"10"}},listMessage:{method:"get",params:{type:"message",currentPage:"1",pageSize:"10"}},read:{url:"notice/read",method:"post",params:{noticeIds:"@noticeIds"}},readNotices:{url:"notice/readAll/notice",method:"post"},readMessage:{url:"notice/readAll/message",method:"post"},deleteNotice:{url:"notice/delete",method:"post",params:{noticeIds:"@noticeIds"}}};return $resource("notice/list/:type",{},actions)}),celloudApp.service("messageService",function($resource,$http){this.getUserSetting=function(){return $resource("message/category/setting")},this.insertUserSetting=function(targetName,targetVal,relatId){return $http({method:"POST",url:"message/category/insert",data:$.param({targetName:targetName,targetVal:targetVal,relatId:relatId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.updateUserSetting=function(targetName,targetVal,relatId){return $http({method:"POST",url:"message/category/update",data:$.param({targetName:targetName,targetVal:targetVal,relatId:relatId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("overviewCount",function($scope,loginCount){var width=($(window).width()-300)/2,height=width/2.5;$(".count-box-body").width(width),$(".count-box-body").height(height),$("body").scrollTop(0),loginCount.loginCount().success(function(response){$scope.map=response,userCount.fileDayCount(),userCount.fileMonthCount(),userCount.fileSizeDayCount(),userCount.fileSizeMonthCount(),userCount.reportDayCount(),userCount.reportMonthCount(),userCount.appDayCount(),userCount.appMonthCount()})})}();
!function(){celloudApp.service("loginCount",function($http){var self=this;self.loginCount=function(){return $http.get("count/loginCount")}})}();
require.config({paths:{echarts:"//cdn.bootcss.com/echarts/2.2.7/"}});var userCount=function(userCount){var self=userCount||{};return self.lineModal=function(id,legend,xdata,ydata,yname,unit){require(["echarts","echarts/chart/line"],function(ec){var myChart=ec.init(document.getElementById(id)),option={tooltip:{trigger:"axis",show:!0},legend:{data:[yname]},xAxis:[{type:"category",data:xdata}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"+("undefined"==typeof unit?"":unit)}}],series:[{name:yname,type:"line",data:ydata,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]}}]};myChart.setOption(option)})},self.fileDayCount=function(){$.get("count/fileDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-data-day-chart","日上传文件统计",eval(x),y,"日上传文件数量")})},self.fileMonthCount=function(){$.get("count/fileMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-data-month-chart","月上传文件统计",eval(x),y,"月上传文件数量"):$("#count-data-charts").hide()})},self.fileSizeDayCount=function(){$.get("count/fileSizeDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.substring(0,x.length-1),x+="]",self.lineModal("count-source-day-chart","日资源占用量统计",eval(x),y,"日上传文件大小",unit)})},self.fileSizeMonthCount=function(){$.get("count/fileSizeMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))});var max=Math.max.apply(null,y),unit="",divisor=1;max>1073741824?(divisor=1073741824,unit="GB"):max>1048576?(divisor=1048576,unit="MB"):(divisor=1024,unit="kB");for(var i=0;i<y.length;i++)y[i]=Number((y[i]/divisor).toFixed(2));x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-source-month-chart","月资源占用量统计",eval(x),y,"月上传文件大小",unit):$("#count-source-charts").hide()})},self.reportDayCount=function(){$.get("count/reportDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-report-day-chart","日报告统计",eval(x),y,"日生成报告个数")})},self.reportMonthCount=function(){$.get("count/reportMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.size))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-report-month-chart","月报告统计",eval(x),y,"月生成报告个数"):$("#count-report-charts").hide()})},self.appDayCount=function(){$.get("count/appDayCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.substring(0,x.length-1),x+="]",self.lineModal("count-app-day-chart","日已添加APP运行次数",eval(x),y,"日APP运行次数")})},self.appMonthCount=function(){$.get("count/appMonthCount",function(data){var x="[",y=[];$.each(data,function(index,map){"undefined"!=typeof map.time&&(x+="'"+map.time+"',",y[y.length]=Number(map.num))}),x=x.length>1?x.substring(0,x.length-1):x,x+="]","[]"!=x?self.lineModal("count-app-month-chart","月已添加APP运行次数",eval(x),y,"月APP运行次数"):$("#count-app-charts").hide()})},self.dayMonthSwitch=function(idShow,idHide){$("#count-"+idShow+"-chart").removeClass("hide"),$("#"+idShow+"-span").addClass("active"),$("#count-"+idHide+"-chart").addClass("hide"),$("#"+idHide+"-span").removeClass("active")},self}(userCount);
!function(){function viewDataReport(userId,dataKey,fileName,appId,appName,proId,proName,obj){if(81==appId||83==appId||85==appId||86==appId||87==appId||88==appId||91==appId||92==appId||93==appId||94==appId||99==appId||100==appId||101==appId||104==appId||106==appId||119==appId||120==appId||121==appId||122==appId||124==appId||125==appId)var href="#/reportpro/PGS/"+appId+"/"+dataKey+"/"+proId;else var href="#/reportpro/"+appName+"/"+appId+"/"+dataKey+"/"+proId;window.location.href=href}function getCountValue(key,id){var val,num=0;return $("#"+id).find("tr").each(function(i){0==i?$(this).find("th").each(function(j){var title=$(this).html();title==key&&(num=j)}):$(this).find("td").each(function(k){if(num==k&&(val=$(this).html(),val.indexOf(",")>0)){var reg=new RegExp(",","g");val=val.replace(reg,"")}})}),val}celloudApp.directive("loadOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("reportLoadOver")})}}}),celloudApp.directive("pgsOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("pgsLoadOver")})}}}),celloudApp.controller("egfrDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getEGFRInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(egfrInfo){$scope.egfr=egfrInfo.egfr,$scope.project=egfrInfo.project,$scope.uploadPath=egfrInfo.uploadPath;var length=$scope.egfr.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/egfrCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("krasDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getKRASInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(krasInfo){$scope.kras=krasInfo.kras,$scope.project=krasInfo.project,$scope.uploadPath=krasInfo.uploadPath;var length=$scope.kras.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/krasCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("hcvDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getHCVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hcvInfo){$scope.hcv=hcvInfo.hcv,$scope.project=hcvInfo.project,$scope.uploadPath=hcvInfo.uploadPath,$scope.change=function(){var val=$("#_change").html();"显示更多"==val?($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#_change").html("返回")):($("#nomal").css("display","none"),$("#cfda").css("display",""),$("#_change").html("显示更多"))},$.get("count/hcvCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split(";"),k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',",Y+=n[0]==one?"{ dataLabels: { enabled: true, y: 0, crop: false, style: { fontWeight: 'bold', fontSize:16 }, }, y:"+n[1]+"},":n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","Subtype",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("brafDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBRAFInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(brafInfo){if($scope.braf=brafInfo.braf,$scope.project=brafInfo.project,$scope.uploadPath=brafInfo.uploadPath,void 0!=$scope.braf){var $table=$($scope.braf.mutationPosition);$scope.searchTable=function(){var result="";$table.find("td").each(function(){var context=$(this).html(),len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(k==-1)result+=after;else if(before!=after)result+=after;else{var search=$("#_snum").val(),r=context.substring(d+1,k);if(parseFloat(r)>parseFloat(search))result+=after;else{var l=context.indexOf("|"),r=context.indexOf("(");result+=context.substring(l+1,r)}}}),$("#searchResult").html(map[result])},$scope.searchTable()}})}),celloudApp.controller("tbRifampicinDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBRifampicinInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbrifampicinInfo){$scope.tbrifampicin=tbrifampicinInfo.tbrifampicin,$scope.project=tbrifampicinInfo.project,$scope.uploadPath=tbrifampicinInfo.uploadPath,$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.tbrifampicin.report).find("td").each(function(){var context=$(this).html();if(search){var len=context.indexOf("-"),d=context.indexOf(","),k=context.indexOf(")");if(len==-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)<parseFloat(search))$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var kl=context.indexOf("(");context=context.substring(0,kl)+context.substring(k+1,context.length),$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3));if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var c5,c=context.split("\t"),c3=c[3].substring(0,c[3].indexOf("|")),c4=(c[4].substring(0,c[3].lastIndexOf("|")-1)+c[4].substring(c[4].lastIndexOf(")")+1,c[4].length)).replace("(","");c5=c[5].indexOf("|")==-1?c[5]:c[5].substring(0,c[5].indexOf("|"));var last=c[0]+"\t"+c[1]+"\t"+c[2]+"\t"+c3+"\t"+c4+"\t"+c5;$("#_sr").append("<tr><td>"+last.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")})},$scope.searchTable(),$.get("count/tbCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("tbinhDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBINHInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbinhInfo){$scope.tbinh=tbinhInfo.tbinh,$scope.project=tbinhInfo.project,$scope.uploadPath=tbinhInfo.uploadPath;var mutant=tbinhInfo.mutant,wild=tbinhInfo.wild,neither=tbinhInfo.neither,data=[{name:"Mutant strain",value:mutant},{name:"Wild type",value:wild},{name:"No Result",value:neither}];$.reportChar.draw.echartsShowPie("_showPie","Samples Statistic",data),$scope.searchTable=function(numId,sourceId,resultId){var search=$("#"+numId).val();$("#"+resultId).html("");var i=0;"r1"==sourceId?$table=$($scope.tbinh.position):$table=$($scope.tbinh.mutationPosition),$table.find("td").each(function(){var context=$(this).html();if(""==search)i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var len=context.lastIndexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&(i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>"))}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),i++,$("#"+resultId).append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}}}),0==i&&$("#"+resultId).append("<tr><td style='color:red'>没有符合筛选条件的结果</tr></td>")},$scope.searchTable("_snum1","r1","_sr1"),$scope.searchTable("_snum2","r2","_sr2")})}),celloudApp.controller("hbvDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.change1=function(){$("#nomal").css("display",""),$("#cfda").css("display","none")},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display","")},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("oncogeneDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getOncogeneInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(oncogeneInfo){$scope.oncogene=oncogeneInfo.oncogene,$scope.project=oncogeneInfo.project,$scope.uploadPath=oncogeneInfo.uploadPath})}),celloudApp.controller("dpdDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getDpdInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(dpdInfo){$scope.dpd=dpdInfo.dpd,$scope.project=dpdInfo.project,$scope.uploadPath=dpdInfo.uploadPath,$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.dpd.mutationPosition).find("td").each(function(){var context=$(this).html();if(""==search)$("#_sr").append("<tr><td>"+context+"</tr></td>");else{var len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),$("#_sr").append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else $("#_sr").append("<tr><td>"+context+"</tr></td>")}}})},$scope.searchTable()})}),celloudApp.controller("abinjDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getABINJInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(abinjInfo){$scope.abinj=abinjInfo.abinj,$scope.project=abinjInfo.project,$scope.uploadPath=abinjInfo.uploadPath})}),celloudApp.controller("ugtDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getUGTInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(ugtInfo){$scope.ugt=ugtInfo.ugt,$scope.project=ugtInfo.project,$scope.uploadPath=ugtInfo.uploadPath})}),celloudApp.controller("16sDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/get16SInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(s16Info){$scope.s16=s16Info.s16,$scope.project=s16Info.project,$scope.uploadPath=s16Info.uploadPath;var $table=$("<div>"+$scope.s16.resultTable+"</div>");$table.find("tr").each(function(i){0==i?length=$(this).find("td").length:(tdlength=$(this).find("td").length,tdlength<length&&$(this).children("td").eq(1).attr("colspan",5))}),$scope.s16.resultTable=$table.html()})}),celloudApp.controller("translateDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTranslateInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(translateInfo){$scope.translate=translateInfo.translate,$scope.project=translateInfo.project,$scope.uploadPath=translateInfo.uploadPath})}),celloudApp.controller("gddDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getGDDInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(gddInfo){$scope.gdd=gddInfo.cmp,$scope.project=gddInfo.project,$scope.uploadPath=gddInfo.uploadPath})}),celloudApp.controller("cmpDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getCMPInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(cmpInfo){$scope.cmp=cmpInfo.cmp,$scope.project=cmpInfo.project,$scope.uploadPath=cmpInfo.uploadPath})}),celloudApp.controller("bsiDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBSIInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(bsiInfo){$scope.bsi=bsiInfo.bsi,$scope.project=bsiInfo.project,$scope.uploadPath=bsiInfo.uploadPath,$scope.tab="patient";for(var havestrain="",i=0;i<$scope.bsi.species_20.length;i++)havestrain+=$scope.bsi.species_20[i].species_zh+",";$scope.havestrain=havestrain.substr(0,havestrain.length-1),$scope.getRowspan=function(val1,val2,val3){var val0=1;return null!=val1&&val0++,null!=val2&&val0++,null!=val3&&val0++,val0}})}),celloudApp.controller("rockyDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getRockyInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(rockyInfo){$scope.rocky=rockyInfo.rocky,$scope.project=rockyInfo.project,$scope.uploadPath=rockyInfo.uploadPath})}),celloudApp.controller("splitDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getSplitInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(splitInfo){$scope.split=splitInfo.split,$scope.project=splitInfo.project,$scope.uploadPath=splitInfo.uploadPath;var printReport={main:function(method,param){$.get(method,param,function(responseText){var obj=window.open("");obj.document.write(responseText),obj.document.close()})},mongoParam:function(projectId,dataKey,appId){var _param={projectId:projectId,dataKey:dataKey,appId:appId};return _param}};$scope.printSplit=function(projectId,dataKey,appId){printReport.main("report/printSplitReport",printReport.mongoParam(projectId,dataKey,appId))},$.get("count/splitCompare",{id:splitInfo.splitId},function(data){var totalSource=JSON.stringify(data.totalSource),totalSample=JSON.stringify(data.totalSample),thisSource=JSON.stringify(data.thisSource),thisSample=JSON.stringify(data.thisSample);console.log("totalSource: "+totalSource),console.log("totalSample: "+totalSample),console.log("thisSource: "+thisSource),console.log("thisSample: "+thisSample),drawScatter("sourceCharDiv",eval(totalSource),eval(thisSource),"Split源数据同比图","平均质量","序列总数"),drawScatter("sampleCharDiv",eval(totalSample),eval(thisSample),"Split分离结果数据同比图","平均质量","序列总数")})})}),celloudApp.controller("pgsDataReportController",function($scope,$routeParams,$compile,dataReportService){$scope.$on("pgsLoadOver",function(){var num=0;$("#reportDiv").find("td").each(function(){var result=$(this).text();num%4==0&&$(this).css("min-width","90px"),num%4==1&&$(this).css("min-width","55px"),num%4==2&&result.length>85&&($(this).html(result.substring(0,84)+"..."),$(this).attr("title",result)),num%4==3&&(result.length>39&&($(this).html(result.substring(0,38)+"..."),$(this).attr("title",result)),$(this).css("width","300px")),$(this).css("padding-left","20px"),$(this).css("text-align","left"),num++});var trTotal=0,tr=0,count=1,need=!1;$("#reportDiv").find("tr").each(function(){var tdVal=$(this).children("td").eq(0).html();if(tdVal.toLowerCase().indexOf("chr")==-1)$(this).children("td").eq(2).remove(),$(this).children("td").eq(2).remove(),tr=trTotal-count,count++,need=!0;else if(need){var rowTr=$("#reportTable tr").eq(tr);$(rowTr).children("td").eq(0).attr("rowspan",count),$(rowTr).children("td").eq(0).css("vertical-align","middle"),$(rowTr).children("td").eq(1).attr("rowspan",count),$(rowTr).children("td").eq(1).css("vertical-align","middle"),count=1,need=!1}trTotal++})}),dataReportService.getDataReportInfo("report/getPgsInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(pgsInfo){function showEdditError(info){$("#edit-conclusionErrorInfo").html(info),$("#edit-conclusion-error").removeClass("hide")}$scope.pgs=pgsInfo.pgs,$scope.experiment=pgsInfo.experiment,$scope.project=pgsInfo.project,$scope.uploadPath=pgsInfo.uploadPath,$scope.editShowConclusion=function(){$("#edit-conclusion-error").addClass("hide"),$("#editReportConclusion").modal("show")},$scope.saveConclusion=function(){var qualified=$("#reportConclusion").find("input:radio[name='qualified']:checked").val();return qualified?void $.get("experiment/updateExperiment",$("#reportConclusionForm").serialize(),function(flag){1==flag?(showAddError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#reportConclusion").modal("hide")},2e3)):showAddError("保存失败！")}):void showAddError("请选择是否合格！")},$scope.editSaveConclusion=function(){var qualified=$("#editReportConclusion").find("input:radio[name='qualified']:checked").val();if(!qualified)return void showEdditError("请选择是否合格！");var remarks=$("#editReportConclusion").find("textarea[name='remarks']").val();return remarks.length>125?void showEdditError("备注长度不能大于125个字符！！"):void $.get("experiment/updateExperiment",$("#editReportConclusionForm").serialize(),function(flag){1==flag?(showEdditError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#editReportConclusion").modal("hide")},2e3)):showEdditError("保存失败！")})},$scope.showModal=function(id){$("#"+id).modal("show")};var appId=$scope.pgs.appId;$.get("count/pgsCompare",{appId:appId,columns:charMap[appId]},function(data){var sp=data.split(";");$("#charResult").html("");for(var i=1;i<sp.length;i++){var big=0,div=$("<div id='char"+i+"' class='col-lg-5' style='width: 410px;height:400px;'></div>");$("#charDiv").append(div);for(var ev=sp[i].split(":"),one=getCountValue(ev[0],"_table"),value=ev[1].split(","),context="[",k=0;k<value.length-1;k++)context+="[1,"+value[k]+"],",value[k]>one&&big++;context+="]";var percent=0;percent="Duplicate"==ev[0]||"Duplicate(%)"==ev[0]||"*SD"==ev[0]?Math.round(big/value.length*100):100-Math.round(big/value.length*100),$("#charResult").append("本数据的 "+ev[0]+" 打败了 <span class='green'>"+percent+"%</span> 的数据；");var single="[[2,"+one+"]]";$.reportChar.draw.echartsShowScatter("char"+i,ev[0],eval(context),eval(single))}})})}),celloudApp.controller("projectReportController",function($scope,$rootScope,$routeParams,$location,projectReportService){$scope.companyId=companyId,$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,tokenSeparators:[","," "]}),$scope.ranAppList=projectReportService.getRanAPP();var options={page:1,pageSize:10,belongs:1,start:null,end:null,app:0,condition:null};$scope.pageQuery=function(currentPage,pageSize){var belongs=options.belongs,start=options.start,end=options.end,app=options.app,condition=options.condition;options.pageSize=pageSize,projectReportService.getReportListCondition(currentPage,pageSize,belongs,start,end,app,condition).success(function(dataList){$scope.dataList=dataList})},$scope.pageQuery(options.page,options.pageSize),$scope.changeBelongs=function(id){$(".belongs").removeClass("active"),$("#belongs"+id).addClass("active"),options.belongs=id,$scope.pageQuery(1,options.pageSize)};var START=null,END=null;$scope.changeDate=function(flag){if($("#_searchDate").val(""),$("#_endDate").val(""),$(".changeDate").removeClass("active"),$("#changeDate"+flag).addClass("active"),0==flag)START=null,END=null;else{var d=new Date,date=new Date(d.getTime()-864e5*flag),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();START=year+"-"+mounth+"-"+day,END=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()}$scope.dateQuery()},$scope.chooseDate=function(){return $(".changeDate").removeClass("active"),START=$("#_searchDate").val(),END=$("#_endDate").val(),START&&END?START>END?void $.alert("起始时间不能大于结束时间"):void $scope.dateQuery():void $.alert("请同时选择起始时间和结束时间")},$scope.dateQuery=function(){null!=START&&(START+=" 00:00:00"),null!=END&&(END+=" 23:59:59"),options.start=START,options.end=END,$scope.pageQuery(1,options.pageSize)},$scope.changeApp=function(appId){$(".changeApp").removeClass("active"),$("#changeApp"+appId).addClass("active"),options.app=appId,$scope.pageQuery(1,options.pageSize)},$scope.changeCondition=function(){options.condition=$scope.reportCondition,$scope.pageQuery(1,options.pageSize)},$scope.toChangePname=function(projectId){$("#showPname"+projectId).addClass("hide"),$("#changePname"+projectId).removeClass("hide")},$scope.changePname=function(projectId){var name=$("#updatePname"+projectId).val(),oldName=$("#pnameSpan"+projectId).text().trim();return name==oldName?($("#showPname"+projectId).removeClass("hide"),void $("#changePname"+projectId).addClass("hide")):void projectReportService.changeProjectName(projectId,name).success(function(response){response.success&&(name.length>13&&(name=name.substring(0,12)+"..."),$("#pnameSpan"+projectId).html(name),$("#showPname"+projectId).removeClass("hide"),$("#changePname"+projectId).addClass("hide")),$scope.message=response.message,$scope.state=!0})},$scope.cancelProjectShare=function(projectId){$.confirm("确定要删除该项目？","确认框",function(){projectReportService.cancelProjectShare(projectId).success(function(response){response.success&&$scope.pageQuery(1,options.pageSize),$.alert(response.message)})})},$scope.downPDF=function(userId,appId,projectId){var path=userId+"/"+appId+"/"+projectId+"/"+projectId+".pdf";projectReportService.downPDF(path).success(function(flag){if(1==flag)$.alert("没有可以下载的pdf文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"report/down?path="+path}})},$scope.toShareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,$scope.updateState=!1,$("#shareProjectSelect").html("")},$scope.shareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,projectReportService.getShareTo(projectId).success(function(data){$scope.updateState=!1,$("#shareProjectSelect").html(""),$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,data:data,tokenSeparators:[","," "]})})},$scope.saveShareProject=function(){var proId=$scope.shareProjectId,data=$("#shareProjectSelect").select2("data"),userNames="";$.each(data,function(id,value){userNames+=value.text+","}),userNames=userNames.toLowerCase(),userNames=userNames.substring(0,userNames.length-1),projectReportService.projectShare(proId,userNames).success(function(response){function hideModal(){$("#project-share-modal").modal("hide"),$scope.pageQuery(options.page,options.pageSize),$scope.updateState=!1}$scope.updateMessage=response.message,$scope.updateState=!0,response.success&&setTimeout(hideModal,1500)})},$scope.removePro=function(projectId){$.confirm("确定要删除该项目吗？","确认框",function(){projectReportService.deleteProject(projectId).success(function(flag){1==flag?($scope.pageQuery(1,options.pageSize),$.alert("项目报告删除成功")):$.alert("项目报告删除失败")})})},$scope.$on("reportLoadOver",function(){$("#_show").find(".projectContext").each(function(){var info=$.trim($(this).prev().html()).split(","),appId=info[0],appName=info[1],proId=info[2],userId=info[3],proName=$("#pnameSpan"+proId).html(),length=0,th_size=0,td_size=0,tr_size=$(this).find("tr").length;$(this).find("table").addClass("table table-main info-table data-report-table"),$(this).find("tr").each(function(j){0==j?th_size=$(this).children().length:td_size=$(this).children().length;var trc=$(this).children().length;"80"==appId&&(0==j&&(length=$(this).children().length),length>6&&j>1&&j%2==0&&($(this).addClass("_HCVTR"),$(this).css("display","none"),$(this).children().attr("colspan","7"),$(this).children().css("word-break","break-all"))),$(this).mouseover(function(){$(this).find("a").addClass("link_hover")}),$(this).mouseout(function(){$(this).find("a").removeClass("link_hover")}),$(this).find("td").each(function(i){if("90"==appId)if(1!=i)4==trc?0==i&&$(this).addClass("hide"):$(this).addClass("hide");else if($(this).css("border-left","none"),j>0){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if("128"==appId||"127"==appId||"126"==appId||"118"==appId||"117"==appId||"114"==appId||"113"==appId||"112"==appId||"111"==appId||"110"==appId||"109"==appId||"106"==appId||"107"==appId||"108"==appId||"105"==appId||"82"==appId||"84"==appId||"89"==appId||"73"==appId||"1"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId&&"126"!=appId&&"127"!=appId&&"128"!=appId&&(fileName=fileName.substring(0,30)+"..."),"114"!=appId&&"118"!=appId?$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+fileName+"</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"82"==appId&&"不敏感"==$(this).html()&&$(this).addClass("red")}if("91"==appId||"95"==appId||"92"==appId||"93"==appId||"94"==appId||"86"==appId||"87"==appId||"88"==appId||"81"==appId||"83"==appId||"85"==appId||"96"==appId||"97"==appId||"98"==appId||"99"==appId||"100"==appId||"101"==appId||"102"==appId||"103"==appId||"104"==appId||"116"==appId||"119"==appId||"120"==appId||"121"==appId||"122"==appId||"124"==appId||"125"==appId){if(j>0&&0==i){$(this).addClass("sub");var fileName=$(this).html();
fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).next().html()+"'>"+$(this).next().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().next().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if(1==i&&$(this).addClass("hide"),j>0&&(4==i||3==i)){var val=$(this).html();!isNaN(val)&&val>999&&$(this).html($.format(val,3,","))}}if("80"==appId){if(5==length){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","2")}if(7!=length&&8!=length||"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","5"),7==length)j>0&&j%2==1&&0==i&&($(this).addClass("sub"),$(this).html("<a id='dataSpan"+proId+$(this).html()+"'>"+$(this).html()+"</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link"));else if(8==length&&(1==i&&$(this).css("border-left","none"),0!=j&&j%2!=1||0!=i||$(this).addClass("hide"),j>0&&j%2==1&&1==i)){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link")}}if("11"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none")}td_size<th_size&&i==td_size-1&&$(this).attr("colspan",th_size-td_size+1)})});var minTdNum=5;"128"!=appId&&"127"!=appId&&"126"!=appId&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId||(minTdNum=4);var rdataNum=$("#rdataNum"+proId).html();if(("114"==appId||"118"==appId)&&tr_size-1<rdataNum){var num=Number(rdataNum)-tr_size+1,height=30*(5-tr_size),adHtml="<tr><td colspan='"+th_size+"' style='border-left-style: none;vertical-align: middle;height:"+height+"px' align='center'><img src='/celloud/images/report/running.png' title='正在运行...'/><br>"+num+"个数据正在运行...</td></tr>";$(this).find("tbody").append(adHtml)}else if(tr_size<minTdNum){var num=5-tr_size;for(i=0;i<num;i++){var adHtml="<tr>";for(j=0;j<th_size-1;j++)adHtml+="<td></td>";adHtml+="</tr>",$(this).find("tbody").append(adHtml)}}})})}),celloudApp.controller("dataReportController",function($scope,projectReportService,dataReportService){$scope.searchInfo=dataReportService.getSearchInfos(),$scope.reportList=dataReportService.getReports();var options={page:1,pageSize:20,beginDate:null,endDate:null,tagId:null,period:null,batch:null,condition:null,sort:"desc"},paramQuqery=function(){dataReportService.getReportsByParams(options.page,options.pageSize,options.condition,options.beginDate,options.endDate,options.batch,options.tagId,options.period,options.sort).success(function(dataList){$scope.reportList=dataList})};$scope.pageQuery=function(page,pageSize){options.page=page,options.pageSize=pageSize,paramQuqery()},$scope.tagsQuery=function(tagId){$(".tagsQuery").removeClass("active"),$("#tagsQuery"+tagId).addClass("active"),options.tagId=tagId,options.page=1,paramQuqery()},$scope.batchsQuery=function(batch){$(".batchsQuery").removeClass("active"),$("#batchsQuery"+batch).addClass("active"),options.batch=batch,options.page=1,paramQuqery()},$scope.periodQuery=function(period){$(".periodQuery").removeClass("active"),$("#periodQuery"+period).addClass("active"),options.period=period,options.page=1,paramQuqery()},$scope.fullDateQuery=function(days){if($(".fullDateQuery").removeClass("active"),$("#fullDateQuery"+days).addClass("active"),0==days)options.beginDate=null,options.endDate=null;else{var d=new Date,date=new Date(d.getTime()-864e5*days),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();options.beginDate=year+"-"+mounth+"-"+day+" 00:00:00",options.endDate=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59"}options.page=1,paramQuqery()},$scope.chooseDate=function(){$(".fullDateQuery").removeClass("active");var d=new Date,begin=$("#begin-date").val(),end=$("#end-date").val();return end=end?end:d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(),begin?begin>end?void $.tips("请确认开始时间  < 结束时间！","时间错误"):(options.beginDate=begin+" 00:00:00",options.endDate=end+" 23:59:59",options.page=1,void paramQuqery()):void $.tips("请选择开始时间！","时间错误")}})}();
!function(){celloudApp.controller("mibReportController",function($scope,$routeParams,mibReportService){mibReportService.reportInfo($routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(mibInfo){$scope.mib=mibInfo.mib,console.log(eval(mibInfo.genusDistributionInfo)),void 0!=mibInfo.readsDistributionInfo&&$.reportChar.draw.circularGraph("reads-distribution-char","Reads","Distribution",mibInfo.readsDistributionInfo),void 0!=mibInfo.familyDistributionInfo&&$.reportChar.draw.circularGraph("family-distribution-char","Family","Distribution",mibInfo.familyDistributionInfo),void 0!=mibInfo.genusDistributionInfo&&$.reportChar.draw.singleBar("genus-distribution-char","Top 10 genus distribution","",mibInfo.genusDistributionInfo,"Depth","Depth")})})}();
!function(){celloudApp.service("mibReportService",function($resource,$http){var self=this;self.reportInfo=function(dataKey,projectId,appId){return $http.get("report/getMIBReportInfo",{params:{dataKey:dataKey,projectId:projectId,appId:appId}})}})}();
!function(){celloudApp.filter("hcvShowMore",function(){return function(input){return"1b"!=input&&"2a"!=input&&"3a"!=input&&"3b"!=input&&"6a"!=input?($("#_change").parent().css("display",""),"其他"):input}})}();
!function(){celloudApp.service("projectReportService",function($resource,$http){var self=this;self.getRanAPP=function(){return $resource("app/getRanAPP").get()},self.getReportList=function(){return $resource("report/getReportPageList").get()},self.getReportListCondition=function(currentPage,pageSize,belongs,start,end,appId,condition){return $http.get("report/getReportPageList?random="+(new Date).getTime(),{params:{page:currentPage,size:pageSize,condition:condition,start:start,end:end,appId:appId,belongs:belongs}})},self.changeProjectName=function(projectId,projectName){return $http.get("project/update",{params:{projectId:projectId,projectName:projectName}})},self.deleteProject=function(projectId){return $http.get("project/deleteByState",{params:{projectId:projectId}})},self.cancelProjectShare=function(projectId){return $http.get("project/deleteShare",{params:{projectId:projectId}})},self.projectShare=function(projectId,userNames){return $http.get("project/shareProject",{params:{projectId:projectId,userNames:userNames}})},self.getShareTo=function(projectId){return $http.get("project/getShareTo",{params:{projectId:projectId}})},self.downPDF=function(path){return $http.get("report/down",{params:{path:path}})}}),celloudApp.service("dataReportService",function($resource,$http){var self=this;self.getReports=function(){return $resource("report/dataReportPages").get()},self.getReportsByParams=function(currentPage,pageSize,condition,beginDate,endDate,batch,tagId,period,sort){return $http.get("report/dataReportPages",{params:{page:currentPage,size:pageSize,condition:condition,beginDate:beginDate,endDate:endDate,tagId:tagId,batch:batch,period:period,sort:sort}})},self.getSearchInfos=function(){return $resource("report/reportSearchInfo").get()},self.getDataReportInfo=function(url,dataKey,projectId,appId){return $http({method:"POST",url:url,data:$.param({dataKey:dataKey,projectId:projectId,appId:appId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){function getUploadingCount(uploader){for(var count=0,i=0;i<uploader.files.length;i++)5!=uploader.files[i].status&&count++;return count}function getSize(fileSize){var unit="b";return fileSize>1e3&&(fileSize/=1e3,unit="kb"),fileSize>1e3&&(fileSize/=1e3,unit="mb"),fileSize.toFixed(2)+unit}function handleStatus(file){var actionClass,iconClass;file.status==plupload.DONE&&(actionClass="plupload_done",iconClass="fa fa-check-circle"),file.status==plupload.FAILED&&(actionClass="plupload_failed",iconClass="fa fa-exclamation-triangle"),file.status!=plupload.QUEUED&&file.status!=plupload.UPLOADING||(actionClass="plupload_delete",iconClass="fa fa-times-circle-o");var icon=$("#uploading-"+file.id).attr("class",actionClass).find("i").attr("class",iconClass);file.hint&&icon.attr("title",file.hint)}celloudApp.controller("fileUpload",function($route,$location,$scope,$rootScope,uploadService){$scope.step="one",$rootScope.getProTags=function(){"one"==$scope.step&&($scope.upload.splice(),$rootScope.tags=uploadService.getProductTags().query())},$scope.nextStep=function(){$scope.step="two"},$scope.beginUpload=function(){$scope.step="three",$scope.upload.start()},$scope.uploadMore=function(){var count=getUploadingCount($scope.upload);0==count&&($scope.step="two")};var initUploader=function(button){var uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight,html4",browse_button:button,url:"../uploadFile/uploadManyFile",chunk_size:"1mb",dragdrop:!0,unique_names:!0,drop_element:"plupload-content",filters:{max_file_size:"3gb",prevent_duplicates:!0,mime_types:[{title:"bam",extensions:"bam"},{title:"ab1",extensions:"ab1"},{title:"abi",extensions:"abi"},{title:"fasta",extensions:"fasta"},{title:"fastq",extensions:"fastq"},{title:"tsv",extensions:"tsv"},{title:"gz",extensions:"gz"},{title:"lis",extensions:"lis"},{title:"txt",extensions:"txt"}]},max_retries:5,multiple_queues:!0,flash_swf_url:"//cdn.bootcss.com/plupload/2.1.8/Moxie.swf"});return uploader.bind("StateChanged",function(){uploader.state===plupload.STARTED?(window.parent.isUploading=!0,refresh=setInterval(function(){$.get("uploadFile/checkAdminSessionTimeOut")},6e5)):uploader.state===plupload.STOPPED&&(window.parent.isUploading=!1,clearInterval(refresh))}),uploader.bind("UploadProgress",function(uploader,file){$("#uploading-"+file.id+" .plupload-file-status").html(file.percent+"%"),$("#uploading-"+file.id+" .plupload-file-surplus").html(utils.formatDate((file.size-file.loaded)/uploader.total.bytesPerSec)),$("#uploading-"+file.id+" .plupload_file_speed").html(getSize(uploader.total.bytesPerSec)+"/s")}),uploader.bind("FilesAdded",function(uploader,files){$scope.isCancel=!1,$.get("uploadFile/checkAdminSessionTimeOut",function(response){response||uploader.destroy()}),$.each(files,function(index,item){var $fileDom_upload=$('<tr class="plupload_delete" id="upload-'+item.id+'">');$fileDom_upload.append($('<td class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></td>")),$fileDom_upload.append($('<td class="plupload-file-size">'+getSize(item.size)+"</td>")),$fileDom_upload.append($('<td class="plupload-file-action"><a href="#" style="display: block;line-height: 30px;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></td>')),$fileDom_upload.append($("</tr>")),$("#upload-list-tbody").append($fileDom_upload);var $fileDom_uploading=$('<tr class="plupload_delete" id="uploading-'+item.id+'">');$fileDom_uploading.append($('<td class="plupload-file-name"><span title="'+item.name+'">'+item.name+"</span></td>")),$fileDom_uploading.append($('<td class="plupload-file-status">_</td>')),$fileDom_uploading.append($('<td class="plupload-file-surplus">_</td>')),$fileDom_uploading.append($('<td class="plupload_file_speed">_</td>')),$fileDom_uploading.append($('<td class="plupload-file-action"><a href="#" style="display: block;line-height: 30px;"><i class="fa fa-times-circle-o" aria-hidden="true"></i></a></td>')),$fileDom_uploading.append($("</tr>")),$("#uploading-list-tbody").append($fileDom_uploading),handleStatus(item),$("#upload-"+item.id+".plupload_delete a").click(function(e){$("#upload-"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e),$scope.$apply()}),$("#uploading-"+item.id+".plupload_delete a").click(function(e){var count=getUploadingCount(uploader);1==count&&5!=item.status&&($scope.isCancel=!0),$("#upload-"+item.id).remove(),$("#uploading-"+item.id).remove(),uploader.removeFile(item),e.preventDefault(),utils.stopBubble(e)})}),$scope.$apply()}),uploader.bind("FileUploaded",function(uploader,file,response){var res=response.response;"1"!=res&&$.get("data/run",JSON.parse(res),function(result){$.report.find.condition()}),handleStatus(file)}),uploader.bind("UploadComplete",function(uploader,files){$scope.step="one",$scope.isCancel||($("#upload-list-tbody").children().remove(),$("#uploading-list-tbody").children().remove(),$("#upload-modal").modal("hide"),"/data"==$location.path()&&$route.reload())}),uploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{originalName:file.name,tagId:$scope.tagSelected.tagId,batch:$scope.batch})}),uploader.bind("Error",function(uploader,error){"-602"==error.code&&alert("当前队列已存在文件【"+error.file.name+"】，请勿重复添加！")}),uploader};$("#upload-modal").on("hidden.bs.modal",function(e){"three"!=$scope.step&&($("#upload-list-tbody").children().remove(),$("#uploading-list-tbody").children().remove(),$scope.step="one",$scope.$apply())}),$scope.upload=initUploader(["plupload-content","uploadMore"]),$scope.upload.init(),window.onbeforeunload=function(){var qp=$scope.upload.total,percent=qp.percent;if(qp.size>0&&percent<100&&percent>0)return"数据正在上传，您确定要关闭页面吗?"}})}();
!function(){celloudApp.service("uploadService",function($resource){this.getProductTags=function(){return $resource("uploadFile/getProductTag")}})}();
!function(){celloudApp.controller("updateBaseInfo",function($scope,userService){userService.getUserInfo().success(function(data){$scope.user=data,$scope.user_bak=angular.copy(data)}),$scope.updateUserInfo=function(){userService.updateUserInfo($scope.user).success(function(data){$.alert(data.message)}).error(function(data){$.alert(data.message)})},$scope.reset=function(){$scope.user=angular.copy($scope.user_bak)}}),celloudApp.controller("updatePassword",function($scope,userService){$scope.reset=function(){$scope.oldPwd="",$scope.newPwd="",$scope.confirmPwd=""},$scope.updatePassword=function(){$scope.state=!1,userService.updatePassword($scope.oldPwd,$scope.newPwd).success(function(data){$scope.code=data.code,203==$scope.code?$scope.pwdMessage=data.message:$.alert(data.message)}).error(function(data){})},$scope.checkOldPwd=function(){""==$.trim($scope.oldPwd)&&($scope.code=0)}}),celloudApp.controller("pageQueryLog",function($scope,$rootScope,$routeParams,$location,userService){$scope.pageQueryLog=function(currentPage,pageSize){userService.pageQueryLog(currentPage,pageSize).success(function(dataList){$scope.dataList=dataList})},$scope.pageList=function(pageSize){$rootScope.pageSize=pageSize,$scope.pageQueryLog(1,pageSize),$location.path($scope.pageType)},null==$routeParams.page?($scope.pageQueryLog(1,$rootScope.pageSize),$location.path($scope.pageType)):$scope.pageQueryLog($routeParams.page,$rootScope.pageSize)}),celloudApp.controller("updateEmail",function($scope,userService){userService.getUserInfo().success(function(data){$scope.user=data}),$scope.isSend=!1,$scope.updateEmail=function(){userService.updateEmail($scope.user.email).success(function(data){1==data?$scope.sendFail=!0:0==data&&($scope.sendSuccess=!0)})}}),celloudApp.controller("setReportController",function($scope,userService){$scope.icon="",$scope.haveImage=!1,userService.getUserCompanyIcon().success(function(company){$scope.icon=company.companyIcon,""==$scope.icon?$scope.isTemp=!0:($scope.haveImage=!0,$scope.isTemp=!1,$scope.path=CONTEXT_PATH+"/user/icon?file="+$scope.icon)}),$scope.apply=function(){userService.setUserCompanyIcon($scope.icon).success(function(data){data>0&&($.alert("更新成功!"),$scope.icon="")})};var initUploader=function(button){var uploader=new plupload.Uploader({browse_button:button,url:"../user/uploadCompanyIcon",chunk_size:"2mb",file_data_name:"file",filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}],prevent_duplicates:!1},multi_selection:!1,flash_swf_url:"../plugins/plupload-2.1.2/Moxie.swf",init:{FilesAdded:function(uploader,files){uploader.start()}}});return uploader},unsaveUploader=initUploader("unsavedAttachmentUploadBtn");unsaveUploader.bind("BeforeUpload",function(uploader,file){uploader.setOption("multipart_params",{fileName:file.name})}),unsaveUploader.bind("FileUploaded",function(uploader,file,response){$scope.tempPath=CONTEXT_PATH+"/user/icon/temp?file="+response.response,$scope.icon=response.response,$scope.isTemp=!0,$scope.haveImage=!0,$scope.$apply()}),unsaveUploader.init()})}();
!function(){celloudApp.service("userService",function($q,$http,$resource){this.getUserInfo=function(){return $http({method:"POST",url:"user/info",params:{}})},this.updateUserInfo=function(user){return $http({method:"POST",url:"user/updateInfo",params:{cellphone:user.cellphone}})},this.updatePassword=function(oldPassword,newPassword){return $http({method:"POST",url:"user/updatePassword",params:{oldPassword:oldPassword,newPassword:newPassword}})},this.updateEmail=function(email){return $http({method:"POST",url:"user/sendOldEmail",params:{email:email}})},this.pageQueryLog=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"user/logInfo",params:{currentPage:currentPage,pageSize:pageSize}})},this.getUserCompanyIcon=function(){return $http({method:"POST",url:"user/getCompanyIcon",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.setUserCompanyIcon=function(companyIcon){return $http({method:"POST",url:"user/setCompanyIcon",data:$.param({companyIcon:companyIcon}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();