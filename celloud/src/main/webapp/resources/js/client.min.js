var utils={};!function($){$.extend({format:function(str,step,splitor){str=str.toString();var len=str.length;if(len>step){var l1=len%step,l2=parseInt(len/step),arr=[],first=str.substr(0,l1);""!=first&&arr.push(first);for(var i=0;i<l2;i++)arr.push(str.substr(l1+i*step,step));str=arr.join(splitor)}return str}})}(jQuery),utils._stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},utils.formatDate=function(size){var ss=parseInt(size);if(0===ss)return"00:00:00";if(/\D/.test(ss))return"N/A";ss=parseInt(size);var radix=60,mm=0,hh=0;return ss>radix&&(mm=parseInt(ss/radix),ss=parseInt(ss%radix),mm>radix&&(hh=parseInt(mm/radix),mm=parseInt(mm%radix))),hh>0&&hh<10?result="0"+parseInt(hh):hh>=10?result=parseInt(hh):hh<=0&&(result="00"),result+=":",mm>0&&mm<10?result+="0"+parseInt(mm):mm>=10?result+=parseInt(mm):mm<=0&&(result+="00"),result+=":",ss>0&&ss<10?result+="0"+parseInt(ss):ss>=10?result+=parseInt(ss):ss<=0&&(result+="00"),result},utils.getExt=function(fileName){var result=/\.[^\.]+/.exec(fileName);return result},utils.isConfigure=function(fileName){return".txt"==utils.getExt(fileName)||".lis"==utils.getExt(fileName)},utils.setDocSize=function(){var winWidth=$(window).width(),docWidth=$(document).width(),winHeight=$(window).height(),docHeight=$(document).height();winWidth>=docWidth?($(".bgContainer").width(winWidth),$(".longbackground").width(winWidth),$("#bg").width(winWidth)):($(".bgContainer").width(docWidth),$(".longbackground").width(docWidth),$("#bg").width(docWidth)),winHeight>=docHeight?($(".bgContainer").height(winHeight),$(".longbackground").height(winHeight),$("#bg").height(winHeight)):($(".bgContainer").height(docHeight),$(".longbackground").height(docHeight),$("#bg").height(docHeight)),$(".bgContainer").css("overflow","hidden")},utils.checkPlaceholder=function(){var input=document.createElement("input"),isPlaceholder="placeholder"in input;isPlaceholder||$(document).ready(function(){if(!isPlaceholder){$("input").not("input[type='password']").each(function(){""==$(this).val()&&""!=$(this).attr("placeholder")&&($(this).val($(this).attr("placeholder")),$(this).addClass("placeholder"),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")}),$(this).blur(function(){""==$(this).val()&&$(this).val($(this).attr("placeholder"))}))});var pwdField=$("input[type=password]"),pwdVal=pwdField.attr("placeholder");pwdField.after('<input id="pwdPlaceholder" type="text" class="pwd" value='+pwdVal+' autocomplete="off" />');var pwdPlaceholder=$("#pwdPlaceholder");pwdField.val()?(pwdPlaceholder.hide(),pwdField.show()):(pwdPlaceholder.show(),pwdField.hide()),pwdPlaceholder.focus(function(){pwdPlaceholder.hide(),pwdField.show(),pwdField.focus()}),pwdField.blur(function(){""==pwdField.val()&&(pwdPlaceholder.show(),pwdField.hide())})}})},utils.splitDataByInfo=function(data,splitStr,number){var reStr="(.{"+number+"}|.*)",reg=new RegExp(reStr,"g"),dataArray=data.match(reg);dataArray.pop();for(var i=(dataArray.length+1,0);i<dataArray.length;i+=2)dataArray.splice(i+1,0,splitStr);dataArray.pop();var str=dataArray.join("");return str},utils.loadBaiduTongji=function(){var host=window.location.host;if(host.indexOf("www.celloud.cn")>=0){!function(){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?f6b04d06932c0fc1578e79be222599f4",hm.async="async",hm.defer="defer";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)}()}},utils.loadBaiduTongji(),utils.setDocSize(),$(window).resize(function(){utils.setDocSize()}),utils.stopBubble=function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0};
var messageUtils=function(messageUtils){function bindEvents(){self.ws.onopen=function(){console.log("websocket connect is opened : "+new Date),clearTimeouts();for(var listener in self.openListeners)$.isFunction(self.openListeners[listener])&&self.openListeners[listener]()},self.ws.onmessage=function(e){var message=JSON.parse(e.data),channels=self.messageChannels[message.channel]||[];if(channels.length<=0)return void console.log("no listener for channel: "+message.channel);for(var channel in channels)$.isFunction(channels[channel])&&channels[channel](message.message)},self.ws.onclose=function(){console.log("websocket connect is closed : "+new Date);for(var listener in self.closeListeners)$.isFunction(self.closeListeners[listener])&&self.closeListeners[listener]()},self.ws.onerror=function(event){console.log("websocket error : "+new Date),console.log(event),console.log(event.data)}}function clearTimeouts(){for(var t in self.timeouts)clearTimeout(self.timeouts[t]);self.timeouts=[]}var self=messageUtils||{};self.messageChannels={listenerNumbers:0},self.openListeners={listenerNumbers:0},self.closeListeners={listenerNumbers:0},self.timeouts={},self.addOpenListener=function(listener){self.openListeners[self.openListeners.listenerNumbers]=listener,self.openListeners.listenerNumbers=self.openListeners.listenerNumbers+1},self.addCloseListener=function(listener){self.closeListeners[self.closeListeners.listenerNumbers]=listener,self.closeListeners.listenerNumbers=self.closeListeners.listenerNumbers+1},self.subscribe=function(channel,callback){var channels=self.messageChannels[channel]||{listenerNumbers:0};$.isFunction(callback)&&(channels[channels.listenerNumbers]=callback,channels.listenerNumbers=channels.listenerNumbers+1,self.messageChannels[channel]=channels)};var openWebSocket=function(){var contextPath=window.CONTEXT_PATH||window.contextPath||"",protocol="https:"==window.location.protocol?"wss://":"ws://",hostname=window.location.hostname,port=window.location.port?":"+window.location.port:"",wsUrl=protocol+hostname+port+contextPath+"/websocket/message",ws=null;return ws="WebSocket"in window?new WebSocket(wsUrl):window.MozWebSocket?new MozWebSocket(wsUrl):new SockJS(contextPath+"/sockjs/message")};self.ws=openWebSocket(),bindEvents();var createNotification=function(title,message,options){var defaultOptions={icon:CONTEXT_PATH+"/images/icon/portrait.png"};return options=$.extend({},defaultOptions,options),options.body=message,new Notification(title,options)};return self.notify=function(title,message,options,events){if(!("Notification"in window))return void console.log("This browser does not support desktop notification");var notification=null;if("granted"===Notification.permission?notification=createNotification(title,message,options):"default"===Notification.permission&&Notification.requestPermission(function(permission){"granted"===permission&&(notification=createNotification(title,message,options))}),null!=notification){var defaultEvents={onclick:function(){notification.close()}};events=$.extend({},defaultEvents,events),$.isFunction(events.onclick)&&(notification.onclick=events.onclick)}},self}(messageUtils);messageUtils.addOpenListener(function(){}),messageUtils.addCloseListener(function(){}),messageUtils.subscribe("userMessage",function(data){console.log("消息来了!")});
!function($){var defaults={delay:3e3},messages=[],showNext=function(){$("#alerts").children().length<5&&messages.length>0&&show(messages.shift())},show=function(message){message.msg=message.msg||"";var $alert=$('<div class="alert message-alert alert-dismissible fade in" role="alert"><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><span>'+message.msg+"</span></div>");$alert.addClass("alert-"+message.type),$alert.on("closed.bs.alert",function(){close($alert)}),$("#alerts").append($alert),setTimeout(function(){close($alert)},message.delay||defaults.delay)},close=function($alert){$alert.remove(),showNext()},push=function(msg,type,delay){messages.push({msg:msg,type:type,delay:delay}),showNext()};$.extend({success:function(msg,delay){push(msg,"success",delay)},info:function(msg,delay){push(msg,"info",delay)},warn:function(msg,delay){push(msg,"warning",delay)},danger:function(msg,delay){push(msg,"danger",delay)},alert:function(msg,delay){push(msg,"success",delay)}})}(jQuery);
!function($){var show=function(type,title,message,callback){$("#confirm-modal-div").html()?$("#confirm-modal-div").html(""):$("BODY").append('<div id="confirm-modal-div"></div>');var $alert=$('<div id="confirm-modal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" role="alert"></div>');$alert.addClass(type+"-modal");var $dialog=$('<div class="modal-dialog modal-sm"></div>'),$content=$('<div class="modal-content"></div>'),$header=$('<div class="modal-header"><button type="button" class="close" aria-label="Close" id="close-confirm"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><h4 class="modal-title">'+title+"</h4></div>"),$body=$('<div class="modal-body"></div>'),$h5=$("<h5></h5>"),$footer=$('<div class="modal-footer"><button type="reset" class="btn btn-cancel -low pull-left" data-dismiss="modal" id="confirm-cancle">取消</button><button type="submit" class="btn -low pull-right" id="confirm-ok">确定</button></div>');switch($h5.append($('<i class="fa fa-exclamation-circle" aria-hidden="true"></i>')),$h5.append($("<span>"+message+"</span>")),$body.append($h5),$content.append($header),$content.append($body),type){case"confirm":$content.append($footer),$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert),$("#confirm-ok").click(function(){hide(),callback()}),$("#confirm-cancle").click(function(){hide()});break;case"tips":$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert)}$("#close-confirm").click(function(){hide()})},hide=function(){$("#confirm-modal").modal("hide")},confirm=function(message,title,callback){null==title&&(title="确认框"),show("confirm",title,message,function(result){callback&&callback(result)})},tips=function(message,title){null==title&&(title="提示框"),show("tips",title,message,null)};$.extend({confirm:function(message,title,callback){confirm(message,title,callback)},tips:function(message,title){tips(message,title)}})}(jQuery);
!function(){window.celloudApp=angular.module("celloudApp",["ngRoute","ngResource","ngSanitize"])}();
!function(){celloudApp.directive("diHref",["$location","$route",function($location,$route){return function(scope,element,attrs){scope.$watch("diHref",function(){attrs.diHref&&(element.attr("href",attrs.diHref),element.bind("click",function(event){scope.$apply(function(){$location.path()==attrs.diHref.substr(attrs.diHref.indexOf("#/")+1)&&$route.reload()})}))})}}])}();
!function(){celloudApp.directive("pagination",function(){return{restrict:"E",replace:!0,scope:{page:"=",change:"&"},templateUrl:"pages/partial/_partial_pagination_template.jsp",controller:function($scope){$scope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p}}}})}();
!function(){celloudApp.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"pages/client/overview.jsp"}).when("/base",{templateUrl:"pages/client/base.jsp",controller:"clientBaseInfo"}).when("/pay",{templateUrl:"pages/client/pay.jsp",controller:"toRecharge"}).when("/report",{templateUrl:"pages/client/report.jsp"}).otherwise({redirectTo:"/"})})}();
!function(){celloudApp.service("projectReportService",function($resource,$http){var self=this;self.getRanAPP=function(){return $resource("app/getRanAPP").get()},self.getReportList=function(){return $resource("report/getReportPageList").get()},self.getReportListCondition=function(currentPage,pageSize,belongs,start,end,appId,condition){return $http.get("report/getReportPageList?random="+(new Date).getTime(),{params:{page:currentPage,size:pageSize,condition:condition,start:start,end:end,appId:appId,belongs:belongs}})},self.changeProjectName=function(projectId,projectName){return $http.get("project/update",{params:{projectId:projectId,projectName:projectName}})},self.deleteProject=function(projectId){return $http.get("project/deleteByState",{params:{projectId:projectId}})},self.cancelProjectShare=function(projectId){return $http.get("project/deleteShare",{params:{projectId:projectId}})},self.projectShare=function(projectId,userNames){return $http.get("project/shareProject",{params:{projectId:projectId,userNames:userNames}})},self.getShareTo=function(projectId){return $http.get("project/getShareTo",{params:{projectId:projectId}})},self.downPDF=function(path){return $http.get("report/down",{params:{path:path}})}}),celloudApp.service("dataReportService",function($resource,$http){var self=this;self.getReports=function(){return $resource("report/dataReportPages?v="+(new Date).getTime()).get()},self.getReportsByParams=function(currentPage,pageSize,condition,beginDate,endDate,batch,tagId,period,sort){return $http.get("report/dataReportPages?v="+(new Date).getTime(),{params:{page:currentPage,size:pageSize,condition:condition,beginDate:beginDate,endDate:endDate,tagId:tagId,batch:batch,period:period,sort:sort}})},self.getSearchInfos=function(){return $resource("report/reportSearchInfo?v="+(new Date).getTime()).get()},self.getDataReportInfo=function(url,dataKey,projectId,appId){return $http({method:"POST",url:url,data:$.param({dataKey:dataKey,projectId:projectId,appId:appId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},self.dataInBatch=function(params){return $http({url:"report/reportInBatch",method:"POST",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){function viewDataReport(userId,dataKey,fileName,appId,appName,proId,proName,obj){for(index in rememberDataReport)if(rememberDataReport[index].proId==proId){var dataKeys=rememberDataReport[index].dataKeys;break}if(void 0!=dataKeys){var flag=!1;for(key in dataKeys)if(dataKeys[key]==dataKey){flag=!0;break}flag||dataKeys.push(dataKey)}else{var remember={proId:proId,dataKeys:[dataKey]};rememberDataReport.push(remember)}if(81==appId||83==appId||85==appId||86==appId||87==appId||88==appId||91==appId||92==appId||93==appId||94==appId||99==appId||100==appId||101==appId||104==appId||116==appId||119==appId||120==appId||121==appId||122==appId||124==appId||125==appId||129==appId||130==appId)var href="#/reportpro/PGS/"+appId+"/"+dataKey+"/"+proId;else if(138==appId)var href="#/reportdata/Sanger/"+appId+"/"+dataKey+"/"+proId;else var href="#/reportpro/"+appName+"/"+appId+"/"+dataKey+"/"+proId;window.location.href=href}function getCountValue(key,id){var val,num=0;return $("#"+id).find("tr").each(function(i){0==i?$(this).find("th").each(function(j){var title=$(this).html();title==key&&(num=j)}):$(this).find("td").each(function(k){if(num==k&&(val=$(this).html(),val.indexOf(",")>0)){var reg=new RegExp(",","g");val=val.replace(reg,"")}})}),val}function dataInPro(appInfo,proId,projectName){$.get("data/getDataFromTbTask",{projectId:proId},function(fileList){$("#fileListUl").append("<a id='prevA' class='btn -low' style='width:100%;'><span class='fa fa-sort-asc'></span></button>");var fileNames=new Array,newList="";if(appId=appInfo.appId,userId=appInfo.userId,dataKey=appInfo.dataKey,110==appId||111==appId||112==appId||113==appId||126==appId||127==appId||128==appId||131==appId||279==appId){$.each(fileList,function(index,item){utils.isConfigure(item.fileName)||fileNames.push(item.fileName)}),newList="[{",fileNames.sort();for(var fileId_n="fileId:",fileName_n=",fileName:'",dataKey_n=",dataKey:'",code_n=",code:'",i=0;i<fileNames.length;i++)fileName_n+=fileNames[i],i<fileNames.length-1&&(fileName_n+="_&_");$.each(fileList,function(index,item){fileNames[0]==item.fileName&&(fileId_n+=item.fileId,dataKey_n+=item.dataKey,code_n+=item.code)}),newList+=fileId_n+fileName_n+"'"+dataKey_n+"'"+code_n+"'}]",newList=eval(newList)}else newList=fileList;$.each(newList,function(index,item){var inner="",obj1=$("#dataSpan"+proId+item.dataKey);0==index&&(dataItem0=item,obj1=$("#dataSpan"+proId+dataItem0.dataKey));var isActive="";item.dataKey==dataKey&&(isActive="active",reportIdNow="fileA"+proId+item.fileId),inner+="<a class='btn -low "+isActive+"' style='font-size:12px;width:100%;margin-top:1px;' id='fileA"+proId+item.fileId+"' title='"+item.fileName+"'>"+(item.fileName.length>15?item.fileName.substring(0,15)+"...":item.fileName)+"</button>",$("#fileListUl").append(inner),$("#fileA"+proId+item.fileId).bind("click",function(){viewDataReport(userId,item.dataKey,item.fileName,appId,item.code,proId,projectName,$(this)),$.get("report/clickItemDataReport",{},function(state){})})}),$("#fileListUl").append("<a id='nextA' class='btn -low' style='width:100%;margin-top:1px;'><span class='caret'></span></button>"),$("#prevA").bind("click",function(){var preId=$("#"+reportIdNow).prev().attr("id");return"prevA"==preId?void $.alert("已经是第一条数据"):($("#fileListUl").find("#"+preId).trigger("click"),$("#fileListUl").removeClass("active"),$("#"+preId).addClass("active"),void $.get("report/prevDataReport",{},function(state){}))}),$("#nextA").bind("click",function(){var nextId=$("#"+reportIdNow).next().attr("id");return"nextA"==nextId?void $.alert("已经是最后一条数据"):($("#fileListUl").find("#"+nextId).trigger("click"),$("#fileListUl").removeClass("active"),$("#"+nextId).addClass("active"),void $.get("report/nextDataReport",{},function(state){}))})})}celloudApp.directive("loadOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("reportLoadOver")})}}}),celloudApp.directive("pgsOver",function($timeout){return{restrict:"A",link:function(scope,element,attr){scope.$last===!0&&$timeout(function(){scope.$emit("pgsLoadOver")})}}}),celloudApp.controller("accuseqa2DataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getAccuSeqα2Info",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(accuSeqα2Info){$scope.accuSeq=accuSeqα2Info.accuSeqα2,$scope.project=accuSeqα2Info.project,$scope.uploadPath=accuSeqα2Info.uploadPath,dataInPro($scope.accuSeq,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataAccuseqa2DataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getAccuSeqα2Info",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(accuSeqα2Info){$scope.accuSeq=accuSeqα2Info.accuSeqα2,$scope.project=accuSeqα2Info.project,$scope.uploadPath=accuSeqα2Info.uploadPath,$scope.appName="AccuSeqα2",$scope.obj=$scope.accuSeq,$scope.obj.batch=accuSeqα2Info.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("commonReport",function($rootScope,dataReportService){$rootScope.dataInBatch=function(currentPage,obj){var params={};null!=currentPage&&(params.currentPage=currentPage),params.appId=obj.appId,params.projectId=obj.projectId,params.dataKey=obj.dataKey,params.batch=obj.batch,dataReportService.dataInBatch(params).success(function(data){$rootScope.taskPageList=data})}}),celloudApp.controller("egfrDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getEGFRInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(egfrInfo){$scope.egfr=egfrInfo.egfr,$scope.project=egfrInfo.project,$scope.uploadPath=egfrInfo.uploadPath,dataInPro($scope.egfr,$scope.project.projectId,$scope.project.projectName);var length=$scope.egfr.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/egfrCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("dataEgfrDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getEGFRInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(egfrInfo){$scope.egfr=egfrInfo.egfr,$scope.project=egfrInfo.project,$scope.uploadPath=egfrInfo.uploadPath,$scope.appName="EGFR",$scope.obj=$scope.egfr,$scope.obj.batch=egfrInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var length=$scope.egfr.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/egfrCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("krasDataReportController",function($scope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getKRASInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(krasInfo){$scope.kras=krasInfo.kras,$scope.project=krasInfo.project,$scope.uploadPath=krasInfo.uploadPath,dataInPro($scope.kras,$scope.project.projectId,$scope.project.projectName);var length=$scope.kras.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/krasCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("dataKrasDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getKRASInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(krasInfo){$scope.kras=krasInfo.kras,$scope.project=krasInfo.project,$scope.uploadPath=krasInfo.uploadPath,$scope.appName="KRAS",$scope.obj=$scope.kras,$scope.obj.batch=krasInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var length=$scope.kras.pos;0==length||isNaN(length)?$("#charDiv").html('<p style="color: red;">数据异常，没有同比结果</p>'):$.get("count/krasCompare",{length:length},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)}),$scope.showHelp=function(){$("#helpModal").modal("show")}})}),celloudApp.controller("hcvDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getHCVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hcvInfo){$scope.hcv=hcvInfo.hcv,$scope.project=hcvInfo.project,$scope.uploadPath=hcvInfo.uploadPath,dataInPro($scope.hcv,$scope.project.projectId,$scope.project.projectName),$scope.change=function(){var val=$("#_change").html();"显示更多"==val?($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#_change").html("返回")):($("#nomal").css("display","none"),$("#cfda").css("display",""),$("#_change").html("显示更多"))},$.get("count/hcvCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split(";"),k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',",Y+=n[0]==one?"{ dataLabels: { enabled: true, y: 0, crop: false, style: { fontWeight: 'bold', fontSize:16 }, }, y:"+n[1]+"},":n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","Subtype",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("dataHcvDataReportController",function($scope,$rootScope,$routeParams,dataReportService){dataReportService.getDataReportInfo("report/getHCVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hcvInfo){$scope.hcv=hcvInfo.hcv,$scope.project=hcvInfo.project,$scope.uploadPath=hcvInfo.uploadPath,$scope.appName="HCV_Genotype",$scope.obj=$scope.hcv,$scope.obj.batch=hcvInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.change=function(){var val=$("#_change").html();"显示更多"==val?($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#_change").html("返回")):($("#nomal").css("display","none"),$("#cfda").css("display",""),$("#_change").html("显示更多"))},$.get("count/hcvCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split(";"),k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',",Y+=n[0]==one?"{ dataLabels: { enabled: true, y: 0, crop: false, style: { fontWeight: 'bold', fontSize:16 }, }, y:"+n[1]+"},":n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","Subtype",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("brafDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBRAFInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(brafInfo){if($scope.braf=brafInfo.braf,$scope.project=brafInfo.project,$scope.uploadPath=brafInfo.uploadPath,dataInPro($scope.braf,$scope.project.projectId,$scope.project.projectName),void 0!=$scope.braf){var $table=$($scope.braf.mutationPosition);$scope.searchTable=function(){var result="";$table.find("td").each(function(){var context=$(this).html(),len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(k==-1)result+=after;else if(before!=after)result+=after;else{var search=$("#_snum").val(),r=context.substring(d+1,k);if(parseFloat(r)>parseFloat(search))result+=after;else{var l=context.indexOf("|"),r=context.indexOf("(");result+=context.substring(l+1,r)}}}),$("#searchResult").html(map[result])},$scope.searchTable()}})}),celloudApp.controller("dataBrafDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBRAFInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(brafInfo){if($scope.braf=brafInfo.braf,$scope.project=brafInfo.project,$scope.uploadPath=brafInfo.uploadPath,$scope.appName="BRAF",$scope.obj=$scope.braf,$scope.obj.batch=brafInfo.batch,$rootScope.dataInBatch(null,$scope.obj),void 0!=$scope.braf){var $table=$($scope.braf.mutationPosition);$scope.searchTable=function(){var result="";$table.find("td").each(function(){var context=$(this).html(),len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(k==-1)result+=after;else if(before!=after)result+=after;else{var search=$("#_snum").val(),r=context.substring(d+1,k);if(parseFloat(r)>parseFloat(search))result+=after;else{var l=context.indexOf("|"),r=context.indexOf("(");result+=context.substring(l+1,r)}}}),$("#searchResult").html(map[result])},$scope.searchTable()}})}),celloudApp.controller("tbRifampicinDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBRifampicinInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbrifampicinInfo){$scope.tbrifampicin=tbrifampicinInfo.tbrifampicin,$scope.project=tbrifampicinInfo.project,$scope.uploadPath=tbrifampicinInfo.uploadPath,dataInPro($scope.tbrifampicin,$scope.project.projectId,$scope.project.projectName),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.tbrifampicin.report).find("td").each(function(){var context=$(this).html();if(search){var len=context.indexOf("-"),d=context.indexOf(","),k=context.indexOf(")");if(len==-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)<parseFloat(search))$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var kl=context.indexOf("(");context=context.substring(0,kl)+context.substring(k+1,context.length),$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3));if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var c5,c=context.split("\t"),c3=c[3].substring(0,c[3].indexOf("|")),c4=(c[4].substring(0,c[3].lastIndexOf("|")-1)+c[4].substring(c[4].lastIndexOf(")")+1,c[4].length)).replace("(","");c5=c[5].indexOf("|")==-1?c[5]:c[5].substring(0,c[5].indexOf("|"));var last=c[0]+"\t"+c[1]+"\t"+c[2]+"\t"+c3+"\t"+c4+"\t"+c5;$("#_sr").append("<tr><td>"+last.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")})},$scope.searchTable(),$.get("count/tbCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("dataTbRifampicinDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBRifampicinInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbrifampicinInfo){$scope.tbrifampicin=tbrifampicinInfo.tbrifampicin,$scope.project=tbrifampicinInfo.project,$scope.uploadPath=tbrifampicinInfo.uploadPath,$scope.appName="TB-Rifampicin",$scope.obj=$scope.tbrifampicin,$scope.obj.batch=tbrifampicinInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.tbrifampicin.report).find("td").each(function(){var context=$(this).html();if(search){var len=context.indexOf("-"),d=context.indexOf(","),k=context.indexOf(")");if(len==-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)<parseFloat(search))$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var kl=context.indexOf("(");context=context.substring(0,kl)+context.substring(k+1,context.length),$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else{var before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3));if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>");else if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var c5,c=context.split("\t"),c3=c[3].substring(0,c[3].indexOf("|")),c4=(c[4].substring(0,c[3].lastIndexOf("|")-1)+c[4].substring(c[4].lastIndexOf(")")+1,c[4].length)).replace("(","");c5=c[5].indexOf("|")==-1?c[5]:c[5].substring(0,c[5].indexOf("|"));var last=c[0]+"\t"+c[1]+"\t"+c[2]+"\t"+c3+"\t"+c4+"\t"+c5;$("#_sr").append("<tr><td>"+last.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")}}else $("#_sr").append("<tr><td>"+context.replace(new RegExp("\t","g"),"&nbsp;&nbsp;&nbsp;&nbsp;")+"</tr></td>")})},$scope.searchTable(),$.get("count/tbCompare",{},function(data){var div=$("<div id='char0' class='col-lg-6' style='width: 1000px;height:400px;'></div>");$("#charDiv").append(div);var X="[",Y="[",value=data.split("\n");if(value.length>1)for(var k=0;k<value.length-1;k++){var n=value[k].split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}else{var n=data.split("\t");X+="'"+n[0]+"',",Y+=n[1]+","}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char0","位点",eval(X),eval(Y),0,500,300)})})}),celloudApp.controller("tbinhDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBINHInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbinhInfo){$scope.tbinh=tbinhInfo.tbinh,$scope.project=tbinhInfo.project,$scope.uploadPath=tbinhInfo.uploadPath,dataInPro($scope.tbinh,$scope.project.projectId,$scope.project.projectName);var mutant=tbinhInfo.mutant,wild=tbinhInfo.wild,neither=tbinhInfo.neither,data=[{name:"Mutant strain",value:mutant},{name:"Wild type",value:wild},{name:"No Result",value:neither}];$.reportChar.draw.echartsShowPie("_showPie","Samples Statistic",data),$scope.searchTable=function(numId,sourceId,resultId){var search=$("#"+numId).val();$("#"+resultId).html("");var i=0;"r1"==sourceId?$table=$($scope.tbinh.position):$table=$($scope.tbinh.mutationPosition),$table.find("td").each(function(){var context=$(this).html();if(""==search)i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var len=context.lastIndexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&(i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>"))}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),i++,$("#"+resultId).append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}}}),0==i&&$("#"+resultId).append("<tr><td style='color:red'>没有符合筛选条件的结果</tr></td>")},$scope.searchTable("_snum1","r1","_sr1"),$scope.searchTable("_snum2","r2","_sr2")})}),celloudApp.controller("dataTbinhDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTBINHInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(tbinhInfo){$scope.tbinh=tbinhInfo.tbinh,$scope.project=tbinhInfo.project,$scope.uploadPath=tbinhInfo.uploadPath,$scope.appName="TB-INH",$scope.obj=$scope.tbinh,$scope.obj.batch=tbinhInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var mutant=tbinhInfo.mutant,wild=tbinhInfo.wild,neither=tbinhInfo.neither,data=[{name:"Mutant strain",value:mutant},{name:"Wild type",value:wild},{name:"No Result",value:neither}];$.reportChar.draw.echartsShowPie("_showPie","Samples Statistic",data),$scope.searchTable=function(numId,sourceId,resultId){var search=$("#"+numId).val();$("#"+resultId).html("");var i=0;"r1"==sourceId?$table=$($scope.tbinh.position):$table=$($scope.tbinh.mutationPosition),$table.find("td").each(function(){var context=$(this).html();if(""==search)i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var len=context.lastIndexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&(i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>"))}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),i++,$("#"+resultId).append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>");else i++,$("#"+resultId).append("<tr><td>"+context+"</tr></td>")}}}),0==i&&$("#"+resultId).append("<tr><td style='color:red'>没有符合筛选条件的结果</tr></td>")},$scope.searchTable("_snum1","r1","_sr1"),$scope.searchTable("_snum2","r2","_sr2")})}),celloudApp.controller("hbvDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.hbvOtherSiteList=hbvInfo.hbvOtherSiteList,$scope.siteKeys=new Array,$scope.lowQcStr=null,$scope.hbv.lowQc&&($scope.lowQcStr=$scope.hbv.lowQc.join(","));for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])$scope.siteKeys.push(j);dataInPro($scope.hbv,$scope.project.projectId,$scope.project.projectName),$scope.change1=function(){if($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#showMain").scrollTop(0),void 0==localStorage.hbvIntro&&(localStorage.hbvIntro=0),0==localStorage.hbvIntro){var intro=introJs();intro.setOption("tooltipPosition","bottom"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.setOption("highlightClass","hbv-introjs-helperLayer"),intro.setOption("tooltipClass","introjs-hbv-tooltip"),intro.goToStep(2).start()}},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display",""),$("#showMain").scrollTop(0)},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)};var X=new Array,Y=new Array;for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])Y.push(j),X.push($scope.hbvOtherSiteList[i][j].count);X.length>20?(xLess=X.slice(0,20),yLess=Y.slice(0,20)):(xLess=X,yLess=Y),xLess=xLess.reverse(),yLess=yLess.reverse();var divLess=$("<div id='less' class='col-lg-12' style='width: 1000px;height: "+40*xLess.length+"px;'></div>");xLessStr="["+xLess.join(",")+"]",yLessStr="["+yLess.join(",")+"]",$("#charDiv0").append(divLess),$.reportChar.draw.echartsShowHorizontalBar("less","其他位点",eval(xLessStr),eval(yLessStr),700,40*xLess.length,"其他位点数量"),X=X.reverse(),Y=Y.reverse();var divMore=$("<div id='more' class='col-lg-12' style='width: 1000px;height: "+40*X.length+"px;'></div>");XStr="["+X.join(",")+"]",YStr="["+Y.join(",")+"]",$("#charDiv0").append(divMore),$.reportChar.draw.echartsShowHorizontalBar("more","其他位点",eval(XStr),eval(YStr),700,40*X.length,"其他位点数量"),$scope.more=!0,$("#more").hide(),$scope.tablePos=document.getElementById("tableDiv").offsetTop,$scope.chartPos=document.getElementById("charDiv0").offsetTop,$scope.showMore=function(flag){$("#more").show(),$("#less").hide(),$scope.more=!1,$scope.less=!0,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$scope.showLess=function(flag){$("#more").hide(),$("#less").show(),$scope.more=!0,$scope.less=!1,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",$routeParams.appId,hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("dataHbvDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.appName="HBV_SNP2",$scope.obj=$scope.hbv,$scope.obj.batch=hbvInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.hbvOtherSiteList=hbvInfo.hbvOtherSiteList,$scope.siteKeys=new Array,$scope.lowQcStr=null,$scope.hbv.lowQc&&($scope.lowQcStr=$scope.hbv.lowQc.join(","));for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])$scope.siteKeys.push(j);$scope.change1=function(){
if($("#nomal").css("display",""),$("#cfda").css("display","none"),$("#showMain").scrollTop(0),void 0==localStorage.hbvIntro&&(localStorage.hbvIntro=0),0==localStorage.hbvIntro){var intro=introJs();intro.setOption("tooltipPosition","bottom"),intro.setOption("positionPrecedence",["left","right","bottom","top"]),intro.setOption("showStepNumbers",!1),intro.setOption("showButtons",!0),intro.setOption("highlightClass","hbv-introjs-helperLayer"),intro.setOption("tooltipClass","introjs-hbv-tooltip"),intro.goToStep(2).start()}},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display",""),$("#showMain").scrollTop(0)},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)};var X=new Array,Y=new Array;for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])Y.push(j),X.push($scope.hbvOtherSiteList[i][j].count);X.length>20?(xLess=X.slice(0,20),yLess=Y.slice(0,20)):(xLess=X,yLess=Y),xLess=xLess.reverse(),yLess=yLess.reverse();var divLess=$("<div id='less' class='col-lg-12' style='width: 1000px;height: "+40*xLess.length+"px;'></div>");xLessStr="["+xLess.join(",")+"]",yLessStr="["+yLess.join(",")+"]",$("#charDiv0").append(divLess),$.reportChar.draw.echartsShowHorizontalBar("less","其他位点",eval(xLessStr),eval(yLessStr),700,40*xLess.length,"其他位点数量"),X=X.reverse(),Y=Y.reverse();var divMore=$("<div id='more' class='col-lg-12' style='width: 1000px;height: "+40*X.length+"px;'></div>");XStr="["+X.join(",")+"]",YStr="["+Y.join(",")+"]",$("#charDiv0").append(divMore),$.reportChar.draw.echartsShowHorizontalBar("more","其他位点",eval(XStr),eval(YStr),700,40*X.length,"其他位点数量"),$scope.more=!0,$("#more").hide(),$scope.tablePos=document.getElementById("tableDiv").offsetTop,$scope.chartPos=document.getElementById("charDiv0").offsetTop,$scope.showMore=function(flag){$("#more").show(),$("#less").hide(),$scope.more=!1,$scope.less=!0,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$scope.showLess=function(flag){$("#more").hide(),$("#less").show(),$scope.more=!0,$scope.less=!1,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",$routeParams.appId,hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("sangerDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getHBVInfo",$routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(hbvInfo){$scope.hbv=hbvInfo.hbv,$scope.project=hbvInfo.project,$scope.uploadPath=hbvInfo.uploadPath,$scope.hbvOtherSiteList=hbvInfo.hbvOtherSiteList,$scope.siteKeys=new Array,$scope.lowQcStr=null,$scope.hbv.lowQc&&($scope.lowQcStr=$scope.hbv.lowQc.join(","));for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])$scope.siteKeys.push(j);dataInPro($scope.hbv,$scope.project.projectId,$scope.project.projectName),$scope.change1=function(){$("#nomal").css("display",""),$("#cfda").css("display","none"),$("#showMain").scrollTop(0)},$scope.change2=function(){$("#nomal").css("display","none"),$("#cfda").css("display",""),$("#showMain").scrollTop(0)},$scope.showModal=function(id,flag,num){$("#_showOne").css("display","none"),$("#_showMore").css("display","none"),$("#_showImg").css("display","none"),2==flag?$("#_showImg").css("display",""):1==flag?$("#_showOne").css("display",""):0==flag&&($(".y").css("display","none"),1==num?$(".y1").css("display",""):2==num?$(".y2").css("display",""):3==num?$(".y3").css("display",""):4==num?$(".y4").css("display",""):5==num?$(".y5").css("display",""):6==num?$(".y6").css("display",""):7==num&&$(".y7").css("display",""),$("#_showMore").css("display","")),$("#"+id).modal("show"),$("#"+id).find(".modal-body").scrollTop(0)};var X=new Array,Y=new Array;for(i in $scope.hbvOtherSiteList)for(j in $scope.hbvOtherSiteList[i])Y.push(j),X.push($scope.hbvOtherSiteList[i][j].count);X.length>20?(xLess=X.slice(0,20),yLess=Y.slice(0,20)):(xLess=X,yLess=Y),xLess=xLess.reverse(),yLess=yLess.reverse();var divLess=$("<div id='less' class='col-lg-12' style='width: 1000px;height: "+40*xLess.length+"px;'></div>");xLessStr="["+xLess.join(",")+"]",yLessStr="["+yLess.join(",")+"]",$("#charDiv0").append(divLess),$.reportChar.draw.echartsShowHorizontalBar("less","其他位点",eval(xLessStr),eval(yLessStr),700,40*xLess.length,"其他位点数量"),X=X.reverse(),Y=Y.reverse();var divMore=$("<div id='more' class='col-lg-12' style='width: 1000px;height: "+40*X.length+"px;'></div>");XStr="["+X.join(",")+"]",YStr="["+Y.join(",")+"]",$("#charDiv0").append(divMore),$.reportChar.draw.echartsShowHorizontalBar("more","其他位点",eval(XStr),eval(YStr),700,40*X.length,"其他位点数量"),$scope.more=!0,$("#more").hide(),$scope.tablePos=document.getElementById("tableDiv").offsetTop,$scope.chartPos=document.getElementById("charDiv0").offsetTop,$scope.showMore=function(flag){$("#more").show(),$("#less").hide(),$scope.more=!1,$scope.less=!0,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$scope.showLess=function(flag){$("#more").hide(),$("#less").show(),$scope.more=!0,$scope.less=!1,"table"==flag?console.log(document.getElementById("tableDiv").offsetTop):console.log(document.getElementById("charDiv0").offsetTop)},$.get("count/hbvCompare",{appId:82,path:DATAPATH},function(data){var div0=$("<div id='char0' class='col-lg-12' style='width: 1000px;height: 450px;'></div>");$("#charDiv").append(div0);var sType=$("#snpType").html();sType||(sType="");var hbvtype=eval(data.split("@")[1]),aType="[";if(sType.indexOf("A")>=0&&(aType+="['A',"+hbvtype[0]/2+"]"),sType.indexOf("B")>=0&&(aType+="'null',['B',"+hbvtype[1]/2+"]"),sType.indexOf("C")>=0&&(aType+="'null','null',['C',"+hbvtype[2]/2+"]"),sType.indexOf("D")>=0){for(var i=0;i<3;i++)aType+="null";aType+="['D',"+hbvtype[3]/2+"]"}if(sType.indexOf("E")>=0){for(var i=0;i<4;i++)aType+="null";aType+="['E',"+hbvtype[4]/2+"]"}if(sType.indexOf("F")>=0){for(var i=0;i<5;i++)aType+="null";aType+="['F',"+hbvtype[5]/2+"]"}if(sType.indexOf("G")>=0){for(var i=0;i<6;i++)aType+="null";aType+="['G',"+hbvtype[6]/2+"G"}if(sType.indexOf("H")>=0){for(var i=0;i<7;i++)aType+="null";aType+="['H',"+hbvtype[7]/2+"H"}if(sType.indexOf("no match")>=0){for(var i=0;i<8;i++)aType+="null";aType+="['比对失败',"+hbvtype[8]/2+"]"}if(""==sType){for(var i=0;i<9;i++)aType+="null";aType+="['异常数据',"+hbvtype[9]/2+"]"}aType+="]",$.reportChar.draw.echartsShowHBVType("char0",hbvtype,aType,45);var result=$("#resultDiv").html();if(result){var temp=result.split("<br>"),rType=new Array;temp[0].indexOf("未检测到")<0&&rType.push("ADV"),temp.length>1&&temp[1].indexOf("未检测到")<0&&rType.push("TDF"),temp.length>2&&temp[2].indexOf("未检测到")<0&&rType.push("LAM"),temp.length>3&&temp[3].indexOf("未检测到")<0&&rType.push("LDT"),temp.length>4&&temp[4].indexOf("未检测到")<0&&rType.push("FTC"),temp.length>5&&temp[5].indexOf("未检测到")<0&&rType.push("ETV")}var div1=$("<div id='char1' class='col-lg-12' style='width: 1000px;height: 535px;margin-left:-15px;'></div>");$("#charDiv").append(div1);for(var one=getCountValue("Subtype","nomal"),X="[",Y="[",value=data.split("@")[0].split(";"),num=value.length,k=0;k<value.length-1;k++){var n=value[k].split(",");X+="'"+n[0]+"',";var tag=n[0].split("_");if(tag.length==rType.length){for(var isOne=!1,i=0;i<tag.length;i++)isOne=$.inArray(tag[i],rType)>=0;Y+=isOne?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}else Y+=0==rType.length&&"none"==n[0]?"{value : "+n[1]+", itemStyle : {normal : {color : '#00cccc'}}},":"'"+n[1]+"',"}X=X.substring(0,X.length-1)+"]",Y=Y.substring(0,Y.length-1)+"]",$.reportChar.draw.echartsShowBar("char1","耐药类型",eval(X),eval(Y),-45,800,350)})})}),celloudApp.controller("oncogeneDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getOncogeneInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(oncogeneInfo){$scope.oncogene=oncogeneInfo.oncogene,$scope.project=oncogeneInfo.project,$scope.uploadPath=oncogeneInfo.uploadPath,dataInPro($scope.oncogene,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataOncogeneDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getOncogeneInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(oncogeneInfo){$scope.oncogene=oncogeneInfo.oncogene,$scope.project=oncogeneInfo.project,$scope.uploadPath=oncogeneInfo.uploadPath,$scope.appName="oncogene",$scope.obj=$scope.oncogene,$scope.obj.batch=oncogeneInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("dpdDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getDpdInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(dpdInfo){$scope.dpd=dpdInfo.dpd,$scope.project=dpdInfo.project,$scope.uploadPath=dpdInfo.uploadPath,dataInPro($scope.dpd,$scope.project.projectId,$scope.project.projectName),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.dpd.mutationPosition).find("td").each(function(){var context=$(this).html();if(""==search)$("#_sr").append("<tr><td>"+context+"</tr></td>");else{var len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),$("#_sr").append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else $("#_sr").append("<tr><td>"+context+"</tr></td>")}}})},$scope.searchTable()})}),celloudApp.controller("dataDpdDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getDpdInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(dpdInfo){$scope.dpd=dpdInfo.dpd,$scope.project=dpdInfo.project,$scope.uploadPath=dpdInfo.uploadPath,$scope.appName="DPD",$scope.obj=$scope.dpd,$scope.obj.batch=dpdInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.searchTable=function(){var search=$("#_snum").val();$("#_sr").html(""),$($scope.dpd.mutationPosition).find("td").each(function(){var context=$(this).html();if(""==search)$("#_sr").append("<tr><td>"+context+"</tr></td>");else{var len=context.indexOf("-"),before=$.trim(context.substring(len-2,len-1)),after=$.trim(context.substring(len+1,len+3)),d=context.indexOf(","),k=context.indexOf(")");if(before==after)if(d>-1&&k>-1){var result=context.substring(d+1,k);parseFloat(result)<parseFloat(search)&&$("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else{var sub=context.indexOf("|");if(sub>-1)if(d>-1&&k>-1){var result=context.substring(d+1,k);if(parseFloat(result)>parseFloat(search)){var last=context.substring(k+1,context.length),l=last.indexOf("|");l==-1&&(l=last.length),$("#_sr").append("<tr><td>"+context.substring(0,sub)+last.substring(0,l)+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>")}else $("#_sr").append("<tr><td>"+context+"</tr></td>");else $("#_sr").append("<tr><td>"+context+"</tr></td>")}}})},$scope.searchTable()})}),celloudApp.controller("abinjDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getABINJInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(abinjInfo){$scope.abinj=abinjInfo.abinj,$scope.project=abinjInfo.project,$scope.uploadPath=abinjInfo.uploadPath,dataInPro($scope.abinj,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataAbinjDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getABINJInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(abinjInfo){$scope.abinj=abinjInfo.abinj,$scope.project=abinjInfo.project,$scope.uploadPath=abinjInfo.uploadPath,$scope.appName="ABI_NJ",$scope.obj=$scope.abinj,$scope.obj.batch=abinjInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("ugtDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getUGTInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(ugtInfo){$scope.ugt=ugtInfo.ugt,$scope.project=ugtInfo.project,$scope.uploadPath=ugtInfo.uploadPath,dataInPro($scope.ugt,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataUgtDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getUGTInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(ugtInfo){$scope.ugt=ugtInfo.ugt,$scope.project=ugtInfo.project,$scope.uploadPath=ugtInfo.uploadPath,$scope.appName="UGT",$scope.obj=$scope.ugt,$scope.obj.batch=ugtInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("16sDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/get16SInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(s16Info){$scope.s16=s16Info.s16,$scope.project=s16Info.project,$scope.uploadPath=s16Info.uploadPath,dataInPro($scope.s16,$scope.project.projectId,$scope.project.projectName);var $table=$("<div>"+$scope.s16.resultTable+"</div>");$table.find("tr").each(function(i){0==i?length=$(this).find("td").length:(tdlength=$(this).find("td").length,tdlength<length&&$(this).children("td").eq(1).attr("colspan",5))}),$scope.s16.resultTable=$table.html()})}),celloudApp.controller("data16sDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/get16SInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(s16Info){$scope.s16=s16Info.s16,$scope.project=s16Info.project,$scope.uploadPath=s16Info.uploadPath,$scope.appName="16S",$scope.obj=$scope.s16,$scope.obj.batch=s16Info.batch,$rootScope.dataInBatch(null,$scope.obj);var $table=$("<div>"+$scope.s16.resultTable+"</div>");$table.find("tr").each(function(i){0==i?length=$(this).find("td").length:(tdlength=$(this).find("td").length,tdlength<length&&$(this).children("td").eq(1).attr("colspan",5))}),$scope.s16.resultTable=$table.html()})}),celloudApp.controller("translateDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTranslateInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(translateInfo){$scope.translate=translateInfo.translate,$scope.project=translateInfo.project,$scope.uploadPath=translateInfo.uploadPath,dataInPro($scope.translate,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataTranslateDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getTranslateInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(translateInfo){$scope.translate=translateInfo.translate,$scope.project=translateInfo.project,$scope.uploadPath=translateInfo.uploadPath,$scope.appName="translate_simplified",$scope.obj=$scope.translate,$scope.obj.batch=translateInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("gddDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getGDDInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(gddInfo){$scope.gdd=gddInfo.cmp,$scope.project=gddInfo.project,$scope.uploadPath=gddInfo.uploadPath,dataInPro($scope.gdd,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataGddDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getGDDInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(gddInfo){$scope.gdd=gddInfo.cmp,$scope.project=gddInfo.project,$scope.uploadPath=gddInfo.uploadPath,$scope.appName=$scope.gdd.appName,$scope.obj=$scope.gdd,$scope.obj.batch=gddInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("cmpDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getCMPInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(cmpInfo){$scope.cmp=cmpInfo.cmp,$scope.project=cmpInfo.project,$scope.uploadPath=cmpInfo.uploadPath,dataInPro($scope.cmp,$scope.project.projectId,$scope.project.projectName)})}),celloudApp.controller("dataCmpDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getCMPInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(cmpInfo){$scope.cmp=cmpInfo.cmp,$scope.project=cmpInfo.project,$scope.uploadPath=cmpInfo.uploadPath,$scope.appName=$scope.cmp.appName,$scope.obj=$scope.cmp,$scope.obj.batch=cmpInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("bsiDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getBSIInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(bsiInfo){if($scope.bsi=bsiInfo.bsi,$scope.data=bsiInfo.data,$scope.project=bsiInfo.project,$scope.uploadPath=bsiInfo.uploadPath,$scope.tab="patient",$scope.havestrain="",$scope.bsi&&$scope.bsi.species_20){for(var i=0;i<$scope.bsi.species_20.length;i++)havestrain+=$scope.bsi.species_20[i].species_zh+",";$scope.havestrain=havestrain.substr(0,havestrain.length-1)}$scope.getRowspan=function(val1,val2,val3){var val0=1;return null!=val1&&val0++,null!=val2&&val0++,null!=val3&&val0++,val0}})}),celloudApp.controller("rockyDataReportController",function($scope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getRockyInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(rockyInfo){$scope.rocky=rockyInfo.rocky,$scope.project=rockyInfo.project,$scope.uploadPath=rockyInfo.uploadPath,$scope.significances=rockyInfo.significances})}),celloudApp.controller("fsocgDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getFSocgInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(fsocgInfo){$scope.fsocg=fsocgInfo.fsocg,$scope.appName=$scope.fsocg.appName,$scope.obj=$scope.fsocg,$scope.obj.batch=fsocgInfo.batch,$rootScope.dataInBatch(null,$scope.obj)})}),celloudApp.controller("dataMibReportController",function($scope,$rootScope,$routeParams,mibReportService){mibReportService.reportInfo($routeParams.dataKey,$routeParams.proId,$routeParams.appId).success(function(mibInfo){$scope.mib=mibInfo.mib,$scope.appName="MIB",$scope.obj=$scope.mib,$scope.obj.batch=mibInfo.batch,$rootScope.dataInBatch(null,$scope.obj),void 0!=mibInfo.readsDistributionInfo&&$.reportChar.draw.circularGraph("reads-distribution-char","Reads","Distribution",mibInfo.readsDistributionInfo),void 0!=mibInfo.familyDistributionInfo&&$.reportChar.draw.circularGraph("family-distribution-char","Family","Distribution",mibInfo.familyDistributionInfo),void 0!=mibInfo.genusDistributionInfo&&$.reportChar.draw.singleBar("genus-distribution-char","Top 10 genus distribution","",mibInfo.genusDistributionInfo,"Depth","Depth")})}),celloudApp.controller("splitDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){dataReportService.getDataReportInfo("report/getSplitInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(splitInfo){$scope.split=splitInfo.split,$scope.project=splitInfo.project,$scope.uploadPath=splitInfo.uploadPath,$scope.appName="split",$scope.obj=$scope.split,$scope.obj.batch=splitInfo.batch,$rootScope.dataInBatch(null,$scope.obj);var printReport={main:function(method,param){$.get(method,param,function(responseText){var obj=window.open("");obj.document.write(responseText),obj.document.close()})},mongoParam:function(projectId,dataKey,appId){var _param={projectId:projectId,dataKey:dataKey,appId:appId};return _param}};$scope.printSplit=function(projectId,dataKey,appId){printReport.main("report/printSplitReport",printReport.mongoParam(projectId,dataKey,appId))},$.get("count/splitCompare",{id:splitInfo.splitId},function(data){var totalSource=JSON.stringify(data.totalSource),totalSample=JSON.stringify(data.totalSample),thisSource=JSON.stringify(data.thisSource),thisSample=JSON.stringify(data.thisSample);console.log("totalSource: "+totalSource),console.log("totalSample: "+totalSample),console.log("thisSource: "+thisSource),console.log("thisSample: "+thisSample),drawScatter("sourceCharDiv",eval(totalSource),eval(thisSource),"Split源数据同比图","平均质量","序列总数"),drawScatter("sampleCharDiv",eval(totalSample),eval(thisSample),"Split分离结果数据同比图","平均质量","序列总数")})})}),celloudApp.controller("pgsDataReportController",function($scope,$routeParams,$compile,dataReportService){$scope.$on("pgsLoadOver",function(){var num=0;$("#reportDiv").find("td").each(function(){var result=$(this).text();num%4==0&&$(this).css("min-width","90px"),num%4==1&&$(this).css("min-width","55px"),num%4==2&&result.length>85&&($(this).html(result.substring(0,84)+"..."),$(this).attr("title",result)),num%4==3&&(result.length>39&&($(this).html(result.substring(0,38)+"..."),$(this).attr("title",result)),$(this).css("width","300px")),$(this).css("padding-left","20px"),$(this).css("text-align","left"),num++});var trTotal=0,tr=0,count=1,need=!1;$("#reportDiv").find("tr").each(function(){var tdVal=$(this).children("td").eq(0).html();if(tdVal.toLowerCase().indexOf("chr")==-1)$(this).children("td").eq(2).remove(),$(this).children("td").eq(2).remove(),tr=trTotal-count,count++,need=!0;else if(need){var rowTr=$("#reportTable tr").eq(tr);$(rowTr).children("td").eq(0).attr("rowspan",count),$(rowTr).children("td").eq(0).css("vertical-align","middle"),$(rowTr).children("td").eq(1).attr("rowspan",count),$(rowTr).children("td").eq(1).css("vertical-align","middle"),count=1,need=!1}trTotal++})}),dataReportService.getDataReportInfo("report/getPgsInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(pgsInfo){function showEdditError(info){$("#edit-conclusionErrorInfo").html(info),$("#edit-conclusion-error").removeClass("hide")}$scope.pgs=pgsInfo.pgs,$scope.experiment=pgsInfo.experiment,$scope.project=pgsInfo.project,$scope.uploadPath=pgsInfo.uploadPath,dataInPro($scope.pgs,$scope.project.projectId,$scope.project.projectName),$scope.editShowConclusion=function(){$("#edit-conclusion-error").addClass("hide"),$("#editReportConclusion").modal("show")},$scope.saveConclusion=function(){var qualified=$("#reportConclusion").find("input:radio[name='qualified']:checked").val();return qualified?void $.get("experiment/updateExperiment",$("#reportConclusionForm").serialize(),function(flag){1==flag?(showAddError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#reportConclusion").modal("hide")},2e3)):showAddError("保存失败！")}):void showAddError("请选择是否合格！")},$scope.editSaveConclusion=function(){var qualified=$("#editReportConclusion").find("input:radio[name='qualified']:checked").val();if(!qualified)return void showEdditError("请选择是否合格！");var remarks=$("#editReportConclusion").find("textarea[name='remarks']").val();return remarks.length>125?void showEdditError("备注长度不能大于125个字符！！"):void $.get("experiment/updateExperiment",$("#editReportConclusionForm").serialize(),function(flag){1==flag?(showEdditError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#editReportConclusion").modal("hide")},2e3)):showEdditError("保存失败！")})},$scope.showModal=function(id){$("#"+id).modal("show")};var appId=$scope.pgs.appId;$.get("count/pgsCompare",{appId:appId,columns:charMap[appId]},function(data){var sp=data.split(";");$("#charResult").html("");for(var i=1;i<sp.length;i++){var big=0,div=$("<div id='char"+i+"' class='col-lg-5' style='width: 410px;height:400px;'></div>");$("#charDiv").append(div);for(var ev=sp[i].split(":"),one=getCountValue(ev[0],"_table"),value=ev[1].split(","),context="[",k=0;k<value.length-1;k++)context+="[1,"+value[k]+"],",value[k]>one&&big++;context+="]";var percent=0;percent="Duplicate"==ev[0]||"Duplicate(%)"==ev[0]||"*SD"==ev[0]?Math.round(big/value.length*100):100-Math.round(big/value.length*100),$("#charResult").append("本数据的 "+ev[0]+" 打败了 <span class='green'>"+percent+"%</span> 的数据；");var single="[[2,"+one+"]]";$.reportChar.draw.echartsShowScatter("char"+i,ev[0],eval(context),eval(single))}})})}),celloudApp.controller("dataPgsDataReportController",function($scope,$rootScope,$routeParams,$compile,dataReportService){$scope.$on("pgsLoadOver",function(){var num=0;$("#reportDiv").find("td").each(function(){var result=$(this).text();num%4==0&&$(this).css("min-width","90px"),num%4==1&&$(this).css("min-width","55px"),num%4==2&&result.length>85&&($(this).html(result.substring(0,84)+"..."),$(this).attr("title",result)),num%4==3&&(result.length>39&&($(this).html(result.substring(0,38)+"..."),$(this).attr("title",result)),$(this).css("width","300px")),$(this).css("padding-left","20px"),$(this).css("text-align","left"),num++});var trTotal=0,tr=0,count=1,need=!1;$("#reportDiv").find("tr").each(function(){var tdVal=$(this).children("td").eq(0).html();if(tdVal.toLowerCase().indexOf("chr")==-1)$(this).children("td").eq(2).remove(),$(this).children("td").eq(2).remove(),tr=trTotal-count,count++,need=!0;else if(need){var rowTr=$("#reportTable tr").eq(tr);$(rowTr).children("td").eq(0).attr("rowspan",count),$(rowTr).children("td").eq(0).css("vertical-align","middle"),$(rowTr).children("td").eq(1).attr("rowspan",count),$(rowTr).children("td").eq(1).css("vertical-align","middle"),count=1,need=!1}trTotal++})}),dataReportService.getDataReportInfo("report/getPgsInfo",$routeParams.dataKey,$routeParams.projectId,$routeParams.appId).success(function(pgsInfo){function showEdditError(info){$("#edit-conclusionErrorInfo").html(info),$("#edit-conclusion-error").removeClass("hide")}$scope.pgs=pgsInfo.pgs,$scope.experiment=pgsInfo.experiment,$scope.project=pgsInfo.project,$scope.uploadPath=pgsInfo.uploadPath,$scope.appName="PGS",$scope.obj=$scope.pgs,$scope.obj.batch=pgsInfo.batch,$rootScope.dataInBatch(null,$scope.obj),$scope.editShowConclusion=function(){$("#edit-conclusion-error").addClass("hide"),$("#editReportConclusion").modal("show")},$scope.saveConclusion=function(){var qualified=$("#reportConclusion").find("input:radio[name='qualified']:checked").val();return qualified?void $.get("experiment/updateExperiment",$("#reportConclusionForm").serialize(),function(flag){1==flag?(showAddError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#reportConclusion").modal("hide")},2e3)):showAddError("保存失败！")}):void showAddError("请选择是否合格！")},$scope.editSaveConclusion=function(){var qualified=$("#editReportConclusion").find("input:radio[name='qualified']:checked").val();if(!qualified)return void showEdditError("请选择是否合格！");var remarks=$("#editReportConclusion").find("textarea[name='remarks']").val();return remarks.length>125?void showEdditError("备注长度不能大于125个字符！！"):void $.get("experiment/updateExperiment",$("#editReportConclusionForm").serialize(),function(flag){1==flag?(showEdditError("保存成功,请重新打开数据报告!"),setTimeout(function(){$("#editReportConclusion").modal("hide")},2e3)):showEdditError("保存失败！")})},$scope.showModal=function(id){$("#"+id).modal("show")};var appId=$scope.pgs.appId;$.get("count/pgsCompare",{appId:appId,columns:charMap[appId]},function(data){var sp=data.split(";");$("#charResult").html("");for(var i=1;i<sp.length;i++){var big=0,div=$("<div id='char"+i+"' class='col-lg-5' style='width: 410px;height:400px;'></div>");$("#charDiv").append(div);for(var ev=sp[i].split(":"),one=getCountValue(ev[0],"_table"),value=ev[1].split(","),context="[",k=0;k<value.length-1;k++)context+="[1,"+value[k]+"],",value[k]>one&&big++;context+="]";var percent=0;percent="Duplicate"==ev[0]||"Duplicate(%)"==ev[0]||"*SD"==ev[0]?Math.round(big/value.length*100):100-Math.round(big/value.length*100),$("#charResult").append("本数据的 "+ev[0]+" 打败了 <span class='green'>"+percent+"%</span> 的数据；");
var single="[[2,"+one+"]]";$.reportChar.draw.echartsShowScatter("char"+i,ev[0],eval(context),eval(single))}})})}),celloudApp.controller("projectReportController",function($scope,$rootScope,$routeParams,$location,projectReportService){$scope.companyId=companyId,$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,tokenSeparators:[","," "]}),$scope.ranAppList=projectReportService.getRanAPP(),$scope.projectOptions={page:$routeParams.page,pageSize:$routeParams.pageSize,belongs:$routeParams.belongs,changeDate:$routeParams.changeDate,start:$routeParams.start,end:$routeParams.end,app:$routeParams.app,condition:"all"==$routeParams.condition?"":$routeParams.condition},$scope.pageQuery=function(currentPage,pageSize){var belongs=$scope.projectOptions.belongs,start="all"==$scope.projectOptions.start?null:$scope.projectOptions.start+" 00:00:00",end="all"==$scope.projectOptions.end?null:$scope.projectOptions.end+" 23:59:59",app=$scope.projectOptions.app,condition=""==$scope.projectOptions.condition?null:$scope.projectOptions.condition;$scope.projectOptions.pageSize=pageSize,$scope.projectOptions.page=currentPage,projectReportService.getReportListCondition($scope.projectOptions.page,$scope.projectOptions.pageSize,belongs,start,end,app,condition).success(function(dataList){$scope.dataList=dataList})},$rootScope.goBack=function(){var belongs=$scope.projectOptions.belongs,changeDate=$scope.projectOptions.changeDate,start=$scope.projectOptions.start,end=$scope.projectOptions.end,app=$scope.projectOptions.app,condition=$scope.projectOptions.condition,pageSize=$scope.projectOptions.pageSize,page=$scope.projectOptions.page;condition=""==condition?"all":condition,window.location.href=CONTEXT_PATH+"/index#/reportpro/"+page+"/"+pageSize+"/"+belongs+"/"+changeDate+"/"+start+"/"+end+"/"+app+"/"+condition},$scope.pageQuery($scope.projectOptions.page,$scope.projectOptions.pageSize),$scope.changeBelongs=function(id){$scope.projectOptions.belongs=id,$scope.pageQuery(1,$scope.projectOptions.pageSize)};var START=null,END=null;$scope.changeDate=function(flag){if($scope.projectOptions.changeDate=flag,0==flag)START="all",END="all";else{var d=new Date,date=new Date(d.getTime()-864e5*flag),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();START=year+"-"+mounth+"-"+day,END=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()}$scope.dateQuery()},$scope.chooseDate=function(){return START=$("#_searchDate").val(),END=$("#_endDate").val(),START&&END?START>END?void $.alert("起始时间不能大于结束时间"):($scope.projectOptions.changeDate=-1,void $scope.dateQuery()):void $.alert("请同时选择起始时间和结束时间")},$scope.dateQuery=function(){null!=START&&($scope.projectOptions.start=START),null!=END&&($scope.projectOptions.end=END),$scope.pageQuery(1,$scope.projectOptions.pageSize)},$scope.changeApp=function(appId){$(".changeApp").removeClass("active"),$("#changeApp"+appId).addClass("active"),$scope.projectOptions.app=appId,$scope.pageQuery(1,$scope.projectOptions.pageSize)},$scope.changeCondition=function(){$scope.pageQuery(1,$scope.projectOptions.pageSize)},$scope.toChangePname=function(projectId){$("#showPname"+projectId).addClass("hide"),$("#changePname"+projectId).removeClass("hide")},$scope.changePname=function(projectId){var name=$("#updatePname"+projectId).val(),oldName=$("#pnameSpan"+projectId).text().trim();return name==oldName?($("#showPname"+projectId).removeClass("hide"),void $("#changePname"+projectId).addClass("hide")):void projectReportService.changeProjectName(projectId,name).success(function(response){response.success&&(name.length>13&&(name=name.substring(0,12)+"..."),$("#pnameSpan"+projectId).html(name),$("#showPname"+projectId).removeClass("hide"),$("#changePname"+projectId).addClass("hide")),$scope.message=response.message,$scope.state=!0})},$scope.cancelProjectShare=function(projectId){$.confirm("确定要删除该项目？","确认框",function(){projectReportService.cancelProjectShare(projectId).success(function(response){response.success&&$scope.pageQuery(1,$scope.projectOptions.pageSize),$.alert(response.message)})})},$scope.downPDF=function(userId,appId,projectId){var path=userId+"/"+appId+"/"+projectId+"/"+projectId+".pdf";projectReportService.downPDF(path).success(function(flag){if(1==flag)$.alert("没有可以下载的pdf文件");else{var url=window.location.href.split("index")[0];window.location.href=url+"report/down?path="+path}})},$scope.toShareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,$scope.updateState=!1,$("#shareProjectSelect").html("")},$scope.shareModal=function(projectId,projectName,dataNum){$scope.shareProjectId=projectId,$scope.shareProjectName=projectName,$scope.dataNum=dataNum,projectReportService.getShareTo(projectId).success(function(data){$scope.updateState=!1,$("#shareProjectSelect").html(""),$("#shareProjectSelect").select2({language:"zh-CN",placeholder:"请输入用户名",tags:!0,data:data,tokenSeparators:[","," "]})})},$scope.saveShareProject=function(){var proId=$scope.shareProjectId,data=$("#shareProjectSelect").select2("data"),userNames="";$.each(data,function(id,value){userNames+=value.text+","}),userNames=userNames.toLowerCase(),userNames=userNames.substring(0,userNames.length-1),projectReportService.projectShare(proId,userNames).success(function(response){function hideModal(){$("#project-share-modal").modal("hide"),$scope.pageQuery($scope.projectOptions.page,$scope.projectOptions.pageSize),$scope.updateState=!1}$scope.updateMessage=response.message,$scope.updateState=!0,response.success&&setTimeout(hideModal,1500)})},$scope.removePro=function(projectId){$.confirm("确定要删除该项目吗？","确认框",function(){projectReportService.deleteProject(projectId).success(function(flag){1==flag?($scope.pageQuery(1,$scope.projectOptions.pageSize),$.alert("项目报告删除成功")):$.alert("项目报告删除失败")})})},$scope.$on("reportLoadOver",function(){$("#_show").find(".projectContext").each(function(){var dataKeys,info=$.trim($(this).prev().html()).split(","),appId=info[0],appName=info[1],proId=info[2],userId=info[3],proName=$("#pnameSpan"+proId).html(),length=0,th_size=0,td_size=0,tr_size=$(this).find("tr").length,fileCount=parseInt($.trim($(this).parent().find("#rdataNum"+proId).html()));for(remember in rememberDataReport)rememberDataReport[remember].proId==proId&&(dataKeys=rememberDataReport[remember].dataKeys);$(this).find("table").addClass("table table-main info-table data-report-table"),$(this).find("tr").each(function(j){0==j?th_size=$(this).children().length:td_size=$(this).children().length;var trc=$(this).children().length;"80"==appId&&(0==j&&(length=$(this).children().length),length>6&&j>1&&j%2==0&&($(this).addClass("_HCVTR"),$(this).css("display","none"),$(this).children().attr("colspan","7"),$(this).children().css("word-break","break-all"))),$(this).mouseover(function(){$(this).find("a").addClass("link_hover")}),$(this).mouseout(function(){$(this).find("a").removeClass("link_hover")}),$(this).find("td").each(function(i){var flag=!1;if(void 0!=dataKeys)for(key in dataKeys)if(dataKeys[key]==$.trim($(this).prev().html())){flag=!0;break}if("90"==appId)if(1!=i)4==trc?0==i&&$(this).addClass("hide"):$(this).addClass("hide");else if($(this).css("border-left","none"),j>0){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if("279"==appId||"131"==appId||"128"==appId||"127"==appId||"126"==appId||"118"==appId||"117"==appId||"114"==appId||"113"==appId||"112"==appId||"111"==appId||"110"==appId||"109"==appId||"106"==appId||"107"==appId||"108"==appId||"105"==appId||"82"==appId||"84"==appId||"89"==appId||"73"==appId||"1"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&"279"!=appId&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId&&"126"!=appId&&"127"!=appId&&"128"!=appId&&"131"!=appId&&(fileName=fileName.substring(0,30)+"..."),"114"!=appId&&"118"!=appId?flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+fileName+"</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+fileName+"</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"82"==appId&&"不敏感"==$(this).html()&&$(this).addClass("red")}if("91"==appId||"95"==appId||"92"==appId||"93"==appId||"94"==appId||"86"==appId||"87"==appId||"88"==appId||"81"==appId||"83"==appId||"85"==appId||"96"==appId||"97"==appId||"98"==appId||"99"==appId||"100"==appId||"101"==appId||"102"==appId||"103"==appId||"104"==appId||"116"==appId||"119"==appId||"120"==appId||"121"==appId||"122"==appId||"124"==appId||"125"==appId||"129"==appId||"130"==appId){if(j>0&&0==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"...");var flag=!1;if(void 0!=dataKeys)for(key in dataKeys)if(dataKeys[key]==$.trim($(this).next().html())){flag=!0;break}flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).next().html()+"'>"+$(this).next().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).next().html()+"'>"+$(this).next().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().next().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}if(1==i&&$(this).addClass("hide"),j>0&&(4==i||3==i)){var val=$(this).html();!isNaN(val)&&val>999&&$(this).html($.format(val,3,","))}}if("80"==appId){if(5==length){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none"),"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","2")}if(7!=length&&8!=length||"No_Alignment"!=$(this).html()&&"Low_Quality"!=$(this).html()&&"No Alignment"!=$(this).html()&&"Low Quality"!=$(this).html()||$(this).attr("colspan","5"),7==length)j>0&&j%2==1&&0==i&&($(this).addClass("sub"),$(this).html("<a id='dataSpan"+proId+$(this).html()+"'>"+$(this).html()+"</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link"));else if(8==length&&(1==i&&$(this).css("border-left","none"),0!=j&&j%2!=1||0!=i||$(this).addClass("hide"),j>0&&j%2==1&&1==i)){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",viewNext),$(this).find("a").addClass("btn-link")}}if("11"==appId){if(j>0&&1==i){$(this).addClass("sub");var fileName=$(this).html();fileName.length>30&&(fileName=fileName.substring(0,30)+"..."),flag?$(this).html("<a style='color: rgb(67, 0, 153);' id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"):$(this).html("<a id='dataSpan"+proId+$(this).prev().html()+"'>"+$(this).prev().html()+" （"+fileName+"）</a>"),$(this).find("a").bind("click",function(){viewDataReport(userId,$.trim($(this).parent().prev().html()),$.trim($(this).html()),appId,appName,proId,proName,$(this))}),$(this).find("a").addClass("btn-link")}0==i&&$(this).addClass("hide"),1==i&&$(this).css("border-left","none")}td_size<th_size&&i==td_size-1&&$(this).attr("colspan",th_size-td_size+1)})});var minTdNum;minTdNum=fileCount<5?5:fileCount+1,"279"!=appId&&"131"!=appId&&"128"!=appId&&"127"!=appId&&"126"!=appId&&"113"!=appId&&"112"!=appId&&"111"!=appId&&"110"!=appId||(minTdNum=fileCount<4?4:fileCount+1);var rdataNum=$("#rdataNum"+proId).html();if(("114"==appId||"118"==appId)&&tr_size-1<rdataNum){var num=Number(rdataNum)-tr_size+1,height=30*(5-tr_size),adHtml="<tr><td colspan='"+th_size+"' style='border-left-style: none;vertical-align: middle;height:"+height+"px' align='center'><img src='/celloud/images/report/running.png' title='正在运行...'/><br>"+num+"个数据正在运行...</td></tr>";$(this).find("tbody").append(adHtml)}else if(tr_size<minTdNum){var num=minTdNum-tr_size;if(tr_size-1<fileCount){var imgTr="<tr><td style='text-align: center;height: 75px;' rowspan='"+num+"' colspan='"+th_size+"'><img src='"+CONTEXT_PATH+"/images/report/running.png' title='正在运行...''/></td></tr>";$(this).find("tbody").append(imgTr)}else for(i=0;i<num;i++){var adHtml="<tr>";for(j=0;j<th_size-1;j++)adHtml+="<td></td>";adHtml+="</tr>",$(this).find("tbody").append(adHtml)}}})})}),celloudApp.controller("dataReportController",function($rootScope,$routeParams,$scope,$location,projectReportService,dataReportService){$scope.searchInfo=dataReportService.getSearchInfos(),$scope.dataOptions={page:$routeParams.page,pageSize:$routeParams.pageSize,fullDate:$routeParams.fullDate,beginDate:$routeParams.beginDate,endDate:$routeParams.endDate,tagId:$routeParams.tagId,period:$routeParams.period,batch:$routeParams.batch,condition:"all"==$routeParams.condition?"":$routeParams.condition,sort:"desc"};var paramQuqery=function(){var beginDate="all"==$scope.dataOptions.beginDate?null:$scope.dataOptions.beginDate+" 00:00:00",endDate="all"==$scope.dataOptions.endDate?null:$scope.dataOptions.endDate+" 23:59:59",tagId="all"==$scope.dataOptions.tagId?null:$scope.dataOptions.tagId,period="all"==$scope.dataOptions.period?null:$scope.dataOptions.period,batch="all"==$scope.dataOptions.batch?null:$scope.dataOptions.batch,condition=""==$scope.dataOptions.condition?null:$scope.dataOptions.condition;dataReportService.getReportsByParams($scope.dataOptions.page,$scope.dataOptions.pageSize,condition,beginDate,endDate,batch,tagId,period,$scope.dataOptions.sort).success(function(dataList){$scope.reportList=dataList})};$rootScope.goBack=function(){var page=$scope.dataOptions.page,pageSize=$scope.dataOptions.pageSize,fullDate=$scope.dataOptions.fullDate,beginDate=$scope.dataOptions.beginDate,endDate=$scope.dataOptions.endDate,tagId=$scope.dataOptions.tagId,period=$scope.dataOptions.period,batch=$scope.dataOptions.batch,condition=$scope.dataOptions.condition;$location.path("/reportdata/"+page+"/"+pageSize+"/"+fullDate+"/"+beginDate+"/"+endDate+"/"+tagId+"/"+period+"/"+batch+"/"+(0==condition.length?"all":condition))},$scope.pageQuery=function(page,pageSize){$scope.dataOptions.page=page,$scope.dataOptions.pageSize=pageSize,paramQuqery()},$scope.tagsQuery=function(tagId){$scope.dataOptions.tagId=tagId,$scope.dataOptions.page=1,paramQuqery()},$scope.batchsQuery=function(batch){$scope.dataOptions.batch=batch,$scope.dataOptions.page=1,paramQuqery()},$scope.periodQuery=function(period){$scope.dataOptions.period=period,$scope.dataOptions.page=1,paramQuqery()},$scope.fullDateQuery=function(days){if($scope.dataOptions.fullDate=days,0==days)$scope.dataOptions.beginDate="all",$scope.dataOptions.endDate="all";else{var d=new Date,date=new Date(d.getTime()-864e5*days),year=date.getFullYear(),mounth=date.getMonth()+1,day=date.getDate();$scope.dataOptions.beginDate=year+"-"+mounth+"-"+day,$scope.dataOptions.endDate=d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()}$scope.dataOptions.page=1,paramQuqery()},$scope.chooseDate=function(){var d=new Date,begin=$("#begin-date").val(),end=$("#end-date").val();return end=end?end:d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate(),begin?begin>end?void $.tips("请确认开始时间  < 结束时间！","时间错误"):($scope.dataOptions.fullDate=-1,$scope.dataOptions.beginDate=begin,$scope.dataOptions.endDate=end,$scope.dataOptions.page=1,void paramQuqery()):void $.tips("请选择开始时间！","时间错误")},$scope.conditionQuery=function(){$scope.dataOptions.page=1,paramQuqery()},paramQuqery()})}();
!function(){window.sessionTimeoutFlagClient=!1,window.celloudApp.factory("sessionTimeout",["$q",function($q){return{response:function(response){var sessionstatus=response.headers().sessionstatus;return"timeout"!=sessionstatus||window.sessionTimeoutFlagClient||(window.sessionTimeoutFlagClient=!0,alert("登录超时，请重新登录！"),window.location.href="client.html"),response}}}]),window.celloudApp.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache",$httpProvider.interceptors.push("sessionTimeout")}])}();
!function(){celloudApp.service("clientBaseService",function($q,$http,$resource){this.getUserInfo=function(){return $http({method:"POST",url:"user/info",params:{}})},this.updateUserInfo=function(user){return $http({method:"POST",url:"user/updateInfo",params:{province:user.province,city:user.city,district:user.district,cellphone:user.cellphone,zipCode:user.zipCode,address:user.address,truename:user.truename,age:user.age,sex:user.sex}})}})}();
!function(){celloudApp.service("expenseService",function($http){this.pageQueryConsume=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"expense/toRunExpenseList",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryRecharge=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"pay/recharge/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryInvoice=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"invoice/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getInvoiceById=function(invoiceId){return $http({method:"POST",url:"invoice/detail",data:$.param({id:invoiceId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.apply=function(params){return $http({method:"POST",url:"invoice/apply",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.toRecharge=function(){return $http({method:"POST",url:"pay/recharge",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("clientBaseInfo",function($scope,$location,clientBaseService){clientBaseService.getUserInfo().success(function(data){$scope.user=data,$scope.province_bak=data.province,$scope.city_bak=data.city,$scope.district_bak=data.district,_init_area($scope.province_bak,$scope.city_bak,$scope.district_bak)}),$scope.updateUserInfo=function(){$scope.user.province=$("#s_province").val(),$scope.user.city=$("#s_city").val(),$scope.user.district=$("#s_county").val(),$scope.user.sex=$("input[name='sex']:checked").val(),clientBaseService.updateUserInfo($scope.user).success(function(data){$.alert(data.message)}).error(function(data){$.alert(data.message)})},$scope.updateToPay=function(){$scope.user.province=$("#s_province").val(),$scope.user.city=$("#s_city").val(),$scope.user.district=$("#s_county").val(),$scope.user.sex=$("input[name='sex']:checked").val(),clientBaseService.updateUserInfo($scope.user).success(function(data){$.alert(data.message),$location.path("/pay")}).error(function(data){$.alert(data.message)})}}),celloudApp.controller("toRecharge",function($scope,$location,expenseService){expenseService.toRecharge().success(function(data){$scope.balance=data}),$scope.sumbitRecharge=function(){var payWay="alipay"==$("input[name='pay_bank']:checked").val()?"alipay":"jdpay",action=CONTEXT_PATH+"/pay/recharge/"+payWay;$("#rechargeForm").attr("action",action),$.tips("请在新打开的页面完成支付操作！")}})}();