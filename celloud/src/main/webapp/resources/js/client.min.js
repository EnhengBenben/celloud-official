var utils={};!function($){$.extend({format:function(str,step,splitor){str=str.toString();var len=str.length;if(len>step){var l1=len%step,l2=parseInt(len/step),arr=[],first=str.substr(0,l1);""!=first&&arr.push(first);for(var i=0;i<l2;i++)arr.push(str.substr(l1+i*step,step));str=arr.join(splitor)}return str}})}(jQuery),utils._stopDefault=function(e){return e&&e.preventDefault?e.preventDefault():window.event.returnValue=!1,!1},utils.formatDate=function(size){var ss=parseInt(size);if(0===ss)return"00:00:00";if(/\D/.test(ss))return"N/A";ss=parseInt(size);var radix=60,mm=0,hh=0;return ss>radix&&(mm=parseInt(ss/radix),ss=parseInt(ss%radix),mm>radix&&(hh=parseInt(mm/radix),mm=parseInt(mm%radix))),hh>0&&hh<10?result="0"+parseInt(hh):hh>=10?result=parseInt(hh):hh<=0&&(result="00"),result+=":",mm>0&&mm<10?result+="0"+parseInt(mm):mm>=10?result+=parseInt(mm):mm<=0&&(result+="00"),result+=":",ss>0&&ss<10?result+="0"+parseInt(ss):ss>=10?result+=parseInt(ss):ss<=0&&(result+="00"),result},utils.getExt=function(fileName){var result=/\.[^\.]+/.exec(fileName);return result},utils.isConfigure=function(fileName){return".txt"==utils.getExt(fileName)||".lis"==utils.getExt(fileName)},utils.setDocSize=function(){var winWidth=$(window).width(),docWidth=$(document).width(),winHeight=$(window).height(),docHeight=$(document).height();winWidth>=docWidth?($(".bgContainer").width(winWidth),$(".longbackground").width(winWidth),$("#bg").width(winWidth)):($(".bgContainer").width(docWidth),$(".longbackground").width(docWidth),$("#bg").width(docWidth)),winHeight>=docHeight?($(".bgContainer").height(winHeight),$(".longbackground").height(winHeight),$("#bg").height(winHeight)):($(".bgContainer").height(docHeight),$(".longbackground").height(docHeight),$("#bg").height(docHeight)),$(".bgContainer").css("overflow","hidden")},utils.checkPlaceholder=function(){var input=document.createElement("input"),isPlaceholder="placeholder"in input;isPlaceholder||$(document).ready(function(){if(!isPlaceholder){$("input").not("input[type='password']").each(function(){""==$(this).val()&&""!=$(this).attr("placeholder")&&($(this).val($(this).attr("placeholder")),$(this).addClass("placeholder"),$(this).focus(function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")}),$(this).blur(function(){""==$(this).val()&&$(this).val($(this).attr("placeholder"))}))});var pwdField=$("input[type=password]"),pwdVal=pwdField.attr("placeholder");pwdField.after('<input id="pwdPlaceholder" type="text" class="pwd" value='+pwdVal+' autocomplete="off" />');var pwdPlaceholder=$("#pwdPlaceholder");pwdField.val()?(pwdPlaceholder.hide(),pwdField.show()):(pwdPlaceholder.show(),pwdField.hide()),pwdPlaceholder.focus(function(){pwdPlaceholder.hide(),pwdField.show(),pwdField.focus()}),pwdField.blur(function(){""==pwdField.val()&&(pwdPlaceholder.show(),pwdField.hide())})}})},utils.splitDataByInfo=function(data,splitStr,number){var reStr="(.{"+number+"}|.*)",reg=new RegExp(reStr,"g"),dataArray=data.match(reg);dataArray.pop();for(var i=(dataArray.length+1,0);i<dataArray.length;i+=2)dataArray.splice(i+1,0,splitStr);dataArray.pop();var str=dataArray.join("");return str},utils.loadBaiduTongji=function(){var host=window.location.host;if(host.indexOf("www.celloud.cn")>=0){!function(){var hm=document.createElement("script");hm.src="//hm.baidu.com/hm.js?f6b04d06932c0fc1578e79be222599f4",hm.async="async",hm.defer="defer";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)}()}},utils.loadBaiduTongji(),utils.setDocSize(),$(window).resize(function(){utils.setDocSize()}),utils.stopBubble=function(e){e&&e.stopPropagation?e.stopPropagation():window.event.cancelBubble=!0};
var messageUtils=function(messageUtils){function bindEvents(){self.ws.onopen=function(){console.log("websocket connect is opened : "+new Date),clearTimeouts();for(var listener in self.openListeners)$.isFunction(self.openListeners[listener])&&self.openListeners[listener]()},self.ws.onmessage=function(e){var message=JSON.parse(e.data),channels=self.messageChannels[message.channel]||[];if(channels.length<=0)return void console.log("no listener for channel: "+message.channel);for(var channel in channels)$.isFunction(channels[channel])&&channels[channel](message.message)},self.ws.onclose=function(){console.log("websocket connect is closed : "+new Date);for(var listener in self.closeListeners)$.isFunction(self.closeListeners[listener])&&self.closeListeners[listener]()},self.ws.onerror=function(event){console.log("websocket error : "+new Date),console.log(event),console.log(event.data)}}function clearTimeouts(){for(var t in self.timeouts)clearTimeout(self.timeouts[t]);self.timeouts=[]}var self=messageUtils||{};self.messageChannels={listenerNumbers:0},self.openListeners={listenerNumbers:0},self.closeListeners={listenerNumbers:0},self.timeouts={},self.addOpenListener=function(listener){self.openListeners[self.openListeners.listenerNumbers]=listener,self.openListeners.listenerNumbers=self.openListeners.listenerNumbers+1},self.addCloseListener=function(listener){self.closeListeners[self.closeListeners.listenerNumbers]=listener,self.closeListeners.listenerNumbers=self.closeListeners.listenerNumbers+1},self.subscribe=function(channel,callback){var channels=self.messageChannels[channel]||{listenerNumbers:0};$.isFunction(callback)&&(channels[channels.listenerNumbers]=callback,channels.listenerNumbers=channels.listenerNumbers+1,self.messageChannels[channel]=channels)};var openWebSocket=function(){var contextPath=window.CONTEXT_PATH||window.contextPath||"",protocol="https:"==window.location.protocol?"wss://":"ws://",hostname=window.location.hostname,port=window.location.port?":"+window.location.port:"",wsUrl=protocol+hostname+port+contextPath+"/websocket/message",ws=null;return ws="WebSocket"in window?new WebSocket(wsUrl):window.MozWebSocket?new MozWebSocket(wsUrl):new SockJS(contextPath+"/sockjs/message")};self.ws=openWebSocket(),bindEvents();var createNotification=function(title,message,options){var defaultOptions={icon:CONTEXT_PATH+"/images/icon/portrait.png"};return options=$.extend({},defaultOptions,options),options.body=message,new Notification(title,options)};return self.notify=function(title,message,options,events){if(!("Notification"in window))return void console.log("This browser does not support desktop notification");var notification=null;if("granted"===Notification.permission?notification=createNotification(title,message,options):"default"===Notification.permission&&Notification.requestPermission(function(permission){"granted"===permission&&(notification=createNotification(title,message,options))}),null!=notification){var defaultEvents={onclick:function(){notification.close()}};events=$.extend({},defaultEvents,events),$.isFunction(events.onclick)&&(notification.onclick=events.onclick)}},self}(messageUtils);messageUtils.addOpenListener(function(){}),messageUtils.addCloseListener(function(){}),messageUtils.subscribe("userMessage",function(data){console.log("消息来了!")});
!function($){var defaults={delay:3e3},messages=[],showNext=function(){$("#alerts").children().length<5&&messages.length>0&&show(messages.shift())},show=function(message){message.msg=message.msg||"";var $alert=$('<div class="alert message-alert alert-dismissible fade in" role="alert"><button type="button" data-dismiss="alert" class="close"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><span>'+message.msg+"</span></div>");$alert.addClass("alert-"+message.type),$alert.on("closed.bs.alert",function(){close($alert)}),$("#alerts").append($alert),setTimeout(function(){close($alert)},message.delay||defaults.delay)},close=function($alert){$alert.remove(),showNext()},push=function(msg,type,delay){messages.push({msg:msg,type:type,delay:delay}),showNext()};$.extend({success:function(msg,delay){push(msg,"success",delay)},info:function(msg,delay){push(msg,"info",delay)},warn:function(msg,delay){push(msg,"warning",delay)},danger:function(msg,delay){push(msg,"danger",delay)},alert:function(msg,delay){push(msg,"success",delay)}})}(jQuery);
!function($){var show=function(type,title,message,callback){$("#confirm-modal-div").html()?$("#confirm-modal-div").html(""):$("BODY").append('<div id="confirm-modal-div"></div>');var $alert=$('<div id="confirm-modal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" role="alert"></div>');$alert.addClass(type+"-modal");var $dialog=$('<div class="modal-dialog modal-sm"></div>'),$content=$('<div class="modal-content"></div>'),$header=$('<div class="modal-header"><button type="button" class="close" aria-label="Close" id="close-confirm"><span aria-hidden="true"><i class="fa fa-times-circle"></i></span></button><h4 class="modal-title">'+title+"</h4></div>"),$body=$('<div class="modal-body"></div>'),$h5=$("<h5></h5>"),$footer=$('<div class="modal-footer"><button type="reset" class="btn btn-cancel -low pull-left" data-dismiss="modal" id="confirm-cancle">取消</button><button type="submit" class="btn -low pull-right" id="confirm-ok">确定</button></div>');switch($h5.append($('<i class="fa fa-exclamation-circle" aria-hidden="true"></i>')),$h5.append($("<span>"+message+"</span>")),$body.append($h5),$content.append($header),$content.append($body),type){case"confirm":$content.append($footer),$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert),$("#confirm-ok").click(function(){hide(),callback()}),$("#confirm-cancle").click(function(){hide()});break;case"tips":$dialog.append($content),$alert.append($dialog),$alert.modal("show"),$("#confirm-modal-div").append($alert)}$("#close-confirm").click(function(){hide()})},hide=function(){$("#confirm-modal").modal("hide")},confirm=function(message,title,callback){null==title&&(title="确认框"),show("confirm",title,message,function(result){callback&&callback(result)})},tips=function(message,title){null==title&&(title="提示框"),show("tips",title,message,null)};$.extend({confirm:function(message,title,callback){confirm(message,title,callback)},tips:function(message,title){tips(message,title)}})}(jQuery);
!function(){window.celloudApp=angular.module("celloudApp",["ngRoute","ngResource","ngSanitize"])}();
!function(){celloudApp.directive("diHref",["$location","$route",function($location,$route){return function(scope,element,attrs){scope.$watch("diHref",function(){attrs.diHref&&(element.attr("href",attrs.diHref),element.bind("click",function(event){scope.$apply(function(){$location.path()==attrs.diHref.substr(attrs.diHref.indexOf("#/")+1)&&$route.reload()})}))})}}])}();
!function(){celloudApp.directive("pagination",function(){return{restrict:"E",replace:!0,scope:{page:"=",change:"&"},templateUrl:"pages/partial/_partial_pagination_template.jsp",controller:function($scope){$scope.pageArray=function(totalPage){var p=[];for(i=1;i<=totalPage;i++)p[i-1]=i;return p}}}})}();
!function(){celloudApp.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"pages/client/overview.jsp"}).when("/base",{templateUrl:"pages/client/base.jsp",controller:"clientBaseInfo"}).when("/pay",{templateUrl:"pages/client/pay.jsp",controller:"toRecharge"}).otherwise({redirectTo:"/"})})}();
!function(){window.sessionTimeoutFlag=!1,window.celloudApp.factory("sessionTimeout",["$q",function($q){return{response:function(response){var sessionstatus=response.headers().sessionstatus;return"timeout"!=sessionstatus||window.sessionTimeoutFlag||(window.sessionTimeoutFlag=!0,alert("登录超时，请重新登录！"),window.location.href="logout"),response}}}]),window.celloudApp.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache",$httpProvider.interceptors.push("sessionTimeout")}])}();
!function(){celloudApp.service("clientBaseService",function($q,$http,$resource){this.getUserInfo=function(){return $http({method:"POST",url:"user/info",params:{}})},this.updateUserInfo=function(user){return $http({method:"POST",url:"user/updateInfo",params:{province:user.province,city:user.city,district:user.district,cellphone:user.cellphone,zipCode:user.zipCode,address:user.address,truename:user.truename,age:user.age,sex:user.sex}})}})}();
!function(){celloudApp.service("expenseService",function($http){this.pageQueryConsume=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"expense/toRunExpenseList",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryRecharge=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"pay/recharge/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.pageQueryInvoice=function(currentPage,pageSize){return pageSize=pageSize||10,$http({method:"POST",url:"invoice/list",data:$.param({currentPage:currentPage,pageSize:pageSize}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.getInvoiceById=function(invoiceId){return $http({method:"POST",url:"invoice/detail",data:$.param({id:invoiceId}),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.apply=function(params){return $http({method:"POST",url:"invoice/apply",data:$.param(params),headers:{"Content-Type":"application/x-www-form-urlencoded"}})},this.toRecharge=function(){return $http({method:"POST",url:"pay/recharge",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"}})}})}();
!function(){celloudApp.controller("clientBaseInfo",function($scope,$location,clientBaseService){clientBaseService.getUserInfo().success(function(data){$scope.user=data,$scope.province_bak=data.province,$scope.city_bak=data.city,$scope.district_bak=data.district,_init_area($scope.province_bak,$scope.city_bak,$scope.district_bak)}),$scope.updateUserInfo=function(){$scope.user.province=$("#s_province").val(),$scope.user.city=$("#s_city").val(),$scope.user.district=$("#s_county").val(),clientBaseService.updateUserInfo($scope.user).success(function(data){$.alert(data.message)}).error(function(data){$.alert(data.message)})},$scope.updateToPay=function(){clientBaseService.updateUserInfo($scope.user).success(function(data){$.alert(data.message),$location.path("/pay")}).error(function(data){$.alert(data.message)})}}),celloudApp.controller("toRecharge",function($scope,$location,expenseService){expenseService.toRecharge().success(function(data){$scope.balance=data}),$scope.tab="pay_tab_alipay",$scope.pay_type="online",$scope.rechargeForm={money:10},$scope.checkMoney=function(){var money=$scope.rechargeForm.money;return $.isNumeric(money)?1*money<10&&1*money!=.01?($scope.moneyError="充值金额要大于10元哦！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):1*money>1e4?($scope.moneyError="大于10000元的充值金额，请使用公司转账方式充值！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):money!=parseInt(money)&&.01!=money?($scope.moneyError="请输入整数金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1):$.isNumeric(money)?($scope.checkFlag=!1,$scope.checkSubmit=!1,!0):void 0:($scope.moneyError="请正确输入充值金额！",$scope.checkFlag=!0,$scope.checkSubmit=!0,!1)},$scope.sumbitRecharge=function(){var payWay=$("#alipay").checked?"alipay":"transfer",action=CONTEXT_PATH+"/pay/recharge/"+payWay;alert(action),$("#rechargeForm").attr("action",action),$.tips("请在新打开的页面完成支付操作！")}})}();